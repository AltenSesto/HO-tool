(this["webpackJsonphazard-ontology-front-end"]=this["webpackJsonphazard-ontology-front-end"]||[]).push([[0],{115:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(15),o=n.n(i),l=n(6),c=n(74),s=(n(99),n(195)),u=n(146),d=n(196),m=n(197),p=n(188),h=n(200),b=n(9),f=n(18),E=n(16),y=n(21),v=n(22),O=n(23),g=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(y.a)(this,Object(v.a)(t).call(this,e))).state={},n}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentDidCatch",value:function(e){this.setState({error:e})}},{key:"render",value:function(){return this.state.error?r.a.createElement("h1",null,"ERROR: "+this.state.error.message):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{error:e}}}]),t}(a.Component),j=n(149),C=n(151);function S(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return{type:"SHOW_CONFIRMATION_DIALOG",payload:{contentText:e,onYes:t,onNo:n}}}function k(e){return S("You have unsaved changes that will be lost. Continue ?",e)}function z(e,t){return{type:e,payload:t,unsavedChanges:!0}}function D(e){return z("UPDATE_HAZARD",e)}function A(e){return z("DELETE_HAZARD",e)}function x(e){return z("UPDATE_SUBSYSTEM",e)}function N(e){return z("DELETE_SYSTEM_OBJECT",e)}function w(){return{type:"RESET_MODEL"}}function T(e,t){return z("ADD_POSSIBLE_HARM",{mishapVictim:e,harm:t})}function _(e,t,n,a){var r=z("REMOVE_POSSIBLE_HARM",{mishapVictim:e,harm:t});if(1===e.possibleHarms.length){var i=n.filter((function(t){return t.mishapVictim.id===e.id}));if(i.length>0)return void a(S("This mishap victim has hazard(s) associated with it. If you delete the only possible harm it will no longer be a mishap victim and all it's hazards will be deleted. Continue?",(function(){a(r),i.forEach((function(e){return a(A(e))}))})))}a(r)}var I={resetSystemModel:w,setSystemModel:function(e){return{type:"LOAD_MODEL",payload:e}},confirmDiscardModel:k},M=Object(b.b)((function(e){return{hasUnsavedChanges:e.unsavedChanges}}),I),R=Object(u.a)((function(){return{inlineBlock:{display:"inline-block"},hidden:{display:"none"}}})),H=M((function(e){var t=R(),n=Object(a.useRef)(),i=Object(a.useRef)(),o=function(){i.current&&i.current.click()},l=function(e){var t="Error reading a file";throw e.target&&e.target.error&&(t=e.target.error.message),new Error(t)},c=function(t){if(!t.target)throw new Error("Error reading a file");var a=t.target.result,r=JSON.parse(a);n.current&&n.current.reset(),e.resetSystemModel(),e.setSystemModel(r)};return window.FileReader&&window.FileList?r.a.createElement("form",{ref:function(e){return n.current=e},className:t.inlineBlock},r.a.createElement("input",{ref:function(e){return i.current=e},className:t.hidden,type:"file",onChange:function(e){return function(e){if(null!==e&&1===e.length){var t=e[0];if("application/json"!==t.type)throw new Error("File type not supported");var n=new FileReader;n.onload=c,n.onerror=l,n.readAsText(t,"utf-8")}}(e.target.files)},accept:".json"}),r.a.createElement(j.a,{title:"Open Project File",size:"small",color:"inherit",component:"span",onClick:function(){e.hasUnsavedChanges?e.confirmDiscardModel(o):o()}},r.a.createElement(C.a,null))):r.a.createElement("div",{title:"File API not supported",className:t.inlineBlock},r.a.createElement(j.a,{size:"small",color:"inherit",disabled:!0},r.a.createElement(C.a,null)))})),F=n(152),P=n(153);var L,V={saveChanges:function(){return{type:"SAVE_CHANGES"}}},U=Object(b.b)((function(e){return{systemModel:e.systemModel,hasUnsavedChanges:e.unsavedChanges}}),V)((function(e){return r.a.createElement(j.a,{size:"small",title:e.hasUnsavedChanges?"Download Project - You have unsaved changes":"Download Project",color:"inherit",onClick:function(){var t=e.systemModel,n=JSON.stringify(t,null,"\t"),a="".concat(t.projectName," ").concat((new Date).toISOString().replace(/:/g,"_"),".json"),r=document.createElement("a");r.setAttribute("href","data:application/json;charset=utf-8,"+encodeURIComponent(n)),r.setAttribute("download",a),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),e.saveChanges()}},r.a.createElement(F.a,{variant:"dot",color:"secondary",invisible:!e.hasUnsavedChanges},r.a.createElement(P.a,null)))})),Y=n(154),B={confirmDiscardModel:k,resetModel:w},X=Object(b.b)((function(e){return{hasUnsavedChanges:e.unsavedChanges}}),B)((function(e){return r.a.createElement(j.a,{size:"small",title:"New Project",color:"inherit",onClick:function(){e.hasUnsavedChanges?e.confirmDiscardModel(e.resetModel):e.resetModel()}},r.a.createElement(Y.a,null))})),G=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(X,null),r.a.createElement(H,null),r.a.createElement(U,null))},J=n(157),W=n(116),q=n(158),Z=n(207),K=n(159),$=n(160),Q=n(161);!function(e){e.OHI="OHI",e.OHI_1="OHI-1",e.SDF_1="SDF-1",e.SDF_2="SDF-2",e.SDF_3="SDF-3",e.SDF_4="SDF-4",e.OHI_2="OHI-2",e.OHI_3="OHI-3",e.OCH="OCH",e.OCH_1="OCH-1",e.OCH_2="OCH-2",e.OCH_3="OCH-3",e.SARE="SARE",e.SARE_1="SARE-1",e.SARE_2="SARE-2",e.SARE_3="SARE-3",e.CM="CM"}(L||(L={}));function ee(){return L.SDF_1}function te(e){switch(e){case L.SDF_1:return 1;case L.SDF_2:return 2;case L.SDF_3:return 3;case L.SDF_4:return 4;case L.OHI_2:return 5;case L.OHI_3:return 6;case L.OCH_1:return 7;default:return-1}}var ne,ae=[{id:L.OHI,label:"Identify Hazards",children:[{id:L.OHI_1,label:"Modelling",children:[{id:L.SDF_1,label:"Step 1",helpText:"Identify the <i>kind</i> and <i>role</i> objects explicitly presented in the system description."},{id:L.SDF_2,label:"Step 2",helpText:"For each <i>kind</i> object obtained in SDF-Step&nbsp;1, identify all the roles it can play, considering the system description."},{id:L.SDF_3,label:"Step 3",helpText:"For each <i>role</i> object obtained in SDF-Step&nbsp;1 and SDF-Step&nbsp;2, identify the relator that connects this role, and specify all the other roles connected by the identified relator, considering the system description and the analysts&apos; expertise."},{id:L.SDF_4,label:"Step 4",helpText:"For each <i>role</i> object obtained in SDF-Step&nbsp;1, SDF-Step&nbsp;2 and SDF-Step&nbsp;3, identify all the <i>kind</i> objects that can play the role, considering the system description."}]},{id:L.OHI_2,label:"Identify Victims",helpText:"Go through all the <i>roles</i> presented in the HO-style model and analyze if the roles are not supposed to but have the potential to encounter harms. Furthermore, the analysts continue with identifying possible harms that can affect the victims, including but not limited to, physical damages, chemical injuries, fatal illness, explosion, etc."},{id:L.OHI_3,label:"Identify Hazards",helpText:"Identify the hazardous situations that are likely to harm the identified mishap victims. Occurrence of a mishap is the manifestation of the <i>harm truthmaker</i> dispositions that characterize the <i>hazard element</i> roles in a hazardous situation. "}]},{id:L.OCH,label:"Identify Causes",children:[{id:L.OCH_1,label:"Categorize",helpText:"Categorize all the hazard descriptions into four categories, in terms of <b>Hazard</b>, <b>Initiating Condition</b>, <b>Initiating Event</b>, and/or <b>Mishap</b> based on the set of heuristic questions."},{id:L.OCH_2,label:"Expand",children:[]},{id:L.OCH_3,label:"Identify Causes",children:[]}]},{id:L.SARE,label:"Safety Requirements",children:[{id:L.SARE_1,label:"Evaluate Severity",children:[]},{id:L.SARE_2,label:"Evaluate Probability",children:[]},{id:L.SARE_3,label:"Safety Requirements",children:[]}]},{id:L.CM,label:"Control Mitigation",children:[]}],re=n(11),ie=n(205),oe=n(33),le=n(155),ce=n(156),se=Object(u.a)((function(e){return{typography:{padding:e.appSpacing.standard,maxWidth:"320px"}}})),ue=function(e){var t=se(),n=Object(a.useState)(null),i=Object(re.a)(n,2),o=i[0],l=i[1],c=Object(a.useState)(!1),s=Object(re.a)(c,2),u=s[0],d=s[1];return Object(a.useEffect)((function(){d(e.open)}),[e.open]),r.a.createElement(r.a.Fragment,null,r.a.createElement(j.a,{ref:function(e){return l(e)},edge:"end",onClick:function(){return d(!0)}},e.highlighted?r.a.createElement(le.a,null):r.a.createElement(ce.a,null)),r.a.createElement(ie.a,{open:u,anchorEl:o,onClose:function(){d(!1)},anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"}},r.a.createElement(oe.a,{variant:"body2",className:t.typography,dangerouslySetInnerHTML:{__html:e.htmlContent}})))},de=Object(u.a)((function(e){return{label:{paddingLeft:e.spacing(1)},phase:{paddingLeft:e.spacing(4)},step:{paddingLeft:e.spacing(8)},bold:{fontWeight:"bold"}}})),me={setCurentStep:function(e){return{type:"UPDATE_FLOW_STEP",payload:e}}},pe=Object(b.b)((function(e){return{currentStep:e.systemModel.currentStep,lastCompletedStep:e.systemModel.lastCompletedStep}}),me)((function(e){var t=de();return r.a.createElement(J.a,{dense:!0},ae.map((function(n){return r.a.createElement(r.a.Fragment,{key:n.id},r.a.createElement(W.a,null,r.a.createElement(q.a,null,r.a.createElement(Z.a,{label:n.id,variant:"outlined",color:"primary"})),r.a.createElement(K.a,{primary:n.label,disableTypography:!0,className:"".concat(t.label," ").concat(t.bold)})),function n(a,i){return r.a.createElement(J.a,{disablePadding:!0,dense:!0},a.map((function(a){var o=te(a.id),l=-1!==o,c=l&&a.id===e.currentStep,s=!l||o<=te(e.lastCompletedStep)+1,u=a.id===e.currentStep&&a.id===e.lastCompletedStep;return r.a.createElement(r.a.Fragment,{key:a.id},r.a.createElement(W.a,{className:i,button:!0,disabled:!s,onClick:function(){return l&&e.setCurentStep(a.id)}},r.a.createElement(q.a,null,r.a.createElement(Z.a,{size:"small",disabled:!s,label:a.id,color:c?"secondary":"primary",variant:l?"default":"outlined"})),r.a.createElement(K.a,{primary:a.label,className:t.label}),a.helpText?r.a.createElement($.a,null,r.a.createElement(ue,{open:u,highlighted:c,htmlContent:a.helpText})):""),a.children?n(a.children,t.step):"")})))}(n.children,t.phase),r.a.createElement(Q.a,null))})))})),he=n(8),be=n(201),fe=n(164),Ee=n(168),ye=n(162),ve=n(163),Oe=Object(u.a)((function(e){return{root:{position:"fixed",bottom:e.appSpacing.standard,right:e.appSpacing.standard,zIndex:e.zIndex.graphHelp,minWidth:200}}})),ge=function(e){var t=Oe();return r.a.createElement(ye.a,{className:t.root},r.a.createElement(ve.a,null,e.children))},je=Object(b.b)((function(e){return{hazards:e.systemModel.hazards}}),(function(e){return{harmAdded:function(t,n){return e(T(t,n))},harmDeleted:function(t,n,a){return _(t,n,a,e)}}}))((function(e){var t=r.a.createElement(oe.a,null,"Click on a role to see or add possible harms"),n=function(t,n,a){return r.a.createElement(W.a,{key:n},r.a.createElement(K.a,{primary:t}),r.a.createElement($.a,null,r.a.createElement(j.a,{edge:"end",title:"Delete",onClick:function(){return function(t,n){e.harmDeleted(t,n,e.hazards)}(a,t)}},r.a.createElement(fe.a,null))))},a=function(t){return r.a.createElement(W.a,{key:"-1"},r.a.createElement("form",{action:"#",onSubmit:function(n){return function(t,n){var a=t.currentTarget,r=a.elements.namedItem("harm").value;a.reset(),t.preventDefault(),e.harmAdded(n,r)}(n,t)}},r.a.createElement(be.a,{required:!0,autoFocus:!0,margin:"dense",type:"text",name:"harm",fullWidth:!0,placeholder:"Add New",autoComplete:"off"}),r.a.createElement($.a,null,r.a.createElement(j.a,{type:"submit",edge:"end",title:"Add"},r.a.createElement(Ee.a,null)))))};return r.a.createElement(ge,null,function(){return e.selectedRole?r.a.createElement(r.a.Fragment,null,r.a.createElement(oe.a,{variant:"body2",color:"textSecondary"},"Mishap Victim"),r.a.createElement(oe.a,{variant:"h6",gutterBottom:!0},e.selectedRole.name),r.a.createElement(oe.a,{variant:"body2",color:"textSecondary"},"Possible Harms"),r.a.createElement(J.a,{dense:!0},(i=e.selectedRole).possibleHarms.sort((function(e,t){return e.localeCompare(t)})).map((function(e,t){return n(e,t,i)})).concat(a(i)))):t;var i}())})),Ce=n(59),Se=n.n(Ce),ke=n(80),ze=n.n(ke),De=n(81),Ae=n.n(De),xe=n(82),Ne=n.n(xe),we=n(204);!function(e){e.kind="kind",e.role="role",e.relator="relator"}(ne||(ne={}));var Te=[{selector:"node",style:{"background-color":"#fff","border-width":1,"border-style":"solid","border-color":"#000",shape:"round-rectangle",label:"data(label)",height:"label",width:"label","text-valign":"center","text-halign":"center","text-wrap":"wrap","text-max-width":"130px","font-size":11,padding:"5px"}},{selector:"edge",style:{width:2,"curve-style":"taxi",label:"data(label)","font-size":11}},{selector:".subsystem",style:{shape:"rectangle","text-valign":"top","text-max-width":"300px"}},{selector:".".concat(ne.kind.toString()),style:{"background-color":"#8282ff",color:"#fff"}},{selector:".".concat(ne.role.toString()),style:{"background-color":"#818181",color:"#fff"}},{selector:".".concat(ne.relator.toString()),style:{"background-color":"#fff",color:"#000"}},{selector:".arrow-edge",style:{"target-arrow-shape":"chevron"}},{selector:".faded",style:{opacity:.6}},{selector:".mishap-victim",style:{"background-color":"#ff0",color:"#000"}}];function _e(e){return"systemObject"in e}function Ie(e){return"subsystem"in e}var Me={animate:!1,cueEnabled:!1};function Re(e){return e.expandCollapse("get")}var He=Object(u.a)((function(e){return{root:{position:"fixed",overflow:"auto",top:e.mixins.toolbar.minHeight,right:0,bottom:0,left:e.appSpacing.drawerWidth}}})),Fe=function(e){var t=He();return r.a.createElement("div",{className:t.root,ref:function(t){t&&e.size&&e.size(t.scrollHeight,t.scrollWidth)}},e.children)};Se.a.use(Ne.a),Ae()(Se.a);var Pe=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(y.a)(this,Object(v.a)(t).call(this,e))).containerSize={height:0,width:0},n.initCytoscape=n.initCytoscape.bind(Object(he.a)(n)),n.addEventListeners=n.addEventListeners.bind(Object(he.a)(n)),n.resizeCanvas=n.resizeCanvas.bind(Object(he.a)(n)),n.handleNodeMoved=n.handleNodeMoved.bind(Object(he.a)(n)),n.setInitialCanvasSize=n.setInitialCanvasSize.bind(Object(he.a)(n)),n.state={cy:null,collapseApi:null,maxX:n.containerSize.width,maxY:n.containerSize.height},n}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.state.cy?this.props.elements:[],t={width:this.state.maxX,height:this.state.maxY,zIndex:this.props.theme.zIndex.graph,cursor:this.props.cursorStyle};return r.a.createElement(Fe,{size:this.setInitialCanvasSize},r.a.createElement(ze.a,{elements:e,style:t,stylesheet:Te,userZoomingEnabled:!1,userPanningEnabled:!1,cy:this.initCytoscape}))}},{key:"componentDidMount",value:function(){this.setState(Object(l.a)({},this.state,{},{maxX:this.containerSize.width,maxY:this.containerSize.height}))}},{key:"setInitialCanvasSize",value:function(e,t){this.containerSize={height:e,width:t}}},{key:"resizeCanvas",value:function(){if(this.state.cy){var e=this.state.cy.nodes().renderedBoundingBox({}),t=Math.max(e.y2,this.state.maxY),n=Math.max(e.x2,this.state.maxX);t===this.state.maxY&&n===this.state.maxX||this.setState(Object(l.a)({},this.state,{},{maxX:n,maxY:t}))}}},{key:"handleNodeMoved",value:function(e){var t,n,a=e.target.element(),r=a.position();(r.x<0||r.y<0)&&a.position(Object(l.a)({},r,{},{x:Math.max(r.x,0),y:Math.max(r.y,0)})),null===(t=(n=this.props).nodeMoved)||void 0===t||t.call(n,e)}},{key:"addEventListeners",value:function(e){var t=e.target.element();if(t.isNode()){t.on("dragfree",this.handleNodeMoved);var n=t.data();this.state.collapseApi&&Ie(n)&&n.subsystem.isCollapsed&&this.state.collapseApi.collapse(t)}t.on("mouseover",this.props.mouseEnteredNode),t.on("mouseout",this.props.mouseLeftNode),t.on("click",this.props.nodeClicked)}},{key:"initCytoscape",value:function(e){var t=this;if(this.props.cy&&this.props.cy(e),!this.state.cy){e.zoom(1.1),e.on("add",this.addEventListeners),e.on("click",(function(e){return t.props.graphClicked&&t.props.graphClicked(e)})),e.on("render",this.resizeCanvas);var n=null;this.props.useCollapseApi&&(!function(e){e.expandCollapse(Me)}(e),n=Re(e)),this.setState(Object(l.a)({},this.state,{},{cy:e,collapseApi:n}))}}}]),t}(r.a.Component),Le=Object(we.a)(Pe);function Ve(e){return"type"in e}function Ue(e){return!("source"in e)&&!("type"in e)}var Ye=function(){function e(){Object(f.a)(this,e)}return Object(E.a)(e,[{key:"mapSystemDescription",value:function(e){return this.mapSystemDescriptionEntities(this.getAllNodes(e).concat(e.systemObjectConnections))}},{key:"mapSystemDescriptionEntities",value:function(e){var t=this;return e.map((function(e){if(Ve(e))return t.mapSystemObject(e);if("source"in e)return t.mapConnection(e);if(Ue(e))return t.mapSubsystem(e);throw new Error("Unknown entity type")}))}},{key:"getAllNodes",value:function(e){return e.kinds.concat(e.relators).concat(e.roles).concat(e.subsystems)}},{key:"hookSystemObject",value:function(e){return e}},{key:"hookConnection",value:function(e){return e}},{key:"hookSubsystem",value:function(e){return e}},{key:"mapSystemObject",value:function(e){return this.hookSystemObject({group:"nodes",data:{id:e.id,label:"<<".concat(e.type.toString(),">>\n").concat(e.name),systemObject:e,parent:e.parent},position:{x:e.posX,y:e.posY},classes:[e.type.toString()]})}},{key:"mapConnection",value:function(e){return this.hookConnection({group:"edges",data:{id:e.id,label:e.label?e.label:"",source:e.source,target:e.target,connection:e},pannable:!0,classes:e.isOriented?["arrow-edge"]:[]})}},{key:"mapSubsystem",value:function(e){return this.hookSubsystem({group:"nodes",data:{id:e.id,label:e.name,subsystem:e},position:{x:e.posX,y:e.posY},classes:["subsystem"]})}}]),e}();function Be(e){return e.type===ne.role}function Xe(e){return Be(e)&&e.possibleHarms.length>0}var Ge=function(e){function t(){return Object(f.a)(this,t),Object(y.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(O.a)(t,e),Object(E.a)(t,[{key:"hookSystemObject",value:function(e){return Be(e.data.systemObject)?Xe(e.data.systemObject)&&(e.classes=["mishap-victim"]):e.classes=[e.data.systemObject.type.toString(),"faded"],e.grabbable=!1,e}},{key:"hookConnection",value:function(e){var t=["faded"];return e.data.connection.isOriented&&t.push("arrow-edge"),e.classes=t,e}},{key:"hookSubsystem",value:function(e){return e.grabbable=!1,e}}]),t}(Ye),Je=Object(b.b)((function(e){return{systemDescription:e.systemModel}}))(function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(y.a)(this,Object(v.a)(t).call(this,e))).getRoleFromEvent=n.getRoleFromEvent.bind(Object(he.a)(n)),n.mouseEntered=n.mouseEntered.bind(Object(he.a)(n)),n.mouseLeft=n.mouseLeft.bind(Object(he.a)(n)),n.selectRole=n.selectRole.bind(Object(he.a)(n)),n.clearRoleSelection=n.clearRoleSelection.bind(Object(he.a)(n)),n.state={selectedRoleId:"",isMouseOverRole:!1},n}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this,t=(new Ge).mapSystemDescription(this.props.systemDescription);return r.a.createElement(r.a.Fragment,null,r.a.createElement(Le,{elements:t,cursorStyle:this.state.isMouseOverRole?"pointer":"default",graphClicked:this.clearRoleSelection,mouseEnteredNode:this.mouseEntered,mouseLeftNode:this.mouseLeft,nodeClicked:this.selectRole}),r.a.createElement(je,{selectedRole:this.props.systemDescription.roles.find((function(t){return t.id===e.state.selectedRoleId}))}))}},{key:"getRoleFromEvent",value:function(e){var t=e.target.element().data();if(_e(t)&&Be(t.systemObject))return t.systemObject}},{key:"mouseEntered",value:function(e){this.getRoleFromEvent(e)&&this.setState(Object(l.a)({},this.state,{},{isMouseOverRole:!0}))}},{key:"mouseLeft",value:function(e){this.getRoleFromEvent(e)&&this.setState(Object(l.a)({},this.state,{},{isMouseOverRole:!1}))}},{key:"selectRole",value:function(e){var t=this.getRoleFromEvent(e);t&&(e.preventDefault(),this.setState(Object(l.a)({},this.state,{},{selectedRoleId:t.id})))}},{key:"clearRoleSelection",value:function(e){e.isDefaultPrevented()||this.setState(Object(l.a)({},this.state,{},{selectedRoleId:""}))}}]),t}(r.a.Component)),We=n(178),qe=n(179),Ze=n(173),Ke=n(174),$e=n(175),Qe=n(169),et=n(170),tt=n(176),nt=Object(b.b)((function(e){return{hazards:e.systemModel.hazards}}),(function(e){return{harmAdded:function(t,n){return e(T(t,n))},harmDeleted:function(t,n,a){return _(t,n,a,e)}}})),at=Object(u.a)((function(e){return{chip:{marginRight:e.spacing(1)}}})),rt=nt((function(e){var t=at();return r.a.createElement(Qe.a,null,r.a.createElement(et.a,{component:"th",scope:"row"},e.role.name),r.a.createElement(et.a,{align:"left"},e.role.possibleHarms.sort((function(e,t){return e.localeCompare(t)})).map((function(n,a){return r.a.createElement(Z.a,{className:t.chip,key:a,label:n,variant:"outlined",onDelete:function(){return function(t){e.harmDeleted(e.role,t,e.hazards)}(n)}})}))),r.a.createElement(et.a,{align:"right"},r.a.createElement("form",{action:"#",onSubmit:function(t){var n=t.currentTarget,a=n.elements.namedItem("harm").value;n.reset(),t.preventDefault(),e.harmAdded(e.role,a)}},r.a.createElement(be.a,{required:!0,autoFocus:!0,margin:"dense",type:"text",name:"harm",placeholder:"Add Harm",autoComplete:"off"}),r.a.createElement(j.a,{size:"small",type:"submit",edge:"end",title:"Add"},r.a.createElement(Ee.a,null)))))})),it=n(167),ot=n(203),lt=n(199),ct=n(171),st=Object(u.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120}}})),ut=function(e){var t=st();return r.a.createElement(Qe.a,null,r.a.createElement(et.a,null,r.a.createElement(it.a,{className:t.formControl},r.a.createElement(ot.a,{id:"label-select-role"},"Select role"),r.a.createElement(lt.a,{labelId:"label-select-role",onChange:function(t){var n=t.target.value;e.roleSelected(e.roles.find((function(e){return e.id===n})))},value:""},e.roles.sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(e){return r.a.createElement(ct.a,{key:e.id,value:e.id},e.name)}))))),r.a.createElement(et.a,{colSpan:2}))},dt=n(172),mt=Object(u.a)((function(e){return{button:{marginLeft:e.appSpacing.standard,marginTop:e.appSpacing.standard,marginBottom:e.appSpacing.fabOverlap}}})),pt=function(e){var t=mt();return r.a.createElement(dt.a,{className:t.button,variant:"contained",color:"primary",onClick:e.onClick,disabled:e.disabled},e.children)},ht=Object(b.b)((function(e){return{roles:e.systemModel.roles}}))((function(e){var t=Object(a.useState)([]),n=Object(re.a)(t,2),i=n[0],o=n[1],l=Object(a.useState)(!1),c=Object(re.a)(l,2),s=c[0],u=c[1],d=e.roles.filter((function(e){return Xe(e)&&!i.some((function(t){return t===e.id}))})).sort((function(e,t){return e.name.localeCompare(t.name)})),m=e.roles.filter((function(e){return i.some((function(t){return t===e.id}))})),p=d.concat(m),h=e.roles.filter((function(e){return!p.some((function(t){return t.id===e.id}))}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ze.a,null,r.a.createElement(Ke.a,{size:"small"},r.a.createElement($e.a,null,r.a.createElement(Qe.a,null,r.a.createElement(et.a,null,"Mishap Victims"),r.a.createElement(et.a,{align:"left"},"Possible Harms"),r.a.createElement(et.a,{align:"right"},"\xa0"))),r.a.createElement(tt.a,null,s||0!==p.length?p.map((function(e){return r.a.createElement(rt,{key:e.id,role:e})})):r.a.createElement(Qe.a,null,r.a.createElement(et.a,{align:"center",colSpan:3},"No mishap victims identified")),s?r.a.createElement(ut,{roles:h,roleSelected:function(e){o(i.concat(e.id)),u(!1)}}):void 0))),r.a.createElement(pt,{onClick:function(){!s&&u(!0)},disabled:0===h.length},0===h.length?"All mishap victims have been identified":"Add new mishap victim"))})),bt=n(177),ft=Object(u.a)((function(e){return{fab:{position:"fixed",marginBottom:e.spacing(2),marginLeft:e.spacing(2),bottom:0,zIndex:e.zIndex.graphAction}}})),Et=function(e){var t=ft();return r.a.createElement(bt.a,{variant:"extended",className:t.fab,size:"medium",onClick:e.onClick},e.children)},yt=function(){var e=Object(a.useState)(!0),t=Object(re.a)(e,2),n=t[0],i=t[1];return n?r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,{onClick:function(){return i(!1)}},r.a.createElement(We.a,null),"Table View"),r.a.createElement(Je,null)):r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,{onClick:function(){return i(!0)}},r.a.createElement(qe.a,null),"Graph View"),r.a.createElement(ht,null))},vt=n(186);function Ot(e){return"".concat(e,"-").concat((new Date).getTime())}var gt=Object(u.a)((function(e){return{root:{position:"fixed",bottom:e.appSpacing.standard,zIndex:e.zIndex.graphAction},fab:{marginLeft:e.appSpacing.standard}}})),jt=function(e){var t=gt();return r.a.createElement("div",{className:t.root},e.buttons.map((function(e,n){return r.a.createElement(bt.a,{key:n,className:t.fab,size:"small",color:"primary",variant:"extended",onClick:e.action},e.icon,e.text)})))},Ct=n(117),St=n(180),kt=n(181),zt=n(182),Dt=Object(u.a)((function(e){return{formControl:{marginTop:e.spacing(1)},selectEmpty:{marginTop:e.spacing(2)}}})),At=function(e){var t,n=Object(a.useState)(e.entity),i=Object(re.a)(n,2),o=i[0],c=i[1],s=Dt();if(Ve(o)){var u=e.subsystemsAvailable.sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(e){return r.a.createElement(ct.a,{key:e.id,value:e.id},e.name)})),d="";o.parent&&(d=o.parent);t=r.a.createElement(it.a,{className:s.formControl},r.a.createElement(ot.a,{shrink:!0,id:"label-subsystem"},"Subsystem"),r.a.createElement(lt.a,{labelId:"label-subsystem",value:d,onChange:function(e){var t;""!==e.target.value&&(t=e.target.value),c(Object(l.a)({},o,{},{parent:t}))},displayEmpty:!0,disabled:0===u.length,className:s.selectEmpty},r.a.createElement(ct.a,{key:"-1",value:""},r.a.createElement("em",null,"None")),u))}return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ct.a,{open:!!e.entity}),r.a.createElement(St.a,{open:!!e.entity},r.a.createElement("form",{autoComplete:"off",onSubmit:function(t){e.entityUpdated(o),t.preventDefault()},onReset:function(){return e.editCancelled()}},r.a.createElement(kt.a,null,r.a.createElement(be.a,{required:!0,autoFocus:!0,margin:"dense",id:"name",label:"Name",type:"text",fullWidth:!0,defaultValue:o.name,onChange:function(e){c(Object(l.a)({},o,{},{name:e.target.value}))}}),t),r.a.createElement(zt.a,null,r.a.createElement(dt.a,{type:"submit",variant:"contained",color:"primary"},"OK"),r.a.createElement(dt.a,{type:"reset",color:"primary"},"Cancel")))))},xt=Object(u.a)((function(e){return{popper:{zIndex:e.zIndex.nodeAction}}})),Nt=function(e){var t=Object(a.createRef)(),n=Object(a.useState)(null),i=Object(re.a)(n,2),o=i[0],l=i[1],c=Object(a.useCallback)((function(){o&&(e.element.off("position",void 0,o.scheduleUpdate),e.element.off("mouseup",void 0,c),o.destroy(),l(null))}),[o,e.element]);Object(a.useEffect)((function(){if(t.current&&!o){var n=e.element.popper({content:function(){return t.current},popper:{placement:e.placement?e.placement:"top"}});e.element.on("position",n.scheduleUpdate),e.element.on("mouseup",c),l(n)}return c}),[t,o,e.element,e.placement,c]);var s=xt();return r.a.createElement("div",{ref:t,className:s.popper},e.children)},wt=function(e){return r.a.createElement(j.a,{size:"small",title:"Delete",onClick:e.click},r.a.createElement(fe.a,null))};function Tt(e){var t=e.data();if(_e(t))return t.systemObject}function _t(e){var t=Tt(e);if(t&&Be(t))return t}function It(e){var t=e.data();if(function(e){return"connection"in e}(t))return t.connection}function Mt(e,t){return t.hazardElementEnvObj.id===e.id||t.mishapVictimEnvObj.id===e.id}function Rt(e,t){return t.mishapVictim.id===e.id||t.hazardElement.id===e.id}function Ht(e,t){return t.exposure.id===e.id}function Ft(e){switch(e.type){case ne.kind:return function(t){return Mt(e,t)};case ne.relator:return function(t){return Ht(e,t)};case ne.role:return function(t){return Rt(e,t)}}}var Pt,Lt,Vt={connectionDeleted:function(e,t){return z("DELETE_CONNECTION",{connection:e,target:t})},confirm:S},Ut=Object(b.b)((function(e){return{hazards:e.systemModel.hazards}}),Vt)((function(e){return r.a.createElement(wt,{click:function(){e.onClick();var t=Tt(e.element.target());if(t){var n=Ft(t);e.hazards.some(n)?e.confirm("This connection takes part in one or more hazards. If you delete it those hazards will be deleted as well. Continue?",(function(){return e.connectionDeleted(e.connection,t)})):e.connectionDeleted(e.connection,t)}}})})),Yt={subsystemCreated:function(e){return z("CREATE_SUBSYSTEM",e)},subsystemUpdated:x,connectionCreated:function(e){return z("CREATE_CONNECTION",e)},systemObjectRenamed:function(e){return z("RENAME_SYSTEM_OBJECT",e)},systemObjectCreated:function(e){return z("CREATE_SYSTEM_OBJECT",e)},systemObjectUpdated:function(e){return z("UPDATE_SYSTEM_OBJECT",e)}},Bt=Object(b.b)((function(e){return{system:e.systemModel}}),Yt),Xt={x:100,y:50},Gt=Bt(function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(y.a)(this,Object(v.a)(t).call(this,e))).showNodeActions=n.showNodeActions.bind(Object(he.a)(n)),n.hideNodeActions=n.hideNodeActions.bind(Object(he.a)(n)),n.createConnection=n.createConnection.bind(Object(he.a)(n)),n.completeEditEntity=n.completeEditEntity.bind(Object(he.a)(n)),n.updateNodePosition=n.updateNodePosition.bind(Object(he.a)(n)),n.validateConnection=n.validateConnection.bind(Object(he.a)(n)),n.preventOverlap=n.preventOverlap.bind(Object(he.a)(n)),n.cancelEditEntity=n.cancelEditEntity.bind(Object(he.a)(n)),n.renderConnectionActions=n.renderConnectionActions.bind(Object(he.a)(n)),n.state={isConnectionValid:!1},n}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=(new Ye).mapSystemDescription(this.props.system),t="top";this.props.elementDisplayPopper&&this.props.elementDisplayPopper.isNode()&&(t=_e(this.props.elementDisplayPopper.data())?"top-start":"bottom-start");var n="default";this.props.nodeConnecting&&(n=this.state.isConnectionValid?"pointer":"not-allowed");var a=r.a.createElement(r.a.Fragment,null),i=this.props.elementDisplayPopper;if(i)if(i.isEdge())a=this.renderConnectionActions(i);else if(i.isNode()){var o=i.data();_e(o)?a=this.props.renderSystemObjectActions(o.systemObject,i):Ie(o)&&(a=this.props.renderSubsystemActions(o.subsystem,i))}return r.a.createElement(r.a.Fragment,null,r.a.createElement(Le,{elements:e,cursorStyle:n,graphClicked:this.props.nodeConnectingDone,nodeClicked:this.createConnection,mouseEnteredNode:this.showNodeActions,mouseLeftNode:this.hideNodeActions,nodeMoved:this.updateNodePosition,useCollapseApi:!0}),this.props.toolbarButtons,this.props.elementDisplayPopper?r.a.createElement(Nt,{element:this.props.elementDisplayPopper,placement:t},a):void 0,this.props.objectEditing?r.a.createElement(At,{entity:this.props.objectEditing,subsystemsAvailable:this.props.system.subsystems,entityUpdated:this.completeEditEntity,editCancelled:this.cancelEditEntity}):void 0)}},{key:"renderConnectionActions",value:function(e){var t=this;if(this.props.tryCreateConnection(e.source(),e.target())){var n=It(e);if(n)return r.a.createElement(Ut,{connection:n,element:e,onClick:function(){return t.props.elementDisplayPopperChanged(null)}})}return r.a.createElement(r.a.Fragment,null)}},{key:"showNodeActions",value:function(e){if(!this.props.elementDisplayPopper){var t=!1,n=e.target;n.isNode()&&(t=!!this.validateConnection(n)),this.setState(Object(l.a)({},this.state,{},{isConnectionValid:t})),this.props.elementDisplayPopperChanged(e.target)}}},{key:"hideNodeActions",value:function(){this.setState(Object(l.a)({},this.state,{},{isConnectionValid:!1})),this.props.elementDisplayPopperChanged(null)}},{key:"createConnection",value:function(e){var t=e.target;if(t.isNode()){var n=this.validateConnection(t);n&&this.props.connectionCreated(n)}this.props.nodeConnectingDone()}},{key:"validateConnection",value:function(e){return this.props.nodeConnecting&&this.props.nodeConnecting!==e&&0===this.props.nodeConnecting.edgesWith(e).length?this.props.tryCreateConnection(this.props.nodeConnecting,e):null}},{key:"updateNodePosition",value:function(e){var t=e.target,n=t.position(),a=t.data();if(_e(a)){var r=a.systemObject;if(this.props.systemObjectUpdated(Object(l.a)({},r,{},{posX:n.x,posY:n.y})),a.parent&&t.parent().length>0){var i=this.props.system.subsystems.find((function(e){return e.id===a.parent}));if(i){var o=t.parent()[0].position();this.props.subsystemUpdated(Object(l.a)({},i,{},{posX:o.x,posY:o.y}))}}}else if(Ie(a)){var c=a.subsystem;this.props.subsystemUpdated(Object(l.a)({},c,{},{posX:n.x,posY:n.y}));for(var s=0;s<t.children().length;s++){var u=t.children()[s],d=u.data();if(_e(d)){var m=d.systemObject,p=u.position();this.props.systemObjectUpdated(Object(l.a)({},m,{},{posX:p.x,posY:p.y}))}}}}},{key:"cancelEditEntity",value:function(){this.props.objectEditingDone&&this.props.objectEditingDone()}},{key:"completeEditEntity",value:function(e){var t=(new Ye).getAllNodes(this.props.system),n=t.find((function(t){return t.id===e.id}));if(n){if(Ve(e)&&Ve(n)){var a=null,r=void 0;if(!e.parent||n.parent&&n.parent===e.parent)!e.parent&&n.parent&&(a=Xt);else{var i=this.props.system.subsystems.find((function(t){return t.id===e.parent}));i&&(a={x:i.posX,y:i.posY},r=i.id)}if(a){var o=this.preventOverlap(a,t,r);e.posX=o.x,e.posY=o.y}e.name!==n.name&&this.props.systemObjectRenamed(e)}Ue(e)?this.props.subsystemUpdated(e):this.props.systemObjectUpdated(e)}else{var l,c=Xt;if(Ve(e)&&e.parent){var s=this.props.system.subsystems.find((function(t){return t.id===e.parent}));s&&(c={x:s.posX,y:s.posY},l=s.id)}var u=this.preventOverlap(c,t,l);e.posX=u.x,e.posY=u.y,Ue(e)?this.props.subsystemCreated(e):this.props.systemObjectCreated(e)}this.props.objectEditingDone&&this.props.objectEditingDone()}},{key:"preventOverlap",value:function(e,t,n){return t.every((function(t){return t.posX!==e.x&&t.posY!==e.y||t.id===n}))?e:this.preventOverlap({x:e.x+20,y:e.y+20},t)}}]),t}(r.a.Component)),Jt={systemObjectDeleted:N,confirm:S},Wt=Object(b.b)((function(e){return{hazards:e.systemModel.hazards}}),Jt)((function(e){return r.a.createElement(wt,{click:function(){e.onClick();var t=Ft(e.systemObject);e.hazards.some(t)?e.confirm("This object takes part in one or more hazards. If you delete it those hazards will be deleted as well. Continue?",(function(){return e.systemObjectDeleted(e.systemObject)})):e.systemObjectDeleted(e.systemObject)}})})),qt={subsystemDeleted:function(e){return z("DELETE_SUBSYSTEM",e)},systemObjectDeleted:N,confirm:S},Zt=Object(b.b)((function(e){return{hazards:e.systemModel.hazards}}),qt)((function(e){var t=function(t){t.forEach((function(t){return t&&e.systemObjectDeleted(t)})),e.subsystemDeleted(e.subsystem)},n=function(){var n=e.element.children().map((function(e){return Tt(e)}));n.some((function(t){if(!t)return!1;var n=Ft(t);return e.hazards.some(n)}))?e.confirm("Some of the subsystem's child objects take part in one ore more hazards. If you delete the subsystem those hazards will be removed as well. Continue?",(function(){return t(n)})):t(n)};return r.a.createElement(wt,{click:function(){e.onClick(),e.element.isChildless()?e.subsystemDeleted(e.subsystem):e.confirm("All the objects in the subsystem will be removed as well. Continue?",n)}})})),Kt=n(183),$t={confirm:S},Qt=Object(b.b)((function(e){return{hazards:e.systemModel.hazards}}),$t)((function(e){return r.a.createElement(j.a,{size:"small",title:"Edit",onClick:function(){if(Ue(e.node))e.onClick();else{var t=Ft(e.node);e.hazards.some(t)?e.confirm("This object takes part in one or more hazards. If you edit it those hazards will be affected. Continue?",e.onClick):e.onClick()}}},r.a.createElement(Kt.a,null))})),en=n(184),tn=n(185),nn={subsystemUpdated:x},an=Object(b.b)(null,nn)((function(e){return r.a.createElement(j.a,{title:e.subsystem.isCollapsed?"Expand":"Collapse",onClick:function(){var t=e.node.cy(),n=Re(t),a=!e.subsystem.isCollapsed;a?n.collapse(e.node):n.expand(e.node),t.json(t.json()),t.zoom(1.1),t.pan({x:0,y:0}),e.subsystemUpdated(Object(l.a)({},e.subsystem,{},{isCollapsed:a}))},size:"small"},e.subsystem.isCollapsed?r.a.createElement(en.a,null):r.a.createElement(tn.a,null))})),rn=Object(u.a)((function(){return{base:{position:"relative",left:"-5px"},top:{top:"-5px"},bottom:{top:"5px"}}})),on=function(e){var t=rn();return r.a.createElement("div",{className:"".concat(t.base," ").concat(t[e.placement])},e.children)},ln=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(y.a)(this,Object(v.a)(t).call(this,e))).tryCreateConnection=n.tryCreateConnection.bind(Object(he.a)(n)),n.startCreatingKind=n.startCreatingKind.bind(Object(he.a)(n)),n.startCreatingRole=n.startCreatingRole.bind(Object(he.a)(n)),n.startCreatingSubsystem=n.startCreatingSubsystem.bind(Object(he.a)(n)),n.renderSystemObjectActions=n.renderSystemObjectActions.bind(Object(he.a)(n)),n.renderSubsystemActions=n.renderSubsystemActions.bind(Object(he.a)(n)),n.state={nodeConnecting:null,objectEditing:null,elementDisplayPopper:null},n}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this,t=r.a.createElement(jt,{buttons:[{icon:r.a.createElement(Ee.a,null),text:"Kind",action:this.startCreatingKind},{icon:r.a.createElement(Ee.a,null),text:"Role",action:this.startCreatingRole},{icon:r.a.createElement(Ee.a,null),text:"Subsystem",action:this.startCreatingSubsystem}]});return r.a.createElement(Gt,{elementDisplayPopper:this.state.elementDisplayPopper,elementDisplayPopperChanged:function(t){return e.setState(Object(l.a)({},e.state,{},{elementDisplayPopper:t}))},nodeConnecting:this.state.nodeConnecting,nodeConnectingDone:function(){return e.setState(Object(l.a)({},e.state,{},{nodeConnecting:null}))},objectEditing:this.state.objectEditing,objectEditingDone:function(){return e.setState(Object(l.a)({},e.state,{},{objectEditing:null}))},toolbarButtons:t,tryCreateConnection:this.tryCreateConnection,renderSubsystemActions:this.renderSubsystemActions,renderSystemObjectActions:this.renderSystemObjectActions})}},{key:"renderSystemObjectActions",value:function(e,t){var n=this;return e.type===ne.kind?r.a.createElement(on,{placement:"top"},r.a.createElement(j.a,{size:"small",title:"Connect to containing kind",onClick:function(){return n.setState(Object(l.a)({},n.state,{},{nodeConnecting:t}))}},r.a.createElement(vt.a,null)),r.a.createElement(Qt,{node:e,onClick:function(){return n.setState(Object(l.a)({},n.state,{},{objectEditing:e,elementDisplayPopper:null}))}}),r.a.createElement(Wt,{systemObject:e,onClick:function(){return n.setState(Object(l.a)({},n.state,{},{elementDisplayPopper:null}))}})):e.type===ne.role?r.a.createElement(on,{placement:"top"},r.a.createElement(Qt,{node:e,onClick:function(){return n.setState(Object(l.a)({},n.state,{},{objectEditing:e,elementDisplayPopper:null}))}}),r.a.createElement(Wt,{systemObject:e,onClick:function(){return n.setState(Object(l.a)({},n.state,{},{elementDisplayPopper:null}))}})):r.a.createElement(r.a.Fragment,null)}},{key:"renderSubsystemActions",value:function(e,t){var n=this;return r.a.createElement(on,{placement:"bottom"},r.a.createElement(an,{node:t,subsystem:e}),r.a.createElement(Qt,{node:e,onClick:function(){return n.setState(Object(l.a)({},n.state,{},{objectEditing:e,elementDisplayPopper:null}))}}),r.a.createElement(Zt,{element:t,subsystem:e,onClick:function(){return n.setState(Object(l.a)({},n.state,{},{elementDisplayPopper:null}))}}))}},{key:"tryCreateConnection",value:function(e,t){var n=e.data(),a=t.data();return _e(n)&&_e(a)&&n.systemObject.type===ne.kind&&a.systemObject.type===ne.kind?{id:Ot("connection"),source:n.systemObject.id,target:a.systemObject.id,label:"ispartof",isOriented:!0}:null}},{key:"startCreatingKind",value:function(){if(!this.state.objectEditing){var e={id:Ot("kind"),name:"",type:ne.kind,posX:0,posY:0};this.setState(Object(l.a)({},this.state,{},{objectEditing:e}))}}},{key:"startCreatingRole",value:function(){if(!this.state.objectEditing){var e={id:Ot("role"),name:"",type:ne.role,posX:0,posY:0,possibleHarms:[]};this.setState(Object(l.a)({},this.state,{},{objectEditing:e}))}}},{key:"startCreatingSubsystem",value:function(){if(!this.state.objectEditing){var e={id:Ot("subsystem"),name:"",posX:0,posY:0,isCollapsed:!1};this.setState(Object(l.a)({},this.state,{},{objectEditing:e}))}}}]),t}(r.a.Component),cn=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(y.a)(this,Object(v.a)(t).call(this,e))).tryCreateConnection=n.tryCreateConnection.bind(Object(he.a)(n)),n.renderSystemObjectActions=n.renderSystemObjectActions.bind(Object(he.a)(n)),n.renderSubsystemActions=n.renderSubsystemActions.bind(Object(he.a)(n)),n.state={nodeConnecting:null,objectEditing:null,elementDisplayPopper:null},n}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(Gt,{elementDisplayPopper:this.state.elementDisplayPopper,elementDisplayPopperChanged:function(t){return e.setState(Object(l.a)({},e.state,{},{elementDisplayPopper:t}))},nodeConnecting:this.state.nodeConnecting,nodeConnectingDone:function(){return e.setState(Object(l.a)({},e.state,{},{nodeConnecting:null}))},tryCreateConnection:this.tryCreateConnection,renderSubsystemActions:this.renderSubsystemActions,renderSystemObjectActions:this.renderSystemObjectActions})}},{key:"renderSystemObjectActions",value:function(e,t){var n=this;return e.type!==ne.kind?r.a.createElement(r.a.Fragment,null):r.a.createElement(on,{placement:"top"},r.a.createElement(j.a,{size:"small",title:"Connect to role",onClick:function(){return n.setState(Object(l.a)({},n.state,{},{nodeConnecting:t}))}},r.a.createElement(vt.a,null)))}},{key:"renderSubsystemActions",value:function(e,t){return r.a.createElement(on,{placement:"bottom"},r.a.createElement(an,{node:t,subsystem:e}))}},{key:"tryCreateConnection",value:function(e,t){var n=e.data(),a=t.data();return _e(n)&&n.systemObject.type===ne.kind&&_e(a)&&a.systemObject.type===ne.role?{id:Ot("connection"),source:n.systemObject.id,target:a.systemObject.id,label:"play",isOriented:!0}:null}}]),t}(r.a.Component),sn=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(y.a)(this,Object(v.a)(t).call(this,e))).tryCreateConnection=n.tryCreateConnection.bind(Object(he.a)(n)),n.startCreatingRelator=n.startCreatingRelator.bind(Object(he.a)(n)),n.renderSystemObjectActions=n.renderSystemObjectActions.bind(Object(he.a)(n)),n.renderSubsystemActions=n.renderSubsystemActions.bind(Object(he.a)(n)),n.state={nodeConnecting:null,objectEditing:null,elementDisplayPopper:null},n}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this,t=r.a.createElement(jt,{buttons:[{icon:r.a.createElement(Ee.a,null),text:"Relator",action:this.startCreatingRelator}]});return r.a.createElement(Gt,{elementDisplayPopper:this.state.elementDisplayPopper,elementDisplayPopperChanged:function(t){return e.setState(Object(l.a)({},e.state,{},{elementDisplayPopper:t}))},nodeConnecting:this.state.nodeConnecting,nodeConnectingDone:function(){return e.setState(Object(l.a)({},e.state,{},{nodeConnecting:null}))},objectEditing:this.state.objectEditing,objectEditingDone:function(){return e.setState(Object(l.a)({},e.state,{},{objectEditing:null}))},toolbarButtons:t,tryCreateConnection:this.tryCreateConnection,renderSubsystemActions:this.renderSubsystemActions,renderSystemObjectActions:this.renderSystemObjectActions})}},{key:"renderSystemObjectActions",value:function(e,t){var n=this;return e.type===ne.relator?r.a.createElement(on,{placement:"top"},r.a.createElement(j.a,{size:"small",title:"Connect to role",onClick:function(){return n.setState(Object(l.a)({},n.state,{},{nodeConnecting:t}))}},r.a.createElement(vt.a,null)),r.a.createElement(Qt,{node:e,onClick:function(){return n.setState(Object(l.a)({},n.state,{},{objectEditing:e,elementDisplayPopper:null}))}}),r.a.createElement(Wt,{systemObject:e,onClick:function(){return n.setState(Object(l.a)({},n.state,{},{elementDisplayPopper:null}))}})):e.type===ne.role?r.a.createElement(on,{placement:"top"},r.a.createElement(j.a,{size:"small",title:"Connect to relator",onClick:function(){return n.setState(Object(l.a)({},n.state,{},{nodeConnecting:t}))}},r.a.createElement(vt.a,null))):r.a.createElement(r.a.Fragment,null)}},{key:"renderSubsystemActions",value:function(e,t){return r.a.createElement(on,{placement:"bottom"},r.a.createElement(an,{node:t,subsystem:e}))}},{key:"tryCreateConnection",value:function(e,t){var n=e.data(),a=t.data();if(_e(n)&&_e(a)){if(n.systemObject.type===ne.role&&a.systemObject.type===ne.relator)return{id:Ot("connection"),source:n.systemObject.id,target:a.systemObject.id,label:"",isOriented:!1};if(n.systemObject.type===ne.relator&&a.systemObject.type===ne.role)return{id:Ot("connection"),source:a.systemObject.id,target:n.systemObject.id,label:"",isOriented:!1}}return null}},{key:"startCreatingRelator",value:function(){if(!this.state.objectEditing){var e={id:Ot(ne.relator.toString()),name:"",type:ne.relator,posX:0,posY:0};this.setState(Object(l.a)({},this.state,{},{objectEditing:e}))}}}]),t}(r.a.Component),un=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(y.a)(this,Object(v.a)(t).call(this,e))).tryCreateConnection=n.tryCreateConnection.bind(Object(he.a)(n)),n.renderSystemObjectActions=n.renderSystemObjectActions.bind(Object(he.a)(n)),n.renderSubsystemActions=n.renderSubsystemActions.bind(Object(he.a)(n)),n.state={nodeConnecting:null,objectEditing:null,elementDisplayPopper:null},n}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(Gt,{elementDisplayPopper:this.state.elementDisplayPopper,elementDisplayPopperChanged:function(t){return e.setState(Object(l.a)({},e.state,{},{elementDisplayPopper:t}))},nodeConnecting:this.state.nodeConnecting,nodeConnectingDone:function(){return e.setState(Object(l.a)({},e.state,{},{nodeConnecting:null}))},tryCreateConnection:this.tryCreateConnection,renderSubsystemActions:this.renderSubsystemActions,renderSystemObjectActions:this.renderSystemObjectActions})}},{key:"renderSystemObjectActions",value:function(e,t){var n=this;return e.type!==ne.role?r.a.createElement(r.a.Fragment,null):r.a.createElement(on,{placement:"top"},r.a.createElement(j.a,{size:"small",title:"Connect to kind",onClick:function(){return n.setState(Object(l.a)({},n.state,{},{nodeConnecting:t}))}},r.a.createElement(vt.a,null)))}},{key:"renderSubsystemActions",value:function(e,t){return r.a.createElement(on,{placement:"bottom"},r.a.createElement(an,{node:t,subsystem:e}))}},{key:"tryCreateConnection",value:function(e,t){var n=e.edgesWith(t);if(n.length>0){var a=It(n[0]);if(a)return a}var r=Tt(e),i=Tt(t);return r&&r.type===ne.role&&i&&i.type===ne.kind?{id:Ot("connection"),source:i.id,target:r.id,label:"play",isOriented:!0}:null}}]),t}(r.a.Component),dn=n(187),mn=function(e){return r.a.createElement(r.a.Fragment,null,"H",e.hazard.id)},pn=n(4),hn=n(206),bn=Object(pn.a)((function(e){return Object(hn.a)({sizeSmall:{padding:e.spacing(1)}})}))(et.a),fn=function(e){var t=Object(a.useState)(!1),n=Object(re.a)(t,2),i=n[0],o=n[1],c=Object(a.useState)(e.hazard.harmTruthmaker),s=Object(re.a)(c,2),u=s[0],d=s[1],m=Object(a.useState)(e.hazard.description),p=Object(re.a)(m,2),h=p[0],b=p[1],f=function(e){return!e||0===e.length};return r.a.createElement(Qe.a,null,r.a.createElement(bn,null,r.a.createElement(mn,{hazard:e.hazard})),r.a.createElement(bn,null,e.hazard.mishapVictim.name,r.a.createElement("br",null),"(",e.hazard.mishapVictimEnvObj.name,")"),r.a.createElement(bn,null,e.hazard.exposure.name),r.a.createElement(bn,null,e.hazard.hazardElement.name,r.a.createElement("br",null),"(",e.hazard.hazardElementEnvObj.name,")"),r.a.createElement(bn,null,i?r.a.createElement(be.a,{required:!0,autoFocus:!0,defaultValue:e.hazard.harmTruthmaker,margin:"none",type:"text",onChange:function(e){return d(e.target.value)},error:f(u),helperText:f(u)?"Required field":" ",autoComplete:"off"}):e.hazard.harmTruthmaker),r.a.createElement(bn,null,i?r.a.createElement(be.a,{required:!0,defaultValue:e.hazard.description,margin:"none",fullWidth:!0,type:"text",onChange:function(e){return b(e.target.value)},error:f(h),helperText:f(h)?"Required field":" ",autoComplete:"off"}):e.hazard.description),r.a.createElement(bn,null,i?r.a.createElement(j.a,{size:"small",onClick:function(){return function(){if(!f(u)||!f(h)){if(u!==e.hazard.harmTruthmaker||h!==e.hazard.description){var t=Object(l.a)({},e.hazard,{harmTruthmaker:u,description:h});e.hazardEdited(t)}o(!1)}}()}},r.a.createElement(dn.a,null)):r.a.createElement(j.a,{size:"small",onClick:function(){return o(!0)}},r.a.createElement(Kt.a,null)),r.a.createElement(j.a,{size:"small",onClick:function(){o(!1),e.hazardDeleted(e.hazard)}},r.a.createElement(fe.a,null))))},En={hazardEdited:D,hazardDeleted:A},yn=Object(b.b)((function(e){return{hazards:e.systemModel.hazards}}),En),vn=Object(u.a)((function(){return{id:{width:"7%"},mishapVictim:{width:"15%"},exposure:{width:"10%"},hazardElement:{width:"15%"},harmTruthmaker:{width:"15%"},actions:{width:"10%"}}})),On=yn((function(e){var t=vn(),n=e.hazards,a=e.selectedMishapVictim;return a&&(n=n.filter((function(e){return e.mishapVictim.id===a.id}))),r.a.createElement(Ze.a,null,r.a.createElement(Ke.a,{size:"small"},r.a.createElement($e.a,null,r.a.createElement(Qe.a,null,r.a.createElement(bn,{className:t.id},"ID"),r.a.createElement(bn,{className:t.mishapVictim},"Mishap Victim",r.a.createElement("br",null),"(Env Obj)"),r.a.createElement(bn,{className:t.exposure},"Exposure"),r.a.createElement(bn,{className:t.hazardElement},"Hazard Element",r.a.createElement("br",null),"(Env Obj)"),r.a.createElement(bn,{className:t.harmTruthmaker},"Harm TruthMaker"),r.a.createElement(bn,null,"Hazard Description"),r.a.createElement(bn,{className:t.actions}))),r.a.createElement(tt.a,null,0===n.length?r.a.createElement(Qe.a,null,r.a.createElement(et.a,{colSpan:7,align:"center"},"No hazards identified")):n.sort((function(e,t){return e.id-t.id})).map((function(t,n){return r.a.createElement(fn,{hazard:t,key:n,hazardEdited:e.hazardEdited,hazardDeleted:e.hazardDeleted})})))))})),gn=Object(u.a)((function(e){return{divide:{paddingRight:e.appSpacing.standard},select:{width:"220px"}}})),jn=function(e){var t=gn(),n="";1===e.template.hazardElementEnvObjs.length&&(n=e.template.hazardElementEnvObjs[0].object.id);var i=Object(a.useState)(n),o=Object(re.a)(i,2),l=o[0],c=o[1],s=Object(a.useState)(""),u=Object(re.a)(s,2),d=u[0],m=u[1],p=Object(a.useState)(""),h=Object(re.a)(p,2),b=h[0],f=h[1],E=e.template.hazardElementEnvObjs.sort((function(e,t){return e.object.name.localeCompare(t.object.name)})).map((function(e,t){return r.a.createElement(ct.a,{key:t,value:e.object.id},e.object.name)}));return 0===e.template.hazardElementEnvObjs.length&&(E=[r.a.createElement(ct.a,{key:-1,value:"",disabled:!0},"Nothing found")]),r.a.createElement(Qe.a,null,r.a.createElement(et.a,{colSpan:3},r.a.createElement("form",{action:"#",onSubmit:function(t){t.currentTarget.reset(),t.preventDefault();var n=e.template.hazardElementEnvObjs.find((function(e){return e.object.id===l}));if(n){var a={id:e.nextHazardId,harmTruthmaker:d,description:b,mishapVictim:{id:e.template.mishapVictim.id,name:e.template.mishapVictim.name},mishapVictimEnvObj:{id:e.template.mishapVictimEnvObj.object.id,name:e.template.mishapVictimEnvObj.object.name},exposure:{id:e.template.exposure.object.id,name:e.template.exposure.object.name},hazardElement:{id:e.template.hazardElement.object.id,name:e.template.hazardElement.object.name},hazardElementEnvObj:{id:n.object.id,name:n.object.name}};e.hazardCreated(a)}}},r.a.createElement(it.a,{className:t.divide},r.a.createElement(be.a,{required:!0,autoFocus:!0,margin:"none",type:"text",onChange:function(e){return m(e.target.value)},label:"Harm Truthmaker",autoComplete:"off",multiline:!0,rowsMax:4})),r.a.createElement(it.a,{className:t.divide},r.a.createElement(be.a,{required:!0,margin:"none",type:"text",onChange:function(e){return f(e.target.value)},label:"Hazard Description",autoComplete:"off",multiline:!0,rowsMax:4})),r.a.createElement(it.a,{className:t.select},r.a.createElement(ot.a,{id:"label-select-env-obj"},"Hazard Evement Env Obj"),r.a.createElement(lt.a,{required:!0,margin:"none",labelId:"label-select-env-obj",value:n,onChange:function(e){return c(e.target.value)}},E)),r.a.createElement(j.a,{type:"submit",edge:"end",title:"Create"},r.a.createElement(Ee.a,null)))))},Cn={hazardCreated:function(e){return z("CREATE_HAZARD",e)}},Sn=Object(b.b)((function(e){return{nextHazardId:e.systemModel.nextHazardId}}),Cn),kn=Object(pn.a)((function(e){return Object(hn.a)({root:{backgroundColor:e.palette.grey[200],cursor:"pointer"}})}))(Qe.a),zn=Object(u.a)((function(e){return{header:{marginLeft:e.appSpacing.standard}}})),Dn=Sn((function(e){var t=zn(),n=Object(a.useState)(null),i=Object(re.a)(n,2),o=i[0],l=i[1],c=Object(a.useState)([]),s=Object(re.a)(c,2),u=s[0],d=s[1];Object(a.useEffect)((function(){var t=_t(e.node);if(!t||!Xe(t))throw new Error("Entity passed is not a mishap victim");var n=function(e,t){if(e.isEdge()){var n=Tt(t?e.source():e.target()),a=It(e);if(n&&a)return{object:n,connection:a}}return null};d(function(t){for(var a=[],r=e.node.incomers(),i=e.node.outgoers(),o=i.incomers(),l=[],c=o.incomers(),s=0;s<c.length;s++){var u=n(c[s],!0);u&&l.push(u)}for(var d=0;d<r.length;d++){var m=n(r[d],!0);if(m)for(var p=0;p<i.length;p++){var h=n(i[p],!1);if(h)for(var b=function(e){var r=n(o[e],!0);if(!r)return"continue";a.push({mishapVictim:t,mishapVictimEnvObj:m,exposure:h,hazardElement:r,hazardElementEnvObjs:l.filter((function(e){return e.connection.target===r.object.id}))})},f=0;f<o.length;f++)b(f)}}return a}(t))}),[e.node]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,{container:!0},r.a.createElement(p.a,{item:!0,xs:12},r.a.createElement(oe.a,{variant:"caption",className:t.header},"Select a table row to add"))),r.a.createElement(Ze.a,null,r.a.createElement(Ke.a,{size:"small"},r.a.createElement($e.a,null,r.a.createElement(Qe.a,null,r.a.createElement(et.a,null,"Mishap Victim (Env Obj)"),r.a.createElement(et.a,null,"Exposure"),r.a.createElement(et.a,null,"Hazard Element"))),r.a.createElement(tt.a,null,0===u.length?r.a.createElement(Qe.a,null,r.a.createElement(et.a,{colSpan:3,align:"center"},"No possible hazards found")):u.map((function(t,n){return r.a.createElement(r.a.Fragment,{key:n},r.a.createElement(kn,{onClick:function(){return l(t)}},r.a.createElement(et.a,null,t.mishapVictim.name," (",t.mishapVictimEnvObj.object.name,")"),r.a.createElement(et.a,null,t.exposure.object.name),r.a.createElement(et.a,null,t.hazardElement.object.name)),o!==t?r.a.createElement(r.a.Fragment,null):r.a.createElement(jn,{template:o,nextHazardId:e.nextHazardId,hazardCreated:e.hazardCreated}))}))))))})),An=Object(u.a)((function(e){return{header:{marginLeft:e.appSpacing.standard},tableGutter:{marginBottom:e.appSpacing.standard},fabSpace:{marginBottom:e.appSpacing.fabOverlap}}})),xn=function(e){var t=An(),n=_t(e.node);if(!n||!Xe(n))throw new Error("Entity passed is not a mishap victim");return r.a.createElement(r.a.Fragment,null,r.a.createElement(oe.a,{variant:"h6",color:"textSecondary",className:t.header},"Possible Harms"),r.a.createElement(oe.a,{variant:"body1",className:t.header,gutterBottom:!0},n.possibleHarms.join(", ")),r.a.createElement(oe.a,{variant:"h6",color:"textSecondary",className:t.header},"Hazards"),r.a.createElement(On,{selectedMishapVictim:n}),r.a.createElement("div",{className:t.tableGutter}),r.a.createElement(oe.a,{variant:"h6",color:"textSecondary",className:t.header},"Add New Hazard"),r.a.createElement(Dn,{node:e.node}),r.a.createElement("div",{className:t.fabSpace}),r.a.createElement(Et,{onClick:e.close},"Back"))},Nn=Object(b.b)((function(e){return{system:e.systemModel}}))((function(e){var t=Object(a.useState)(!1),n=Object(re.a)(t,2),i=n[0],o=n[1],l=function(e){var t=_t(e.target.element());if(t&&Xe(t))return t},c=function(e){o(!!l(e))},s=(new Ge).mapSystemDescription(e.system);return r.a.createElement(r.a.Fragment,null,r.a.createElement(Le,{elements:s,cursorStyle:i?"pointer":"default",mouseEnteredNode:c,mouseLeftNode:c,nodeClicked:function(t){l(t)&&e.victimSelected(t.target)},cy:e.cyInitialized}),r.a.createElement(ge,null,r.a.createElement(oe.a,null,"Click on a mishap victim to populate hazards"),r.a.createElement(oe.a,{variant:"caption"},"Mishap victims are marked yellow")))})),wn=Object(b.b)((function(e){return{mishapVictims:e.systemModel.roles.filter((function(e){return Xe(e)}))}})),Tn=Object(u.a)((function(e){return{header:{marginLeft:e.appSpacing.standard},tableGutter:{marginBottom:e.appSpacing.standard},select:{marginLeft:e.appSpacing.standard,width:"220px"}}})),_n=wn((function(e){var t=Tn(),n=Object(a.useState)(""),i=Object(re.a)(n,2),o=i[0],l=i[1],c=Object(a.useState)(null),s=Object(re.a)(c,2),u=s[0],d=s[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(oe.a,{variant:"h6",color:"textSecondary",className:t.header},"Hazards"),r.a.createElement(On,null),r.a.createElement("div",{className:t.tableGutter}),r.a.createElement(oe.a,{variant:"h6",color:"textSecondary",className:t.header},"Add New Hazard"),r.a.createElement(it.a,{className:t.select},r.a.createElement(ot.a,{id:"label-select-mishap-victim"},"Select mishap victim"),r.a.createElement(lt.a,{margin:"none",labelId:"label-select-mishap-victim",onChange:function(t){var n=t.target.value,a=e.getNode(n);a&&(l(n),d(a))},value:o},e.mishapVictims.sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(e,t){return r.a.createElement(ct.a,{key:t,value:e.id},e.name)})))),u?r.a.createElement(Dn,{node:u}):void 0)})),In=Object(u.a)((function(e){return{fabSpace:{height:e.appSpacing.fabOverlap}}})),Mn=function(){var e=In(),t=Object(a.useState)(!1),n=Object(re.a)(t,2),i=n[0],o=n[1],l=Object(a.useState)(null),c=Object(re.a)(l,2),s=c[0],u=c[1],d=Object(a.useRef)();if(s){if(!Tt(s))throw new Error("Selected node does not represent a mishap victim");return r.a.createElement(xn,{node:s,close:function(){return u(null)}})}return i?r.a.createElement(r.a.Fragment,null,r.a.createElement(_n,{getNode:function(e){if(!d.current)return null;var t=d.current.$("#".concat(e));return t.isNode()?t:null}}),r.a.createElement("div",{className:e.fabSpace}),r.a.createElement(Et,{onClick:function(){return o(!1)}},r.a.createElement(qe.a,null),"Graph View")):r.a.createElement(r.a.Fragment,null,r.a.createElement(Nn,{victimSelected:u,cyInitialized:function(e){return d.current=e}}),r.a.createElement(Et,{onClick:function(){return o(!0)}},r.a.createElement(We.a,null),"Table View"))},Rn=n(189),Hn=n(190),Fn={nameUpdated:function(e){return z("UPDATE_PROJECT_NAME",e)}},Pn=Object(b.b)((function(e){return{name:e.systemModel.projectName}}),Fn),Ln=Object(u.a)((function(e){return{input:{"& .MuiInput-input":{color:e.palette.common.white}},buttonGutter:{paddingLeft:e.spacing(1)}}})),Vn=Pn((function(e){var t=Ln(),n=Object(a.useState)(!1),i=Object(re.a)(n,2),o=i[0],l=i[1],c=Object(a.useState)(e.name),s=Object(re.a)(c,2),u=s[0],d=s[1],m=Object(a.useRef)();Object(a.useEffect)((function(){d(e.name)}),[e.name]);var p=function(e){e&&!m.current&&(e.select(),m.current=e)};return o?r.a.createElement("form",{onReset:function(){d(e.name),l(!1),m.current=void 0},onSubmit:function(t){t.preventDefault(),l(!1),e.nameUpdated(u),m.current=void 0}},r.a.createElement(be.a,{className:t.input,type:"text",required:!0,autoFocus:!0,onChange:function(e){return d(e.target.value)},value:u,inputRef:function(e){return p(e)}}),r.a.createElement(j.a,{type:"submit",size:"small",className:t.buttonGutter},r.a.createElement(Rn.a,null)),r.a.createElement(j.a,{type:"reset",size:"small"},r.a.createElement(Hn.a,null))):r.a.createElement(oe.a,{variant:"h6"},u,r.a.createElement(j.a,{size:"small",onClick:function(){return l(!0)},title:"Edit project name",className:t.buttonGutter},r.a.createElement(Kt.a,null)))})),Un=n(191),Yn={close:function(){return{type:"HIDE_CONFIRMATION_DIALOG"}}},Bn=Object(b.b)((function(e){return{dialog:e.modalDialog}}),Yn)((function(e){return r.a.createElement(St.a,{open:!!e.dialog.contentText,onClose:e.close,disableBackdropClick:!0,disableEscapeKeyDown:!0},r.a.createElement(kt.a,null,r.a.createElement(Un.a,null,e.dialog.contentText)),r.a.createElement(zt.a,null,r.a.createElement(dt.a,{onClick:function(){e.close(),e.dialog.onYes()},color:"primary"},"Yes"),r.a.createElement(dt.a,{onClick:function(){e.close(),e.dialog.onNo&&e.dialog.onNo()},color:"primary",autoFocus:!0},"No")))})),Xn=n(192),Gn=n(194),Jn=n(193);!function(e){e.hazard="Hazard",e.initiatingCondition="Initiating Condition",e.initiatingEvent="Initiating Event",e.mishap="Mishap"}(Pt||(Pt={})),function(e){e[e.notSet=0]="notSet",e[e.situation=1]="situation",e[e.event=2]="event"}(Lt||(Lt={}));var Wn=function(e){var t,n,i=Object(a.useState)(Lt.notSet),o=Object(re.a)(i,2),l=o[0],c=o[1],s=null;switch(l){case Lt.notSet:t="Is the hazard description describing a situation (state of affairs) or an event?",s=r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Note that"),r.a.createElement("p",null,"1) if a hazard description describes that some event is supposed to occur but does not, then the hazard description is regarded as a generic ",r.a.createElement("b",null,"situation"),' that will not trigger the specific event, such as "the brake command is not issued",'),r.a.createElement("p",null,"and"),r.a.createElement("p",null,"2) if a hazard description describes a repetitive and continuous behavior, it can be regarded as a ",r.a.createElement("b",null,"situation"),', such as "a train is running on the track".')),n=r.a.createElement(r.a.Fragment,null,r.a.createElement(dt.a,{size:"small",variant:"outlined",onClick:function(){return c(Lt.situation)}},"Situation"),r.a.createElement(dt.a,{size:"small",variant:"outlined",onClick:function(){return c(Lt.event)}},"Event"));break;case Lt.situation:t="Can the situation trigger mishaps when some dispositions in the situation are manifested ?",n=r.a.createElement(r.a.Fragment,null,r.a.createElement(dt.a,{size:"small",variant:"outlined",onClick:function(){return e.complete(Pt.hazard)}},"Yes \u2014 Hazard"),r.a.createElement(dt.a,{size:"small",variant:"outlined",onClick:function(){return e.complete(Pt.initiatingCondition)}},"No \u2014 Initiating Condition"));break;case Lt.event:t="Can the event bring about severe injuries of people or damages to the environment?",n=r.a.createElement(r.a.Fragment,null,r.a.createElement(dt.a,{size:"small",variant:"outlined",onClick:function(){return e.complete(Pt.mishap)}},"Yes \u2014 Mishap"),r.a.createElement(dt.a,{size:"small",variant:"outlined",onClick:function(){return e.complete(Pt.initiatingEvent)}},"No \u2014 Initiating Event"));break;default:throw new Error("Unknown intermediate category")}return r.a.createElement(ye.a,{variant:"outlined"},r.a.createElement(Xn.a,{action:r.a.createElement(j.a,{size:"small",onClick:e.cancel},r.a.createElement(Jn.a,null)),title:t}),s?r.a.createElement(ve.a,null,r.a.createElement(oe.a,{variant:"body2",component:"div"},s)):void 0,r.a.createElement(Gn.a,null,n))},qn=function(e){var t=Object(a.useState)(!1),n=Object(re.a)(t,2),i=n[0],o=n[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe.a,null,r.a.createElement(et.a,null,r.a.createElement(mn,{hazard:e.hazard})),r.a.createElement(et.a,null,e.hazard.description),r.a.createElement(et.a,null,e.hazard.category?e.hazard.category:"-"),r.a.createElement(et.a,null,r.a.createElement(dt.a,{variant:"outlined",onClick:function(){return o(!0)}},"Categorize"))),i?r.a.createElement(Qe.a,null,r.a.createElement(et.a,{colSpan:4},r.a.createElement(Wn,{cancel:function(){return o(!1)},complete:function(t){o(!1),e.hazardUpdated(Object(l.a)({},e.hazard,{},{category:t}))}}))):void 0)},Zn={hazardUpdated:D},Kn=Object(b.b)((function(e){return{hazards:e.systemModel.hazards}}),Zn)((function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ze.a,null,r.a.createElement(Ke.a,{size:"small"},r.a.createElement($e.a,null,r.a.createElement(Qe.a,null,r.a.createElement(et.a,null,"ID"),r.a.createElement(et.a,null,"Hazard Description"),r.a.createElement(et.a,null,"Category"),r.a.createElement(et.a,null))),r.a.createElement(tt.a,null,0===e.hazards.length?r.a.createElement(Qe.a,null,r.a.createElement(et.a,{colSpan:4},"No hazards identified")):e.hazards.map((function(t,n){return r.a.createElement(qn,{key:n,hazard:t,hazardUpdated:e.hazardUpdated})}))))))})),$n=Object(u.a)((function(e){return{root:{display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},drawerOpen:{width:240},toolbar:Object(l.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:e.spacing(0,1)},e.mixins.toolbar),content:{flexGrow:1},appTitle:{textAlign:"center"}}})),Qn=Object(b.b)((function(e){return{currentStep:e.systemModel.currentStep,hasUnsavedChanges:e.unsavedChanges}}))((function(e){Object(c.useBeforeunload)((function(t){e.hasUnsavedChanges&&t.preventDefault()}));var t=$n();return r.a.createElement(g,null,r.a.createElement(s.a,null),r.a.createElement(Bn,null),r.a.createElement("div",{className:t.root},r.a.createElement(d.a,{position:"fixed",className:t.appBar},r.a.createElement(m.a,{variant:"dense"},r.a.createElement(p.a,{container:!0,justify:"space-evenly"},r.a.createElement(p.a,{item:!0,xs:!0},r.a.createElement(G,null)),r.a.createElement(p.a,{item:!0,xs:6,className:t.appTitle},r.a.createElement(Vn,null)),r.a.createElement(p.a,{item:!0,xs:!0},"\xa0")))),r.a.createElement(h.a,{variant:"permanent",className:t.drawerOpen,classes:{paper:t.drawerOpen}},r.a.createElement("div",{className:t.toolbar}),r.a.createElement(pe,null)),r.a.createElement("main",{className:t.content},r.a.createElement("div",{className:t.toolbar}),function(){switch(e.currentStep){case L.SDF_1:return r.a.createElement(ln,null);case L.SDF_2:return r.a.createElement(cn,null);case L.SDF_3:return r.a.createElement(sn,null);case L.SDF_4:return r.a.createElement(un,null);case L.OHI_2:return r.a.createElement(yt,null);case L.OHI_3:return r.a.createElement(Mn,null);case L.OCH_1:return r.a.createElement(Kn,null);default:throw new Error("Unknown step id ".concat(e.currentStep))}}())))})),ea=n(45);function ta(e,t){switch(t.type){case"CREATE_HAZARD":return e.concat(t.payload);case"UPDATE_HAZARD":return e.map((function(e){return e.id===t.payload.id?t.payload:e}));case"DELETE_HAZARD":return e.filter((function(e){return e.id!==t.payload.id}));case"RENAME_SYSTEM_OBJECT":var n=function(e){switch(e.type){case ne.relator:return function(t){return Ht(e,t)?Object(l.a)({},t,{},{exposure:{id:e.id,name:e.name}}):t};case ne.role:return function(t){return Rt(e,t)?Object(l.a)({},t,{},{mishapVictim:t.mishapVictim.id===e.id?{id:e.id,name:e.name}:t.mishapVictim,hazardElement:t.hazardElement.id===e.id?{id:e.id,name:e.name}:t.hazardElement}):t};case ne.kind:return function(t){return Mt(e,t)?Object(l.a)({},t,{},{mishapVictimEnvObj:t.mishapVictimEnvObj.id===e.id?{id:e.id,name:e.name}:t.mishapVictimEnvObj,hazardElementEnvObj:t.hazardElementEnvObj.id===e.id?{id:e.id,name:e.name}:t.hazardElementEnvObj}):t}}}(t.payload);return e.map(n);case"DELETE_CONNECTION":var a=Ft(t.payload.target);return e.filter((function(e){return!a(e)}));case"DELETE_SYSTEM_OBJECT":var r=Ft(t.payload);return e.filter((function(e){return!r(e)}));default:return e}}function na(e,t){return"CREATE_HAZARD"===t.type?e+1:e}function aa(e,t){switch(t.type){case"CREATE_SUBSYSTEM":return e.concat(t.payload);case"UPDATE_SUBSYSTEM":return e.map((function(e){return e.id===t.payload.id?t.payload:e}));case"DELETE_SUBSYSTEM":return e.filter((function(e){return e.id!==t.payload.id}));default:return e}}function ra(e,t){switch(t.type){case"CREATE_CONNECTION":return e.concat(t.payload);case"DELETE_CONNECTION":return e.filter((function(e){return e.id!==t.payload.connection.id}));case"DELETE_SYSTEM_OBJECT":var n=t.payload.id;return e.filter((function(e){return e.source!==n&&e.target!==n}));default:return e}}function ia(e,t,n){switch(t.type){case"CREATE_SYSTEM_OBJECT":return t.payload.type!==n?e:e.concat(t.payload);case"UPDATE_SYSTEM_OBJECT":return t.payload.type!==n?e:e.map((function(e){return e.id===t.payload.id?t.payload:e}));case"DELETE_SYSTEM_OBJECT":return t.payload.type!==n?e:e.filter((function(e){return e.id!==t.payload.id}));default:return e}}function oa(e,t){return ia(e,t,ne.kind)}function la(e,t){switch(t.type){case"ADD_POSSIBLE_HARM":return e.map((function(e){if(e.id===t.payload.mishapVictim.id){var n=e.possibleHarms.concat(t.payload.harm);return Object(l.a)({},e,{},{possibleHarms:n})}return e}));case"REMOVE_POSSIBLE_HARM":return e.map((function(e){if(e.id===t.payload.mishapVictim.id){var n=e.possibleHarms.filter((function(e){return e!==t.payload.harm}));return Object(l.a)({},e,{},{possibleHarms:n})}return e}));default:return ia(e,t,ne.role)}}function ca(e,t){return ia(e,t,ne.relator)}var sa={projectName:"Hazard Ontology",currentStep:ee(),lastCompletedStep:ee(),kinds:[],roles:[],relators:[],systemObjectConnections:[],subsystems:[],hazards:[],nextHazardId:1};var ua={contentText:"",onYes:function(){}};var da=Object(ea.b)({systemModel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOAD_MODEL":return t.payload;case"RESET_MODEL":return sa;case"UPDATE_FLOW_STEP":var n=t.payload,a=te(n);return a===te(e.currentStep)?e:a>te(e.lastCompletedStep)?Object(l.a)({},e,{},{currentStep:n,lastCompletedStep:n}):Object(l.a)({},e,{},{currentStep:n});case"UPDATE_PROJECT_NAME":return Object(l.a)({},e,{},{projectName:t.payload});default:return Object(l.a)({},e,{},{hazards:ta(e.hazards,t),nextHazardId:na(e.nextHazardId,t),subsystems:aa(e.subsystems,t),systemObjectConnections:ra(e.systemObjectConnections,t),kinds:oa(e.kinds,t),roles:la(e.roles,t),relators:ca(e.relators,t)})}},unsavedChanges:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("unsavedChanges"in t)return t.unsavedChanges;switch(t.type){case"RESET_MODEL":case"LOAD_MODEL":case"SAVE_CHANGES":return!1;default:return e}},modalDialog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ua,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SHOW_CONFIRMATION_DIALOG":return t.payload;case"HIDE_CONFIRMATION_DIALOG":return ua;default:return e}}}),ma=n(198),pa=n(83),ha=Object(pa.a)(),ba={standard:ha.spacing(2),fabOverlap:ha.spacing(2)+ha.spacing(1)+40,drawerWidth:240},fa=Object(pa.a)({zIndex:{graph:10,nodeAction:20,graphHelp:30,graphAction:40},appSpacing:ba}),Ea=Object(ea.c)(da);o.a.render(r.a.createElement(b.a,{store:Ea},r.a.createElement(ma.a,{theme:fa},r.a.createElement(Qn,null))),document.getElementById("root"))},92:function(e,t,n){e.exports=n(115)}},[[92,1,2]]]);
//# sourceMappingURL=main.5258c84d.chunk.js.map