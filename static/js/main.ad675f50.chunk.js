(this["webpackJsonphazard-ontology-front-end"]=this["webpackJsonphazard-ontology-front-end"]||[]).push([[0],{107:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(14),s=a.n(i),o=a(9),l=a(5),c=a(69),d=(a(93),a(187)),m=a(147),u=a(188),p=a(189),h=a(181),b=a(196),y=a(16),f=a(17),E=a(19),v=a(18),g=function(e){Object(E.a)(a,e);var t=Object(v.a)(a);function a(e){var n;return Object(y.a)(this,a),(n=t.call(this,e)).state={},n}return Object(f.a)(a,[{key:"componentDidCatch",value:function(e){this.setState({error:e})}},{key:"render",value:function(){return this.state.error?r.a.createElement("h1",null,"ERROR: "+this.state.error.message):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{error:e}}}]),a}(n.Component),j=a(7),O=a(141),C=a(145),S=a(146);function z(e){return"type"in e}function k(e){return"source"in e}function x(e){return!("source"in e)&&!("type"in e)}var D={OHI:{name:"OHI",order:-1},OHI_1:{name:"OHI-1",order:-1},SDF_1:{name:"SDF-1",order:1},SDF_2:{name:"SDF-2",order:2},SDF_3:{name:"SDF-3",order:3},SDF_4:{name:"SDF-4",order:4},OHI_2:{name:"OHI-2",order:5},OHI_3:{name:"OHI-3",order:6},OCH:{name:"OCH",order:-1},OCH_1:{name:"OCH-1",order:7},OCH_2:{name:"OCH-2",order:-1},OCH_3:{name:"OCH-3",order:-1},SARE:{name:"SARE",order:-1},SARE_1:{name:"SARE-1",order:-1},SARE_2:{name:"SARE-2",order:-1},SARE_3:{name:"SARE-3",order:-1},CM:{name:"CM",order:-1}},w=[{id:D.OHI,label:"Identify Hazards",children:[{id:D.OHI_1,label:"Modelling",children:[{id:D.SDF_1,label:"Step 1",helpText:"Identify the <i>kind</i> and <i>role</i> objects explicitly presented in the system description."},{id:D.SDF_2,label:"Step 2",helpText:"For each <i>kind</i> object obtained in SDF-Step&nbsp;1, identify all the roles it can play, considering the system description."},{id:D.SDF_3,label:"Step 3",helpText:"For each <i>role</i> object obtained in SDF-Step&nbsp;1 and SDF-Step&nbsp;2, identify the relator that connects this role, and specify all the other roles connected by the identified relator, considering the system description and the analysts&apos; expertise."},{id:D.SDF_4,label:"Step 4",helpText:"For each <i>role</i> object obtained in SDF-Step&nbsp;1, SDF-Step&nbsp;2 and SDF-Step&nbsp;3, identify all the <i>kind</i> objects that can play the role, considering the system description."}]},{id:D.OHI_2,label:"Identify Victims",helpText:"Go through all the <i>roles</i> presented in the HO-style model and analyze if the roles are not supposed to but have the potential to encounter harms. Furthermore, the analysts continue with identifying possible harms that can affect the victims, including but not limited to, physical damages, chemical injuries, fatal illness, explosion, etc."},{id:D.OHI_3,label:"Identify Hazards",helpText:"Identify the hazardous situations that are likely to harm the identified mishap victims. Occurrence of a mishap is the manifestation of the <i>harm truthmaker</i> dispositions that characterize the <i>hazard element</i> roles in a hazardous situation. "}]},{id:D.OCH,label:"Identify Causes",children:[{id:D.OCH_1,label:"Categorize",helpText:"Categorize all the hazard descriptions into four categories, in terms of <b>Hazard</b>, <b>Initiating Condition</b>, <b>Initiating Event</b>, and/or <b>Mishap</b> based on the set of heuristic questions."},{id:D.OCH_2,label:"Expand",children:[]},{id:D.OCH_3,label:"Identify Causes",children:[]}]},{id:D.SARE,label:"Safety Requirements",children:[{id:D.SARE_1,label:"Evaluate Severity",children:[]},{id:D.SARE_2,label:"Evaluate Probability",children:[]},{id:D.SARE_3,label:"Safety Requirements",children:[]}]},{id:D.CM,label:"Control Mitigation",children:[]}];function F(){return D.SDF_1}var N,A=function(e){Object(E.a)(a,e);var t=Object(v.a)(a);function a(e){var n;return Object(y.a)(this,a),(n=t.call(this,e))._openFileRef=void 0,n.readFile=n.readFile.bind(Object(j.a)(n)),n.downloadFile=n.downloadFile.bind(Object(j.a)(n)),n.processResult=n.processResult.bind(Object(j.a)(n)),n.handleFileError=n.handleFileError.bind(Object(j.a)(n)),n.reportError=n.reportError.bind(Object(j.a)(n)),n.prepareDataToDownload=n.prepareDataToDownload.bind(Object(j.a)(n)),n._openFileRef=null,n}return Object(f.a)(a,[{key:"render",value:function(){var e,t=this;return e=window.FileReader&&window.FileList?r.a.createElement(r.a.Fragment,null,r.a.createElement("form",{ref:function(e){return t._openFileRef=e},style:{display:"inline-block"}},r.a.createElement("input",{style:{display:"none"},type:"file",onChange:function(e){return t.readFile(e.target.files)},accept:".json",id:"input-open-file"}),r.a.createElement("label",{htmlFor:"input-open-file"},r.a.createElement(O.a,{title:"Open File",size:"small",color:"inherit",component:"span"},r.a.createElement(C.a,null))))):r.a.createElement("div",{title:"File API not supported",style:{display:"inline-block"}},r.a.createElement(O.a,{size:"small",color:"inherit",disabled:!0},r.a.createElement(C.a,null))),r.a.createElement(r.a.Fragment,null,e,r.a.createElement(O.a,{size:"small",title:"Download",color:"inherit",onClick:this.downloadFile},r.a.createElement(S.a,null)))}},{key:"readFile",value:function(e){if(null!==e&&1===e.length&&(!this.props.hasUnsavedChanges||window.confirm("You have usaved changes that will be lost. Continue?"))){var t=e[0];if("application/json"!==t.type)return this.reportError("File type not supported");var a=new FileReader;a.onload=this.processResult,a.onerror=this.handleFileError,a.readAsText(t,"utf-8")}}},{key:"downloadFile",value:function(){var e=this.prepareDataToDownload(),t=JSON.stringify(this.prepareDataToDownload(),null,"\t"),a="".concat(e.projectName," ").concat((new Date).toISOString().replace(/:/g,"_"),".json"),n=document.createElement("a");n.setAttribute("href","data:application/json;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",a),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}},{key:"prepareDataToDownload",value:function(){var e=this.props.saveFile();return Object(l.a)({},e,{},{systemObjectConnections:this.patchCollapsedConnections(e.systemObjectConnections),currentStep:this.serializeStepId(e.currentStep),lastCompletedStep:this.serializeStepId(e.lastCompletedStep)})}},{key:"prepareReadData",value:function(e){return Object(l.a)({},e,{},{currentStep:this.deserializeStepId(e.currentStep),lastCompletedStep:this.deserializeStepId(e.lastCompletedStep)})}},{key:"patchCollapsedConnections",value:function(e){return e.map((function(e){return k(t=e)&&"originalEnds"in t?{id:e.id,source:e.originalEnds.source.data().id,target:e.originalEnds.target.data().id}:e;var t}))}},{key:"serializeStepId",value:function(e){return e.name}},{key:"deserializeStepId",value:function(e){for(var t in D)if(D[t].name===e)return D[t];throw new Error("Unknown flow step id - ".concat(e))}},{key:"reportError",value:function(e){return alert(e)}},{key:"handleFileError",value:function(e){var t="Error reading a file";e.target&&e.target.error&&(t=e.target.error.message),this.reportError(t)}},{key:"processResult",value:function(e){if(!e.target)return this.reportError("Error reading a file");var t=e.target.result,a=this.prepareReadData(JSON.parse(t));this._openFileRef&&this._openFileRef.reset(),this.props.openFile(a)}}]),a}(r.a.Component),H=a(150),I=a(108),R=a(151),U=a(194),P=a(152),M=a(153),V=a(154),T=a(195),_=a(34),Y=a(148),X=a(149),L=Object(m.a)((function(e){return{typography:{padding:e.spacing(2),maxWidth:"320px"}}})),B=function(e){var t=L(),a=Object(n.useState)(null),i=Object(o.a)(a,2),s=i[0],l=i[1],c=Object(n.useState)(!1),d=Object(o.a)(c,2),m=d[0],u=d[1];return Object(n.useEffect)((function(){u(e.open)}),[e.open]),r.a.createElement(r.a.Fragment,null,r.a.createElement(O.a,{ref:function(e){return l(e)},edge:"end",onClick:function(){return u(!0)}},e.highlighted?r.a.createElement(Y.a,null):r.a.createElement(X.a,null)),r.a.createElement(T.a,{open:m,anchorEl:s,onClose:function(){u(!1)},anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"}},r.a.createElement(_.a,{variant:"body2",className:t.typography,dangerouslySetInnerHTML:{__html:e.htmlContent}})))},q=Object(m.a)((function(e){return{label:{paddingLeft:e.spacing(1)},phase:{paddingLeft:e.spacing(4)},step:{paddingLeft:e.spacing(8)},bold:{fontWeight:"bold"}}})),G=function(e){var t=q(),a=function(t){t.order>e.progress.currentStep.order?function(t){var a=t;e.progress.lastCompletedStep.order>t.order&&(a=e.progress.lastCompletedStep),e.progressUpdated({currentStep:t,lastCompletedStep:a},!1)}(t):t.order<e.progress.currentStep.order&&function(t){e.progressUpdated({currentStep:t,lastCompletedStep:e.progress.lastCompletedStep},!1)}(t)};return r.a.createElement(H.a,{dense:!0},w.map((function(n){return r.a.createElement(r.a.Fragment,{key:n.id.name},r.a.createElement(I.a,null,r.a.createElement(R.a,null,r.a.createElement(U.a,{label:n.id.name,variant:"outlined",color:"primary"})),r.a.createElement(P.a,{primary:n.label,disableTypography:!0,className:"".concat(t.label," ").concat(t.bold)})),function n(i,s){return r.a.createElement(H.a,{disablePadding:!0,dense:!0},i.map((function(i){var o=-1!==i.id.order,l=o&&i.id.order===e.progress.currentStep.order,c=!o||i.id.order<=e.progress.lastCompletedStep.order+1,d=i.id===e.progress.currentStep&&i.id===e.progress.lastCompletedStep;return r.a.createElement(r.a.Fragment,{key:i.id.name},r.a.createElement(I.a,{className:s,button:!0,disabled:!c,onClick:function(){return o&&a(i.id)}},r.a.createElement(R.a,null,r.a.createElement(U.a,{size:"small",disabled:!c,label:i.id.name,color:l?"secondary":"primary",variant:o?"default":"outlined"})),r.a.createElement(P.a,{primary:i.label,className:t.label}),i.helpText?r.a.createElement(M.a,null,r.a.createElement(B,{open:d,highlighted:l,htmlContent:i.helpText})):""),i.children?n(i.children,t.step):"")})))}(n.children,t.phase),r.a.createElement(V.a,null))})))},W=a(193),K=a(157),J=a(161),Z=a(155),$=a(156),Q=Object(m.a)((function(e){return{root:{position:"fixed",bottom:e.spacing(2),right:e.spacing(1),zIndex:110,minWidth:200}}})),ee=function(e){var t=Q();return r.a.createElement(Z.a,{className:t.root},r.a.createElement($.a,null,e.children))},te=function(e){var t=r.a.createElement(_.a,null,"Click on a role to see or add possible harms"),a=function(t,a,n){return r.a.createElement(I.a,{key:a},r.a.createElement(P.a,{primary:t}),r.a.createElement(M.a,null,r.a.createElement(O.a,{edge:"end",title:"Delete",onClick:function(){return function(t,a){var n=t.possibleHarms.filter((function(e){return e!==a}));e.possibleHarmsUpdated(Object(l.a)({},t,{},{possibleHarms:n}))}(n,t)}},r.a.createElement(K.a,null))))},n=function(t){return r.a.createElement(I.a,{key:"-1"},r.a.createElement("form",{action:"#",onSubmit:function(a){return function(t,a){var n=t.currentTarget,r=n.elements.namedItem("harm").value;n.reset(),t.preventDefault();var i=a.possibleHarms.concat(r);e.possibleHarmsUpdated(Object(l.a)({},a,{},{possibleHarms:i}))}(a,t)}},r.a.createElement(W.a,{required:!0,autoFocus:!0,margin:"dense",type:"text",name:"harm",fullWidth:!0,placeholder:"Add New",autoComplete:"off"}),r.a.createElement(M.a,null,r.a.createElement(O.a,{type:"submit",edge:"end",title:"Add"},r.a.createElement(J.a,null)))))};return r.a.createElement(ee,null,function(){return e.selectedRole?r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{variant:"body2",color:"textSecondary"},"Mishap Victim"),r.a.createElement(_.a,{variant:"h6",gutterBottom:!0},e.selectedRole.name),r.a.createElement(_.a,{variant:"body2",color:"textSecondary"},"Possible Harms"),r.a.createElement(H.a,{dense:!0},(i=e.selectedRole).possibleHarms.sort((function(e,t){return e.localeCompare(t)})).map((function(e,t){return a(e,t,i)})).concat(n(i)))):t;var i}())},ae=a(57),ne=a.n(ae),re=a(74),ie=a.n(re),se=a(75),oe=a.n(se),le=a(76),ce=a.n(le);!function(e){e.kind="kind",e.role="role",e.relator="relator"}(N||(N={}));var de=[{selector:"node",style:{"background-color":"#fff","border-width":1,"border-style":"solid","border-color":"#000",shape:"round-rectangle",label:"data(label)",height:"label",width:"label","text-valign":"center","text-halign":"center","text-wrap":"wrap","text-max-width":"130px","font-size":11,padding:"5px"}},{selector:"edge",style:{width:2,"curve-style":"taxi",label:"data(label)","font-size":11}},{selector:".subsystem",style:{shape:"rectangle","text-valign":"top","text-max-width":"300px"}},{selector:".".concat(N.kind.toString()),style:{"background-color":"#8282ff",color:"#fff"}},{selector:".".concat(N.role.toString()),style:{"background-color":"#818181",color:"#fff"}},{selector:".".concat(N.relator.toString()),style:{"background-color":"#fff",color:"#000"}},{selector:".arrow-edge",style:{"target-arrow-shape":"chevron"}},{selector:".faded",style:{opacity:.6}},{selector:".mishap-victim",style:{"background-color":"#ff0",color:"#000"}}];function me(e){return"systemObject"in e}function ue(e){return"subsystem"in e}function pe(e){return"connection"in e}var he={animate:!1,cueEnabled:!1};function be(e){return e.expandCollapse("get")}ne.a.use(ce.a),oe()(ne.a);var ye=function(e){Object(E.a)(a,e);var t=Object(v.a)(a);function a(e){var n;return Object(y.a)(this,a),(n=t.call(this,e)).newMaxX=void 0,n.newMaxY=void 0,n.initCytoscape=n.initCytoscape.bind(Object(j.a)(n)),n.addEventListeners=n.addEventListeners.bind(Object(j.a)(n)),n.checkCanvasSizeToFitNode=n.checkCanvasSizeToFitNode.bind(Object(j.a)(n)),n.resizeCanvas=n.resizeCanvas.bind(Object(j.a)(n)),n.handleNodeMoved=n.handleNodeMoved.bind(Object(j.a)(n)),n.newMaxX=1500,n.newMaxY=900,n.state={cy:null,collapseApi:null,maxX:n.newMaxX,maxY:n.newMaxY},n}return Object(f.a)(a,[{key:"render",value:function(){var e=this.state.cy?this.props.elements:[],t={width:this.state.maxX,height:this.state.maxY,zIndex:10,cursor:this.props.cursorStyle};return r.a.createElement(ie.a,{elements:e,style:t,stylesheet:de,userZoomingEnabled:!1,userPanningEnabled:!1,cy:this.initCytoscape})}},{key:"resizeCanvas",value:function(){(this.newMaxX>this.state.maxX||this.newMaxY>this.state.maxY)&&this.setState(Object(l.a)({},this.state,{},{maxX:this.newMaxX,maxY:this.newMaxY}))}},{key:"checkCanvasSizeToFitNode",value:function(e){var t=e.target,a=t.position(),n=t.outerWidth(),r=t.outerHeight();a.x+n+120>this.newMaxX&&(this.newMaxX=a.x+n+120),a.y+r+120>this.newMaxY&&(this.newMaxY=a.y+r+120)}},{key:"handleNodeMoved",value:function(e){this.props.nodeMoved&&this.props.nodeMoved(e)}},{key:"addEventListeners",value:function(e){var t=e.target.element();if(t.isNode()){t.on("position",this.checkCanvasSizeToFitNode),t.trigger("position"),t.on("dragfree",this.handleNodeMoved);var a=t.data();this.state.collapseApi&&ue(a)&&a.subsystem.isCollapsed&&this.state.collapseApi.collapse(t)}t.on("mouseover",this.props.mouseEnteredNode),t.on("mouseout",this.props.mouseLeftNode),t.on("click",this.props.nodeClicked)}},{key:"initCytoscape",value:function(e){var t=this;if(this.props.cy&&this.props.cy(e),!this.state.cy){e.zoom(1.1),e.on("add",this.addEventListeners),e.on("click",(function(e){return t.props.graphClicked&&t.props.graphClicked(e)})),e.on("render",this.resizeCanvas);var a=null;this.props.useCollapseApi&&(!function(e){e.expandCollapse(he)}(e),a=be(e)),this.setState(Object(l.a)({},this.state,{},{cy:e,collapseApi:a}))}}}]),a}(r.a.Component),fe=function(){function e(){Object(y.a)(this,e)}return Object(f.a)(e,[{key:"mapSystemDescription",value:function(e){return this.mapSystemDescriptionEntities(this.getAllNodes(e).concat(e.systemObjectConnections))}},{key:"mapSystemDescriptionEntities",value:function(e){var t=this;return e.map((function(e){if(z(e))return t.mapSystemObject(e);if(k(e))return t.mapConnection(e);if(x(e))return t.mapSubsystem(e);throw new Error("Unknown entity type")}))}},{key:"getAllNodes",value:function(e){return e.kinds.concat(e.relators).concat(e.roles).concat(e.subsystems)}},{key:"hookSystemObject",value:function(e){return e}},{key:"hookConnection",value:function(e){return e}},{key:"hookSubsystem",value:function(e){return e}},{key:"mapSystemObject",value:function(e){return this.hookSystemObject({group:"nodes",data:{id:e.id,label:"<<".concat(e.type.toString(),">>\n").concat(e.name),systemObject:e,parent:e.parent},position:{x:e.posX,y:e.posY},classes:[e.type.toString()]})}},{key:"mapConnection",value:function(e){return this.hookConnection({group:"edges",data:{id:e.id,label:e.label?e.label:"",source:e.source,target:e.target,connection:e},pannable:!0,classes:e.isOriented?["arrow-edge"]:[]})}},{key:"mapSubsystem",value:function(e){return this.hookSubsystem({group:"nodes",data:{id:e.id,label:e.name,subsystem:e},position:{x:e.posX,y:e.posY},classes:["subsystem"]})}}]),e}();function Ee(e){return e.type===N.role}function ve(e){return Ee(e)&&e.possibleHarms.length>0}var ge=function(e){Object(E.a)(a,e);var t=Object(v.a)(a);function a(){return Object(y.a)(this,a),t.apply(this,arguments)}return Object(f.a)(a,[{key:"hookSystemObject",value:function(e){return Ee(e.data.systemObject)?ve(e.data.systemObject)&&(e.classes=["mishap-victim"]):e.classes=[e.data.systemObject.type.toString(),"faded"],e.grabbable=!1,e}},{key:"hookConnection",value:function(e){var t=["faded"];return e.data.connection.isOriented&&t.push("arrow-edge"),e.classes=t,e}},{key:"hookSubsystem",value:function(e){return e.grabbable=!1,e}}]),a}(fe),je=function(e){Object(E.a)(a,e);var t=Object(v.a)(a);function a(e){var n;return Object(y.a)(this,a),(n=t.call(this,e)).getRoleFromEvent=n.getRoleFromEvent.bind(Object(j.a)(n)),n.mouseEntered=n.mouseEntered.bind(Object(j.a)(n)),n.mouseLeft=n.mouseLeft.bind(Object(j.a)(n)),n.selectRole=n.selectRole.bind(Object(j.a)(n)),n.clearRoleSelection=n.clearRoleSelection.bind(Object(j.a)(n)),n.state={selectedRoleId:"",isMouseOverRole:!1},n}return Object(f.a)(a,[{key:"render",value:function(){var e=this,t=(new ge).mapSystemDescription(this.props.systemDescription);return r.a.createElement(r.a.Fragment,null,r.a.createElement(ye,{elements:t,cursorStyle:this.state.isMouseOverRole?"pointer":"default",graphClicked:this.clearRoleSelection,mouseEnteredNode:this.mouseEntered,mouseLeftNode:this.mouseLeft,nodeClicked:this.selectRole}),r.a.createElement(te,{selectedRole:this.props.systemDescription.roles.find((function(t){return t.id===e.state.selectedRoleId})),possibleHarmsUpdated:this.props.possibleHarmsUpdated}))}},{key:"getRoleFromEvent",value:function(e){var t=e.target.element().data();if(me(t)&&Ee(t.systemObject))return t.systemObject}},{key:"mouseEntered",value:function(e){this.getRoleFromEvent(e)&&this.setState(Object(l.a)({},this.state,{},{isMouseOverRole:!0}))}},{key:"mouseLeft",value:function(e){this.getRoleFromEvent(e)&&this.setState(Object(l.a)({},this.state,{},{isMouseOverRole:!1}))}},{key:"selectRole",value:function(e){var t=this.getRoleFromEvent(e);t&&(e.preventDefault(),this.setState(Object(l.a)({},this.state,{},{selectedRoleId:t.id})))}},{key:"clearRoleSelection",value:function(e){e.isDefaultPrevented()||this.setState(Object(l.a)({},this.state,{},{selectedRoleId:""}))}}]),a}(r.a.Component),Oe=a(171),Ce=a(172),Se=a(166),ze=a(167),ke=a(168),xe=a(162),De=a(163),we=a(169),Fe=Object(m.a)((function(e){return{chip:{marginRight:e.spacing(1)}}})),Ne=function(e){var t=Fe();return r.a.createElement(xe.a,null,r.a.createElement(De.a,{component:"th",scope:"row"},e.role.name),r.a.createElement(De.a,{align:"left"},e.role.possibleHarms.sort((function(e,t){return e.localeCompare(t)})).map((function(a,n){return r.a.createElement(U.a,{className:t.chip,key:n,label:a,variant:"outlined",onDelete:function(){return function(t){var a=e.role.possibleHarms.filter((function(e){return e!==t}));e.harmsUpdated(Object(l.a)({},e.role,{},{possibleHarms:a}))}(a)}})}))),r.a.createElement(De.a,{align:"right"},r.a.createElement("form",{action:"#",onSubmit:function(t){var a=t.currentTarget,n=a.elements.namedItem("harm").value;a.reset(),t.preventDefault();var r=e.role.possibleHarms.concat(n);e.harmsUpdated(Object(l.a)({},e.role,{},{possibleHarms:r}))}},r.a.createElement(W.a,{required:!0,autoFocus:!0,margin:"dense",type:"text",name:"harm",placeholder:"Add Harm",autoComplete:"off"}),r.a.createElement(O.a,{size:"small",type:"submit",edge:"end",title:"Add"},r.a.createElement(J.a,null)))))},Ae=a(160),He=a(191),Ie=a(190),Re=a(164),Ue=Object(m.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120}}})),Pe=function(e){var t=Ue();return r.a.createElement(xe.a,null,r.a.createElement(De.a,null,r.a.createElement(Ae.a,{className:t.formControl},r.a.createElement(He.a,{id:"label-select-role"},"Select role"),r.a.createElement(Ie.a,{labelId:"label-select-role",onChange:function(t){var a=t.target.value;e.roleSelected(e.roles.find((function(e){return e.id===a})))},value:""},e.roles.sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(e){return r.a.createElement(Re.a,{key:e.id,value:e.id},e.name)}))))),r.a.createElement(De.a,{colSpan:2}))},Me=a(165),Ve=Object(m.a)((function(e){return{button:{marginLeft:e.spacing(2),marginTop:e.spacing(2),marginBottom:e.spacing(2)+40}}})),Te=function(e){var t=Ve();return r.a.createElement(Me.a,{className:t.button,variant:"contained",color:"primary",onClick:e.onClick,disabled:e.disabled},e.children)},_e=function(e){var t=Object(n.useState)([]),a=Object(o.a)(t,2),i=a[0],s=a[1],l=Object(n.useState)(!1),c=Object(o.a)(l,2),d=c[0],m=c[1],u=e.roles.filter((function(e){return ve(e)&&!i.some((function(t){return t===e.id}))})).sort((function(e,t){return e.name.localeCompare(t.name)})),p=e.roles.filter((function(e){return i.some((function(t){return t===e.id}))})),h=u.concat(p),b=e.roles.filter((function(e){return!h.some((function(t){return t.id===e.id}))}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(Se.a,null,r.a.createElement(ze.a,{size:"small"},r.a.createElement(ke.a,null,r.a.createElement(xe.a,null,r.a.createElement(De.a,null,"Mishap Victims"),r.a.createElement(De.a,{align:"left"},"Possible Harms"),r.a.createElement(De.a,{align:"right"},"\xa0"))),r.a.createElement(we.a,null,d||0!==h.length?h.map((function(t){return r.a.createElement(Ne,{key:t.id,role:t,harmsUpdated:e.possibleHarmsUpdated})})):r.a.createElement(xe.a,null,r.a.createElement(De.a,{align:"center",colSpan:3},"No mishap victims identified")),d?r.a.createElement(Pe,{roles:b,roleSelected:function(e){s(i.concat(e.id)),m(!1)}}):void 0))),r.a.createElement(Te,{onClick:function(){!d&&m(!0)},disabled:0===b.length},0===b.length?"All mishap victims have been identified":"Add new mishap victim"))},Ye=a(170),Xe=Object(m.a)((function(e){return{fab:{position:"fixed",marginBottom:e.spacing(2),marginLeft:e.spacing(2),bottom:0,zIndex:110}}})),Le=function(e){var t=Xe();return r.a.createElement(Ye.a,{variant:"extended",className:t.fab,size:"medium",onClick:e.onClick},e.children)},Be=function(e){var t=Object(n.useState)(!0),a=Object(o.a)(t,2),i=a[0],s=a[1],l=function(t){var a=e.system.roles.map((function(e){return e.id===t.id?t:e}));e.possibleHarmsUpdated({roles:a})};return i?r.a.createElement(r.a.Fragment,null,r.a.createElement(Le,{onClick:function(){return s(!1)}},r.a.createElement(Oe.a,null),"Table View"),r.a.createElement(je,{systemDescription:e.system,possibleHarmsUpdated:l})):r.a.createElement(r.a.Fragment,null,r.a.createElement(Le,{onClick:function(){return s(!0)}},r.a.createElement(Ce.a,null),"Graph View"),r.a.createElement(_e,{roles:e.system.roles,possibleHarmsUpdated:l}))},qe=a(178),Ge=a(179);function We(e){return"".concat(e,"-").concat((new Date).getTime())}var Ke=Object(m.a)((function(e){return{root:{position:"fixed",bottom:0,zIndex:110},fab:{marginBottom:e.spacing(1),marginLeft:e.spacing(2),display:"flex"}}})),Je=function(e){var t=Ke();return r.a.createElement("div",{className:t.root},e.buttons.map((function(e,a){return r.a.createElement(Ye.a,{key:a,className:t.fab,size:"small",color:"primary",variant:"extended",onClick:e.action},e.icon,e.text)})))},Ze=a(109),$e=a(173),Qe=a(174),et=a(175),tt=Object(m.a)((function(e){return{formControl:{marginTop:e.spacing(1)},selectEmpty:{marginTop:e.spacing(2)}}})),at=function(e){var t,a=Object(n.useState)(e.entity),i=Object(o.a)(a,2),s=i[0],c=i[1],d=tt();if(z(s)){var m=e.subsystemsAvailable.sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(e){return r.a.createElement(Re.a,{key:e.id,value:e.id},e.name)})),u="";s.parent&&(u=s.parent);t=r.a.createElement(Ae.a,{className:d.formControl},r.a.createElement(He.a,{shrink:!0,id:"label-subsystem"},"Subsystem"),r.a.createElement(Ie.a,{labelId:"label-subsystem",value:u,onChange:function(e){var t;""!==e.target.value&&(t=e.target.value),c(Object(l.a)({},s,{},{parent:t}))},displayEmpty:!0,disabled:0===m.length,className:d.selectEmpty},r.a.createElement(Re.a,{key:"-1",value:""},r.a.createElement("em",null,"None")),m))}return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ze.a,{open:!!e.entity}),r.a.createElement($e.a,{open:!!e.entity},r.a.createElement("form",{autoComplete:"off",onSubmit:function(t){e.entityUpdated(s),t.preventDefault()},onReset:function(){return e.editCancelled()}},r.a.createElement(Qe.a,null,r.a.createElement(W.a,{required:!0,autoFocus:!0,margin:"dense",id:"name",label:"Name",type:"text",fullWidth:!0,defaultValue:s.name,onChange:function(e){c(Object(l.a)({},s,{},{name:e.target.value}))}}),t),r.a.createElement(et.a,null,r.a.createElement(Me.a,{type:"submit",variant:"contained",color:"primary"},"OK"),r.a.createElement(Me.a,{type:"reset",color:"primary"},"Cancel")))))},nt=Object(m.a)((function(){return{popper:{zIndex:100}}})),rt=function(e){var t=Object(n.createRef)(),a=Object(n.useState)(null),i=Object(o.a)(a,2),s=i[0],l=i[1];Object(n.useEffect)((function(){if(t.current&&!s){var a=e.element.popper({content:function(){return t.current},popper:{placement:e.placement?e.placement:"top"}});e.element.on("position",a.scheduleUpdate),l(a)}return function(){s&&(e.element.off("position",void 0,s.scheduleUpdate),s.destroy())}}),[t,s,e.element,e.placement]);var c=nt();return r.a.createElement("div",{ref:t,className:c.popper},e.children)},it=function(e){var t=function(e,t){var a=t.systemObjectConnections.filter((function(t){return t.id!==e.id})),n=t.hazards.filter((function(t){return t.mishapVictim.id!==e.target&&t.exposure.id!==e.target&&t.hazardElement.id!==e.target&&t.hazardElementEnvObj.id!==e.target&&t.mishapVictimEnvObj.id!==e.target}));return Object(l.a)({},t,{},{systemObjectConnections:a,hazards:n})},a=function(e,a,n){var r=function(e,t){switch(e.type){case N.kind:return Object(l.a)({},t,{},{kinds:t.kinds.filter((function(t){return t.id!==e.id}))});case N.relator:return Object(l.a)({},t,{},{relators:t.relators.filter((function(t){return t.id!==e.id}))});case N.role:return Object(l.a)({},t,{},{roles:t.roles.filter((function(t){return t.id!==e.id}))});default:throw new Error("Unknown entity type")}}(e,n);return r=a.connectedEdges().reduce((function(e,a){var n=a.data();return pe(n)?t(n.connection,e):e}),r)},n=function(e,t,n){var r=function(e,t){return Object(l.a)({},t,{},{subsystems:t.subsystems.filter((function(t){return t.id!==e.id}))})}(e,n);return r=t.children().reduce((function(e,t){var n=t.data();return me(n)?a(n.systemObject,t,e):e}),r)};return r.a.createElement(O.a,{size:"small",title:"Delete",onClick:function(){var r=e.system,i=e.element.data();if(pe(i))r=t(i.connection,r);else if(me(i)&&e.element.isNode())r=a(i.systemObject,e.element,r);else if(ue(i)&&e.element.isNode()){if(!e.element.isChildless()&&!window.confirm("All the objects in the subsystem will be removed as well. Continue?"))return;r=n(i.subsystem,e.element,r)}e.systemUpdated(r)}},r.a.createElement(K.a,null))},st={x:100,y:50},ot=function(e){Object(E.a)(a,e);var t=Object(v.a)(a);function a(e){var n;return Object(y.a)(this,a),(n=t.call(this,e)).showNodeActions=n.showNodeActions.bind(Object(j.a)(n)),n.hideNodeActions=n.hideNodeActions.bind(Object(j.a)(n)),n.tryCreateConnection=n.tryCreateConnection.bind(Object(j.a)(n)),n.updateEntity=n.updateEntity.bind(Object(j.a)(n)),n.completeEditEntity=n.completeEditEntity.bind(Object(j.a)(n)),n.modifySystemDescription=n.modifySystemDescription.bind(Object(j.a)(n)),n.updateNodePosition=n.updateNodePosition.bind(Object(j.a)(n)),n.validateConnection=n.validateConnection.bind(Object(j.a)(n)),n.preventOverlap=n.preventOverlap.bind(Object(j.a)(n)),n.cancelEditEntity=n.cancelEditEntity.bind(Object(j.a)(n)),n.renderConnectionActions=n.renderConnectionActions.bind(Object(j.a)(n)),n.updateHazards=n.updateHazards.bind(Object(j.a)(n)),n.state={isConnectionValid:!1},n}return Object(f.a)(a,[{key:"render",value:function(){var e=(new fe).mapSystemDescription(this.props.system),t="top";this.props.elementDisplayPopper&&this.props.elementDisplayPopper.isNode()&&(t=me(this.props.elementDisplayPopper.data())?"top-start":"bottom-start");var a="default";this.props.nodeConnecting&&(a=this.state.isConnectionValid?"pointer":"not-allowed");var n=r.a.createElement(r.a.Fragment,null),i=this.props.elementDisplayPopper;if(i)if(i.isEdge())n=this.props.renderConnectionActions?this.props.renderConnectionActions(i):this.renderConnectionActions(i);else if(i.isNode()){var s=i.data();me(s)?n=this.props.renderSystemObjectActions(s.systemObject,i):ue(s)&&(n=this.props.renderSubsystemActions(s.subsystem,i))}return r.a.createElement(r.a.Fragment,null,r.a.createElement(ye,{elements:e,cursorStyle:a,graphClicked:this.props.nodeConnectingDone,nodeClicked:this.tryCreateConnection,mouseEnteredNode:this.showNodeActions,mouseLeftNode:this.hideNodeActions,nodeMoved:this.updateNodePosition,useCollapseApi:!0}),this.props.toolbarButtons,this.props.elementDisplayPopper?r.a.createElement(rt,{element:this.props.elementDisplayPopper,placement:t},n):void 0,this.props.objectEditing?r.a.createElement(at,{entity:this.props.objectEditing,subsystemsAvailable:this.props.system.subsystems,entityUpdated:this.completeEditEntity,editCancelled:this.cancelEditEntity}):void 0)}},{key:"renderConnectionActions",value:function(e){return this.props.tryCreateConnection(e.source(),e.target())?r.a.createElement(it,{element:e,system:this.props.system,systemUpdated:this.props.systemUpdated}):r.a.createElement(r.a.Fragment,null)}},{key:"showNodeActions",value:function(e){if(!this.props.elementDisplayPopper){var t=!1,a=e.target;a.isNode()&&(t=!!this.validateConnection(a)),this.setState(Object(l.a)({},this.state,{},{isConnectionValid:t})),this.props.elementDisplayPopperChanged(e.target)}}},{key:"hideNodeActions",value:function(){this.setState(Object(l.a)({},this.state,{},{isConnectionValid:!1})),this.props.elementDisplayPopperChanged(null)}},{key:"tryCreateConnection",value:function(e){var t=e.target;if(t.isNode()){var a=this.validateConnection(t);a&&this.modifySystemDescription(a,(function(e,t){return e.concat(t)}))}this.props.nodeConnectingDone()}},{key:"validateConnection",value:function(e){return this.props.nodeConnecting&&this.props.nodeConnecting!==e&&0===this.props.nodeConnecting.edgesWith(e).length?this.props.tryCreateConnection(this.props.nodeConnecting,e):null}},{key:"updateNodePosition",value:function(e){var t=e.target,a=t.position(),n=t.data();if(me(n)){var r=n.systemObject;if(r.posX=a.x,r.posY=a.y,this.updateEntity(r),n.parent&&t.parent().length>0){var i=this.props.system.subsystems.find((function(e){return e.id===n.parent}));if(i){var s=t.parent()[0].position();i.posX=s.x,i.posY=s.y,this.updateEntity(i)}}}else if(ue(n)){var o=n.subsystem;o.posX=a.x,o.posY=a.y,this.updateEntity(o);for(var l=0;l<t.children().length;l++){var c=t.children()[l],d=c.data();if(me(d)){var m=d.systemObject,u=c.position();m.posX=u.x,m.posY=u.y,this.updateEntity(m)}}}}},{key:"updateHazards",value:function(e){var t=function(e){return e};switch(e.type){case N.relator:t=function(t){return t.exposure.id!==e.id?t:Object(l.a)({},t,{},{exposure:{id:e.id,name:e.name}})};break;case N.role:t=function(t){return t.mishapVictim.id!==e.id&&t.hazardElement.id!==e.id?t:Object(l.a)({},t,{},{mishapVictim:t.mishapVictim.id===e.id?{id:e.id,name:e.name}:t.mishapVictim,hazardElement:t.hazardElement.id===e.id?{id:e.id,name:e.name}:t.hazardElement})};break;case N.kind:t=function(t){return t.mishapVictimEnvObj.id!==e.id&&t.hazardElementEnvObj.id!==e.id?t:Object(l.a)({},t,{},{mishapVictimEnvObj:t.mishapVictimEnvObj.id===e.id?{id:e.id,name:e.name}:t.mishapVictimEnvObj,hazardElementEnvObj:t.hazardElementEnvObj.id===e.id?{id:e.id,name:e.name}:t.hazardElementEnvObj})}}var a=this.props.system.hazards.map(t);this.props.systemUpdated(Object(l.a)({},this.props.system,{},{hazards:a}))}},{key:"updateEntity",value:function(e){this.modifySystemDescription(e,(function(e,t){return e.map((function(e){return e.id===t.id?t:e}))}))}},{key:"modifySystemDescription",value:function(e,t){var a=this.props.system;if(x(e))a.subsystems=t(a.subsystems,e);else if(z(e))if(Ee(e))a.roles=t(a.roles,e);else switch(e.type){case N.kind:a.kinds=t(a.kinds,e);break;case N.relator:a.relators=t(a.relators,e);break;default:throw new Error("Unknown entity type")}else k(e)&&(a.systemObjectConnections=t(a.systemObjectConnections,e));this.props.systemUpdated(Object(l.a)({},this.props.system,{},a))}},{key:"cancelEditEntity",value:function(){this.props.objectEditingDone&&this.props.objectEditingDone()}},{key:"completeEditEntity",value:function(e){var t=(new fe).getAllNodes(this.props.system),a=t.find((function(t){return t.id===e.id}));if(a){if(z(e)&&z(a)){var n=null,r=void 0;if(!e.parent||a.parent&&a.parent===e.parent)!e.parent&&a.parent&&(n=st);else{var i=this.props.system.subsystems.find((function(t){return t.id===e.parent}));i&&(n={x:i.posX,y:i.posY},r=i.id)}if(n){var s=this.preventOverlap(n,t,r);e.posX=s.x,e.posY=s.y}e.name!==a.name&&this.updateHazards(e)}this.updateEntity(e)}else{var o,l=st;if(z(e)&&e.parent){var c=this.props.system.subsystems.find((function(t){return t.id===e.parent}));c&&(l={x:c.posX,y:c.posY},o=c.id)}var d=this.preventOverlap(l,t,o);e.posX=d.x,e.posY=d.y,this.modifySystemDescription(e,(function(e,t){return e.concat(t)}))}this.props.objectEditingDone&&this.props.objectEditingDone()}},{key:"preventOverlap",value:function(e,t,a){return t.every((function(t){return t.posX!==e.x&&t.posY!==e.y||t.id===a}))?e:this.preventOverlap({x:e.x+20,y:e.y+20},t)}}]),a}(r.a.Component),lt=a(176),ct=a(177),dt=function(e){return r.a.createElement(O.a,{title:e.subsystem.isCollapsed?"Expand":"Collapse",onClick:function(){var t=e.node.cy(),a=be(t),n=!e.subsystem.isCollapsed;n?a.collapse(e.node):a.expand(e.node),t.json(t.json()),t.zoom(1.1),t.pan({x:0,y:0});var r=e.system.subsystems.map((function(t){return t.id!==e.subsystem.id?t:Object(l.a)({},e.subsystem,{},{isCollapsed:n})}));e.systemUpdated(Object(l.a)({},e.system,{},{subsystems:r}))},size:"small"},e.subsystem.isCollapsed?r.a.createElement(lt.a,null):r.a.createElement(ct.a,null))},mt=function(e){Object(E.a)(a,e);var t=Object(v.a)(a);function a(e){var n;return Object(y.a)(this,a),(n=t.call(this,e)).tryCreateConnection=n.tryCreateConnection.bind(Object(j.a)(n)),n.startCreatingKind=n.startCreatingKind.bind(Object(j.a)(n)),n.startCreatingRole=n.startCreatingRole.bind(Object(j.a)(n)),n.startCreatingSubsystem=n.startCreatingSubsystem.bind(Object(j.a)(n)),n.renderSystemObjectActions=n.renderSystemObjectActions.bind(Object(j.a)(n)),n.renderSubsystemActions=n.renderSubsystemActions.bind(Object(j.a)(n)),n.state={nodeConnecting:null,objectEditing:null,elementDisplayPopper:null},n}return Object(f.a)(a,[{key:"render",value:function(){var e=this,t=r.a.createElement(Je,{buttons:[{icon:r.a.createElement(J.a,null),text:"Kind",action:this.startCreatingKind},{icon:r.a.createElement(J.a,null),text:"Role",action:this.startCreatingRole},{icon:r.a.createElement(J.a,null),text:"Subsystem",action:this.startCreatingSubsystem}]});return r.a.createElement(ot,{system:this.props.system,systemUpdated:this.props.systemUpdated,elementDisplayPopper:this.state.elementDisplayPopper,elementDisplayPopperChanged:function(t){return e.setState(Object(l.a)({},e.state,{},{elementDisplayPopper:t}))},nodeConnecting:this.state.nodeConnecting,nodeConnectingDone:function(){return e.setState(Object(l.a)({},e.state,{},{nodeConnecting:null}))},objectEditing:this.state.objectEditing,objectEditingDone:function(){return e.setState(Object(l.a)({},e.state,{},{objectEditing:null}))},toolbarButtons:t,tryCreateConnection:this.tryCreateConnection,renderSubsystemActions:this.renderSubsystemActions,renderSystemObjectActions:this.renderSystemObjectActions})}},{key:"renderSystemObjectActions",value:function(e,t){var a=this;return e.type===N.kind?r.a.createElement("div",{style:{position:"relative",top:"-5px",left:"-5px"}},r.a.createElement(O.a,{size:"small",title:"Connect to containing kind",onClick:function(){return a.setState(Object(l.a)({},a.state,{},{nodeConnecting:t}))}},r.a.createElement(qe.a,null)),r.a.createElement(O.a,{size:"small",title:"Edit",onClick:function(){return a.setState(Object(l.a)({},a.state,{},{objectEditing:e,elementDisplayPopper:null}))}},r.a.createElement(Ge.a,null)),r.a.createElement(it,{element:t,system:this.props.system,systemUpdated:this.props.systemUpdated})):e.type===N.role?r.a.createElement("div",{style:{position:"relative",top:"-5px",left:"-5px"}},r.a.createElement(O.a,{size:"small",title:"Edit",onClick:function(){return a.setState(Object(l.a)({},a.state,{},{objectEditing:e,elementDisplayPopper:null}))}},r.a.createElement(Ge.a,null)),r.a.createElement(it,{element:t,system:this.props.system,systemUpdated:this.props.systemUpdated})):r.a.createElement(r.a.Fragment,null)}},{key:"renderSubsystemActions",value:function(e,t){var a=this;return r.a.createElement("div",{style:{position:"relative",top:"5px",left:"-5px"}},r.a.createElement(dt,{node:t,subsystem:e,system:this.props.system,systemUpdated:this.props.systemUpdated}),r.a.createElement(O.a,{size:"small",title:"Edit",onClick:function(){return a.setState(Object(l.a)({},a.state,{},{objectEditing:e,elementDisplayPopper:null}))}},r.a.createElement(Ge.a,null)),r.a.createElement(it,{element:t,system:this.props.system,systemUpdated:this.props.systemUpdated}))}},{key:"tryCreateConnection",value:function(e,t){var a=e.data(),n=t.data();return me(a)&&me(n)&&a.systemObject.type===N.kind&&n.systemObject.type===N.kind?{id:We("connection"),source:a.systemObject.id,target:n.systemObject.id,label:"ispartof",isOriented:!0}:null}},{key:"startCreatingKind",value:function(){if(!this.state.objectEditing){var e={id:We("kind"),name:"",type:N.kind,posX:0,posY:0};this.setState(Object(l.a)({},this.state,{},{objectEditing:e}))}}},{key:"startCreatingRole",value:function(){if(!this.state.objectEditing){var e={id:We("role"),name:"",type:N.role,posX:0,posY:0,possibleHarms:[]};this.setState(Object(l.a)({},this.state,{},{objectEditing:e}))}}},{key:"startCreatingSubsystem",value:function(){if(!this.state.objectEditing){var e={id:We("subsystem"),name:"",posX:0,posY:0,isCollapsed:!1};this.setState(Object(l.a)({},this.state,{},{objectEditing:e}))}}}]),a}(r.a.Component),ut=function(e){Object(E.a)(a,e);var t=Object(v.a)(a);function a(e){var n;return Object(y.a)(this,a),(n=t.call(this,e)).tryCreateConnection=n.tryCreateConnection.bind(Object(j.a)(n)),n.renderSystemObjectActions=n.renderSystemObjectActions.bind(Object(j.a)(n)),n.renderSubsystemActions=n.renderSubsystemActions.bind(Object(j.a)(n)),n.state={nodeConnecting:null,objectEditing:null,elementDisplayPopper:null},n}return Object(f.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement(ot,{system:this.props.system,systemUpdated:this.props.systemUpdated,elementDisplayPopper:this.state.elementDisplayPopper,elementDisplayPopperChanged:function(t){return e.setState(Object(l.a)({},e.state,{},{elementDisplayPopper:t}))},nodeConnecting:this.state.nodeConnecting,nodeConnectingDone:function(){return e.setState(Object(l.a)({},e.state,{},{nodeConnecting:null}))},tryCreateConnection:this.tryCreateConnection,renderSubsystemActions:this.renderSubsystemActions,renderSystemObjectActions:this.renderSystemObjectActions})}},{key:"renderSystemObjectActions",value:function(e,t){var a=this;return e.type!==N.kind?r.a.createElement(r.a.Fragment,null):r.a.createElement("div",{style:{position:"relative",top:"-5px",left:"-5px"}},r.a.createElement(O.a,{size:"small",title:"Connect to role",onClick:function(){return a.setState(Object(l.a)({},a.state,{},{nodeConnecting:t}))}},r.a.createElement(qe.a,null)))}},{key:"renderSubsystemActions",value:function(e,t){return r.a.createElement("div",{style:{position:"relative",top:"5px",left:"-5px"}},r.a.createElement(dt,{node:t,subsystem:e,system:this.props.system,systemUpdated:this.props.systemUpdated}))}},{key:"tryCreateConnection",value:function(e,t){var a=e.data(),n=t.data();return me(a)&&a.systemObject.type===N.kind&&me(n)&&n.systemObject.type===N.role?{id:We("connection"),source:a.systemObject.id,target:n.systemObject.id,label:"play",isOriented:!0}:null}}]),a}(r.a.Component),pt=function(e){Object(E.a)(a,e);var t=Object(v.a)(a);function a(e){var n;return Object(y.a)(this,a),(n=t.call(this,e)).tryCreateConnection=n.tryCreateConnection.bind(Object(j.a)(n)),n.startCreatingRelator=n.startCreatingRelator.bind(Object(j.a)(n)),n.renderSystemObjectActions=n.renderSystemObjectActions.bind(Object(j.a)(n)),n.renderSubsystemActions=n.renderSubsystemActions.bind(Object(j.a)(n)),n.state={nodeConnecting:null,objectEditing:null,elementDisplayPopper:null},n}return Object(f.a)(a,[{key:"render",value:function(){var e=this,t=r.a.createElement(Je,{buttons:[{icon:r.a.createElement(J.a,null),text:"Relator",action:this.startCreatingRelator}]});return r.a.createElement(ot,{system:this.props.system,systemUpdated:this.props.systemUpdated,elementDisplayPopper:this.state.elementDisplayPopper,elementDisplayPopperChanged:function(t){return e.setState(Object(l.a)({},e.state,{},{elementDisplayPopper:t}))},nodeConnecting:this.state.nodeConnecting,nodeConnectingDone:function(){return e.setState(Object(l.a)({},e.state,{},{nodeConnecting:null}))},objectEditing:this.state.objectEditing,objectEditingDone:function(){return e.setState(Object(l.a)({},e.state,{},{objectEditing:null}))},toolbarButtons:t,tryCreateConnection:this.tryCreateConnection,renderSubsystemActions:this.renderSubsystemActions,renderSystemObjectActions:this.renderSystemObjectActions})}},{key:"renderSystemObjectActions",value:function(e,t){var a=this;return e.type===N.relator?r.a.createElement("div",{style:{position:"relative",top:"-5px",left:"-5px"}},r.a.createElement(O.a,{size:"small",title:"Connect to role",onClick:function(){return a.setState(Object(l.a)({},a.state,{},{nodeConnecting:t}))}},r.a.createElement(qe.a,null)),r.a.createElement(O.a,{size:"small",title:"Edit",onClick:function(){return a.setState(Object(l.a)({},a.state,{},{objectEditing:e,elementDisplayPopper:null}))}},r.a.createElement(Ge.a,null)),r.a.createElement(it,{element:t,system:this.props.system,systemUpdated:this.props.systemUpdated})):e.type===N.role?r.a.createElement("div",{style:{position:"relative",top:"-5px",left:"-5px"}},r.a.createElement(O.a,{size:"small",title:"Connect to relator",onClick:function(){return a.setState(Object(l.a)({},a.state,{},{nodeConnecting:t}))}},r.a.createElement(qe.a,null))):r.a.createElement(r.a.Fragment,null)}},{key:"renderSubsystemActions",value:function(e,t){return r.a.createElement("div",{style:{position:"relative",top:"5px",left:"-5px"}},r.a.createElement(dt,{node:t,subsystem:e,system:this.props.system,systemUpdated:this.props.systemUpdated}))}},{key:"tryCreateConnection",value:function(e,t){var a=e.data(),n=t.data();if(me(a)&&me(n)){if(a.systemObject.type===N.role&&n.systemObject.type===N.relator)return{id:We("connection"),source:a.systemObject.id,target:n.systemObject.id,label:"",isOriented:!1};if(a.systemObject.type===N.relator&&n.systemObject.type===N.role)return{id:We("connection"),source:n.systemObject.id,target:a.systemObject.id,label:"",isOriented:!1}}return null}},{key:"startCreatingRelator",value:function(){if(!this.state.objectEditing){var e={id:We(N.relator.toString()),name:"",type:N.relator,posX:0,posY:0};this.setState(Object(l.a)({},this.state,{},{objectEditing:e}))}}}]),a}(r.a.Component),ht=function(e){Object(E.a)(a,e);var t=Object(v.a)(a);function a(e){var n;return Object(y.a)(this,a),(n=t.call(this,e)).tryCreateConnection=n.tryCreateConnection.bind(Object(j.a)(n)),n.renderSystemObjectActions=n.renderSystemObjectActions.bind(Object(j.a)(n)),n.renderSubsystemActions=n.renderSubsystemActions.bind(Object(j.a)(n)),n.renderConnectionActions=n.renderConnectionActions.bind(Object(j.a)(n)),n.state={nodeConnecting:null,objectEditing:null,elementDisplayPopper:null},n}return Object(f.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement(ot,{system:this.props.system,systemUpdated:this.props.systemUpdated,elementDisplayPopper:this.state.elementDisplayPopper,elementDisplayPopperChanged:function(t){return e.setState(Object(l.a)({},e.state,{},{elementDisplayPopper:t}))},nodeConnecting:this.state.nodeConnecting,nodeConnectingDone:function(){return e.setState(Object(l.a)({},e.state,{},{nodeConnecting:null}))},tryCreateConnection:this.tryCreateConnection,renderSubsystemActions:this.renderSubsystemActions,renderSystemObjectActions:this.renderSystemObjectActions,renderConnectionActions:this.renderConnectionActions})}},{key:"renderSystemObjectActions",value:function(e,t){var a=this;return e.type!==N.role?r.a.createElement(r.a.Fragment,null):r.a.createElement("div",{style:{position:"relative",top:"-5px",left:"-5px"}},r.a.createElement(O.a,{size:"small",title:"Connect to kind",onClick:function(){return a.setState(Object(l.a)({},a.state,{},{nodeConnecting:t}))}},r.a.createElement(qe.a,null)))}},{key:"renderSubsystemActions",value:function(e,t){return r.a.createElement("div",{style:{position:"relative",top:"5px",left:"-5px"}},r.a.createElement(dt,{node:t,subsystem:e,system:this.props.system,systemUpdated:this.props.systemUpdated}))}},{key:"renderConnectionActions",value:function(e){return this.tryCreateConnection(e.target(),e.source())?r.a.createElement(it,{element:e,system:this.props.system,systemUpdated:this.props.systemUpdated}):r.a.createElement(r.a.Fragment,null)}},{key:"tryCreateConnection",value:function(e,t){var a=e.data(),n=t.data();return me(a)&&a.systemObject.type===N.role&&me(n)&&n.systemObject.type===N.kind?{id:We("connection"),source:n.systemObject.id,target:a.systemObject.id,label:"play",isOriented:!0}:null}}]),a}(r.a.Component);function bt(e){var t=e.data();if(me(t))return t.systemObject}function yt(e){var t=bt(e);if(t&&Ee(t))return t}var ft,Et,vt=a(4),gt=a(197),jt=a(180),Ot=function(e){return r.a.createElement(r.a.Fragment,null,"H",e.hazard.id)},Ct=Object(vt.a)((function(e){return Object(gt.a)({sizeSmall:{padding:e.spacing(1)}})}))(De.a),St=function(e){var t=Object(n.useState)(!1),a=Object(o.a)(t,2),i=a[0],s=a[1],c=Object(n.useState)(e.hazard.harmTruthmaker),d=Object(o.a)(c,2),m=d[0],u=d[1],p=Object(n.useState)(e.hazard.description),h=Object(o.a)(p,2),b=h[0],y=h[1];return r.a.createElement(xe.a,{key:e.index},r.a.createElement(Ct,null,r.a.createElement(Ot,{hazard:e.hazard})),r.a.createElement(Ct,null,e.hazard.mishapVictim.name,r.a.createElement("br",null),"(",e.hazard.mishapVictimEnvObj.name,")"),r.a.createElement(Ct,null,e.hazard.exposure.name),r.a.createElement(Ct,null,e.hazard.hazardElement.name,r.a.createElement("br",null),"(",e.hazard.hazardElementEnvObj.name,")"),r.a.createElement(Ct,null,i?r.a.createElement(W.a,{required:!0,autoFocus:!0,defaultValue:e.hazard.harmTruthmaker,margin:"none",type:"text",onChange:function(e){return u(e.target.value)},autoComplete:"off"}):e.hazard.harmTruthmaker),r.a.createElement(Ct,null,i?r.a.createElement(W.a,{required:!0,defaultValue:e.hazard.description,margin:"none",fullWidth:!0,type:"text",onChange:function(e){return y(e.target.value)},autoComplete:"off"}):e.hazard.description),r.a.createElement(Ct,null,i?r.a.createElement(O.a,{size:"small",onClick:function(){return function(){if(m!==e.hazard.harmTruthmaker||b!==e.hazard.description){var t=Object(l.a)({},e.hazard,{harmTruthmaker:m,description:b});e.hazardEdited(t)}s(!1)}()}},r.a.createElement(jt.a,null)):r.a.createElement(O.a,{size:"small",onClick:function(){return s(!0)}},r.a.createElement(Ge.a,null)),r.a.createElement(O.a,{size:"small",onClick:function(){return e.hazardDeleted(e.index)}},r.a.createElement(K.a,null))))},zt=Object(vt.a)((function(e){return Object(gt.a)({sizeSmall:{padding:e.spacing(1)}})}))(De.a),kt=Object(m.a)((function(){return{id:{width:"7%"},mishapVictim:{width:"15%"},exposure:{width:"10%"},hazardElement:{width:"15%"},harmTruthmaker:{width:"15%"},actions:{width:"10%"}}})),xt=function(e){var t=kt();return r.a.createElement(Se.a,null,r.a.createElement(ze.a,{size:"small"},r.a.createElement(ke.a,null,r.a.createElement(xe.a,null,r.a.createElement(zt,{className:t.id},"ID"),r.a.createElement(zt,{className:t.mishapVictim},"Mishap Victim",r.a.createElement("br",null),"(Env Obj)"),r.a.createElement(zt,{className:t.exposure},"Exposure"),r.a.createElement(zt,{className:t.hazardElement},"Hazard Element",r.a.createElement("br",null),"(Env Obj)"),r.a.createElement(zt,{className:t.harmTruthmaker},"Harm TruthMaker"),r.a.createElement(zt,null,"Hazard Description"),r.a.createElement(zt,{className:t.actions}))),r.a.createElement(we.a,null,0===e.hazards.length?r.a.createElement(xe.a,null,r.a.createElement(De.a,{colSpan:7,align:"center"},"No hazards identified")):e.hazards.sort((function(e,t){return e.id-t.id})).map((function(t,a){return r.a.createElement(St,{hazard:t,index:a,hazardEdited:e.hazardEdited,hazardDeleted:e.hazardDeleted})})))))},Dt=Object(m.a)((function(e){return{divide:{paddingRight:e.spacing(2)},select:{width:"220px"}}})),wt=function(e){var t=Dt(),a="";1===e.template.hazardElementEnvObjs.length&&(a=e.template.hazardElementEnvObjs[0].object.id);var i=Object(n.useState)(a),s=Object(o.a)(i,2),l=s[0],c=s[1],d=Object(n.useState)(""),m=Object(o.a)(d,2),u=m[0],p=m[1],h=Object(n.useState)(""),b=Object(o.a)(h,2),y=b[0],f=b[1],E=e.template.hazardElementEnvObjs.sort((function(e,t){return e.object.name.localeCompare(t.object.name)})).map((function(e,t){return r.a.createElement(Re.a,{key:t,value:e.object.id},e.object.name)}));return 0===e.template.hazardElementEnvObjs.length&&(E=[r.a.createElement(Re.a,{key:-1,value:"",disabled:!0},"Nothing found")]),r.a.createElement(xe.a,null,r.a.createElement(De.a,{colSpan:3},r.a.createElement("form",{action:"#",onSubmit:function(t){t.currentTarget.reset(),t.preventDefault();var a=e.template.hazardElementEnvObjs.find((function(e){return e.object.id===l}));if(a){var n={id:e.nextHazardId,harmTruthmaker:u,description:y,mishapVictim:{id:e.template.mishapVictim.id,name:e.template.mishapVictim.name},mishapVictimEnvObj:{id:e.template.mishapVictimEnvObj.object.id,name:e.template.mishapVictimEnvObj.object.name},exposure:{id:e.template.exposure.object.id,name:e.template.exposure.object.name},hazardElement:{id:e.template.hazardElement.object.id,name:e.template.hazardElement.object.name},hazardElementEnvObj:{id:a.object.id,name:a.object.name}};e.hazardCreated(n)}}},r.a.createElement(Ae.a,{className:t.divide},r.a.createElement(W.a,{required:!0,autoFocus:!0,margin:"none",type:"text",onChange:function(e){return p(e.target.value)},label:"Harm Truthmaker",autoComplete:"off",multiline:!0,rowsMax:4})),r.a.createElement(Ae.a,{className:t.divide},r.a.createElement(W.a,{required:!0,margin:"none",type:"text",onChange:function(e){return f(e.target.value)},label:"Hazard Description",autoComplete:"off",multiline:!0,rowsMax:4})),r.a.createElement(Ae.a,{className:t.select},r.a.createElement(He.a,{id:"label-select-env-obj"},"Hazard Evement Env Obj"),r.a.createElement(Ie.a,{required:!0,margin:"none",labelId:"label-select-env-obj",value:a,onChange:function(e){return c(e.target.value)}},E)),r.a.createElement(O.a,{type:"submit",edge:"end",title:"Create"},r.a.createElement(J.a,null)))))},Ft=Object(vt.a)((function(e){return Object(gt.a)({root:{backgroundColor:e.palette.grey[200],cursor:"pointer"}})}))(xe.a),Nt=Object(m.a)((function(e){return{header:{marginLeft:e.spacing(2)}}})),At=function(e){var t=Nt(),a=Object(n.useState)(null),i=Object(o.a)(a,2),s=i[0],l=i[1],c=Object(n.useState)([]),d=Object(o.a)(c,2),m=d[0],u=d[1];Object(n.useEffect)((function(){var t=yt(e.node);if(!t||!ve(t))throw new Error("Entity passed is not a mishap victim");var a=function(e,t){if(e.isEdge()){var a=bt(t?e.source():e.target()),n=function(e){var t=e.data();if(pe(t))return t.connection}(e);if(a&&n)return{object:a,connection:n}}return null};u(function(t){for(var n=[],r=e.node.incomers(),i=e.node.outgoers(),s=i.incomers(),o=[],l=s.incomers(),c=0;c<l.length;c++){var d=a(l[c],!0);d&&o.push(d)}for(var m=0;m<r.length;m++){var u=a(r[m],!0);if(u)for(var p=0;p<i.length;p++){var h=a(i[p],!1);if(h)for(var b=function(e){var r=a(s[e],!0);if(!r)return"continue";n.push({mishapVictim:t,mishapVictimEnvObj:u,exposure:h,hazardElement:r,hazardElementEnvObjs:o.filter((function(e){return e.connection.target===r.object.id}))})},y=0;y<s.length;y++)b(y)}}return n}(t))}),[e.node]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(h.a,{container:!0},r.a.createElement(h.a,{item:!0,xs:12},r.a.createElement(_.a,{variant:"caption",className:t.header},"Select a table row to add"))),r.a.createElement(Se.a,null,r.a.createElement(ze.a,{size:"small"},r.a.createElement(ke.a,null,r.a.createElement(xe.a,null,r.a.createElement(De.a,null,"Mishap Victim (Env Obj)"),r.a.createElement(De.a,null,"Exposure"),r.a.createElement(De.a,null,"Hazard Element"))),r.a.createElement(we.a,null,0===m.length?r.a.createElement(xe.a,null,r.a.createElement(De.a,{colSpan:3,align:"center"},"No possible hazards found")):m.map((function(t,a){return r.a.createElement(r.a.Fragment,{key:a},r.a.createElement(Ft,{onClick:function(){return l(t)}},r.a.createElement(De.a,null,t.mishapVictim.name," (",t.mishapVictimEnvObj.object.name,")"),r.a.createElement(De.a,null,t.exposure.object.name),r.a.createElement(De.a,null,t.hazardElement.object.name)),s!==t?r.a.createElement(r.a.Fragment,null):r.a.createElement(wt,{template:s,nextHazardId:e.nextHazardId,hazardCreated:e.hazardCreated}))}))))))},Ht=Object(m.a)((function(e){return{header:{marginLeft:e.spacing(2)},tableGutter:{marginBottom:e.spacing(2)},fabSpace:{marginBottom:e.spacing(2)+40}}})),It=function(e){var t=Ht(),a=yt(e.node);if(!a||!ve(a))throw new Error("Entity passed is not a mishap victim");return r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{variant:"h6",color:"textSecondary",className:t.header},"Possible Harms"),r.a.createElement(_.a,{variant:"body1",className:t.header,gutterBottom:!0},a.possibleHarms.join(", ")),r.a.createElement(_.a,{variant:"h6",color:"textSecondary",className:t.header},"Hazards"),r.a.createElement(xt,{hazards:e.hazards,hazardEdited:e.hazardEdited,hazardDeleted:e.hazardDeleted}),r.a.createElement("div",{className:t.tableGutter}),r.a.createElement(_.a,{variant:"h6",color:"textSecondary",className:t.header},"Add New Hazard"),r.a.createElement(At,{hazardCreated:e.hazardCreated,nextHazardId:e.nextHazardId,node:e.node}),r.a.createElement("div",{className:t.fabSpace}),r.a.createElement(Le,{onClick:e.close},"Back"))},Rt=function(e){var t=Object(n.useState)(!1),a=Object(o.a)(t,2),i=a[0],s=a[1],l=function(e){var t=yt(e.target.element());if(t&&ve(t))return t},c=function(e){s(!!l(e))},d=(new ge).mapSystemDescription(e.system);return r.a.createElement(r.a.Fragment,null,r.a.createElement(ye,{elements:d,cursorStyle:i?"pointer":"default",mouseEnteredNode:c,mouseLeftNode:c,nodeClicked:function(t){l(t)&&e.victimSelected(t.target)},cy:e.cyInitialized}),r.a.createElement(ee,null,r.a.createElement(_.a,null,"Click on a mishap victim to populate hazards"),r.a.createElement(_.a,{variant:"caption"},"Mishap victims are marked yellow")))},Ut=Object(m.a)((function(e){return{header:{marginLeft:e.spacing(2)},tableGutter:{marginBottom:e.spacing(2)},select:{marginLeft:e.spacing(2),width:"220px"}}})),Pt=function(e){var t=Ut(),a=Object(n.useState)(""),i=Object(o.a)(a,2),s=i[0],l=i[1],c=Object(n.useState)(null),d=Object(o.a)(c,2),m=d[0],u=d[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{variant:"h6",color:"textSecondary",className:t.header},"Hazards"),r.a.createElement(xt,{hazards:e.hazards,hazardEdited:e.hazardEdited,hazardDeleted:e.hazardDeleted}),r.a.createElement("div",{className:t.tableGutter}),r.a.createElement(_.a,{variant:"h6",color:"textSecondary",className:t.header},"Add New Hazard"),r.a.createElement(Ae.a,{className:t.select},r.a.createElement(He.a,{id:"label-select-mishap-victim"},"Select mishap victim"),r.a.createElement(Ie.a,{margin:"none",labelId:"label-select-mishap-victim",onChange:function(t){var a=t.target.value,n=e.getNode(a);n&&(l(a),u(n))},value:s},e.mishapVictims.sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(e,t){return r.a.createElement(Re.a,{key:t,value:e.id},e.name)})))),m?r.a.createElement(r.a.Fragment,null,r.a.createElement(At,{hazardCreated:e.hazardCreated,nextHazardId:e.nextHazardId,node:m})):void 0)},Mt=Object(m.a)((function(e){return{fabSpace:{height:e.spacing(2)+40}}})),Vt=function(e){var t=Mt(),a=Object(n.useState)(!1),i=Object(o.a)(a,2),s=i[0],c=i[1],d=Object(n.useState)(null),m=Object(o.a)(d,2),u=m[0],p=m[1],h=Object(n.useRef)(),b=function(t){return e.systemUpdated(Object(l.a)({},e.system,{},{hazards:e.system.hazards.concat(t),nextHazardId:e.system.nextHazardId+1}))},y=function(t){return e.systemUpdated(Object(l.a)({},e.system,{},{hazards:e.system.hazards.map((function(e){return e.id===t.id?t:e}))}))},f=function(t){return e.systemUpdated(Object(l.a)({},e.system,{},{hazards:e.system.hazards.filter((function(e){return e.id!==t}))}))};if(u){var E=bt(u);if(!E)throw new Error("Selected node does not represent a mishap victim");return r.a.createElement(It,{node:u,hazards:e.system.hazards.filter((function(e){return e.mishapVictim.id===E.id})),nextHazardId:e.system.nextHazardId,hazardCreated:b,hazardEdited:y,hazardDeleted:f,close:function(){return p(null)}})}return s?r.a.createElement(r.a.Fragment,null,r.a.createElement(Pt,{hazards:e.system.hazards,mishapVictims:e.system.roles.filter((function(e){return ve(e)})),getNode:function(e){if(!h.current)return null;var t=h.current.$("#".concat(e));return t.isNode()?t:null},hazardCreated:b,hazardEdited:y,hazardDeleted:f,nextHazardId:e.system.nextHazardId}),r.a.createElement("div",{className:t.fabSpace}),r.a.createElement(Le,{onClick:function(){return c(!1)}},r.a.createElement(Ce.a,null),"Graph View")):r.a.createElement(r.a.Fragment,null,r.a.createElement(Rt,{system:e.system,victimSelected:p,cyInitialized:function(e){return h.current=e}}),r.a.createElement(Le,{onClick:function(){return c(!0)}},r.a.createElement(Oe.a,null),"Table View"))},Tt=a(182),_t=a(183),Yt=Object(m.a)((function(e){return{input:{"& .MuiInput-input":{color:e.palette.common.white}},buttonGutter:{paddingLeft:e.spacing(1)}}})),Xt=function(e){var t=Yt(),a=Object(n.useState)(!1),i=Object(o.a)(a,2),s=i[0],l=i[1],c=Object(n.useState)(e.name),d=Object(o.a)(c,2),m=d[0],u=d[1],p=Object(n.useRef)();Object(n.useEffect)((function(){u(e.name)}),[e.name]);var h=function(e){e&&!p.current&&(e.select(),p.current=e)};return s?r.a.createElement("form",{onReset:function(){u(e.name),l(!1),p.current=void 0},onSubmit:function(t){t.preventDefault(),l(!1),e.nameUpdated(m),p.current=void 0}},r.a.createElement(W.a,{className:t.input,type:"text",required:!0,autoFocus:!0,onChange:function(e){return u(e.target.value)},value:m,inputRef:function(e){return h(e)}}),r.a.createElement(O.a,{type:"submit",size:"small",className:t.buttonGutter},r.a.createElement(Tt.a,null)),r.a.createElement(O.a,{type:"reset",size:"small"},r.a.createElement(_t.a,null))):r.a.createElement(_.a,{variant:"h6"},m,r.a.createElement(O.a,{size:"small",onClick:function(){return l(!0)},title:"Edit project name",className:t.buttonGutter},r.a.createElement(Ge.a,null)))},Lt=a(184),Bt=a(186),qt=a(185);!function(e){e.hazard="Hazard",e.initiatingCondition="Initiating Condition",e.initiatingEvent="Initiating Event",e.mishap="Mishap"}(ft||(ft={})),function(e){e[e.notSet=0]="notSet",e[e.situation=1]="situation",e[e.event=2]="event"}(Et||(Et={}));var Gt=function(e){var t,a,i=Object(n.useState)(Et.notSet),s=Object(o.a)(i,2),l=s[0],c=s[1],d=null;switch(l){case Et.notSet:t="Is the hazard description describing a situation (state of affairs) or an event?",d=r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Note that"),r.a.createElement("p",null,'1) if a hazard description describes that some event is supposed to occur but does not, then the hazard description is regarded as a generic situation that will not trigger the specific event, such as "the brake command is not issued",'),r.a.createElement("p",null,"and"),r.a.createElement("p",null,'2) if a hazard description describes a repetitive and continuous behavior, it can be regarded as a situation, such as "a train is running on the track".')),a=r.a.createElement(r.a.Fragment,null,r.a.createElement(Me.a,{size:"small",variant:"outlined",onClick:function(){return c(Et.situation)}},"Situation"),r.a.createElement(Me.a,{size:"small",variant:"outlined",onClick:function(){return c(Et.event)}},"Event"));break;case Et.situation:t="Can the situation trigger mishaps when some dispositions in the situation are manifested ?",a=r.a.createElement(r.a.Fragment,null,r.a.createElement(Me.a,{size:"small",variant:"outlined",onClick:function(){return e.complete(ft.hazard)}},"Yes \u2014 Hazard"),r.a.createElement(Me.a,{size:"small",variant:"outlined",onClick:function(){return e.complete(ft.initiatingCondition)}},"No \u2014 Initiating Condition"));break;case Et.event:t="Can the event bring about severe injuries of people or damages to the environment?",a=r.a.createElement(r.a.Fragment,null,r.a.createElement(Me.a,{size:"small",variant:"outlined",onClick:function(){return e.complete(ft.mishap)}},"Yes \u2014 Mishap"),r.a.createElement(Me.a,{size:"small",variant:"outlined",onClick:function(){return e.complete(ft.initiatingEvent)}},"No \u2014 Initiating Event"));break;default:throw new Error("Unknown intermediate category")}return r.a.createElement(Z.a,{variant:"outlined"},r.a.createElement(Lt.a,{action:r.a.createElement(O.a,{size:"small",onClick:e.cancel},r.a.createElement(qt.a,null)),title:t}),d?r.a.createElement($.a,null,r.a.createElement(_.a,{variant:"body2",component:"div"},d)):void 0,r.a.createElement(Bt.a,null,a))},Wt=function(e){var t=Object(n.useState)(!1),a=Object(o.a)(t,2),i=a[0],s=a[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(xe.a,null,r.a.createElement(De.a,null,r.a.createElement(Ot,{hazard:e.hazard})),r.a.createElement(De.a,null,e.hazard.description),r.a.createElement(De.a,null,e.hazard.category?e.hazard.category:"-"),r.a.createElement(De.a,null,r.a.createElement(Me.a,{variant:"outlined",onClick:function(){return s(!0)}},"Categorize"))),i?r.a.createElement(xe.a,null,r.a.createElement(De.a,{colSpan:4},r.a.createElement(Gt,{cancel:function(){return s(!1)},complete:function(t){s(!1),e.hazardUpdated(Object(l.a)({},e.hazard,{},{category:t}))}}))):void 0)},Kt=function(e){var t=function(t){e.systemUpdated({hazards:e.hazards.map((function(e){return e.id===t.id?t:e}))})};return r.a.createElement(r.a.Fragment,null,r.a.createElement(Se.a,null,r.a.createElement(ze.a,{size:"small"},r.a.createElement(ke.a,null,r.a.createElement(xe.a,null,r.a.createElement(De.a,null,"ID"),r.a.createElement(De.a,null,"Hazard Description"),r.a.createElement(De.a,null,"Category"),r.a.createElement(De.a,null))),r.a.createElement(we.a,null,0===e.hazards.length?r.a.createElement(xe.a,null,r.a.createElement(De.a,{colSpan:4},"No hazards identified")):e.hazards.map((function(e,a){return r.a.createElement(Wt,{key:a,hazard:e,hazardUpdated:t})}))))))},Jt=Object(m.a)((function(e){return{root:{display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},drawerOpen:{width:240},toolbar:Object(l.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:e.spacing(0,1)},e.mixins.toolbar),content:{flexGrow:1},appTitle:{textAlign:"center"}}})),Zt={projectName:"Hazard Ontology",currentStep:F(),lastCompletedStep:F(),kinds:[],roles:[],relators:[],systemObjectConnections:[],subsystems:[],hazards:[],nextHazardId:1},$t=function(){var e=Object(n.useState)(Zt),t=Object(o.a)(e,2),a=t[0],i=t[1],s=Object(n.useState)(!1),m=Object(o.a)(s,2),y=m[0],f=m[1];Object(c.useBeforeunload)((function(e){y&&e.preventDefault()}));var E=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&f(!0),i(Object(l.a)({},a,{},e))},v=Jt();return r.a.createElement(g,null,r.a.createElement(d.a,null),r.a.createElement("div",{className:v.root},r.a.createElement(u.a,{position:"fixed",className:v.appBar},r.a.createElement(p.a,{variant:"dense"},r.a.createElement(h.a,{container:!0,justify:"space-evenly"},r.a.createElement(h.a,{item:!0,xs:!0},r.a.createElement(A,{openFile:function(e){i(Zt),i(e),f(!1)},saveFile:function(){return f(!1),a},hasUnsavedChanges:y})),r.a.createElement(h.a,{item:!0,xs:6,className:v.appTitle},r.a.createElement(Xt,{name:a.projectName,nameUpdated:function(e){return E({projectName:e})}})),r.a.createElement(h.a,{item:!0,xs:!0},"\xa0")))),r.a.createElement(b.a,{variant:"permanent",className:v.drawerOpen,classes:{paper:v.drawerOpen}},r.a.createElement("div",{className:v.toolbar}),r.a.createElement(G,{progress:a,progressUpdated:E})),r.a.createElement("main",{className:v.content},r.a.createElement("div",{className:v.toolbar}),function(){switch(a.currentStep){case D.SDF_1:return r.a.createElement(mt,{system:a,systemUpdated:E});case D.SDF_2:return r.a.createElement(ut,{system:a,systemUpdated:E});case D.SDF_3:return r.a.createElement(pt,{system:a,systemUpdated:E});case D.SDF_4:return r.a.createElement(ht,{system:a,systemUpdated:E});case D.OHI_2:return r.a.createElement(Be,{system:a,possibleHarmsUpdated:E});case D.OHI_3:return r.a.createElement(Vt,{system:a,systemUpdated:E});case D.OCH_1:return r.a.createElement(Kt,{hazards:a.hazards,systemUpdated:E})}}())))};s.a.render(r.a.createElement($t,null),document.getElementById("root"))},86:function(e,t,a){e.exports=a(107)}},[[86,1,2]]]);
//# sourceMappingURL=main.ad675f50.chunk.js.map