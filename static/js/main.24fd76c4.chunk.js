(this["webpackJsonphazard-ontology-front-end"]=this["webpackJsonphazard-ontology-front-end"]||[]).push([[0],{118:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(16),c=n.n(i),l=n(4),o=n(86),s=(n(103),n(201)),u=n(151),d=n(202),m=n(203),p=n(196),b=n(207),h=n(8),f=n(17),E=n(18),y=n(21),O=n(20),v=function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(f.a)(this,n),(a=t.call(this,e)).state={},a}return Object(E.a)(n,[{key:"componentDidCatch",value:function(e){this.setState({error:e})}},{key:"render",value:function(){return this.state.error?r.a.createElement("h1",null,"ERROR: "+this.state.error.message):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{error:e}}}]),n}(a.Component),j=n(154),g=n(156);function C(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return{type:"SHOW_CONFIRMATION_DIALOG",payload:{contentText:e,onYes:t,onNo:n}}}function S(e){return C("You have unsaved changes that will be lost. Continue ?",e)}function z(e,t){return{type:e,payload:t,unsavedChanges:!0}}function k(e){return z("UPDATE_HAZARD",e)}function D(e){return z("DELETE_HAZARD",e)}function x(e){return z("UPDATE_SUBSYSTEM",e)}function A(e){return z("DELETE_SYSTEM_OBJECT",e)}function N(){return{type:"RESET_MODEL"}}function w(e,t){return z("ADD_POSSIBLE_HARM",{mishapVictim:e,harm:t})}function _(e,t,n,a){var r=z("REMOVE_POSSIBLE_HARM",{mishapVictim:e,harm:t});if(1===e.possibleHarms.length){var i=n.filter((function(t){return t.mishapVictim.id===e.id}));if(i.length>0)return void a(C("This mishap victim has hazard(s) associated with it. If you delete the only possible harm it will no longer be a mishap victim and all it's hazards will be deleted. Continue?",(function(){a(r),i.forEach((function(e){return a(D(e))}))})))}a(r)}var T={resetSystemModel:N,setSystemModel:function(e){return{type:"LOAD_MODEL",payload:e}},confirmDiscardModel:S},M=Object(h.b)((function(e){return{hasUnsavedChanges:e.unsavedChanges}}),T),H=Object(u.a)((function(){return{inlineBlock:{display:"inline-block"},hidden:{display:"none"}}})),R=M((function(e){var t=H(),n=Object(a.useRef)(),i=Object(a.useRef)(),c=function(){i.current&&i.current.click()},l=function(e){var t="Error reading a file";throw e.target&&e.target.error&&(t=e.target.error.message),new Error(t)},o=function(t){if(!t.target)throw new Error("Error reading a file");var a=t.target.result,r=JSON.parse(a);n.current&&n.current.reset(),e.resetSystemModel(),e.setSystemModel(r)};return window.FileReader&&window.FileList?r.a.createElement("form",{ref:function(e){return n.current=e},className:t.inlineBlock},r.a.createElement("input",{ref:function(e){return i.current=e},className:t.hidden,type:"file",onChange:function(e){return function(e){if(null!==e&&1===e.length){var t=e[0];if("application/json"!==t.type)throw new Error("File type not supported");var n=new FileReader;n.onload=o,n.onerror=l,n.readAsText(t,"utf-8")}}(e.target.files)},accept:".json"}),r.a.createElement(j.a,{title:"Open Project File",size:"small",color:"inherit",component:"span",onClick:function(){e.hasUnsavedChanges?e.confirmDiscardModel(c):c()}},r.a.createElement(g.a,null))):r.a.createElement("div",{title:"File API not supported",className:t.inlineBlock},r.a.createElement(j.a,{size:"small",color:"inherit",disabled:!0},r.a.createElement(g.a,null)))})),I=n(157),F=n(158);var P,L={saveChanges:function(){return{type:"SAVE_CHANGES"}}},V=Object(h.b)((function(e){return{systemModel:e.systemModel,hasUnsavedChanges:e.unsavedChanges}}),L)((function(e){return r.a.createElement(j.a,{size:"small",title:e.hasUnsavedChanges?"Download Project - You have unsaved changes":"Download Project",color:"inherit",onClick:function(){var t=e.systemModel,n=JSON.stringify(t,null,"\t"),a="".concat(t.projectName," ").concat((new Date).toISOString().replace(/:/g,"_"),".json"),r=document.createElement("a");r.setAttribute("href","data:application/json;charset=utf-8,"+encodeURIComponent(n)),r.setAttribute("download",a),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),e.saveChanges()}},r.a.createElement(I.a,{variant:"dot",color:"secondary",invisible:!e.hasUnsavedChanges},r.a.createElement(F.a,null)))})),U=n(159),Y={confirmDiscardModel:S,resetModel:N},B=Object(h.b)((function(e){return{hasUnsavedChanges:e.unsavedChanges}}),Y)((function(e){return r.a.createElement(j.a,{size:"small",title:"New Project",color:"inherit",onClick:function(){e.hasUnsavedChanges?e.confirmDiscardModel(e.resetModel):e.resetModel()}},r.a.createElement(U.a,null))})),X=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(B,null),r.a.createElement(R,null),r.a.createElement(V,null))},G=n(162),W=n(119),J=n(163),q=n(206),Z=n(164),K=n(165),$=n(166);!function(e){e.OHI="OHI",e.OHI_1="OHI-1",e.SDF_1="SDF-1",e.SDF_2="SDF-2",e.SDF_3="SDF-3",e.SDF_4="SDF-4",e.OHI_2="OHI-2",e.OHI_3="OHI-3",e.OCH="OCH",e.OCH_1="OCH-1",e.OCH_2="OCH-2",e.OCH_3="OCH-3",e.SARE="SARE",e.SARE_1="SARE-1",e.SARE_2="SARE-2",e.SARE_3="SARE-3",e.CM="CM"}(P||(P={}));function Q(){return P.SDF_1}function ee(e){switch(e){case P.SDF_1:return 1;case P.SDF_2:return 2;case P.SDF_3:return 3;case P.SDF_4:return 4;case P.OHI_2:return 5;case P.OHI_3:return 6;case P.OCH_1:return 7;case P.OCH_2:return 8;default:return-1}}var te,ne=[{id:P.OHI,label:"Identify Hazards",children:[{id:P.OHI_1,label:"Modelling",children:[{id:P.SDF_1,label:"Step 1",helpText:"Identify the <i>kind</i> and <i>role</i> objects explicitly presented in the system description."},{id:P.SDF_2,label:"Step 2",helpText:"For each <i>kind</i> object obtained in SDF-Step&nbsp;1, identify all the roles it can play, considering the system description."},{id:P.SDF_3,label:"Step 3",helpText:"For each <i>role</i> object obtained in SDF-Step&nbsp;1 and SDF-Step&nbsp;2, identify the relator that connects this role, and specify all the other roles connected by the identified relator, considering the system description and the analysts&apos; expertise."},{id:P.SDF_4,label:"Step 4",helpText:"For each <i>role</i> object obtained in SDF-Step&nbsp;1, SDF-Step&nbsp;2 and SDF-Step&nbsp;3, identify all the <i>kind</i> objects that can play the role, considering the system description."}]},{id:P.OHI_2,label:"Identify Victims",helpText:"Go through all the <i>roles</i> presented in the HO-style model and analyze if the roles are not supposed to but have the potential to encounter harms. Furthermore, the analysts continue with identifying possible harms that can affect the victims, including but not limited to, physical damages, chemical injuries, fatal illness, explosion, etc."},{id:P.OHI_3,label:"Identify Hazards",helpText:"Identify the hazardous situations that are likely to harm the identified mishap victims. Occurrence of a mishap is the manifestation of the <i>harm truthmaker</i> dispositions that characterize the <i>hazard element</i> roles in a hazardous situation. "}]},{id:P.OCH,label:"Identify Causes",children:[{id:P.OCH_1,label:"Categorize",helpText:"Categorize all the hazard descriptions into four categories, in terms of <b>Hazard</b>, <b>Initiating Condition</b>, <b>Initiating Event</b>, and/or <b>Mishap</b> based on the set of heuristic questions."},{id:P.OCH_2,label:"Expand",helpText:"Expand the categorized hazard description, taking both the expertise of analysts and the system description into consideration. "},{id:P.OCH_3,label:"Identify Causes",children:[]}]},{id:P.SARE,label:"Safety Requirements",children:[{id:P.SARE_1,label:"Evaluate Severity",children:[]},{id:P.SARE_2,label:"Evaluate Probability",children:[]},{id:P.SARE_3,label:"Safety Requirements",children:[]}]},{id:P.CM,label:"Control Mitigation",children:[]}],ae=n(10),re=n(213),ie=n(32),ce=n(160),le=n(161),oe=Object(u.a)((function(e){return{typography:{padding:e.appSpacing.standard,maxWidth:"320px"}}})),se=function(e){var t=oe(),n=Object(a.useState)(null),i=Object(ae.a)(n,2),c=i[0],l=i[1],o=Object(a.useState)(!1),s=Object(ae.a)(o,2),u=s[0],d=s[1];return Object(a.useEffect)((function(){d(e.open)}),[e.open]),r.a.createElement(r.a.Fragment,null,r.a.createElement(j.a,{ref:function(e){return l(e)},edge:"end",onClick:function(){return d(!0)}},e.highlighted?r.a.createElement(ce.a,null):r.a.createElement(le.a,null)),r.a.createElement(re.a,{open:u,anchorEl:c,onClose:function(){d(!1)},anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"}},r.a.createElement(ie.a,{variant:"body2",className:t.typography,dangerouslySetInnerHTML:{__html:e.htmlContent}})))},ue=Object(u.a)((function(e){return{label:{paddingLeft:e.spacing(1)},phase:{paddingLeft:e.spacing(4)},step:{paddingLeft:e.spacing(8)},bold:{fontWeight:"bold"}}})),de={setCurentStep:function(e){return{type:"UPDATE_FLOW_STEP",payload:e}}},me=Object(h.b)((function(e){return{currentStep:e.systemModel.currentStep,lastCompletedStep:e.systemModel.lastCompletedStep}}),de)((function(e){var t=ue();return r.a.createElement(G.a,{dense:!0},ne.map((function(n){return r.a.createElement(r.a.Fragment,{key:n.id},r.a.createElement(W.a,null,r.a.createElement(J.a,null,r.a.createElement(q.a,{label:n.id,variant:"outlined",color:"primary"})),r.a.createElement(Z.a,{primary:n.label,disableTypography:!0,className:"".concat(t.label," ").concat(t.bold)})),function n(a,i){return r.a.createElement(G.a,{disablePadding:!0,dense:!0},a.map((function(a){var c=ee(a.id),l=-1!==c,o=l&&a.id===e.currentStep,s=!l||c<=ee(e.lastCompletedStep)+1,u=a.id===e.currentStep&&a.id===e.lastCompletedStep;return r.a.createElement(r.a.Fragment,{key:a.id},r.a.createElement(W.a,{className:i,button:!0,disabled:!s,onClick:function(){return l&&e.setCurentStep(a.id)}},r.a.createElement(J.a,null,r.a.createElement(q.a,{size:"small",disabled:!s,label:a.id,color:o?"secondary":"primary",variant:l?"default":"outlined"})),r.a.createElement(Z.a,{primary:a.label,className:t.label}),a.helpText?r.a.createElement(K.a,null,r.a.createElement(se,{open:u,highlighted:o,htmlContent:a.helpText})):""),a.children?n(a.children,t.step):"")})))}(n.children,t.phase),r.a.createElement($.a,null))})))})),pe=n(209),be=n(170),he=n(171),fe=n(172),Ee={nameUpdated:function(e){return z("UPDATE_PROJECT_NAME",e)}},ye=Object(h.b)((function(e){return{name:e.systemModel.projectName}}),Ee),Oe=Object(u.a)((function(e){return{input:{"& .MuiInput-input":{color:e.palette.common.white}},buttonGutter:{paddingLeft:e.spacing(1)}}})),ve=ye((function(e){var t=Oe(),n=Object(a.useState)(!1),i=Object(ae.a)(n,2),c=i[0],l=i[1],o=Object(a.useState)(e.name),s=Object(ae.a)(o,2),u=s[0],d=s[1],m=Object(a.useRef)();Object(a.useEffect)((function(){d(e.name)}),[e.name]);var p=function(e){e&&!m.current&&(e.select(),m.current=e)};return c?r.a.createElement("form",{onReset:function(){d(e.name),l(!1),m.current=void 0},onSubmit:function(t){t.preventDefault(),l(!1),e.nameUpdated(u),m.current=void 0}},r.a.createElement(pe.a,{className:t.input,type:"text",required:!0,autoFocus:!0,onChange:function(e){return d(e.target.value)},value:u,inputRef:function(e){return p(e)}}),r.a.createElement(j.a,{type:"submit",size:"small",className:t.buttonGutter},r.a.createElement(be.a,null)),r.a.createElement(j.a,{type:"reset",size:"small"},r.a.createElement(he.a,null))):r.a.createElement(ie.a,{variant:"h6"},u,r.a.createElement(j.a,{size:"small",onClick:function(){return l(!0)},title:"Edit project name",className:t.buttonGutter},r.a.createElement(fe.a,null)))})),je=n(173),ge=n(174),Ce=n(175),Se=n(176),ze=n(177),ke={close:function(){return{type:"HIDE_CONFIRMATION_DIALOG"}}},De=Object(h.b)((function(e){return{dialog:e.modalDialog}}),ke)((function(e){return r.a.createElement(je.a,{open:!!e.dialog.contentText,onClose:e.close,disableBackdropClick:!0,disableEscapeKeyDown:!0},r.a.createElement(ge.a,null,r.a.createElement(Ce.a,null,e.dialog.contentText)),r.a.createElement(Se.a,null,r.a.createElement(ze.a,{onClick:function(){e.close(),e.dialog.onYes()},color:"primary"},"Yes"),r.a.createElement(ze.a,{onClick:function(){e.close(),e.dialog.onNo&&e.dialog.onNo()},color:"primary",autoFocus:!0},"No")))})),xe=n(9),Ae=n(180),Ne=n(181),we=n(178),_e=n(179),Te=Object(u.a)((function(e){return{root:{position:"fixed",bottom:e.appSpacing.standard,right:e.appSpacing.standard,zIndex:e.zIndex.graphHelp,minWidth:200}}})),Me=function(e){var t=Te();return r.a.createElement(we.a,{className:t.root},r.a.createElement(_e.a,null,e.children))},He=Object(h.b)((function(e){return{hazards:e.systemModel.hazards}}),(function(e){return{harmAdded:function(t,n){return e(w(t,n))},harmDeleted:function(t,n,a){return _(t,n,a,e)}}}))((function(e){var t=r.a.createElement(ie.a,null,"Click on a role to see or add possible harms"),n=function(t,n,a){return r.a.createElement(W.a,{key:n},r.a.createElement(Z.a,{primary:t}),r.a.createElement(K.a,null,r.a.createElement(j.a,{edge:"end",title:"Delete",onClick:function(){return function(t,n){e.harmDeleted(t,n,e.hazards)}(a,t)}},r.a.createElement(Ae.a,null))))},a=function(t){return r.a.createElement(W.a,{key:"-1"},r.a.createElement("form",{action:"#",onSubmit:function(n){return function(t,n){var a=t.currentTarget,r=a.elements.namedItem("harm").value;a.reset(),t.preventDefault(),e.harmAdded(n,r)}(n,t)}},r.a.createElement(pe.a,{required:!0,autoFocus:!0,margin:"dense",type:"text",name:"harm",fullWidth:!0,placeholder:"Add New",autoComplete:"off"}),r.a.createElement(K.a,null,r.a.createElement(j.a,{type:"submit",edge:"end",title:"Add"},r.a.createElement(Ne.a,null)))))};return r.a.createElement(Me,null,function(){return e.selectedRole?r.a.createElement(r.a.Fragment,null,r.a.createElement(ie.a,{variant:"body2",color:"textSecondary"},"Mishap Victim"),r.a.createElement(ie.a,{variant:"h6",gutterBottom:!0},e.selectedRole.name),r.a.createElement(ie.a,{variant:"body2",color:"textSecondary"},"Possible Harms"),r.a.createElement(G.a,{dense:!0},(i=e.selectedRole).possibleHarms.sort((function(e,t){return e.localeCompare(t)})).map((function(e,t){return n(e,t,i)})).concat(a(i)))):t;var i}())})),Re=n(47),Ie=n.n(Re),Fe=n(82),Pe=n.n(Fe),Le=n(83),Ve=n.n(Le),Ue=n(84),Ye=n.n(Ue),Be=n(212);!function(e){e.kind="kind",e.role="role",e.relator="relator"}(te||(te={}));var Xe=[{selector:"node",style:{"background-color":"#fff","border-width":1,"border-style":"solid","border-color":"#000",shape:"round-rectangle",label:"data(label)",height:"label",width:"label","text-valign":"center","text-halign":"center","text-wrap":"wrap","text-max-width":"130px","font-size":11,padding:"5px"}},{selector:"edge",style:{width:2,"curve-style":"taxi",label:"data(label)","font-size":11}},{selector:".subsystem",style:{shape:"rectangle","text-valign":"top","text-max-width":"300px"}},{selector:".".concat(te.kind.toString()),style:{"background-color":"#8282ff",color:"#fff"}},{selector:".".concat(te.role.toString()),style:{"background-color":"#818181",color:"#fff"}},{selector:".".concat(te.relator.toString()),style:{"background-color":"#fff",color:"#000"}},{selector:".arrow-edge",style:{"target-arrow-shape":"chevron"}},{selector:".faded",style:{opacity:.6}},{selector:".mishap-victim",style:{"background-color":"#ff0",color:"#000"}}];function Ge(e){return"systemObject"in e}function We(e){return"subsystem"in e}var Je={animate:!1,cueEnabled:!1};function qe(e){return e.expandCollapse("get")}var Ze=Object(u.a)((function(e){return{root:{position:"fixed",overflow:"auto",top:e.mixins.toolbar.minHeight,right:0,bottom:0,left:e.appSpacing.drawerWidth}}})),Ke=function(e){var t=Ze();return r.a.createElement("div",{className:t.root,ref:function(t){t&&e.size&&e.size(t.scrollHeight,t.scrollWidth)}},e.children)};Ie.a.use(Ye.a),Ve()(Ie.a);var $e=function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(f.a)(this,n),(a=t.call(this,e)).containerSize={height:0,width:0},a.initCytoscape=a.initCytoscape.bind(Object(xe.a)(a)),a.addEventListeners=a.addEventListeners.bind(Object(xe.a)(a)),a.resizeCanvas=a.resizeCanvas.bind(Object(xe.a)(a)),a.handleNodeMoved=a.handleNodeMoved.bind(Object(xe.a)(a)),a.setInitialCanvasSize=a.setInitialCanvasSize.bind(Object(xe.a)(a)),a.state={cy:null,collapseApi:null,maxX:a.containerSize.width,maxY:a.containerSize.height},a}return Object(E.a)(n,[{key:"render",value:function(){var e=this.state.cy?this.props.elements:[],t={width:this.state.maxX,height:this.state.maxY,zIndex:this.props.theme.zIndex.graph,cursor:this.props.cursorStyle};return r.a.createElement(Ke,{size:this.setInitialCanvasSize},r.a.createElement(Pe.a,{elements:e,style:t,stylesheet:Xe,userZoomingEnabled:!1,userPanningEnabled:!1,cy:this.initCytoscape}))}},{key:"componentDidMount",value:function(){this.setState(Object(l.a)(Object(l.a)({},this.state),{maxX:this.containerSize.width,maxY:this.containerSize.height}))}},{key:"setInitialCanvasSize",value:function(e,t){this.containerSize={height:e,width:t}}},{key:"resizeCanvas",value:function(){if(this.state.cy){var e=this.state.cy.nodes().renderedBoundingBox({}),t=Math.max(e.y2,this.state.maxY),n=Math.max(e.x2,this.state.maxX);t===this.state.maxY&&n===this.state.maxX||this.setState(Object(l.a)(Object(l.a)({},this.state),{maxX:n,maxY:t}))}}},{key:"handleNodeMoved",value:function(e){var t,n,a=e.target.element(),r=a.position();(r.x<0||r.y<0)&&a.position(Object(l.a)(Object(l.a)({},r),{x:Math.max(r.x,0),y:Math.max(r.y,0)})),null===(t=(n=this.props).nodeMoved)||void 0===t||t.call(n,e)}},{key:"addEventListeners",value:function(e){var t=e.target.element();if(t.isNode()){t.on("dragfree",this.handleNodeMoved);var n=t.data();this.state.collapseApi&&We(n)&&n.subsystem.isCollapsed&&this.state.collapseApi.collapse(t)}t.on("mouseover",this.props.mouseEnteredNode),t.on("mouseout",this.props.mouseLeftNode),t.on("click",this.props.nodeClicked)}},{key:"initCytoscape",value:function(e){var t=this;if(!this.state.cy){e.zoom(1.1),e.on("add",this.addEventListeners),e.on("click",(function(e){return t.props.graphClicked&&t.props.graphClicked(e)})),e.on("render",this.resizeCanvas);var n=null;this.props.useCollapseApi&&(!function(e){e.expandCollapse(Je)}(e),n=qe(e)),this.setState(Object(l.a)(Object(l.a)({},this.state),{cy:e,collapseApi:n}))}}}]),n}(r.a.Component),Qe=Object(Be.a)($e);function et(e){return"type"in e}function tt(e){return!("source"in e)&&!("type"in e)}var nt=function(){function e(){Object(f.a)(this,e)}return Object(E.a)(e,[{key:"mapSystemDescription",value:function(e){return this.mapSystemDescriptionEntities(this.getAllNodes(e).concat(e.systemObjectConnections))}},{key:"mapSystemDescriptionEntities",value:function(e){var t=this;return e.map((function(e){if(et(e))return t.mapSystemObject(e);if("source"in e)return t.mapConnection(e);if(tt(e))return t.mapSubsystem(e);throw new Error("Unknown entity type")}))}},{key:"getAllNodes",value:function(e){return e.kinds.concat(e.relators).concat(e.roles).concat(e.subsystems)}},{key:"hookSystemObject",value:function(e){return e}},{key:"hookConnection",value:function(e){return e}},{key:"hookSubsystem",value:function(e){return e}},{key:"mapSystemObject",value:function(e){return this.hookSystemObject({group:"nodes",data:{id:e.id,label:"<<".concat(e.type.toString(),">>\n").concat(e.name),systemObject:e,parent:e.parent},position:{x:e.posX,y:e.posY},classes:[e.type.toString()]})}},{key:"mapConnection",value:function(e){return this.hookConnection({group:"edges",data:{id:e.id,label:e.label?e.label:"",source:e.source,target:e.target,connection:e},pannable:!0,classes:e.isOriented?["arrow-edge"]:[]})}},{key:"mapSubsystem",value:function(e){return this.hookSubsystem({group:"nodes",data:{id:e.id,label:e.name,subsystem:e},position:{x:e.posX,y:e.posY},classes:["subsystem"]})}}]),e}();function at(e){return e.type===te.role}function rt(e){return at(e)&&e.possibleHarms.length>0}var it=function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(E.a)(n,[{key:"hookSystemObject",value:function(e){return at(e.data.systemObject)?rt(e.data.systemObject)&&(e.classes=["mishap-victim"]):e.classes=[e.data.systemObject.type.toString(),"faded"],e.grabbable=!1,e}},{key:"hookConnection",value:function(e){var t=["faded"];return e.data.connection.isOriented&&t.push("arrow-edge"),e.classes=t,e}},{key:"hookSubsystem",value:function(e){return e.grabbable=!1,e}}]),n}(nt),ct=Object(h.b)((function(e){return{systemDescription:e.systemModel}}))(function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(f.a)(this,n),(a=t.call(this,e)).getRoleFromEvent=a.getRoleFromEvent.bind(Object(xe.a)(a)),a.mouseEntered=a.mouseEntered.bind(Object(xe.a)(a)),a.mouseLeft=a.mouseLeft.bind(Object(xe.a)(a)),a.selectRole=a.selectRole.bind(Object(xe.a)(a)),a.clearRoleSelection=a.clearRoleSelection.bind(Object(xe.a)(a)),a.state={selectedRoleId:"",isMouseOverRole:!1},a}return Object(E.a)(n,[{key:"render",value:function(){var e=this,t=(new it).mapSystemDescription(this.props.systemDescription);return r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe,{elements:t,cursorStyle:this.state.isMouseOverRole?"pointer":"default",graphClicked:this.clearRoleSelection,mouseEnteredNode:this.mouseEntered,mouseLeftNode:this.mouseLeft,nodeClicked:this.selectRole}),r.a.createElement(He,{selectedRole:this.props.systemDescription.roles.find((function(t){return t.id===e.state.selectedRoleId}))}))}},{key:"getRoleFromEvent",value:function(e){var t=e.target.element().data();if(Ge(t)&&at(t.systemObject))return t.systemObject}},{key:"mouseEntered",value:function(e){this.getRoleFromEvent(e)&&this.setState(Object(l.a)(Object(l.a)({},this.state),{isMouseOverRole:!0}))}},{key:"mouseLeft",value:function(e){this.getRoleFromEvent(e)&&this.setState(Object(l.a)(Object(l.a)({},this.state),{isMouseOverRole:!1}))}},{key:"selectRole",value:function(e){var t=this.getRoleFromEvent(e);t&&(e.preventDefault(),this.setState(Object(l.a)(Object(l.a)({},this.state),{selectedRoleId:t.id})))}},{key:"clearRoleSelection",value:function(e){e.isDefaultPrevented()||this.setState(Object(l.a)(Object(l.a)({},this.state),{selectedRoleId:""}))}}]),n}(r.a.Component)),lt=n(190),ot=n(191),st=n(185),ut=n(186),dt=n(187),mt=n(182),pt=n(183),bt=n(188),ht=Object(h.b)((function(e){return{hazards:e.systemModel.hazards}}),(function(e){return{harmAdded:function(t,n){return e(w(t,n))},harmDeleted:function(t,n,a){return _(t,n,a,e)}}})),ft=Object(u.a)((function(e){return{chip:{marginRight:e.spacing(1)}}})),Et=ht((function(e){var t=ft();return r.a.createElement(mt.a,null,r.a.createElement(pt.a,{component:"th",scope:"row"},e.role.name),r.a.createElement(pt.a,{align:"left"},e.role.possibleHarms.sort((function(e,t){return e.localeCompare(t)})).map((function(n,a){return r.a.createElement(q.a,{className:t.chip,key:a,label:n,variant:"outlined",onDelete:function(){return function(t){e.harmDeleted(e.role,t,e.hazards)}(n)}})}))),r.a.createElement(pt.a,{align:"right"},r.a.createElement("form",{action:"#",onSubmit:function(t){var n=t.currentTarget,a=n.elements.namedItem("harm").value;n.reset(),t.preventDefault(),e.harmAdded(e.role,a)}},r.a.createElement(pe.a,{required:!0,autoFocus:!0,margin:"dense",type:"text",name:"harm",placeholder:"Add Harm",autoComplete:"off"}),r.a.createElement(j.a,{size:"small",type:"submit",edge:"end",title:"Add"},r.a.createElement(Ne.a,null)))))})),yt=n(169),Ot=n(211),vt=n(205),jt=n(184),gt=Object(u.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120}}})),Ct=function(e){var t=gt();return r.a.createElement(mt.a,null,r.a.createElement(pt.a,null,r.a.createElement(yt.a,{className:t.formControl},r.a.createElement(Ot.a,{id:"label-select-role"},"Select role"),r.a.createElement(vt.a,{labelId:"label-select-role",onChange:function(t){var n=t.target.value;e.roleSelected(e.roles.find((function(e){return e.id===n})))},value:""},e.roles.sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(e){return r.a.createElement(jt.a,{key:e.id,value:e.id},e.name)}))))),r.a.createElement(pt.a,{colSpan:2}))},St=Object(u.a)((function(e){return{button:{marginLeft:e.appSpacing.standard,marginTop:e.appSpacing.standard}}})),zt=function(e){var t=St();return r.a.createElement(ze.a,{className:t.button,variant:"contained",color:"primary",onClick:e.onClick,disabled:e.disabled},e.children)},kt=Object(h.b)((function(e){return{roles:e.systemModel.roles}}))((function(e){var t=Object(a.useState)([]),n=Object(ae.a)(t,2),i=n[0],c=n[1],l=Object(a.useState)(!1),o=Object(ae.a)(l,2),s=o[0],u=o[1],d=e.roles.filter((function(e){return rt(e)&&!i.some((function(t){return t===e.id}))})).sort((function(e,t){return e.name.localeCompare(t.name)})),m=e.roles.filter((function(e){return i.some((function(t){return t===e.id}))})),p=d.concat(m),b=e.roles.filter((function(e){return!p.some((function(t){return t.id===e.id}))}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(st.a,null,r.a.createElement(ut.a,{size:"small"},r.a.createElement(dt.a,null,r.a.createElement(mt.a,null,r.a.createElement(pt.a,null,"Mishap Victims"),r.a.createElement(pt.a,{align:"left"},"Possible Harms"),r.a.createElement(pt.a,{align:"right"},"\xa0"))),r.a.createElement(bt.a,null,s||0!==p.length?p.map((function(e){return r.a.createElement(Et,{key:e.id,role:e})})):r.a.createElement(mt.a,null,r.a.createElement(pt.a,{align:"center",colSpan:3},"No mishap victims identified")),s?r.a.createElement(Ct,{roles:b,roleSelected:function(e){c(i.concat(e.id)),u(!1)}}):void 0))),r.a.createElement(zt,{onClick:function(){!s&&u(!0)},disabled:0===b.length},0===b.length?"All mishap victims have been identified":"Add new mishap victim"))})),Dt=n(189),xt=Object(u.a)((function(e){return{fab:{position:"fixed",marginBottom:e.spacing(2),marginLeft:e.spacing(2),bottom:0,zIndex:e.zIndex.graphAction},fabSpace:{height:e.spacing(3)+40}}})),At=function(e){var t=xt();return r.a.createElement(r.a.Fragment,null,e.separated?r.a.createElement("div",{className:t.fabSpace}):void 0,r.a.createElement(Dt.a,{variant:"extended",className:t.fab,size:"medium",onClick:e.onClick},"props.children"))},Nt=function(){var e=Object(a.useState)(!0),t=Object(ae.a)(e,2),n=t[0],i=t[1];return n?r.a.createElement(r.a.Fragment,null,r.a.createElement(ct,null),r.a.createElement(At,{onClick:function(){return i(!1)}},r.a.createElement(lt.a,null),"Table View")):r.a.createElement(r.a.Fragment,null,r.a.createElement(kt,null),r.a.createElement(At,{separated:!0,onClick:function(){return i(!0)}},r.a.createElement(ot.a,null),"Graph View"))},wt=n(194);function _t(e){return"".concat(e,"-").concat((new Date).getTime())}var Tt=Object(u.a)((function(e){return{root:{position:"fixed",bottom:e.appSpacing.standard,zIndex:e.zIndex.graphAction},fab:{marginLeft:e.appSpacing.standard}}})),Mt=function(e){var t=Tt();return r.a.createElement("div",{className:t.root},e.buttons.map((function(e,n){return r.a.createElement(Dt.a,{key:n,className:t.fab,size:"small",color:"primary",variant:"extended",onClick:e.action},e.icon,e.text)})))},Ht=n(120),Rt=Object(u.a)((function(e){return{formControl:{marginTop:e.spacing(1)},selectEmpty:{marginTop:e.spacing(2)}}})),It=function(e){var t,n=Object(a.useState)(e.entity),i=Object(ae.a)(n,2),c=i[0],o=i[1],s=Rt();if(et(c)){var u=e.subsystemsAvailable.sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(e){return r.a.createElement(jt.a,{key:e.id,value:e.id},e.name)})),d="";c.parent&&(d=c.parent);t=r.a.createElement(yt.a,{className:s.formControl},r.a.createElement(Ot.a,{shrink:!0,id:"label-subsystem"},"Subsystem"),r.a.createElement(vt.a,{labelId:"label-subsystem",value:d,onChange:function(e){var t;""!==e.target.value&&(t=e.target.value),o(Object(l.a)(Object(l.a)({},c),{parent:t}))},displayEmpty:!0,disabled:0===u.length,className:s.selectEmpty},r.a.createElement(jt.a,{key:"-1",value:""},r.a.createElement("em",null,"None")),u))}return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ht.a,{open:!!e.entity}),r.a.createElement(je.a,{open:!!e.entity},r.a.createElement("form",{autoComplete:"off",onSubmit:function(t){e.entityUpdated(c),t.preventDefault()},onReset:function(){return e.editCancelled()}},r.a.createElement(ge.a,null,r.a.createElement(pe.a,{required:!0,autoFocus:!0,margin:"dense",id:"name",label:"Name",type:"text",fullWidth:!0,defaultValue:c.name,onChange:function(e){o(Object(l.a)(Object(l.a)({},c),{name:e.target.value}))}}),t),r.a.createElement(Se.a,null,r.a.createElement(ze.a,{type:"submit",variant:"contained",color:"primary"},"OK"),r.a.createElement(ze.a,{type:"reset",color:"primary"},"Cancel")))))},Ft=Object(u.a)((function(e){return{popper:{zIndex:e.zIndex.nodeAction}}})),Pt=function(e){var t=Object(a.createRef)(),n=Object(a.useState)(null),i=Object(ae.a)(n,2),c=i[0],l=i[1],o=Object(a.useCallback)((function(){c&&(e.element.off("position",void 0,c.scheduleUpdate),e.element.off("mouseup",void 0,o),c.destroy(),l(null))}),[c,e.element]);Object(a.useEffect)((function(){if(t.current&&!c){var n=e.element.popper({content:function(){return t.current},popper:{placement:e.placement?e.placement:"top"}});e.element.on("position",n.scheduleUpdate),e.element.on("mouseup",o),l(n)}return o}),[t,c,e.element,e.placement,o]);var s=Ft();return r.a.createElement("div",{ref:t,className:s.popper},e.children)},Lt=function(e){return r.a.createElement(j.a,{size:"small",title:"Delete",onClick:e.click},r.a.createElement(Ae.a,null))};function Vt(e){var t=e.data();if(Ge(t))return t.systemObject}function Ut(e){var t=Vt(e);if(t&&at(t))return t}function Yt(e){var t=e.data();if(function(e){return"connection"in e}(t))return t.connection}function Bt(e,t){return t.hazardElementEnvObj.id===e.id||t.mishapVictimEnvObj.id===e.id}function Xt(e,t){return t.mishapVictim.id===e.id||t.hazardElement.id===e.id}function Gt(e,t){return t.exposure.id===e.id}function Wt(e){switch(e.type){case te.kind:return function(t){return Bt(e,t)};case te.relator:return function(t){return Gt(e,t)};case te.role:return function(t){return Xt(e,t)}}}var Jt,qt,Zt={connectionDeleted:function(e,t){return z("DELETE_CONNECTION",{connection:e,target:t})},confirm:C},Kt=Object(h.b)((function(e){return{hazards:e.systemModel.hazards}}),Zt)((function(e){return r.a.createElement(Lt,{click:function(){e.onClick();var t=Vt(e.element.target());if(t){var n=Wt(t);e.hazards.some(n)?e.confirm("This connection takes part in one or more hazards. If you delete it those hazards will be deleted as well. Continue?",(function(){return e.connectionDeleted(e.connection,t)})):e.connectionDeleted(e.connection,t)}}})})),$t={subsystemCreated:function(e){return z("CREATE_SUBSYSTEM",e)},subsystemUpdated:x,connectionCreated:function(e){return z("CREATE_CONNECTION",e)},systemObjectRenamed:function(e){return z("RENAME_SYSTEM_OBJECT",e)},systemObjectCreated:function(e){return z("CREATE_SYSTEM_OBJECT",e)},systemObjectUpdated:function(e){return z("UPDATE_SYSTEM_OBJECT",e)}},Qt=Object(h.b)((function(e){return{system:e.systemModel}}),$t),en={x:100,y:50},tn=Qt(function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(f.a)(this,n),(a=t.call(this,e)).showNodeActions=a.showNodeActions.bind(Object(xe.a)(a)),a.hideNodeActions=a.hideNodeActions.bind(Object(xe.a)(a)),a.createConnection=a.createConnection.bind(Object(xe.a)(a)),a.completeEditEntity=a.completeEditEntity.bind(Object(xe.a)(a)),a.updateNodePosition=a.updateNodePosition.bind(Object(xe.a)(a)),a.validateConnection=a.validateConnection.bind(Object(xe.a)(a)),a.preventOverlap=a.preventOverlap.bind(Object(xe.a)(a)),a.cancelEditEntity=a.cancelEditEntity.bind(Object(xe.a)(a)),a.renderConnectionActions=a.renderConnectionActions.bind(Object(xe.a)(a)),a.state={isConnectionValid:!1},a}return Object(E.a)(n,[{key:"render",value:function(){var e=(new nt).mapSystemDescription(this.props.system),t="top";this.props.elementDisplayPopper&&this.props.elementDisplayPopper.isNode()&&(t=Ge(this.props.elementDisplayPopper.data())?"top-start":"bottom-start");var n="default";this.props.nodeConnecting&&(n=this.state.isConnectionValid?"pointer":"not-allowed");var a=r.a.createElement(r.a.Fragment,null),i=this.props.elementDisplayPopper;if(i)if(i.isEdge())a=this.renderConnectionActions(i);else if(i.isNode()){var c=i.data();Ge(c)?a=this.props.renderSystemObjectActions(c.systemObject,i):We(c)&&(a=this.props.renderSubsystemActions(c.subsystem,i))}return r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe,{elements:e,cursorStyle:n,graphClicked:this.props.nodeConnectingDone,nodeClicked:this.createConnection,mouseEnteredNode:this.showNodeActions,mouseLeftNode:this.hideNodeActions,nodeMoved:this.updateNodePosition,useCollapseApi:!0}),this.props.toolbarButtons,this.props.elementDisplayPopper?r.a.createElement(Pt,{element:this.props.elementDisplayPopper,placement:t},a):void 0,this.props.objectEditing?r.a.createElement(It,{entity:this.props.objectEditing,subsystemsAvailable:this.props.system.subsystems,entityUpdated:this.completeEditEntity,editCancelled:this.cancelEditEntity}):void 0)}},{key:"renderConnectionActions",value:function(e){var t=this;if(this.props.tryCreateConnection(e.source(),e.target())){var n=Yt(e);if(n)return r.a.createElement(Kt,{connection:n,element:e,onClick:function(){return t.props.elementDisplayPopperChanged(null)}})}return r.a.createElement(r.a.Fragment,null)}},{key:"showNodeActions",value:function(e){if(!this.props.elementDisplayPopper){var t=!1,n=e.target;n.isNode()&&(t=!!this.validateConnection(n)),this.setState(Object(l.a)(Object(l.a)({},this.state),{isConnectionValid:t})),this.props.elementDisplayPopperChanged(e.target)}}},{key:"hideNodeActions",value:function(){this.setState(Object(l.a)(Object(l.a)({},this.state),{isConnectionValid:!1})),this.props.elementDisplayPopperChanged(null)}},{key:"createConnection",value:function(e){var t=e.target;if(t.isNode()){var n=this.validateConnection(t);n&&this.props.connectionCreated(n)}this.props.nodeConnectingDone()}},{key:"validateConnection",value:function(e){return this.props.nodeConnecting&&this.props.nodeConnecting!==e&&0===this.props.nodeConnecting.edgesWith(e).length?this.props.tryCreateConnection(this.props.nodeConnecting,e):null}},{key:"updateNodePosition",value:function(e){var t=e.target,n=t.position(),a=t.data();if(Ge(a)){var r=a.systemObject;if(this.props.systemObjectUpdated(Object(l.a)(Object(l.a)({},r),{posX:n.x,posY:n.y})),a.parent&&t.parent().length>0){var i=this.props.system.subsystems.find((function(e){return e.id===a.parent}));if(i){var c=t.parent()[0].position();this.props.subsystemUpdated(Object(l.a)(Object(l.a)({},i),{posX:c.x,posY:c.y}))}}}else if(We(a)){var o=a.subsystem;this.props.subsystemUpdated(Object(l.a)(Object(l.a)({},o),{posX:n.x,posY:n.y}));for(var s=0;s<t.children().length;s++){var u=t.children()[s],d=u.data();if(Ge(d)){var m=d.systemObject,p=u.position();this.props.systemObjectUpdated(Object(l.a)(Object(l.a)({},m),{posX:p.x,posY:p.y}))}}}}},{key:"cancelEditEntity",value:function(){this.props.objectEditingDone&&this.props.objectEditingDone()}},{key:"completeEditEntity",value:function(e){var t=(new nt).getAllNodes(this.props.system),n=t.find((function(t){return t.id===e.id}));if(n){if(et(e)&&et(n)){var a=null,r=void 0;if(!e.parent||n.parent&&n.parent===e.parent)!e.parent&&n.parent&&(a=en);else{var i=this.props.system.subsystems.find((function(t){return t.id===e.parent}));i&&(a={x:i.posX,y:i.posY},r=i.id)}if(a){var c=this.preventOverlap(a,t,r);e.posX=c.x,e.posY=c.y}e.name!==n.name&&this.props.systemObjectRenamed(e)}tt(e)?this.props.subsystemUpdated(e):this.props.systemObjectUpdated(e)}else{var l,o=en;if(et(e)&&e.parent){var s=this.props.system.subsystems.find((function(t){return t.id===e.parent}));s&&(o={x:s.posX,y:s.posY},l=s.id)}var u=this.preventOverlap(o,t,l);e.posX=u.x,e.posY=u.y,tt(e)?this.props.subsystemCreated(e):this.props.systemObjectCreated(e)}this.props.objectEditingDone&&this.props.objectEditingDone()}},{key:"preventOverlap",value:function(e,t,n){return t.every((function(t){return t.posX!==e.x&&t.posY!==e.y||t.id===n}))?e:this.preventOverlap({x:e.x+20,y:e.y+20},t)}}]),n}(r.a.Component)),nn={systemObjectDeleted:A,confirm:C},an=Object(h.b)((function(e){return{hazards:e.systemModel.hazards}}),nn)((function(e){return r.a.createElement(Lt,{click:function(){e.onClick();var t=Wt(e.systemObject);e.hazards.some(t)?e.confirm("This object takes part in one or more hazards. If you delete it those hazards will be deleted as well. Continue?",(function(){return e.systemObjectDeleted(e.systemObject)})):e.systemObjectDeleted(e.systemObject)}})})),rn={subsystemDeleted:function(e){return z("DELETE_SUBSYSTEM",e)},systemObjectDeleted:A,confirm:C},cn=Object(h.b)((function(e){return{hazards:e.systemModel.hazards}}),rn)((function(e){var t=function(t){t.forEach((function(t){return t&&e.systemObjectDeleted(t)})),e.subsystemDeleted(e.subsystem)},n=function(){var n=e.element.children().map((function(e){return Vt(e)}));n.some((function(t){if(!t)return!1;var n=Wt(t);return e.hazards.some(n)}))?e.confirm("Some of the subsystem's child objects take part in one ore more hazards. If you delete the subsystem those hazards will be removed as well. Continue?",(function(){return t(n)})):t(n)};return r.a.createElement(Lt,{click:function(){e.onClick(),e.element.isChildless()?e.subsystemDeleted(e.subsystem):e.confirm("All the objects in the subsystem will be removed as well. Continue?",n)}})})),ln={confirm:C},on=Object(h.b)((function(e){return{hazards:e.systemModel.hazards}}),ln)((function(e){return r.a.createElement(j.a,{size:"small",title:"Edit",onClick:function(){if(tt(e.node))e.onClick();else{var t=Wt(e.node);e.hazards.some(t)?e.confirm("This object takes part in one or more hazards. If you edit it those hazards will be affected. Continue?",e.onClick):e.onClick()}}},r.a.createElement(fe.a,null))})),sn=n(192),un=n(193),dn={subsystemUpdated:x},mn=Object(h.b)(null,dn)((function(e){return r.a.createElement(j.a,{title:e.subsystem.isCollapsed?"Expand":"Collapse",onClick:function(){var t=e.node.cy(),n=qe(t),a=!e.subsystem.isCollapsed;a?n.collapse(e.node):n.expand(e.node),t.json(t.json()),t.zoom(1.1),t.pan({x:0,y:0}),e.subsystemUpdated(Object(l.a)(Object(l.a)({},e.subsystem),{isCollapsed:a}))},size:"small"},e.subsystem.isCollapsed?r.a.createElement(sn.a,null):r.a.createElement(un.a,null))})),pn=Object(u.a)((function(){return{base:{position:"relative",left:"-5px"},top:{top:"-5px"},bottom:{top:"5px"}}})),bn=function(e){var t=pn();return r.a.createElement("div",{className:"".concat(t.base," ").concat(t[e.placement])},e.children)},hn=function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(f.a)(this,n),(a=t.call(this,e)).tryCreateConnection=a.tryCreateConnection.bind(Object(xe.a)(a)),a.startCreatingKind=a.startCreatingKind.bind(Object(xe.a)(a)),a.startCreatingRole=a.startCreatingRole.bind(Object(xe.a)(a)),a.startCreatingSubsystem=a.startCreatingSubsystem.bind(Object(xe.a)(a)),a.renderSystemObjectActions=a.renderSystemObjectActions.bind(Object(xe.a)(a)),a.renderSubsystemActions=a.renderSubsystemActions.bind(Object(xe.a)(a)),a.state={nodeConnecting:null,objectEditing:null,elementDisplayPopper:null},a}return Object(E.a)(n,[{key:"render",value:function(){var e=this,t=r.a.createElement(Mt,{buttons:[{icon:r.a.createElement(Ne.a,null),text:"Kind",action:this.startCreatingKind},{icon:r.a.createElement(Ne.a,null),text:"Role",action:this.startCreatingRole},{icon:r.a.createElement(Ne.a,null),text:"Subsystem",action:this.startCreatingSubsystem}]});return r.a.createElement(tn,{elementDisplayPopper:this.state.elementDisplayPopper,elementDisplayPopperChanged:function(t){return e.setState(Object(l.a)(Object(l.a)({},e.state),{elementDisplayPopper:t}))},nodeConnecting:this.state.nodeConnecting,nodeConnectingDone:function(){return e.setState(Object(l.a)(Object(l.a)({},e.state),{nodeConnecting:null}))},objectEditing:this.state.objectEditing,objectEditingDone:function(){return e.setState(Object(l.a)(Object(l.a)({},e.state),{objectEditing:null}))},toolbarButtons:t,tryCreateConnection:this.tryCreateConnection,renderSubsystemActions:this.renderSubsystemActions,renderSystemObjectActions:this.renderSystemObjectActions})}},{key:"renderSystemObjectActions",value:function(e,t){var n=this;return e.type===te.kind?r.a.createElement(bn,{placement:"top"},r.a.createElement(j.a,{size:"small",title:"Connect to containing kind",onClick:function(){return n.setState(Object(l.a)(Object(l.a)({},n.state),{nodeConnecting:t}))}},r.a.createElement(wt.a,null)),r.a.createElement(on,{node:e,onClick:function(){return n.setState(Object(l.a)(Object(l.a)({},n.state),{objectEditing:e,elementDisplayPopper:null}))}}),r.a.createElement(an,{systemObject:e,onClick:function(){return n.setState(Object(l.a)(Object(l.a)({},n.state),{elementDisplayPopper:null}))}})):e.type===te.role?r.a.createElement(bn,{placement:"top"},r.a.createElement(on,{node:e,onClick:function(){return n.setState(Object(l.a)(Object(l.a)({},n.state),{objectEditing:e,elementDisplayPopper:null}))}}),r.a.createElement(an,{systemObject:e,onClick:function(){return n.setState(Object(l.a)(Object(l.a)({},n.state),{elementDisplayPopper:null}))}})):r.a.createElement(r.a.Fragment,null)}},{key:"renderSubsystemActions",value:function(e,t){var n=this;return r.a.createElement(bn,{placement:"bottom"},r.a.createElement(mn,{node:t,subsystem:e}),r.a.createElement(on,{node:e,onClick:function(){return n.setState(Object(l.a)(Object(l.a)({},n.state),{objectEditing:e,elementDisplayPopper:null}))}}),r.a.createElement(cn,{element:t,subsystem:e,onClick:function(){return n.setState(Object(l.a)(Object(l.a)({},n.state),{elementDisplayPopper:null}))}}))}},{key:"tryCreateConnection",value:function(e,t){var n=e.data(),a=t.data();return Ge(n)&&Ge(a)&&n.systemObject.type===te.kind&&a.systemObject.type===te.kind?{id:_t("connection"),source:n.systemObject.id,target:a.systemObject.id,label:"ispartof",isOriented:!0}:null}},{key:"startCreatingKind",value:function(){if(!this.state.objectEditing){var e={id:_t("kind"),name:"",type:te.kind,posX:0,posY:0};this.setState(Object(l.a)(Object(l.a)({},this.state),{objectEditing:e}))}}},{key:"startCreatingRole",value:function(){if(!this.state.objectEditing){var e={id:_t("role"),name:"",type:te.role,posX:0,posY:0,possibleHarms:[]};this.setState(Object(l.a)(Object(l.a)({},this.state),{objectEditing:e}))}}},{key:"startCreatingSubsystem",value:function(){if(!this.state.objectEditing){var e={id:_t("subsystem"),name:"",posX:0,posY:0,isCollapsed:!1};this.setState(Object(l.a)(Object(l.a)({},this.state),{objectEditing:e}))}}}]),n}(r.a.Component),fn=function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(f.a)(this,n),(a=t.call(this,e)).tryCreateConnection=a.tryCreateConnection.bind(Object(xe.a)(a)),a.renderSystemObjectActions=a.renderSystemObjectActions.bind(Object(xe.a)(a)),a.renderSubsystemActions=a.renderSubsystemActions.bind(Object(xe.a)(a)),a.state={nodeConnecting:null,objectEditing:null,elementDisplayPopper:null},a}return Object(E.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement(tn,{elementDisplayPopper:this.state.elementDisplayPopper,elementDisplayPopperChanged:function(t){return e.setState(Object(l.a)(Object(l.a)({},e.state),{elementDisplayPopper:t}))},nodeConnecting:this.state.nodeConnecting,nodeConnectingDone:function(){return e.setState(Object(l.a)(Object(l.a)({},e.state),{nodeConnecting:null}))},tryCreateConnection:this.tryCreateConnection,renderSubsystemActions:this.renderSubsystemActions,renderSystemObjectActions:this.renderSystemObjectActions})}},{key:"renderSystemObjectActions",value:function(e,t){var n=this;return e.type!==te.kind?r.a.createElement(r.a.Fragment,null):r.a.createElement(bn,{placement:"top"},r.a.createElement(j.a,{size:"small",title:"Connect to role",onClick:function(){return n.setState(Object(l.a)(Object(l.a)({},n.state),{nodeConnecting:t}))}},r.a.createElement(wt.a,null)))}},{key:"renderSubsystemActions",value:function(e,t){return r.a.createElement(bn,{placement:"bottom"},r.a.createElement(mn,{node:t,subsystem:e}))}},{key:"tryCreateConnection",value:function(e,t){var n=e.data(),a=t.data();return Ge(n)&&n.systemObject.type===te.kind&&Ge(a)&&a.systemObject.type===te.role?{id:_t("connection"),source:n.systemObject.id,target:a.systemObject.id,label:"play",isOriented:!0}:null}}]),n}(r.a.Component),En=function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(f.a)(this,n),(a=t.call(this,e)).tryCreateConnection=a.tryCreateConnection.bind(Object(xe.a)(a)),a.startCreatingRelator=a.startCreatingRelator.bind(Object(xe.a)(a)),a.renderSystemObjectActions=a.renderSystemObjectActions.bind(Object(xe.a)(a)),a.renderSubsystemActions=a.renderSubsystemActions.bind(Object(xe.a)(a)),a.state={nodeConnecting:null,objectEditing:null,elementDisplayPopper:null},a}return Object(E.a)(n,[{key:"render",value:function(){var e=this,t=r.a.createElement(Mt,{buttons:[{icon:r.a.createElement(Ne.a,null),text:"Relator",action:this.startCreatingRelator}]});return r.a.createElement(tn,{elementDisplayPopper:this.state.elementDisplayPopper,elementDisplayPopperChanged:function(t){return e.setState(Object(l.a)(Object(l.a)({},e.state),{elementDisplayPopper:t}))},nodeConnecting:this.state.nodeConnecting,nodeConnectingDone:function(){return e.setState(Object(l.a)(Object(l.a)({},e.state),{nodeConnecting:null}))},objectEditing:this.state.objectEditing,objectEditingDone:function(){return e.setState(Object(l.a)(Object(l.a)({},e.state),{objectEditing:null}))},toolbarButtons:t,tryCreateConnection:this.tryCreateConnection,renderSubsystemActions:this.renderSubsystemActions,renderSystemObjectActions:this.renderSystemObjectActions})}},{key:"renderSystemObjectActions",value:function(e,t){var n=this;return e.type===te.relator?r.a.createElement(bn,{placement:"top"},r.a.createElement(j.a,{size:"small",title:"Connect to role",onClick:function(){return n.setState(Object(l.a)(Object(l.a)({},n.state),{nodeConnecting:t}))}},r.a.createElement(wt.a,null)),r.a.createElement(on,{node:e,onClick:function(){return n.setState(Object(l.a)(Object(l.a)({},n.state),{objectEditing:e,elementDisplayPopper:null}))}}),r.a.createElement(an,{systemObject:e,onClick:function(){return n.setState(Object(l.a)(Object(l.a)({},n.state),{elementDisplayPopper:null}))}})):e.type===te.role?r.a.createElement(bn,{placement:"top"},r.a.createElement(j.a,{size:"small",title:"Connect to relator",onClick:function(){return n.setState(Object(l.a)(Object(l.a)({},n.state),{nodeConnecting:t}))}},r.a.createElement(wt.a,null))):r.a.createElement(r.a.Fragment,null)}},{key:"renderSubsystemActions",value:function(e,t){return r.a.createElement(bn,{placement:"bottom"},r.a.createElement(mn,{node:t,subsystem:e}))}},{key:"tryCreateConnection",value:function(e,t){var n=e.data(),a=t.data();if(Ge(n)&&Ge(a)){if(n.systemObject.type===te.role&&a.systemObject.type===te.relator)return{id:_t("connection"),source:n.systemObject.id,target:a.systemObject.id,label:"",isOriented:!1};if(n.systemObject.type===te.relator&&a.systemObject.type===te.role)return{id:_t("connection"),source:a.systemObject.id,target:n.systemObject.id,label:"",isOriented:!1}}return null}},{key:"startCreatingRelator",value:function(){if(!this.state.objectEditing){var e={id:_t(te.relator.toString()),name:"",type:te.relator,posX:0,posY:0};this.setState(Object(l.a)(Object(l.a)({},this.state),{objectEditing:e}))}}}]),n}(r.a.Component),yn=function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(f.a)(this,n),(a=t.call(this,e)).tryCreateConnection=a.tryCreateConnection.bind(Object(xe.a)(a)),a.renderSystemObjectActions=a.renderSystemObjectActions.bind(Object(xe.a)(a)),a.renderSubsystemActions=a.renderSubsystemActions.bind(Object(xe.a)(a)),a.state={nodeConnecting:null,objectEditing:null,elementDisplayPopper:null},a}return Object(E.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement(tn,{elementDisplayPopper:this.state.elementDisplayPopper,elementDisplayPopperChanged:function(t){return e.setState(Object(l.a)(Object(l.a)({},e.state),{elementDisplayPopper:t}))},nodeConnecting:this.state.nodeConnecting,nodeConnectingDone:function(){return e.setState(Object(l.a)(Object(l.a)({},e.state),{nodeConnecting:null}))},tryCreateConnection:this.tryCreateConnection,renderSubsystemActions:this.renderSubsystemActions,renderSystemObjectActions:this.renderSystemObjectActions})}},{key:"renderSystemObjectActions",value:function(e,t){var n=this;return e.type!==te.role?r.a.createElement(r.a.Fragment,null):r.a.createElement(bn,{placement:"top"},r.a.createElement(j.a,{size:"small",title:"Connect to kind",onClick:function(){return n.setState(Object(l.a)(Object(l.a)({},n.state),{nodeConnecting:t}))}},r.a.createElement(wt.a,null)))}},{key:"renderSubsystemActions",value:function(e,t){return r.a.createElement(bn,{placement:"bottom"},r.a.createElement(mn,{node:t,subsystem:e}))}},{key:"tryCreateConnection",value:function(e,t){var n=e.edgesWith(t);if(n.length>0){var a=Yt(n[0]);if(a)return a}var r=Vt(e),i=Vt(t);return r&&r.type===te.role&&i&&i.type===te.kind?{id:_t("connection"),source:i.id,target:r.id,label:"play",isOriented:!0}:null}}]),n}(r.a.Component),On=n(195),vn=function(e){return r.a.createElement(r.a.Fragment,null,"H",e.hazard.id)},jn=n(5),gn=n(208),Cn=Object(jn.a)((function(e){return Object(gn.a)({sizeSmall:{padding:e.spacing(1)}})}))(pt.a),Sn=function(e){var t=Object(a.useState)(!1),n=Object(ae.a)(t,2),i=n[0],c=n[1],o=Object(a.useState)(e.hazard.harmTruthmaker),s=Object(ae.a)(o,2),u=s[0],d=s[1],m=Object(a.useState)(e.hazard.description),p=Object(ae.a)(m,2),b=p[0],h=p[1],f=function(e){return!e||0===e.length};return r.a.createElement(mt.a,null,r.a.createElement(Cn,null,r.a.createElement(vn,{hazard:e.hazard})),r.a.createElement(Cn,null,e.hazard.mishapVictim.name,r.a.createElement("br",null),"(",e.hazard.mishapVictimEnvObj.name,")"),r.a.createElement(Cn,null,e.hazard.exposure.name),r.a.createElement(Cn,null,e.hazard.hazardElement.name,r.a.createElement("br",null),"(",e.hazard.hazardElementEnvObj.name,")"),r.a.createElement(Cn,null,i?r.a.createElement(pe.a,{required:!0,autoFocus:!0,defaultValue:e.hazard.harmTruthmaker,margin:"none",type:"text",onChange:function(e){return d(e.target.value)},error:f(u),helperText:f(u)?"Required field":" ",autoComplete:"off"}):e.hazard.harmTruthmaker),r.a.createElement(Cn,null,i?r.a.createElement(pe.a,{required:!0,defaultValue:e.hazard.description,margin:"none",fullWidth:!0,type:"text",onChange:function(e){return h(e.target.value)},error:f(b),helperText:f(b)?"Required field":" ",autoComplete:"off"}):e.hazard.description),r.a.createElement(Cn,null,i?r.a.createElement(j.a,{size:"small",onClick:function(){return function(){if(!f(u)||!f(b)){if(u!==e.hazard.harmTruthmaker||b!==e.hazard.description){var t=Object(l.a)(Object(l.a)({},e.hazard),{},{harmTruthmaker:u,description:b});e.hazardEdited(t)}c(!1)}}()}},r.a.createElement(On.a,null)):r.a.createElement(j.a,{size:"small",onClick:function(){return c(!0)}},r.a.createElement(fe.a,null)),r.a.createElement(j.a,{size:"small",onClick:function(){c(!1),e.hazardDeleted(e.hazard)}},r.a.createElement(Ae.a,null))))},zn={hazardEdited:k,hazardDeleted:D},kn=Object(h.b)((function(e){return{hazards:e.systemModel.hazards}}),zn),Dn=Object(u.a)((function(){return{id:{width:"7%"},mishapVictim:{width:"15%"},exposure:{width:"10%"},hazardElement:{width:"15%"},harmTruthmaker:{width:"15%"},actions:{width:"10%"}}})),xn=kn((function(e){var t=Dn(),n=e.hazards,a=e.selectedMishapVictim;return a&&(n=n.filter((function(e){return e.mishapVictim.id===a.id}))),r.a.createElement(st.a,null,r.a.createElement(ut.a,{size:"small"},r.a.createElement(dt.a,null,r.a.createElement(mt.a,null,r.a.createElement(Cn,{className:t.id},"ID"),r.a.createElement(Cn,{className:t.mishapVictim},"Mishap Victim",r.a.createElement("br",null),"(Env Obj)"),r.a.createElement(Cn,{className:t.exposure},"Exposure"),r.a.createElement(Cn,{className:t.hazardElement},"Hazard Element",r.a.createElement("br",null),"(Env Obj)"),r.a.createElement(Cn,{className:t.harmTruthmaker},"Harm TruthMaker"),r.a.createElement(Cn,null,"Hazard Description"),r.a.createElement(Cn,{className:t.actions}))),r.a.createElement(bt.a,null,0===n.length?r.a.createElement(mt.a,null,r.a.createElement(pt.a,{colSpan:7,align:"center"},"No hazards identified")):n.sort((function(e,t){return e.id-t.id})).map((function(t,n){return r.a.createElement(Sn,{hazard:t,key:n,hazardEdited:e.hazardEdited,hazardDeleted:e.hazardDeleted})})))))})),An=Object(u.a)((function(e){return{divide:{paddingRight:e.appSpacing.standard},select:{width:"220px"}}})),Nn=function(e){var t=An(),n="";1===e.template.hazardElementEnvObjs.length&&(n=e.template.hazardElementEnvObjs[0].object.id);var i=Object(a.useState)(n),c=Object(ae.a)(i,2),l=c[0],o=c[1],s=Object(a.useState)(""),u=Object(ae.a)(s,2),d=u[0],m=u[1],p=Object(a.useState)(""),b=Object(ae.a)(p,2),h=b[0],f=b[1],E=e.template.hazardElementEnvObjs.sort((function(e,t){return e.object.name.localeCompare(t.object.name)})).map((function(e,t){return r.a.createElement(jt.a,{key:t,value:e.object.id},e.object.name)}));return 0===e.template.hazardElementEnvObjs.length&&(E=[r.a.createElement(jt.a,{key:-1,value:"",disabled:!0},"Nothing found")]),r.a.createElement(mt.a,null,r.a.createElement(pt.a,{colSpan:3},r.a.createElement("form",{action:"#",onSubmit:function(t){t.currentTarget.reset(),t.preventDefault();var n=e.template.hazardElementEnvObjs.find((function(e){return e.object.id===l}));if(n){var a={id:e.nextHazardId,harmTruthmaker:d,description:h,mishapVictim:{id:e.template.mishapVictim.id,name:e.template.mishapVictim.name},mishapVictimEnvObj:{id:e.template.mishapVictimEnvObj.object.id,name:e.template.mishapVictimEnvObj.object.name},exposure:{id:e.template.exposure.object.id,name:e.template.exposure.object.name},hazardElement:{id:e.template.hazardElement.object.id,name:e.template.hazardElement.object.name},hazardElementEnvObj:{id:n.object.id,name:n.object.name}};e.hazardCreated(a)}}},r.a.createElement(yt.a,{className:t.divide},r.a.createElement(pe.a,{required:!0,autoFocus:!0,margin:"none",type:"text",onChange:function(e){return m(e.target.value)},label:"Harm Truthmaker",autoComplete:"off",multiline:!0,rowsMax:4})),r.a.createElement(yt.a,{className:t.divide},r.a.createElement(pe.a,{required:!0,margin:"none",type:"text",onChange:function(e){return f(e.target.value)},label:"Hazard Description",autoComplete:"off",multiline:!0,rowsMax:4})),r.a.createElement(yt.a,{className:t.select},r.a.createElement(Ot.a,{id:"label-select-env-obj"},"Hazard Evement Env Obj"),r.a.createElement(vt.a,{required:!0,margin:"none",labelId:"label-select-env-obj",value:n,onChange:function(e){return o(e.target.value)}},E)),r.a.createElement(j.a,{type:"submit",edge:"end",title:"Create"},r.a.createElement(Ne.a,null)))))},wn={hazardCreated:function(e){return z("CREATE_HAZARD",e)}},_n=Object(h.b)((function(e){return{nextHazardId:e.systemModel.nextHazardId}}),wn),Tn=Object(jn.a)((function(e){return Object(gn.a)({root:{backgroundColor:e.palette.grey[200],cursor:"pointer"}})}))(mt.a),Mn=Object(u.a)((function(e){return{header:{marginLeft:e.appSpacing.standard}}})),Hn=_n((function(e){var t=Mn(),n=Object(a.useState)(null),i=Object(ae.a)(n,2),c=i[0],l=i[1],o=Object(a.useState)([]),s=Object(ae.a)(o,2),u=s[0],d=s[1];Object(a.useEffect)((function(){var t=Ut(e.node);if(!t||!rt(t))throw new Error("Entity passed is not a mishap victim");var n=function(e,t){if(e.isEdge()){var n=Vt(t?e.source():e.target()),a=Yt(e);if(n&&a)return{object:n,connection:a}}return null};d(function(t){for(var a=[],r=e.node.incomers(),i=e.node.outgoers(),c=i.incomers(),l=[],o=c.incomers(),s=0;s<o.length;s++){var u=n(o[s],!0);u&&l.push(u)}for(var d=0;d<r.length;d++){var m=n(r[d],!0);if(m)for(var p=0;p<i.length;p++){var b=n(i[p],!1);if(b)for(var h=function(e){var r=n(c[e],!0);if(!r)return"continue";a.push({mishapVictim:t,mishapVictimEnvObj:m,exposure:b,hazardElement:r,hazardElementEnvObjs:l.filter((function(e){return e.connection.target===r.object.id}))})},f=0;f<c.length;f++)h(f)}}return a}(t))}),[e.node]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,{container:!0},r.a.createElement(p.a,{item:!0,xs:12},r.a.createElement(ie.a,{variant:"caption",className:t.header},"Select a table row to add"))),r.a.createElement(st.a,null,r.a.createElement(ut.a,{size:"small"},r.a.createElement(dt.a,null,r.a.createElement(mt.a,null,r.a.createElement(pt.a,null,"Mishap Victim (Env Obj)"),r.a.createElement(pt.a,null,"Exposure"),r.a.createElement(pt.a,null,"Hazard Element"))),r.a.createElement(bt.a,null,0===u.length?r.a.createElement(mt.a,null,r.a.createElement(pt.a,{colSpan:3,align:"center"},"No possible hazards found")):u.map((function(t,n){return r.a.createElement(r.a.Fragment,{key:n},r.a.createElement(Tn,{onClick:function(){return l(t)}},r.a.createElement(pt.a,null,t.mishapVictim.name," (",t.mishapVictimEnvObj.object.name,")"),r.a.createElement(pt.a,null,t.exposure.object.name),r.a.createElement(pt.a,null,t.hazardElement.object.name)),c!==t?r.a.createElement(r.a.Fragment,null):r.a.createElement(Nn,{template:c,nextHazardId:e.nextHazardId,hazardCreated:e.hazardCreated}))}))))))})),Rn=Object(u.a)((function(e){return{header:{marginLeft:e.appSpacing.standard},tableGutter:{marginBottom:e.appSpacing.standard}}})),In=function(e){var t=Rn(),n=Ut(e.node);if(!n||!rt(n))throw new Error("Entity passed is not a mishap victim");return r.a.createElement(r.a.Fragment,null,r.a.createElement(ie.a,{variant:"h6",color:"textSecondary",className:t.header},"Possible Harms"),r.a.createElement(ie.a,{variant:"body1",className:t.header,gutterBottom:!0},n.possibleHarms.join(", ")),r.a.createElement(ie.a,{variant:"h6",color:"textSecondary",className:t.header},"Hazards"),r.a.createElement(xn,{selectedMishapVictim:n}),r.a.createElement("div",{className:t.tableGutter}),r.a.createElement(ie.a,{variant:"h6",color:"textSecondary",className:t.header},"Add New Hazard"),r.a.createElement(Hn,{node:e.node}),r.a.createElement(At,{separated:!0,onClick:e.close},"Back"))},Fn=Object(h.b)((function(e){return{system:e.systemModel}}))((function(e){var t=Object(a.useState)(!1),n=Object(ae.a)(t,2),i=n[0],c=n[1],l=function(e){var t=Ut(e.target.element());if(t&&rt(t))return t},o=function(e){c(!!l(e))},s=(new it).mapSystemDescription(e.system);return r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe,{elements:s,cursorStyle:i?"pointer":"default",mouseEnteredNode:o,mouseLeftNode:o,nodeClicked:function(t){l(t)&&e.victimSelected(t.target)}}),r.a.createElement(Me,null,r.a.createElement(ie.a,null,"Click on a mishap victim to populate hazards"),r.a.createElement(ie.a,{variant:"caption"},"Mishap victims are marked yellow")))})),Pn=function(){function e(t){Object(f.a)(this,e),this._cy=void 0;var n=(new nt).mapSystemDescription(t);this._cy=Ie()({elements:n,headless:!0})}return Object(E.a)(e,[{key:"cy",get:function(){return this._cy}}]),e}(),Ln=Object(h.b)((function(e){return{mishapVictims:e.systemModel.roles.filter((function(e){return rt(e)})),systemModel:e.systemModel}})),Vn=Object(u.a)((function(e){return{header:{marginLeft:e.appSpacing.standard},tableGutter:{marginBottom:e.appSpacing.standard},select:{marginLeft:e.appSpacing.standard,width:"220px"}}})),Un=Ln((function(e){var t=Vn(),n=Object(a.useState)(""),i=Object(ae.a)(n,2),c=i[0],l=i[1],o=Object(a.useState)(null),s=Object(ae.a)(o,2),u=s[0],d=s[1],m=Object(a.useRef)();return r.a.createElement(r.a.Fragment,null,r.a.createElement(ie.a,{variant:"h6",color:"textSecondary",className:t.header},"Hazards"),r.a.createElement(xn,null),r.a.createElement("div",{className:t.tableGutter}),r.a.createElement(ie.a,{variant:"h6",color:"textSecondary",className:t.header},"Add New Hazard"),r.a.createElement(yt.a,{className:t.select},r.a.createElement(Ot.a,{id:"label-select-mishap-victim"},"Select mishap victim"),r.a.createElement(vt.a,{margin:"none",labelId:"label-select-mishap-victim",onChange:function(t){var n=t.target.value;m.current||(m.current=new Pn(e.systemModel));var a=m.current.cy.$("#".concat(n));if(!a||!a.isNode())throw new Error("Node with id ".concat(n," not found"));l(n),d(a)},value:c},e.mishapVictims.sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(e,t){return r.a.createElement(jt.a,{key:t,value:e.id},e.name)})))),u?r.a.createElement(Hn,{node:u}):void 0)})),Yn=function(){var e=Object(a.useState)(!1),t=Object(ae.a)(e,2),n=t[0],i=t[1],c=Object(a.useState)(null),l=Object(ae.a)(c,2),o=l[0],s=l[1];if(o){if(!Vt(o))throw new Error("Selected node does not represent a mishap victim");return r.a.createElement(In,{node:o,close:function(){return s(null)}})}return n?r.a.createElement(r.a.Fragment,null,r.a.createElement(Un,null),r.a.createElement(At,{separated:!0,onClick:function(){return i(!1)}},r.a.createElement(ot.a,null),"Graph View")):r.a.createElement(r.a.Fragment,null,r.a.createElement(Fn,{victimSelected:s}),r.a.createElement(At,{onClick:function(){return i(!0)}},r.a.createElement(lt.a,null),"Table View"))},Bn=n(197),Xn=n(199),Gn=n(198);!function(e){e.hazard="Hazard",e.initiatingCondition="Initiating Condition",e.initiatingEvent="Initiating Event",e.mishap="Mishap"}(Jt||(Jt={})),function(e){e[e.notSet=0]="notSet",e[e.situation=1]="situation",e[e.event=2]="event"}(qt||(qt={}));var Wn=function(e){var t,n,i=Object(a.useState)(qt.notSet),c=Object(ae.a)(i,2),l=c[0],o=c[1],s=null;switch(l){case qt.notSet:t="Is the hazard description describing a situation (state of affairs) or an event?",s=r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Note that"),r.a.createElement("p",null,"1) if a hazard description describes that some event is supposed to occur but does not, then the hazard description is regarded as a generic ",r.a.createElement("b",null,"situation"),' that will not trigger the specific event, such as "the brake command is not issued",'),r.a.createElement("p",null,"and"),r.a.createElement("p",null,"2) if a hazard description describes a repetitive and continuous behavior, it can be regarded as a ",r.a.createElement("b",null,"situation"),', such as "a train is running on the track".')),n=r.a.createElement(r.a.Fragment,null,r.a.createElement(ze.a,{size:"small",variant:"outlined",onClick:function(){return o(qt.situation)}},"Situation"),r.a.createElement(ze.a,{size:"small",variant:"outlined",onClick:function(){return o(qt.event)}},"Event"));break;case qt.situation:t="Can the situation trigger mishaps when some dispositions in the situation are manifested ?",n=r.a.createElement(r.a.Fragment,null,r.a.createElement(ze.a,{size:"small",variant:"outlined",onClick:function(){return e.complete(Jt.hazard)}},"Yes \u2014 Hazard"),r.a.createElement(ze.a,{size:"small",variant:"outlined",onClick:function(){return e.complete(Jt.initiatingCondition)}},"No \u2014 Initiating Condition"));break;case qt.event:t="Can the event bring about severe injuries of people or damages to the environment?",n=r.a.createElement(r.a.Fragment,null,r.a.createElement(ze.a,{size:"small",variant:"outlined",onClick:function(){return e.complete(Jt.mishap)}},"Yes \u2014 Mishap"),r.a.createElement(ze.a,{size:"small",variant:"outlined",onClick:function(){return e.complete(Jt.initiatingEvent)}},"No \u2014 Initiating Event"));break;default:throw new Error("Unknown intermediate category")}return r.a.createElement(we.a,{variant:"outlined"},r.a.createElement(Bn.a,{action:r.a.createElement(j.a,{size:"small",onClick:e.cancel},r.a.createElement(Gn.a,null)),title:t}),s?r.a.createElement(_e.a,null,r.a.createElement(ie.a,{variant:"body2",component:"div"},s)):void 0,r.a.createElement(Xn.a,null,n))},Jn=function(e){var t=Object(a.useState)(!1),n=Object(ae.a)(t,2),i=n[0],c=n[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(mt.a,null,r.a.createElement(pt.a,null,r.a.createElement(vn,{hazard:e.hazard})),r.a.createElement(pt.a,null,e.hazard.description),r.a.createElement(pt.a,null,e.hazard.category?e.hazard.category:"-"),r.a.createElement(pt.a,null,r.a.createElement(ze.a,{variant:"outlined",onClick:function(){return c(!0)}},"Categorize"))),i?r.a.createElement(mt.a,null,r.a.createElement(pt.a,{colSpan:4},r.a.createElement(Wn,{cancel:function(){return c(!1)},complete:function(t){c(!1),e.hazardUpdated(Object(l.a)(Object(l.a)({},e.hazard),{category:t}))}}))):void 0)},qn={hazardUpdated:k},Zn=Object(h.b)((function(e){return{hazards:e.systemModel.hazards}}),qn)((function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(st.a,null,r.a.createElement(ut.a,{size:"small"},r.a.createElement(dt.a,null,r.a.createElement(mt.a,null,r.a.createElement(pt.a,null,"ID"),r.a.createElement(pt.a,null,"Hazard Description"),r.a.createElement(pt.a,null,"Category"),r.a.createElement(pt.a,null))),r.a.createElement(bt.a,null,0===e.hazards.length?r.a.createElement(mt.a,null,r.a.createElement(pt.a,{colSpan:4,align:"center"},"No hazards identified")):e.hazards.map((function(t,n){return r.a.createElement(Jn,{key:n,hazard:t,hazardUpdated:e.hazardUpdated})}))))))})),Kn=n(200),$n=Object(h.b)((function(e){return{hazards:e.systemModel.hazards}}))((function(e){var t=e.hazards.filter((function(e){return e.category}));return r.a.createElement(st.a,null,r.a.createElement(ut.a,{size:"small"},r.a.createElement(dt.a,null,r.a.createElement(mt.a,null,r.a.createElement(pt.a,null,"ID"),r.a.createElement(pt.a,null,"Hazard Description"),r.a.createElement(pt.a,null,"Category"),r.a.createElement(pt.a,null,"Expanded"),r.a.createElement(pt.a,null))),r.a.createElement(bt.a,null,0===t.length?r.a.createElement(mt.a,null,r.a.createElement(pt.a,{colSpan:5,align:"center"},"No hazards categorized")):t.map((function(t,n){return r.a.createElement(mt.a,{key:n},r.a.createElement(pt.a,null,r.a.createElement(vn,{hazard:t})),r.a.createElement(pt.a,null,t.description),r.a.createElement(pt.a,null,t.category),r.a.createElement(pt.a,null,t.expansion?r.a.createElement(Kn.a,null):"-"),r.a.createElement(pt.a,null,r.a.createElement(ze.a,{variant:"outlined",onClick:function(){return e.hazardSelected(t)}},"Expand")))})))))})),Qn=Object(h.b)((function(e){return{systemModel:e.systemModel}}),{})((function(e){var t=Object(a.useRef)(),n=Object(a.useState)([]),i=Object(ae.a)(n,2),c=i[0],l=i[1];Object(a.useEffect)((function(){t.current=new Pn(e.systemModel);var n="#".concat(e.selectedHazard.exposure.id,",")+"#".concat(e.selectedHazard.hazardElement.id,",")+"#".concat(e.selectedHazard.hazardElementEnvObj.id,",")+"#".concat(e.selectedHazard.mishapVictim.id,",")+"#".concat(e.selectedHazard.mishapVictimEnvObj.id),a=t.current.cy.nodes(n),r=a.edgesWith(a),i=a.map(Vt),c=r.map(Yt);l(i.concat(c))}),[e.systemModel,e.selectedHazard]);var o=(new nt).mapSystemDescriptionEntities(c);return r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe,{cursorStyle:"default",elements:o,mouseEnteredNode:function(){},mouseLeftNode:function(){},nodeClicked:function(){},graphClicked:function(){}}),r.a.createElement(At,{onClick:e.onClose},"Back"))})),ea=function(){var e=Object(a.useState)(null),t=Object(ae.a)(e,2),n=t[0],i=t[1];return n?r.a.createElement(Qn,{selectedHazard:n,onClose:function(){return i(null)}}):r.a.createElement($n,{hazardSelected:i})},ta=Object(u.a)((function(e){return{root:{display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},drawerOpen:{width:240},toolbar:Object(l.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:e.spacing(0,1)},e.mixins.toolbar),content:{flexGrow:1},appTitle:{textAlign:"center"}}})),na=Object(h.b)((function(e){return{currentStep:e.systemModel.currentStep,hasUnsavedChanges:e.unsavedChanges}}))((function(e){Object(o.a)((function(t){e.hasUnsavedChanges&&t.preventDefault()}));var t=ta();return r.a.createElement(v,null,r.a.createElement(s.a,null),r.a.createElement(De,null),r.a.createElement("div",{className:t.root},r.a.createElement(d.a,{position:"fixed",className:t.appBar},r.a.createElement(m.a,{variant:"dense"},r.a.createElement(p.a,{container:!0,justify:"space-evenly"},r.a.createElement(p.a,{item:!0,xs:!0},r.a.createElement(X,null)),r.a.createElement(p.a,{item:!0,xs:6,className:t.appTitle},r.a.createElement(ve,null)),r.a.createElement(p.a,{item:!0,xs:!0},"\xa0")))),r.a.createElement(b.a,{variant:"permanent",className:t.drawerOpen,classes:{paper:t.drawerOpen}},r.a.createElement("div",{className:t.toolbar}),r.a.createElement(me,null)),r.a.createElement("main",{className:t.content},r.a.createElement("div",{className:t.toolbar}),function(){switch(e.currentStep){case P.SDF_1:return r.a.createElement(hn,null);case P.SDF_2:return r.a.createElement(fn,null);case P.SDF_3:return r.a.createElement(En,null);case P.SDF_4:return r.a.createElement(yn,null);case P.OHI_2:return r.a.createElement(Nt,null);case P.OHI_3:return r.a.createElement(Yn,null);case P.OCH_1:return r.a.createElement(Zn,null);case P.OCH_2:return r.a.createElement(ea,null);default:throw new Error("Unknown step id ".concat(e.currentStep))}}())))})),aa=n(45);function ra(e,t){switch(t.type){case"CREATE_HAZARD":return e.concat(t.payload);case"UPDATE_HAZARD":return e.map((function(e){return e.id===t.payload.id?t.payload:e}));case"DELETE_HAZARD":return e.filter((function(e){return e.id!==t.payload.id}));case"RENAME_SYSTEM_OBJECT":var n=function(e){switch(e.type){case te.relator:return function(t){return Gt(e,t)?Object(l.a)(Object(l.a)({},t),{exposure:{id:e.id,name:e.name}}):t};case te.role:return function(t){return Xt(e,t)?Object(l.a)(Object(l.a)({},t),{mishapVictim:t.mishapVictim.id===e.id?{id:e.id,name:e.name}:t.mishapVictim,hazardElement:t.hazardElement.id===e.id?{id:e.id,name:e.name}:t.hazardElement}):t};case te.kind:return function(t){return Bt(e,t)?Object(l.a)(Object(l.a)({},t),{mishapVictimEnvObj:t.mishapVictimEnvObj.id===e.id?{id:e.id,name:e.name}:t.mishapVictimEnvObj,hazardElementEnvObj:t.hazardElementEnvObj.id===e.id?{id:e.id,name:e.name}:t.hazardElementEnvObj}):t}}}(t.payload);return e.map(n);case"DELETE_CONNECTION":var a=Wt(t.payload.target);return e.filter((function(e){return!a(e)}));case"DELETE_SYSTEM_OBJECT":var r=Wt(t.payload);return e.filter((function(e){return!r(e)}));default:return e}}function ia(e,t){return"CREATE_HAZARD"===t.type?e+1:e}function ca(e,t){switch(t.type){case"CREATE_SUBSYSTEM":return e.concat(t.payload);case"UPDATE_SUBSYSTEM":return e.map((function(e){return e.id===t.payload.id?t.payload:e}));case"DELETE_SUBSYSTEM":return e.filter((function(e){return e.id!==t.payload.id}));default:return e}}function la(e,t){switch(t.type){case"CREATE_CONNECTION":return e.concat(t.payload);case"DELETE_CONNECTION":return e.filter((function(e){return e.id!==t.payload.connection.id}));case"DELETE_SYSTEM_OBJECT":var n=t.payload.id;return e.filter((function(e){return e.source!==n&&e.target!==n}));default:return e}}function oa(e,t,n){switch(t.type){case"CREATE_SYSTEM_OBJECT":return t.payload.type!==n?e:e.concat(t.payload);case"UPDATE_SYSTEM_OBJECT":return t.payload.type!==n?e:e.map((function(e){return e.id===t.payload.id?t.payload:e}));case"DELETE_SYSTEM_OBJECT":return t.payload.type!==n?e:e.filter((function(e){return e.id!==t.payload.id}));default:return e}}function sa(e,t){return oa(e,t,te.kind)}function ua(e,t){switch(t.type){case"ADD_POSSIBLE_HARM":return e.map((function(e){if(e.id===t.payload.mishapVictim.id){var n=e.possibleHarms.concat(t.payload.harm);return Object(l.a)(Object(l.a)({},e),{possibleHarms:n})}return e}));case"REMOVE_POSSIBLE_HARM":return e.map((function(e){if(e.id===t.payload.mishapVictim.id){var n=e.possibleHarms.filter((function(e){return e!==t.payload.harm}));return Object(l.a)(Object(l.a)({},e),{possibleHarms:n})}return e}));default:return oa(e,t,te.role)}}function da(e,t){return oa(e,t,te.relator)}var ma={projectName:"Hazard Ontology",currentStep:Q(),lastCompletedStep:Q(),kinds:[],roles:[],relators:[],systemObjectConnections:[],subsystems:[],hazards:[],nextHazardId:1};var pa={contentText:"",onYes:function(){}};var ba=Object(aa.b)({systemModel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ma,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOAD_MODEL":return t.payload;case"RESET_MODEL":return ma;case"UPDATE_FLOW_STEP":var n=t.payload,a=ee(n);return a===ee(e.currentStep)?e:a>ee(e.lastCompletedStep)?Object(l.a)(Object(l.a)({},e),{currentStep:n,lastCompletedStep:n}):Object(l.a)(Object(l.a)({},e),{currentStep:n});case"UPDATE_PROJECT_NAME":return Object(l.a)(Object(l.a)({},e),{projectName:t.payload});default:return Object(l.a)(Object(l.a)({},e),{hazards:ra(e.hazards,t),nextHazardId:ia(e.nextHazardId,t),subsystems:ca(e.subsystems,t),systemObjectConnections:la(e.systemObjectConnections,t),kinds:sa(e.kinds,t),roles:ua(e.roles,t),relators:da(e.relators,t)})}},unsavedChanges:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("unsavedChanges"in t)return t.unsavedChanges;switch(t.type){case"RESET_MODEL":case"LOAD_MODEL":case"SAVE_CHANGES":return!1;default:return e}},modalDialog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SHOW_CONFIRMATION_DIALOG":return t.payload;case"HIDE_CONFIRMATION_DIALOG":return pa;default:return e}}}),ha=n(204),fa=n(85),Ea={standard:Object(fa.a)().spacing(2),drawerWidth:240},ya=Object(fa.a)({zIndex:{graph:10,nodeAction:20,graphHelp:30,graphAction:40},appSpacing:Ea}),Oa=Object(aa.c)(ba);c.a.render(r.a.createElement(h.a,{store:Oa},r.a.createElement(ha.a,{theme:ya},r.a.createElement(na,null))),document.getElementById("root"))},96:function(e,t,n){e.exports=n(118)}},[[96,1,2]]]);
//# sourceMappingURL=main.24fd76c4.chunk.js.map