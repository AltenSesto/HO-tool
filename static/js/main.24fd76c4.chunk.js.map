{"version":3,"sources":["components/error-boundary.tsx","store/modal-dialog/actions.ts","store/modal-dialog/types.ts","store/system-model/actions.ts","store/system-model/types.ts","components/meny/open-file-button.tsx","components/meny/download-file-button.tsx","entities/meny/flow-step-id.ts","store/unsaved-changes/actions.ts","store/unsaved-changes/types.ts","components/meny/new-file-button.tsx","components/meny/meny.tsx","entities/meny/flow.ts","entities/system-description/object-types.ts","components/meny/help-text.tsx","components/meny/progress-steps.tsx","components/project-name.tsx","components/confirmation-dialog.tsx","components/shared/corner-card.tsx","components/mishap-victim-identification/victim-harms.tsx","styles/graph-style.ts","entities/graph/graph-element.ts","entities/graph/collapse-api.ts","components/graph/graph-container.tsx","components/graph/graph.tsx","entities/system-description/system-description-entity.ts","entities/graph/graph-elements-factory.ts","entities/system-description/role.ts","entities/graph/graph-elements-factory-mishap-victims.ts","components/mishap-victim-identification/graph-view.tsx","components/mishap-victim-identification/harms-table-row.tsx","components/mishap-victim-identification/select-role-table-row.tsx","components/shared/corner-button-primary.tsx","components/mishap-victim-identification/table-view.tsx","components/shared/corner-fab.tsx","components/mishap-victim-identification/mishap-victim-identification.tsx","entities/system-model.ts","components/system-description/toolbar-buttons.tsx","components/system-description/node-editor.tsx","components/graph/node-popper.tsx","components/system-description/delete-element-button.tsx","entities/graph/element-utilities.ts","entities/hazard-population/hazard.ts","components/system-description/delete-connection-button.tsx","entities/hazard-description-categorization/hazard-category.ts","components/causes-identification/och-step-1/categorization-wizard.tsx","components/system-description/sdf-step-base.tsx","components/system-description/delete-system-object-button.tsx","components/system-description/delete-subsystem-button.tsx","components/system-description/edit-node-button.tsx","components/system-description/subsystem-collapse-button.tsx","components/graph/node-actions.tsx","components/system-description/sdf-step-1.tsx","components/system-description/sdf-step-2.tsx","components/system-description/sdf-step-3.tsx","components/system-description/sdf-step-4.tsx","components/hazard-population/hazard-id.tsx","components/shared/table-cell-small.ts","components/hazard-population/hazard-row.tsx","components/hazard-population/hazards-table.tsx","components/hazard-population/hazard-create-details.tsx","components/hazard-population/hazard-create.tsx","components/hazard-population/victim-hazards.tsx","components/hazard-population/graph-view.tsx","entities/graph/headless-graph.ts","components/hazard-population/table-view.tsx","components/hazard-population/hazard-population.tsx","components/causes-identification/och-step-1/table-row.tsx","components/causes-identification/och-step-1/och-step-1.tsx","components/causes-identification/och-step-2/hazards-list.tsx","components/causes-identification/och-step-2/expansion-graph.tsx","components/causes-identification/och-step-2/och-step-2.tsx","App.tsx","store/system-model/reducers/hazards-reducer.ts","store/system-model/reducers/next-hazard-id-reducer.ts","store/system-model/reducers/subsystems-reducer.ts","store/system-model/reducers/connections-reducer.ts","store/system-model/reducers/system-object-reducer.ts","store/system-model/reducers/kinds-reducer.ts","store/system-model/reducers/roles-reducer.ts","store/system-model/reducers/relators-reducer.ts","store/system-model/system-model-reducer.ts","store/modal-dialog/reducers.ts","store/index.ts","store/unsaved-changes/reducers.ts","styles/app-theme.ts","index.tsx"],"names":["ErrorBoundary","props","state","error","this","setState","message","children","Component","showConfirmationDialog","contentText","onYes","onNo","undefined","type","payload","confirmDiscardModel","createBaseCrudAction","unsavedChanges","updateHazard","hazard","deleteHazard","updateSubsystem","subsystem","deleteSystemObject","systemObject","resetModel","addPossibleHarm","mishapVictim","harm","removePossibleHarm","hazards","dispatch","removeHarmAction","possibleHarms","length","affectedHazards","filter","e","id","forEach","h","mapDispatch","resetSystemModel","setSystemModel","model","connector","connect","hasUnsavedChanges","useStyles","makeStyles","inlineBlock","display","hidden","classes","formRef","useRef","inputRef","openSelectFileDialog","current","click","handleFileError","ev","target","Error","processFile","data","result","JSON","parse","reset","window","FileReader","FileList","ref","className","onChange","files","file","reader","onload","onerror","readAsText","readFile","accept","IconButton","title","size","color","component","onClick","FolderOpen","disabled","FlowStepId","saveChanges","systemModel","serialized","stringify","fileName","projectName","Date","toISOString","replace","element","document","createElement","setAttribute","encodeURIComponent","style","body","appendChild","removeChild","Badge","variant","invisible","SaveAlt","InsertDriveFileOutlined","Meny","Fragment","getFirstStepId","SDF_1","getFlowStepOrder","step","SDF_2","SDF_3","SDF_4","OHI_2","OHI_3","OCH_1","OCH_2","ObjectTypes","flow","OHI","label","OHI_1","helpText","OCH","OCH_3","SARE","SARE_1","SARE_2","SARE_3","CM","theme","typography","padding","appSpacing","standard","maxWidth","HelpText","useState","popoverAnchor","setPopoverAnchor","isOpen","setIsOpen","useEffect","open","edge","highlighted","Help","HelpOutline","Popover","anchorEl","onClose","anchorOrigin","vertical","horizontal","transformOrigin","Typography","dangerouslySetInnerHTML","__html","htmlContent","paddingLeft","spacing","phase","bold","fontWeight","setCurentStep","currentStep","lastCompletedStep","List","dense","map","stage","key","ListItem","ListItemIcon","Chip","ListItemText","primary","disableTypography","renderSteps","steps","paddingClass","disablePadding","stepOrder","isInFlow","isCurrent","isEnabled","helpOpenedOnFirstVisit","button","ListItemSecondaryAction","Divider","nameUpdated","name","useStyle","input","palette","common","white","buttonGutter","isEditing","setIsEditing","setName","initInput","select","onReset","onSubmit","preventDefault","TextField","required","autoFocus","value","Done","Clear","Edit","close","dialog","modalDialog","Dialog","disableBackdropClick","disableEscapeKeyDown","DialogContent","DialogContentText","DialogActions","Button","root","position","bottom","right","zIndex","graphHelp","minWidth","CornerCard","Card","CardContent","harmAdded","harmDeleted","emptyContent","renderHarmItem","item","index","role","deletePossibleHarm","Delete","renderAddItem","action","form","currentTarget","elements","namedItem","createMishapVictim","margin","fullWidth","placeholder","autoComplete","Add","selectedRole","gutterBottom","sort","a","b","localeCompare","concat","renderContent","graphStyle","selector","kind","toString","relator","isSystemObjectData","isSubsystemData","options","animate","cueEnabled","getCollapseApi","cy","expandCollapse","overflow","top","mixins","toolbar","minHeight","left","drawerWidth","GraphContainer","scrollHeight","scrollWidth","cytoscape","use","popper","Graph","containerSize","height","width","initCytoscape","bind","addEventListeners","resizeCanvas","handleNodeMoved","setInitialCanvasSize","collapseApi","maxX","maxY","graphContainerStyle","graph","cursor","cursorStyle","stylesheet","userZoomingEnabled","userPanningEnabled","boundingBox","nodes","renderedBoundingBox","Math","max","y2","x2","event","node","x","y","nodeMoved","ele","isNode","on","isCollapsed","collapse","mouseEnteredNode","mouseLeftNode","nodeClicked","zoom","graphClicked","useCollapseApi","initCollapseApi","React","withTheme","isSystemObject","entity","isSubsystem","GraphElementsFactory","system","mapSystemDescriptionEntities","getAllNodes","systemObjectConnections","entities","mapSystemObject","mapConnection","mapSubsystem","kinds","relators","roles","subsystems","object","hookSystemObject","group","parent","posX","posY","connection","hookConnection","source","pannable","isOriented","hookSubsystem","isRole","obj","isMishapVictim","GraphElementsFactoryMishapVictims","grabbable","push","systemDescription","getRoleFromEvent","mouseEntered","mouseLeft","selectRole","clearRoleSelection","selectedRoleId","isMouseOverRole","mapSystemDescription","find","isDefaultPrevented","chip","marginRight","TableRow","TableCell","scope","align","onDelete","deleteHarm","formControl","SelectRoleTableRow","FormControl","InputLabel","Select","labelId","roleId","roleSelected","MenuItem","colSpan","marginLeft","marginTop","CornerButtonPrimary","newlyAdded","setNewlyAdded","isSelectingRole","setIsSelectingRole","existingMishapVictims","some","n","newlyAddedMishapVictims","mishapVictims","rolesToSelect","r","TableContainer","Table","TableHead","TableBody","fab","marginBottom","graphAction","fabSpace","CornerFab","separated","Fab","MishapVictimIdentification","isGraphView","setIsGraphView","TableChart","BubbleChart","createObjectId","prefix","getTime","ToolbarButtons","buttons","icon","text","selectEmpty","NodeEditor","parentEditor","setEntity","subsystemsAvailable","entityParent","shrink","displayEmpty","Backdrop","entityUpdated","editCancelled","defaultValue","nodeAction","NodePopper","createRef","setPopper","destroyPopper","useCallback","off","scheduleUpdate","destroy","popperObj","content","placement","DeleteElementButton","getSystemObject","getRole","getConnection","isConnectionData","isKindInHazard","hazardElementEnvObj","mishapVictimEnvObj","isRoleInHazard","hazardElement","isRelatorInHazard","exposure","getIsSystemObjectInHazard","HazardCategory","IntermediateCategory","connectionDeleted","confirm","isTargetInHazard","subsystemCreated","subsystemUpdated","connectionCreated","systemObjectRenamed","systemObjectCreated","systemObjectUpdated","DEFAULT_POSITION","showNodeActions","hideNodeActions","createConnection","completeEditEntity","updateNodePosition","validateConnection","preventOverlap","cancelEditEntity","renderConnectionActions","isConnectionValid","actionButtonsPlacement","elementDisplayPopper","nodeConnecting","elementActions","actionElement","isEdge","renderSystemObjectActions","renderSubsystemActions","nodeConnectingDone","toolbarButtons","objectEditing","tryCreateConnection","elementDisplayPopperChanged","edgesWith","parentPosition","i","childNode","childData","childObject","objectEditingDone","allNodes","existingEntity","positionOverride","parentId","adjustedPosition","nodePosition","otherNodes","every","systemObjectDeleted","isObjectInHazard","subsystemDeleted","deleteSubsystemWithChildren","checkHazardsAndDelete","isChildless","newStateCollapsed","expand","json","pan","ExpandMore","ExpandLess","base","NodeActions","SdfStep1","startCreatingKind","startCreatingRole","startCreatingSubsystem","Link","sourceData","targetData","SdfStep2","SdfStep3","startCreatingRelator","SdfStep4","existingConnection","sourceObj","targetObj","HazardId","TableCellSmall","withStyles","createStyles","sizeSmall","HazardsRow","isEditable","setIsEditable","harmTruthmaker","setHarmTruthmaker","description","setDescription","isEmpty","string","helperText","hazardEdited","editHazard","Save","hazardDeleted","actions","selectedMishapVictim","divide","paddingRight","HazardCreateDetails","template","hazardElementEnvObjs","envObj","setEnvObj","selectOptions","nextHazardId","hazardCreated","multiline","rowsMax","StyledTableRow","backgroundColor","grey","header","setTemplate","possibleHazards","setPossibleHazards","getEntityPair","takeSource","victimKinds","incomers","outgoers","hazardRoles","hazardElementsEnvObjs","hazardKinds","j","k","findPossibleHazards","Grid","container","xs","tableGutter","VictimHazards","join","isVictimPointed","setIsVictimPointed","getMishapVictimFromEvent","checkVictimPointed","victimSelected","HeadlessGraph","_cy","headless","mishapVictimId","setMishapVictimId","mishapVictimNode","setMishapVictimNode","headlessGraph","$","HazardPopulation","isSummarySelected","setIsSummarySelected","selectedVictim","setSelectedVictim","CategorizationWizard","question","notSet","category","setCategory","instructions","situation","complete","initiatingCondition","mishap","initiatingEvent","CardHeader","cancel","Close","CardActions","OchStep1TableRow","isCategorizing","setIsCategorizing","hazardUpdated","expansion","Check","hazardSelected","expansionMembers","setExpansionMembers","hazardNodesSelector","selectedHazard","hazardNodes","hazardEdges","hazardSystemObjects","hazardConnections","OchStep2","setSelectedHazard","appBar","drawer","drawerOpen","alignItems","justifyContent","flexGrow","appTitle","textAlign","useBeforeunload","CssBaseline","AppBar","Toolbar","justify","Drawer","paper","getMainContent","hazardsReducer","transform","getHazardTransform","nextHazardIdReducer","subsystemReducer","connectionReducer","objectId","systemObjectReducer","objectType","kindsReducer","rolesReducer","relatorsReducer","initialState","rootReducer","combineReducers","createMuiTheme","appTheme","store","createStore","ReactDOM","render","ThemeProvider","getElementById"],"mappings":"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","file":"static/js/main.24fd76c4.chunk.js","sourcesContent":["import React, { Component } from 'react';\r\n\r\ninterface State {\r\n    error?: Error\r\n}\r\n\r\ninterface Props {}\r\n\r\nclass ErrorBoundary extends Component<Props, State> {\r\n    constructor(props: Props) {\r\n      super(props);\r\n      this.state = {};\r\n    }\r\n\r\n    static getDerivedStateFromError(error: Error) {\r\n      // Update state so the next render will show the fallback UI.\r\n      return { error: error };\r\n    }\r\n  \r\n    componentDidCatch(error: Error) {\r\n      this.setState({ error });\r\n    }\r\n  \r\n    render() {\r\n      if (this.state.error) {\r\n        return <h1>{'ERROR: ' + this.state.error.message}</h1>;\r\n      }\r\n      return this.props.children;\r\n    }\r\n  }\r\n\r\n  export default ErrorBoundary;\r\n","import { SHOW_CONFIRMATION_DIALOG, ModalDialogActionTypes, HIDE_CONFIRMATION_DIALOG } from \"./types\";\r\n\r\nexport function showConfirmationDialog(\r\n    contentText: string,\r\n    onYes: () => void,\r\n    onNo: (() => void) | undefined = undefined\r\n): ModalDialogActionTypes {\r\n    return {\r\n        type: SHOW_CONFIRMATION_DIALOG,\r\n        payload: { contentText, onYes, onNo }\r\n    };\r\n}\r\n\r\nexport function hideConfirmationDialog(): ModalDialogActionTypes {\r\n    return {\r\n        type: HIDE_CONFIRMATION_DIALOG\r\n    };\r\n}\r\n\r\nexport function confirmDiscardModel(onYes: () => void) {\r\n    return showConfirmationDialog('You have unsaved changes that will be lost. Continue ?', onYes);\r\n}\r\n","import DialogConfirmation from \"../../entities/dialog-confirmation\";\r\n\r\nexport const SHOW_CONFIRMATION_DIALOG = 'SHOW_CONFIRMATION_DIALOG'\r\nexport const HIDE_CONFIRMATION_DIALOG = 'HIDE_CONFIRMATION_DIALOG'\r\n\r\ninterface ShowConfirmationDialogAction {\r\n    type: typeof SHOW_CONFIRMATION_DIALOG;\r\n    payload: DialogConfirmation;\r\n}\r\n\r\ninterface HideConfirmationDialogAction {\r\n    type: typeof HIDE_CONFIRMATION_DIALOG;\r\n}\r\n\r\nexport type ModalDialogActionTypes = ShowConfirmationDialogAction | HideConfirmationDialogAction\r\n","import { Action, Dispatch } from 'redux';\r\nimport { SystemModelActionTypes, CREATE_HAZARD, UPDATE_HAZARD, DELETE_HAZARD, LOAD_MODEL, RESET_MODEL, UPDATE_FLOW_STEP, ADD_POSSIBLE_HARM, REMOVE_POSSIBLE_HARM, CREATE_SUBSYSTEM, UPDATE_SUBSYSTEM, DELETE_SUBSYSTEM, CREATE_CONNECTION, DELETE_CONNECTION, CREATE_SYSTEM_OBJECT, UPDATE_SYSTEM_OBJECT, DELETE_SYSTEM_OBJECT, RENAME_SYSTEM_OBJECT, UPDATE_PROJECT_NAME } from \"./types\";\r\nimport Hazard from \"../../entities/hazard-population/hazard\";\r\nimport { SystemModel } from \"../../entities/system-model\";\r\nimport { MishapVictim } from \"../../entities/system-description/role\";\r\nimport { showConfirmationDialog } from \"../modal-dialog/actions\";\r\nimport Subsystem from '../../entities/system-description/subsystem';\r\nimport Connection from '../../entities/system-description/connection';\r\nimport SystemObject from '../../entities/system-description/system-object';\r\nimport { FlowStepId } from '../../entities/meny/flow-step-id';\r\n\r\nfunction createBaseCrudAction<T extends string, P>(type: T, payload: P) {\r\n    return {\r\n        type,\r\n        payload,\r\n        unsavedChanges: true\r\n    };\r\n}\r\n\r\nexport function createHazard(hazard: Hazard): SystemModelActionTypes {\r\n    return createBaseCrudAction(CREATE_HAZARD, hazard);\r\n}\r\n\r\nexport function updateHazard(hazard: Hazard): SystemModelActionTypes {\r\n    return createBaseCrudAction(UPDATE_HAZARD, hazard);\r\n}\r\n\r\nexport function deleteHazard(hazard: Hazard): SystemModelActionTypes {\r\n    return createBaseCrudAction(DELETE_HAZARD, hazard);\r\n}\r\n\r\nexport function createSubsystem(subsystem: Subsystem): SystemModelActionTypes {\r\n    return createBaseCrudAction(CREATE_SUBSYSTEM, subsystem);\r\n}\r\n\r\nexport function updateSubsystem(subsystem: Subsystem): SystemModelActionTypes {\r\n    return createBaseCrudAction(UPDATE_SUBSYSTEM, subsystem);\r\n}\r\n\r\nexport function deleteSubsystem(subsystem: Subsystem): SystemModelActionTypes {\r\n    return createBaseCrudAction(DELETE_SUBSYSTEM, subsystem);\r\n}\r\n\r\nexport function createConnection(connection: Connection): SystemModelActionTypes {\r\n    return createBaseCrudAction(CREATE_CONNECTION, connection);\r\n}\r\n\r\nexport function deleteConnection(connection: Connection, target: SystemObject): SystemModelActionTypes {\r\n    return createBaseCrudAction(DELETE_CONNECTION, { connection, target });\r\n}\r\n\r\nexport function createSystemObject(systemObject: SystemObject): SystemModelActionTypes {\r\n    return createBaseCrudAction(CREATE_SYSTEM_OBJECT, systemObject);\r\n}\r\n\r\nexport function updateSystemObject(systemObject: SystemObject): SystemModelActionTypes {\r\n    return createBaseCrudAction(UPDATE_SYSTEM_OBJECT, systemObject);\r\n}\r\n\r\nexport function deleteSystemObject(systemObject: SystemObject): SystemModelActionTypes {\r\n    return createBaseCrudAction(DELETE_SYSTEM_OBJECT, systemObject);\r\n}\r\n\r\nexport function renameSystemObject(systemObject: SystemObject): SystemModelActionTypes {\r\n    return createBaseCrudAction(RENAME_SYSTEM_OBJECT, systemObject);\r\n}\r\n\r\nexport function loadModel(model: SystemModel): SystemModelActionTypes {\r\n    return {\r\n        type: LOAD_MODEL,\r\n        payload: model\r\n    };\r\n}\r\n\r\nexport function resetModel(): SystemModelActionTypes {\r\n    return {\r\n        type: RESET_MODEL\r\n    };\r\n}\r\n\r\nexport function updateFlowStep(step: FlowStepId): SystemModelActionTypes {\r\n    return {\r\n        type: UPDATE_FLOW_STEP,\r\n        payload: step\r\n    };\r\n}\r\n\r\nexport function addPossibleHarm(mishapVictim: MishapVictim, harm: string): SystemModelActionTypes {\r\n    return createBaseCrudAction(ADD_POSSIBLE_HARM, { mishapVictim, harm });\r\n}\r\n\r\nexport function removePossibleHarm(\r\n    mishapVictim: MishapVictim,\r\n    harm: string,\r\n    hazards: Hazard[],\r\n    dispatch: Dispatch<Action>\r\n) {\r\n    const removeHarmAction = createBaseCrudAction(REMOVE_POSSIBLE_HARM, { mishapVictim, harm });\r\n\r\n    if (mishapVictim.possibleHarms.length === 1) {\r\n        const affectedHazards = hazards.filter(e => e.mishapVictim.id === mishapVictim.id);\r\n        if (affectedHazards.length > 0) {\r\n            dispatch(showConfirmationDialog(\r\n                'This mishap victim has hazard(s) associated with it. If you delete the only possible harm it will no longer be a mishap victim and all it\\'s hazards will be deleted. Continue?',\r\n                () => {\r\n                    dispatch(removeHarmAction);\r\n                    affectedHazards.forEach((h) => dispatch(deleteHazard(h)));\r\n                }\r\n            ));\r\n            return;\r\n        }\r\n    }\r\n\r\n    dispatch(removeHarmAction);\r\n}\r\n\r\nexport function updateProjectName(name: string): SystemModelActionTypes {\r\n    return createBaseCrudAction(UPDATE_PROJECT_NAME, name);\r\n}\r\n","import Hazard from '../../entities/hazard-population/hazard'\r\nimport { SystemModel } from '../../entities/system-model'\r\nimport { MishapVictim } from '../../entities/system-description/role'\r\nimport Subsystem from '../../entities/system-description/subsystem'\r\nimport Connection from '../../entities/system-description/connection'\r\nimport SystemObject from '../../entities/system-description/system-object'\r\nimport { FlowStepId } from '../../entities/meny/flow-step-id'\r\n\r\nexport const CREATE_HAZARD = 'CREATE_HAZARD'\r\nexport const DELETE_HAZARD = 'DELETE_HAZARD'\r\nexport const UPDATE_HAZARD = 'UPDATE_HAZARD'\r\nexport const LOAD_MODEL = 'LOAD_MODEL'\r\nexport const RESET_MODEL = 'RESET_MODEL'\r\nexport const UPDATE_FLOW_STEP = 'UPDATE_FLOW_STEP'\r\nexport const ADD_POSSIBLE_HARM = 'ADD_POSSIBLE_HARM'\r\nexport const REMOVE_POSSIBLE_HARM = 'REMOVE_POSSIBLE_HARM'\r\nexport const CREATE_SUBSYSTEM = 'CREATE_SUBSYSTEM'\r\nexport const DELETE_SUBSYSTEM = 'DELETE_SUBSYSTEM'\r\nexport const UPDATE_SUBSYSTEM = 'UPDATE_SUBSYSTEM'\r\nexport const CREATE_CONNECTION = 'CREATE_CONNECTION'\r\nexport const DELETE_CONNECTION = 'DELETE_CONNECTION'\r\nexport const CREATE_SYSTEM_OBJECT = 'CREATE_SYSTEM_OBJECT'\r\nexport const DELETE_SYSTEM_OBJECT = 'DELETE_SYSTEM_OBJECT'\r\nexport const UPDATE_SYSTEM_OBJECT = 'UPDATE_SYSTEM_OBJECT'\r\nexport const RENAME_SYSTEM_OBJECT = 'RENAME_SYSTEM_OBJECT'\r\nexport const UPDATE_PROJECT_NAME = 'UPDATE_PROJECT_NAME'\r\n\r\n\r\ninterface CrudActionBase<T, P> {\r\n    type: T;\r\n    payload: P;\r\n    unsavedChanges: boolean;\r\n}\r\n\r\ninterface CreateHazardAction extends CrudActionBase<typeof CREATE_HAZARD, Hazard> { }\r\n\r\ninterface DeleteHazardAction extends CrudActionBase<typeof DELETE_HAZARD, Hazard> { }\r\n\r\ninterface UpdateHazardAction extends CrudActionBase<typeof UPDATE_HAZARD, Hazard> { }\r\n\r\ninterface CreateSubsystemAction extends CrudActionBase<typeof CREATE_SUBSYSTEM, Subsystem> { }\r\n\r\ninterface DeleteSubsystemAction extends CrudActionBase<typeof DELETE_SUBSYSTEM, Subsystem> { }\r\n\r\ninterface UpdateSubsystemAction extends CrudActionBase<typeof UPDATE_SUBSYSTEM, Subsystem> { }\r\n\r\ninterface CreateConnectionAction extends CrudActionBase<typeof CREATE_CONNECTION, Connection> { }\r\n\r\ninterface DeleteConnectionAction extends CrudActionBase<typeof DELETE_CONNECTION, {\r\n    connection: Connection,\r\n    target: SystemObject\r\n}> { }\r\n\r\ninterface CreateSystemObjectAction extends CrudActionBase<typeof CREATE_SYSTEM_OBJECT, SystemObject> { }\r\n\r\ninterface DeleteSystemObjectAction extends CrudActionBase<typeof DELETE_SYSTEM_OBJECT, SystemObject> { }\r\n\r\ninterface UpdateSystemObjectAction extends CrudActionBase<typeof UPDATE_SYSTEM_OBJECT, SystemObject> { }\r\n\r\ninterface RenameSystemObjectAction extends CrudActionBase<typeof RENAME_SYSTEM_OBJECT, SystemObject> { }\r\n\r\ninterface LoadModelAction {\r\n    type: typeof LOAD_MODEL,\r\n    payload: SystemModel\r\n}\r\n\r\ninterface ResetModelAction {\r\n    type: typeof RESET_MODEL;\r\n}\r\n\r\ninterface UpdateFlowStepAction {\r\n    type: typeof UPDATE_FLOW_STEP;\r\n    payload: FlowStepId\r\n}\r\n\r\ninterface AddPossibleHarmAction extends CrudActionBase<\r\n        typeof ADD_POSSIBLE_HARM,\r\n        { mishapVictim: MishapVictim, harm: string }\r\n    > { }\r\n\r\ninterface RemovePossibleHarmAction extends CrudActionBase<\r\n    typeof REMOVE_POSSIBLE_HARM,\r\n    { mishapVictim: MishapVictim, harm: string }\r\n    > { }\r\n\r\ninterface UpdateProjectName extends CrudActionBase<typeof UPDATE_PROJECT_NAME, string> { }\r\n\r\nexport type SystemModelActionTypes = CreateHazardAction | DeleteHazardAction | UpdateHazardAction |\r\n    LoadModelAction | ResetModelAction | UpdateFlowStepAction |\r\n    AddPossibleHarmAction | RemovePossibleHarmAction | UpdateProjectName |\r\n    CreateSubsystemAction | UpdateSubsystemAction | DeleteSubsystemAction |\r\n    CreateConnectionAction | DeleteConnectionAction | RenameSystemObjectAction |\r\n    CreateSystemObjectAction | DeleteSystemObjectAction | UpdateSystemObjectAction\r\n","import React, { useRef } from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { RootState } from '../../store';\r\nimport { IconButton, makeStyles } from '@material-ui/core';\r\nimport { FolderOpen } from '@material-ui/icons';\r\nimport { resetModel, loadModel } from '../../store/system-model/actions';\r\nimport { confirmDiscardModel } from '../../store/modal-dialog/actions';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    hasUnsavedChanges: state.unsavedChanges\r\n});\r\n\r\nconst mapDispatch = {\r\n    resetSystemModel: resetModel,\r\n    setSystemModel: loadModel,\r\n    confirmDiscardModel: confirmDiscardModel\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatch);\r\n\r\ntype Props = ConnectedProps<typeof connector>\r\n\r\nconst useStyles = makeStyles(() => ({\r\n    inlineBlock: {\r\n        display: 'inline-block'\r\n    },\r\n    hidden: {\r\n        display: 'none'\r\n    }\r\n}));\r\n\r\nconst OpenFileButton: React.FC<Props> = (props) => {\r\n    const classes = useStyles();\r\n    const formRef = useRef<HTMLFormElement | null>();\r\n    const inputRef = useRef<HTMLInputElement | null>();\r\n\r\n    const openSelectFileDialog = () => {\r\n        if (inputRef.current) {\r\n            inputRef.current.click();\r\n        }\r\n    };\r\n\r\n    const confirmOpenFile = () => {\r\n        if (!props.hasUnsavedChanges) {\r\n            openSelectFileDialog();\r\n        } else {\r\n            props.confirmDiscardModel(openSelectFileDialog);\r\n        }\r\n    };\r\n\r\n    const readFile = (files: FileList | null) => {\r\n        if (files === null || files.length !== 1) {\r\n            return;\r\n        }\r\n        const file = files[0];\r\n        if (file.type !== 'application/json') {\r\n            throw new Error('File type not supported');\r\n        }\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = processFile;\r\n        reader.onerror = handleFileError;\r\n        reader.readAsText(file, 'utf-8');\r\n    };\r\n\r\n    const handleFileError = (ev: ProgressEvent<FileReader>) => {\r\n        let message = 'Error reading a file';\r\n        if (ev.target && ev.target.error) {\r\n            message = ev.target.error.message;\r\n        }\r\n        throw new Error(message);\r\n    };\r\n\r\n    const processFile = (ev: ProgressEvent<FileReader>) => {\r\n        if (!ev.target) {\r\n            throw new Error('Error reading a file');\r\n        }\r\n\r\n        const data = ev.target.result as string;\r\n        const model = JSON.parse(data);\r\n        if (formRef.current) {\r\n            formRef.current.reset();\r\n        }\r\n\r\n        props.resetSystemModel();\r\n        props.setSystemModel(model);\r\n    };\r\n\r\n    if (window.FileReader && window.FileList) {\r\n        return (\r\n            <form\r\n                ref={(ref) => formRef.current = ref}\r\n                className={classes.inlineBlock}\r\n            >\r\n                <input\r\n                    ref={(ref) => inputRef.current = ref}\r\n                    className={classes.hidden}\r\n                    type='file'\r\n                    onChange={(ev) => readFile(ev.target.files)}\r\n                    accept='.json'\r\n                />\r\n                <IconButton\r\n                    title='Open Project File'\r\n                    size='small'\r\n                    color='inherit'\r\n                    component='span'\r\n                    onClick={confirmOpenFile}\r\n                >\r\n                    <FolderOpen />\r\n                </IconButton>\r\n            </form>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div title='File API not supported' className={classes.inlineBlock}>\r\n            <IconButton size='small' color='inherit' disabled={true}>\r\n                <FolderOpen />\r\n            </IconButton>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default connector(OpenFileButton);\r\n","import React from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { RootState } from '../../store';\r\nimport { IconButton, Badge } from '@material-ui/core';\r\nimport { SaveAlt } from '@material-ui/icons';\r\nimport { saveChanges } from '../../store/unsaved-changes/actions';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    systemModel: state.systemModel,\r\n    hasUnsavedChanges: state.unsavedChanges\r\n});\r\n\r\nconst mapDispatch = {\r\n    saveChanges: saveChanges\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatch);\r\n\r\ntype Props = ConnectedProps<typeof connector>\r\n\r\nconst DownloadFileButton: React.FC<Props> = (props) => {\r\n\r\n    const downloadFile = () => {\r\n        const data = props.systemModel;\r\n        const serialized = JSON.stringify(data, null, '\\t');\r\n        const fileName = `${data.projectName} ${new Date().toISOString().replace(/:/g, '_')}.json`;\r\n\r\n        var element = document.createElement('a');\r\n        element.setAttribute('href', 'data:application/json;charset=utf-8,' + encodeURIComponent(serialized));\r\n        element.setAttribute('download', fileName);\r\n        element.style.display = 'none';\r\n        document.body.appendChild(element);\r\n\r\n        element.click();\r\n        document.body.removeChild(element);\r\n\r\n        props.saveChanges();\r\n    };\r\n\r\n    return (\r\n        <IconButton\r\n            size='small'\r\n            title={props.hasUnsavedChanges ? 'Download Project - You have unsaved changes' : 'Download Project'}\r\n            color='inherit'\r\n            onClick={downloadFile}\r\n        >\r\n            <Badge variant='dot' color='secondary' invisible={!props.hasUnsavedChanges}>\r\n                <SaveAlt />\r\n            </Badge>\r\n        </IconButton>\r\n    );\r\n};\r\n\r\nexport default connector(DownloadFileButton);\r\n","export enum FlowStepId {\r\n    OHI = 'OHI',\r\n    OHI_1 = 'OHI-1',\r\n    SDF_1 = 'SDF-1',\r\n    SDF_2 = 'SDF-2',\r\n    SDF_3 = 'SDF-3',\r\n    SDF_4 = 'SDF-4',\r\n    OHI_2 = 'OHI-2',\r\n    OHI_3 = 'OHI-3',\r\n    OCH = 'OCH',\r\n    OCH_1 = 'OCH-1',\r\n    OCH_2 = 'OCH-2',\r\n    OCH_3 = 'OCH-3',\r\n    SARE = 'SARE',\r\n    SARE_1 = 'SARE-1',\r\n    SARE_2 = 'SARE-2',\r\n    SARE_3 = 'SARE-3',\r\n    CM = 'CM'\r\n}","import { UnsavedChangesActionType, SAVE_CHANGES } from './types';\r\n\r\nexport function saveChanges(): UnsavedChangesActionType {\r\n    return {\r\n        type: SAVE_CHANGES\r\n    };\r\n}\r\n","export const SAVE_CHANGES = 'SAVE_CHANGES'\r\n\r\ninterface SaveChangesAction {\r\n    type: typeof SAVE_CHANGES;\r\n}\r\n\r\nexport type UnsavedChangesActionType = SaveChangesAction\r\n","import React from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { RootState } from '../../store';\r\nimport { confirmDiscardModel } from '../../store/modal-dialog/actions';\r\nimport { resetModel } from '../../store/system-model/actions';\r\nimport { IconButton } from '@material-ui/core';\r\nimport { InsertDriveFileOutlined } from '@material-ui/icons';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    hasUnsavedChanges: state.unsavedChanges\r\n});\r\n\r\nconst mapDispatch = {\r\n    confirmDiscardModel: confirmDiscardModel,\r\n    resetModel: resetModel\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatch);\r\n\r\ntype Props = ConnectedProps<typeof connector>\r\n\r\nconst NewFileButton: React.FC<Props> = (props) => {\r\n\r\n    const setNewProject = () => {\r\n        if (!props.hasUnsavedChanges) {\r\n            props.resetModel();\r\n        } else {\r\n            props.confirmDiscardModel(props.resetModel);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <IconButton\r\n            size='small'\r\n            title='New Project'\r\n            color='inherit'\r\n            onClick={setNewProject}\r\n        >\r\n            <InsertDriveFileOutlined />\r\n        </IconButton>\r\n    );\r\n};\r\n\r\nexport default connector(NewFileButton);\r\n","import React from 'react';\r\n\r\nimport OpenFileButton from './open-file-button';\r\nimport DownloadFileButton from './download-file-button';\r\nimport NewFileButton from './new-file-button';\r\n\r\nconst Meny: React.FC = () => {\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <NewFileButton />\r\n            <OpenFileButton />\r\n            <DownloadFileButton />\r\n        </React.Fragment>\r\n    );\r\n};\r\n\r\nexport default Meny\r\n","import { FlowStepId } from \"./flow-step-id\";\r\n\r\nexport const OUT_OF_FLOW = -1;\r\n\r\nexport function getFirstStepId() {\r\n    return FlowStepId.SDF_1;\r\n};\r\n\r\nexport function getFlowStepOrder(step: FlowStepId): number {\r\n    switch (step) {\r\n        case FlowStepId.SDF_1:\r\n            return 1;\r\n        case FlowStepId.SDF_2:\r\n            return 2;\r\n        case FlowStepId.SDF_3:\r\n            return 3;\r\n        case FlowStepId.SDF_4:\r\n            return 4;\r\n        case FlowStepId.OHI_2:\r\n            return 5;\r\n        case FlowStepId.OHI_3:\r\n            return 6;\r\n        case FlowStepId.OCH_1:\r\n            return 7;\r\n        case FlowStepId.OCH_2:\r\n            return 8;\r\n        default:\r\n            return OUT_OF_FLOW;\r\n    }\r\n};\r\n\r\nexport const flow = [\r\n    {\r\n        id: FlowStepId.OHI, label: 'Identify Hazards', children: [\r\n            {\r\n                id: FlowStepId.OHI_1, label: 'Modelling', children: [\r\n                    { id: FlowStepId.SDF_1, label: 'Step 1', helpText: 'Identify the <i>kind</i> and <i>role</i> objects explicitly presented in the system description.' },\r\n                    { id: FlowStepId.SDF_2, label: 'Step 2', helpText: 'For each <i>kind</i> object obtained in SDF-Step&nbsp;1, identify all the roles it can play, considering the system description.' },\r\n                    { id: FlowStepId.SDF_3, label: 'Step 3', helpText: 'For each <i>role</i> object obtained in SDF-Step&nbsp;1 and SDF-Step&nbsp;2, identify the relator that connects this role, and specify all the other roles connected by the identified relator, considering the system description and the analysts&apos; expertise.' },\r\n                    { id: FlowStepId.SDF_4, label: 'Step 4', helpText: 'For each <i>role</i> object obtained in SDF-Step&nbsp;1, SDF-Step&nbsp;2 and SDF-Step&nbsp;3, identify all the <i>kind</i> objects that can play the role, considering the system description.' },\r\n                ]\r\n            },\r\n            {\r\n                id: FlowStepId.OHI_2, label: 'Identify Victims', helpText: 'Go through all the <i>roles</i> presented in the HO-style model and analyze if the roles are not supposed to but have the potential to encounter harms. Furthermore, the analysts continue with identifying possible harms that can affect the victims, including but not limited to, physical damages, chemical injuries, fatal illness, explosion, etc.'\r\n            },\r\n            {\r\n                id: FlowStepId.OHI_3, label: 'Identify Hazards', helpText: 'Identify the hazardous situations that are likely to harm the identified mishap victims. Occurrence of a mishap is the manifestation of the <i>harm truthmaker</i> dispositions that characterize the <i>hazard element</i> roles in a hazardous situation. '\r\n            },\r\n        ]\r\n    },\r\n    {\r\n        id: FlowStepId.OCH, label: 'Identify Causes', children: [\r\n            {\r\n                id: FlowStepId.OCH_1, label: 'Categorize', helpText: 'Categorize all the hazard descriptions into four categories, in terms of <b>Hazard</b>, <b>Initiating Condition</b>, <b>Initiating Event</b>, and/or <b>Mishap</b> based on the set of heuristic questions.'\r\n            },\r\n            {\r\n                id: FlowStepId.OCH_2, label: 'Expand', helpText: 'Expand the categorized hazard description, taking both the expertise of analysts and the system description into consideration. '\r\n            },\r\n            {\r\n                id: FlowStepId.OCH_3, label: 'Identify Causes', children: []\r\n            },\r\n        ]\r\n    },\r\n    {\r\n        id: FlowStepId.SARE, label: 'Safety Requirements', children: [\r\n            {\r\n                id: FlowStepId.SARE_1, label: 'Evaluate Severity', children: []\r\n            },\r\n            {\r\n                id: FlowStepId.SARE_2, label: 'Evaluate Probability', children: []\r\n            },\r\n            {\r\n                id: FlowStepId.SARE_3, label: 'Safety Requirements', children: []\r\n            },\r\n        ]\r\n    },\r\n    {\r\n        id: FlowStepId.CM, label: 'Control Mitigation', children: []\r\n    }\r\n];\r\n","export enum ObjectTypes {\r\n    kind = 'kind',\r\n    role = 'role',\r\n    relator = 'relator'\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { IconButton, Popover, Typography, makeStyles } from '@material-ui/core';\r\nimport { Help, HelpOutline } from '@material-ui/icons';\r\n\r\ninterface Props {\r\n    open: boolean;\r\n    highlighted?: boolean;\r\n    htmlContent: string;\r\n}\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    typography: {\r\n        padding: theme.appSpacing.standard,\r\n        maxWidth: '320px'\r\n    }\r\n}));\r\n\r\nconst HelpText: React.FC<Props> = (props: Props) => {\r\n    const classes = useStyles();\r\n\r\n    const [popoverAnchor, setPopoverAnchor] = useState<Element | null>(null);\r\n    const [isOpen, setIsOpen] = useState(false);\r\n\r\n    const handleClose = () => {\r\n        setIsOpen(false);\r\n    };\r\n\r\n    // can be opened both from parent component and from itself\r\n    useEffect(() => {\r\n        setIsOpen(props.open);\r\n    }, [props.open]);\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <IconButton ref={(ref) => setPopoverAnchor(ref)} edge=\"end\" onClick={() => setIsOpen(true)}>\r\n                {props.highlighted ? <Help /> : <HelpOutline />}\r\n            </IconButton>\r\n            <Popover\r\n                open={isOpen}\r\n                anchorEl={popoverAnchor}\r\n                onClose={handleClose}\r\n                anchorOrigin={{\r\n                    vertical: 'center',\r\n                    horizontal: 'right',\r\n                }}\r\n                transformOrigin={{\r\n                    vertical: 'center',\r\n                    horizontal: 'left',\r\n                }}\r\n            >\r\n                <Typography variant='body2' className={classes.typography} dangerouslySetInnerHTML={{ __html: props.htmlContent }}></Typography>\r\n            </Popover>\r\n        </React.Fragment>\r\n    );\r\n};\r\n\r\nexport default HelpText;\r\n","import React from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { List, ListItem, ListItemText, Chip, makeStyles, ListItemIcon, Divider, ListItemSecondaryAction } from '@material-ui/core';\r\nimport { FlowStep } from '../../entities/meny/flow-step';\r\nimport { flow, OUT_OF_FLOW, getFlowStepOrder } from '../../entities/meny/flow';\r\nimport HelpText from './help-text';\r\nimport { RootState } from '../../store';\r\nimport { updateFlowStep } from '../../store/system-model/actions';\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    label: {\r\n        paddingLeft: theme.spacing(1)\r\n    },\r\n    phase: {\r\n        paddingLeft: theme.spacing(4)\r\n    },\r\n    step: {\r\n        paddingLeft: theme.spacing(8)\r\n    },\r\n    bold: {\r\n        fontWeight: 'bold'\r\n    }\r\n}));\r\n\r\nconst mapState = (state: RootState) => ({\r\n    currentStep: state.systemModel.currentStep,\r\n    lastCompletedStep: state.systemModel.lastCompletedStep\r\n})\r\n\r\nconst mapDispatch = {\r\n    setCurentStep: updateFlowStep\r\n}\r\n\r\nconst connector = connect(mapState, mapDispatch);\r\n\r\ntype Props = ConnectedProps<typeof connector>\r\n\r\nconst ProgressSteps: React.FC<Props> = (props: Props) => {\r\n    const classes = useStyles();\r\n\r\n    const renderSteps = (steps: FlowStep[], paddingClass: string) => (\r\n        <List disablePadding dense>\r\n            {steps.map((step: FlowStep) => {\r\n                const stepOrder = getFlowStepOrder(step.id);\r\n                const isInFlow = stepOrder !== OUT_OF_FLOW;\r\n                const isCurrent = isInFlow && step.id === props.currentStep;\r\n                const isEnabled = !isInFlow ||\r\n                    stepOrder <= getFlowStepOrder(props.lastCompletedStep) + 1;\r\n                const helpOpenedOnFirstVisit = step.id === props.currentStep &&\r\n                    step.id === props.lastCompletedStep;\r\n\r\n                return (\r\n                    <React.Fragment key={step.id}>\r\n                        <ListItem\r\n                            className={paddingClass}\r\n                            button\r\n                            disabled={!isEnabled}\r\n                            onClick={() => isInFlow && props.setCurentStep(step.id)}\r\n                        >\r\n                            <ListItemIcon>\r\n                                <Chip\r\n                                    size=\"small\"\r\n                                    disabled={!isEnabled}\r\n                                    label={step.id}\r\n                                    color={isCurrent ? 'secondary' : 'primary'}\r\n                                    variant={isInFlow ? 'default' : 'outlined'}\r\n                                />\r\n                            </ListItemIcon>\r\n                            <ListItemText primary={step.label} className={classes.label} />\r\n                            {step.helpText ? (\r\n                                <ListItemSecondaryAction>\r\n                                    <HelpText\r\n                                        open={helpOpenedOnFirstVisit}\r\n                                        highlighted={isCurrent}\r\n                                        htmlContent={step.helpText}\r\n                                    />\r\n                                </ListItemSecondaryAction>)\r\n                                : ''\r\n                            }\r\n                        </ListItem>\r\n                        {step.children ? renderSteps(step.children, classes.step) : ''}\r\n                    </React.Fragment>\r\n                );\r\n            })}\r\n        </List>\r\n    );\r\n\r\n    return (\r\n        <List dense>\r\n            {flow.map(stage => (\r\n                <React.Fragment key={stage.id}>\r\n                    <ListItem>\r\n                        <ListItemIcon>\r\n                            <Chip label={stage.id} variant='outlined' color='primary' />\r\n                        </ListItemIcon>\r\n                        <ListItemText\r\n                            primary={stage.label}\r\n                            disableTypography\r\n                            className={`${classes.label} ${classes.bold}`}\r\n                        />\r\n                    </ListItem>\r\n                    {renderSteps(stage.children, classes.phase)}\r\n                    <Divider />\r\n                </React.Fragment>\r\n            ))}\r\n        </List>\r\n    );\r\n};\r\n\r\nexport default connector(ProgressSteps);\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { Typography, IconButton, TextField, makeStyles } from '@material-ui/core';\r\nimport { Edit, Done, Clear } from '@material-ui/icons';\r\nimport { RootState } from '../store';\r\nimport { updateProjectName } from '../store/system-model/actions';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    name: state.systemModel.projectName\r\n});\r\n\r\nconst mapDispatch = {\r\n    nameUpdated: updateProjectName\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatch);\r\n\r\ntype Props = ConnectedProps<typeof connector>\r\n\r\nconst useStyle = makeStyles(theme => ({\r\n    input: {\r\n        '& .MuiInput-input': {\r\n            color: theme.palette.common.white,\r\n        }\r\n    },\r\n    buttonGutter: {\r\n        paddingLeft: theme.spacing(1),\r\n    }\r\n}));\r\n\r\nconst ProjectName: React.FC<Props> = (props) => {\r\n    const classes = useStyle();\r\n\r\n    const [isEditing, setIsEditing] = useState(false);\r\n    const [name, setName] = useState(props.name);\r\n\r\n    const inputRef = useRef<HTMLInputElement>();\r\n\r\n    useEffect(() => {\r\n        setName(props.name);\r\n    }, [props.name]);\r\n\r\n    const cancelEdit = () => {\r\n        setName(props.name);\r\n        setIsEditing(false);\r\n        inputRef.current = undefined;\r\n    };\r\n\r\n    const confirmEdit = (ev: React.FormEvent<HTMLFormElement>) => {\r\n        ev.preventDefault();\r\n        setIsEditing(false);\r\n        props.nameUpdated(name);\r\n        inputRef.current = undefined;\r\n    };\r\n\r\n    const initInput = (input: HTMLInputElement | null) => {\r\n        if (input && !inputRef.current) {\r\n            input.select();\r\n            inputRef.current = input;\r\n        }\r\n    }\r\n\r\n    if (isEditing) {\r\n        return (\r\n            <form onReset={cancelEdit} onSubmit={confirmEdit} >\r\n                <TextField\r\n                    className={classes.input}\r\n                    type='text'\r\n                    required\r\n                    autoFocus\r\n                    onChange={ev => setName(ev.target.value)}\r\n                    value={name}\r\n                    inputRef={ref => initInput(ref)}\r\n                />\r\n                <IconButton type='submit' size='small' className={classes.buttonGutter} >\r\n                    <Done />\r\n                </IconButton>\r\n                <IconButton type='reset' size='small' >\r\n                    <Clear />\r\n                </IconButton>\r\n            </form>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Typography variant=\"h6\">\r\n            {name}\r\n            <IconButton\r\n                size='small'\r\n                onClick={() => setIsEditing(true)}\r\n                title='Edit project name'\r\n                className={classes.buttonGutter}\r\n            >\r\n                <Edit />\r\n            </IconButton>\r\n        </Typography>\r\n    );\r\n};\r\n\r\nexport default connector(ProjectName);\r\n","import React from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { Dialog, DialogContentText, DialogContent, Button, DialogActions } from '@material-ui/core';\r\nimport { RootState } from '../store';\r\nimport { hideConfirmationDialog } from '../store/modal-dialog/actions';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    dialog: state.modalDialog\r\n});\r\n\r\nconst mapDispatch = {\r\n    close: hideConfirmationDialog\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatch);\r\n\r\ntype Props = ConnectedProps<typeof connector>\r\n\r\nconst ConfirmationDialog: React.FC<Props> = (props) => {\r\n\r\n    const handleYes = () => {\r\n        props.close();\r\n        props.dialog.onYes();\r\n    };\r\n\r\n    const handleNo = () => {\r\n        props.close();\r\n        if (props.dialog.onNo) {\r\n            props.dialog.onNo();\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Dialog\r\n            open={!!props.dialog.contentText}\r\n            onClose={props.close}\r\n            disableBackdropClick\r\n            disableEscapeKeyDown\r\n        >\r\n            <DialogContent>\r\n                <DialogContentText>\r\n                    {props.dialog.contentText}\r\n                </DialogContentText>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleYes} color=\"primary\">\r\n                    Yes\r\n                </Button>\r\n                <Button onClick={handleNo} color=\"primary\" autoFocus>\r\n                    No\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n\r\nexport default connector(ConfirmationDialog);\r\n","import React from 'react';\r\nimport { Card, makeStyles, CardContent } from '@material-ui/core';\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    root: {\r\n        position: 'fixed',\r\n        bottom: theme.appSpacing.standard,\r\n        right: theme.appSpacing.standard,\r\n        zIndex: theme.zIndex.graphHelp,\r\n        minWidth: 200,\r\n    }\r\n}));\r\n\r\nconst CornerCard: React.FC = (props) => {\r\n    const classes = useStyles();\r\n    return (\r\n        <Card className={classes.root}>\r\n            <CardContent>\r\n                {props.children}\r\n            </CardContent>\r\n        </Card>\r\n    );\r\n}\r\n\r\nexport default CornerCard;\r\n","import React from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { Action, Dispatch } from 'redux';\r\nimport { Typography, ListItem, ListItemText, ListItemSecondaryAction, IconButton, TextField, List } from '@material-ui/core';\r\n\r\nimport { Delete, Add } from '@material-ui/icons';\r\nimport Role, { MishapVictim } from '../../entities/system-description/role';\r\nimport CornerCard from '../shared/corner-card';\r\nimport { addPossibleHarm, removePossibleHarm } from '../../store/system-model/actions';\r\nimport { RootState } from '../../store';\r\nimport Hazard from '../../entities/hazard-population/hazard';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    hazards: state.systemModel.hazards\r\n});\r\n\r\nconst mapDispatch = (dispatch: Dispatch<Action>) => ({\r\n    harmAdded: (mishapVictim: MishapVictim, harm: string) =>\r\n        dispatch(addPossibleHarm(mishapVictim, harm)),\r\n    harmDeleted: (mishapVictim: MishapVictim, harm: string, hazards: Hazard[]) =>\r\n        removePossibleHarm(mishapVictim, harm, hazards, dispatch)\r\n});\r\n\r\nconst connector = connect(mapState, mapDispatch);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>\r\n\r\ntype Props = PropsFromRedux & {\r\n    selectedRole: Role | undefined;\r\n};\r\n\r\nconst VictimHarms: React.FC<Props> = (props: Props) => {\r\n\r\n    const createMishapVictim = (ev: React.FormEvent<HTMLFormElement>, role: Role) => {\r\n        const form = ev.currentTarget;\r\n        const harm = (form.elements.namedItem(\"harm\") as HTMLInputElement).value;\r\n        form.reset();\r\n        ev.preventDefault();\r\n        props.harmAdded(role, harm);\r\n    };\r\n\r\n    const deletePossibleHarm = (role: Role, harm: string) => {\r\n        props.harmDeleted(role, harm, props.hazards);\r\n    };\r\n\r\n    const emptyContent = (\r\n            <Typography>\r\n                Click on a role to see or add possible harms\r\n            </Typography>\r\n        );\r\n\r\n    const renderHarms = (role: Role) => {\r\n        return role.possibleHarms\r\n            .sort((a, b) => a.localeCompare(b))\r\n            .map((harm, index) => renderHarmItem(harm, index, role))\r\n            .concat(renderAddItem(role));\r\n    };\r\n\r\n    const renderHarmItem = (item: string, index: number, role: Role) => (\r\n        <ListItem key={index}>\r\n            <ListItemText primary={item} />\r\n            <ListItemSecondaryAction>\r\n                <IconButton edge=\"end\" title=\"Delete\" onClick={() => deletePossibleHarm(role, item)}>\r\n                    <Delete />\r\n                </IconButton>\r\n            </ListItemSecondaryAction>\r\n        </ListItem>\r\n    );\r\n\r\n    const renderAddItem = (role: Role) => (\r\n        <ListItem key=\"-1\">\r\n            <form action='#' onSubmit={(ev) => createMishapVictim(ev, role)}>\r\n                <TextField\r\n                    required\r\n                    autoFocus\r\n                    margin=\"dense\"\r\n                    type=\"text\"\r\n                    name=\"harm\"\r\n                    fullWidth\r\n                    placeholder=\"Add New\"\r\n                    autoComplete=\"off\"\r\n                />\r\n                <ListItemSecondaryAction>\r\n                    <IconButton type=\"submit\" edge=\"end\" title=\"Add\">\r\n                        <Add />\r\n                    </IconButton>\r\n                </ListItemSecondaryAction>\r\n            </form>\r\n        </ListItem>\r\n    );\r\n\r\n    const renderContent = () => {\r\n        if (!props.selectedRole) {\r\n            return emptyContent;\r\n        }\r\n        return (\r\n            <React.Fragment>\r\n                <Typography variant=\"body2\" color=\"textSecondary\">\r\n                    Mishap Victim\r\n                </Typography>\r\n                <Typography variant=\"h6\" gutterBottom>\r\n                    {props.selectedRole.name}\r\n                </Typography>\r\n                <Typography variant=\"body2\" color=\"textSecondary\">\r\n                    Possible Harms\r\n                </Typography>\r\n                <List dense>\r\n                    {renderHarms(props.selectedRole)}\r\n                </List>\r\n            </React.Fragment>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <CornerCard>\r\n            {renderContent()}\r\n        </CornerCard>\r\n    );\r\n};\r\n\r\nexport default connector(VictimHarms);\r\n","import { ObjectTypes } from '../entities/system-description/object-types';\r\n\r\nconst graphStyle = [\r\n    {\r\n        selector: 'node',\r\n        style: {\r\n            'background-color': '#fff',\r\n            'border-width': 1,\r\n            'border-style': 'solid',\r\n            'border-color': '#000',\r\n            'shape': 'round-rectangle',\r\n            'label': 'data(label)',\r\n            'height': 'label',\r\n            'width': 'label',\r\n            'text-valign': 'center',\r\n            'text-halign': 'center',\r\n            'text-wrap': 'wrap',\r\n            'text-max-width': '130px',\r\n            'font-size': 11,\r\n            'padding': '5px'\r\n        }\r\n    },\r\n    {\r\n        selector: 'edge',\r\n        style: {\r\n            'width': 2,\r\n            'curve-style': 'taxi',\r\n            'label': 'data(label)',\r\n            'font-size': 11\r\n        }\r\n    },\r\n    {\r\n        selector: '.subsystem',\r\n        style: {\r\n            'shape': 'rectangle',\r\n            'text-valign': 'top',\r\n            'text-max-width': '300px'\r\n        }\r\n    },\r\n    {\r\n        selector: `.${ObjectTypes.kind.toString()}`,\r\n        style: {\r\n            'background-color': '#8282ff',\r\n            'color': '#fff'\r\n        }\r\n    },\r\n    {\r\n        selector: `.${ObjectTypes.role.toString()}`,\r\n        style: {\r\n            'background-color': '#818181',\r\n            'color': '#fff'\r\n        }\r\n    },\r\n    {\r\n        selector: `.${ObjectTypes.relator.toString()}`,\r\n        style: {\r\n            'background-color': '#fff',\r\n            'color': '#000'\r\n        }\r\n    },\r\n    {\r\n        selector: '.arrow-edge',\r\n        style: {\r\n            'target-arrow-shape': 'chevron'\r\n        }\r\n    },\r\n    {\r\n        selector: '.faded',\r\n        style: {\r\n            'opacity': 0.6\r\n        }\r\n    },\r\n    {\r\n        selector: '.mishap-victim',\r\n        style: {\r\n            'background-color': '#ff0',\r\n            'color': '#000'\r\n        }\r\n    }\r\n];\r\n\r\nexport default graphStyle;\r\n","import SystemObject from \"../system-description/system-object\";\r\nimport Subsystem from \"../system-description/subsystem\";\r\nimport Connection from \"../system-description/connection\";\r\n\r\nexport interface Data {\r\n    id: string;\r\n    label: string;\r\n}\r\n\r\nexport interface SystemObjectData extends Data {\r\n    systemObject: SystemObject;\r\n    parent?: string;\r\n}\r\n\r\nexport interface SubsystemData extends Data {\r\n    subsystem: Subsystem;\r\n}\r\n\r\nexport interface ConnectionData extends Data {\r\n    source: string;\r\n    target: string;\r\n    connection: Connection;\r\n}\r\n\r\nexport interface GraphElement<TData extends Data> {\r\n    group: 'nodes' | 'edges';\r\n    data: TData;\r\n    position?: GraphElementPosition;\r\n    classes?: string[];\r\n    grabbable?: boolean,\r\n    pannable?: boolean;\r\n}\r\n\r\nexport interface GraphElementPosition {\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\nexport function isSystemObjectData(data: Data): data is SystemObjectData {\r\n    return 'systemObject' in data;\r\n}\r\n\r\nexport function isSubsystemData(data: Data): data is SubsystemData {\r\n    return 'subsystem' in data;\r\n}\r\n\r\nexport function isConnectionData(data: Data): data is ConnectionData {\r\n    return 'connection' in data;\r\n}\r\n","import { NodeSingular } from \"cytoscape\";\r\n\r\nconst options = {\r\n    animate: false,\r\n    cueEnabled: false\r\n};\r\n\r\nexport interface CollapseApi {\r\n    collapse: (node: NodeSingular) => void;\r\n    expand: (node: NodeSingular) => void;\r\n}\r\n\r\nexport function initCollapseApi(cy: any) {\r\n    cy.expandCollapse(options);\r\n}\r\n\r\nexport function getCollapseApi(cy: any): CollapseApi {\r\n    return cy.expandCollapse('get');\r\n}\r\n","import React from 'react';\r\nimport { makeStyles } from '@material-ui/core';\r\n\r\ninterface Props {\r\n    size?: (height: number, width: number) => void;\r\n}\r\n\r\nconst useStyle = makeStyles(theme => ({\r\n    root: {\r\n        position: 'fixed',\r\n        overflow: 'auto',\r\n        top: theme.mixins.toolbar.minHeight,\r\n        right: 0,\r\n        bottom: 0,\r\n        left: theme.appSpacing.drawerWidth\r\n    }\r\n}));\r\n\r\nconst GraphContainer: React.FC<Props> = (props) => {\r\n    const classes = useStyle();\r\n\r\n    const extractSize = (ref: HTMLDivElement | null) => {\r\n        if (ref && props.size) {\r\n            props.size(ref.scrollHeight, ref.scrollWidth);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={classes.root} ref={extractSize}>\r\n            {props.children}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default GraphContainer;\r\n","import React from 'react';\r\nimport cytoscape, { Core, EventObject, Singular, NodeSingular } from 'cytoscape';\r\nimport CytoscapeComponent from 'react-cytoscapejs';\r\nimport expandCollapse from 'cytoscape-expand-collapse';\r\nimport popper from 'cytoscape-popper';\r\nimport { withTheme, Theme } from '@material-ui/core/styles';\r\n\r\nimport style from '../../styles/graph-style';\r\nimport { GraphElement, isSubsystemData } from '../../entities/graph/graph-element';\r\nimport { initCollapseApi, CollapseApi, getCollapseApi } from '../../entities/graph/collapse-api';\r\nimport GraphContainer from './graph-container';\r\n\r\ncytoscape.use(popper);\r\nexpandCollapse(cytoscape);\r\n\r\ninterface Props {\r\n    elements: GraphElement<any>[];\r\n    cursorStyle: string;\r\n    useCollapseApi?: boolean;\r\n    mouseEnteredNode: (ev: EventObject) => void;\r\n    mouseLeftNode: (ev: EventObject) => void;\r\n    nodeClicked: (ev: EventObject) => void;\r\n    graphClicked?: (ev: EventObject) => void;\r\n    nodeMoved?: (ev: EventObject) => void;\r\n    theme: Theme;\r\n}\r\n\r\ninterface State {\r\n    cy: Core | null;\r\n    collapseApi: CollapseApi | null;\r\n    maxX: number;\r\n    maxY: number;\r\n}\r\n\r\nclass Graph extends React.Component<Props, State> {\r\n\r\n    private containerSize = {\r\n        height: 0,\r\n        width: 0\r\n    };\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.initCytoscape = this.initCytoscape.bind(this);\r\n        this.addEventListeners = this.addEventListeners.bind(this);\r\n        this.resizeCanvas = this.resizeCanvas.bind(this);\r\n        this.handleNodeMoved = this.handleNodeMoved.bind(this);\r\n        this.setInitialCanvasSize = this.setInitialCanvasSize.bind(this);\r\n\r\n        this.state = {\r\n            cy: null,\r\n            collapseApi: null,\r\n            maxX: this.containerSize.width,\r\n            maxY: this.containerSize.height\r\n        };\r\n    }\r\n\r\n    render() {\r\n        // if cytoscape is not initialized yet it is impossible to render elements, so first init empty cytoscape \r\n        const elements = this.state.cy ? this.props.elements : [];\r\n        const graphContainerStyle = {\r\n            width: this.state.maxX,\r\n            height: this.state.maxY,\r\n            zIndex: this.props.theme.zIndex.graph,\r\n            cursor: this.props.cursorStyle\r\n        };\r\n\r\n        return (\r\n            <GraphContainer size={this.setInitialCanvasSize}>\r\n                <CytoscapeComponent\r\n                    elements={elements}\r\n                    style={graphContainerStyle}\r\n                    stylesheet={style}\r\n                    userZoomingEnabled={false}\r\n                    userPanningEnabled={false}\r\n                    cy={this.initCytoscape} />\r\n            </GraphContainer>\r\n        );\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.setState({\r\n            ...this.state,\r\n            ...{ maxX: this.containerSize.width, maxY: this.containerSize.height }\r\n        });\r\n    }\r\n\r\n    private setInitialCanvasSize(height: number, width: number) {\r\n        this.containerSize = { height, width };\r\n    }\r\n\r\n    private resizeCanvas() {\r\n        if (this.state.cy) {\r\n            const boundingBox = this.state.cy.nodes().renderedBoundingBox({});\r\n            const height = Math.max(boundingBox.y2, this.state.maxY);\r\n            const width = Math.max(boundingBox.x2, this.state.maxX);\r\n            if (height !== this.state.maxY || width !== this.state.maxX) {\r\n                this.setState({ ...this.state, ...{ maxX: width, maxY: height } });\r\n            }\r\n        }\r\n    }\r\n\r\n    private handleNodeMoved(event: EventObject) {\r\n        const node: NodeSingular = event.target.element();\r\n        const position = node.position();\r\n        // prevent a node from being dragged beyond left and top border\r\n        if (position.x < 0 || position.y < 0) {\r\n            node.position({\r\n                ...position,\r\n                ...{ x: Math.max(position.x, 0), y: Math.max(position.y, 0) }\r\n            });\r\n        }\r\n\r\n        this.props.nodeMoved?.(event);\r\n    }\r\n\r\n    private addEventListeners(event: EventObject) {\r\n        const ele: Singular = event.target.element();\r\n        if (ele.isNode()) {\r\n            ele.on('dragfree', this.handleNodeMoved);\r\n\r\n            const data = ele.data();\r\n            if (this.state.collapseApi && isSubsystemData(data) && data.subsystem.isCollapsed) {\r\n                this.state.collapseApi.collapse(ele);\r\n            }\r\n        }\r\n        ele.on('mouseover', this.props.mouseEnteredNode);\r\n        ele.on('mouseout', this.props.mouseLeftNode);\r\n        ele.on('click', this.props.nodeClicked);\r\n    }\r\n\r\n    private initCytoscape(cy: Core) {\r\n\r\n        // this method must run only once\r\n        if (this.state.cy) {\r\n            return;\r\n        }\r\n        cy.zoom(1.1); // hack to fix blurring\r\n        cy.on('add', this.addEventListeners);\r\n        cy.on('click', (ev) => this.props.graphClicked && this.props.graphClicked(ev));\r\n        cy.on('render', this.resizeCanvas);\r\n\r\n        let collapseApi = null;\r\n        if (this.props.useCollapseApi) {\r\n            initCollapseApi(cy);\r\n            collapseApi = getCollapseApi(cy);\r\n        }\r\n\r\n        this.setState({ ...this.state, ...{ cy, collapseApi } });\r\n    }\r\n}\r\n\r\nexport default withTheme(Graph);\r\n","import SystemObject from \"./system-object\";\r\nimport Connection from \"./connection\";\r\nimport Subsystem from \"./subsystem\";\r\n\r\nexport type SystemDescriptionEntity = Connection | SystemObject | Subsystem;\r\n\r\nexport function isSystemObject(entity: SystemDescriptionEntity): entity is SystemObject {\r\n    return 'type' in entity;\r\n}\r\n\r\nexport function isConnection(entity: SystemDescriptionEntity): entity is Connection {\r\n    return 'source' in entity;\r\n}\r\n\r\nexport function isSubsystem(entity: SystemDescriptionEntity): entity is Subsystem {\r\n    return !('source' in entity) && !('type' in entity);\r\n}\r\n","import { SystemDescriptionEntity, isSystemObject, isConnection, isSubsystem } from \"../system-description/system-description-entity\";\r\nimport SystemObject from \"../system-description/system-object\";\r\nimport { GraphElement, SystemObjectData, ConnectionData, SubsystemData, Data } from \"./graph-element\";\r\nimport Connection from \"../system-description/connection\";\r\nimport Subsystem from \"../system-description/subsystem\";\r\nimport { SystemDescription } from \"../system-model\";\r\n\r\nexport default class GraphElementsFactory {\r\n\r\n    mapSystemDescription(system: SystemDescription) {\r\n        return this.mapSystemDescriptionEntities(\r\n            (this.getAllNodes(system) as SystemDescriptionEntity[])\r\n                .concat(system.systemObjectConnections)\r\n        );\r\n    }\r\n\r\n    mapSystemDescriptionEntities(entities: SystemDescriptionEntity[]): GraphElement<Data>[] {\r\n        return entities.map((e) => {\r\n            if (isSystemObject(e)) return this.mapSystemObject(e);\r\n            if (isConnection(e)) return this.mapConnection(e);\r\n            if (isSubsystem(e)) return this.mapSubsystem(e);\r\n            throw new Error('Unknown entity type');\r\n        });\r\n    }\r\n\r\n    getAllNodes(system: SystemDescription): (SystemObject | Subsystem)[] {\r\n        return (system.kinds as (SystemObject | Subsystem)[])\r\n            .concat(system.relators)\r\n            .concat(system.roles)\r\n            .concat(system.subsystems);\r\n    }\r\n\r\n    protected hookSystemObject(element: GraphElement<SystemObjectData>) {\r\n        return element;\r\n    }\r\n\r\n    protected hookConnection(element: GraphElement<ConnectionData>) {\r\n        return element;\r\n    }\r\n\r\n    protected hookSubsystem(element: GraphElement<SubsystemData>) {\r\n        return element;\r\n    }\r\n\r\n    private mapSystemObject(object: SystemObject): GraphElement<SystemObjectData> {\r\n        return this.hookSystemObject({\r\n            group: 'nodes',\r\n            data: {\r\n                id: object.id,\r\n                label: `<<${object.type.toString()}>>\\n${object.name}`,\r\n                systemObject: object,\r\n                parent: object.parent\r\n            },\r\n            position: {\r\n                x: object.posX, y: object.posY\r\n            },\r\n            classes: [object.type.toString()]\r\n        });\r\n    }\r\n\r\n    private mapConnection(connection: Connection): GraphElement<ConnectionData> {\r\n        return this.hookConnection({\r\n            group: 'edges',\r\n            data: {\r\n                id: connection.id,\r\n                label: connection.label ? connection.label : '',\r\n                source: connection.source,\r\n                target: connection.target,\r\n                connection: connection\r\n            },\r\n            pannable: true,\r\n            classes: connection.isOriented ? ['arrow-edge'] : []\r\n        });\r\n    }\r\n\r\n    private mapSubsystem(subsystem: Subsystem): GraphElement<SubsystemData> {\r\n        return this.hookSubsystem({\r\n            group: 'nodes',\r\n            data: {\r\n                id: subsystem.id,\r\n                label: subsystem.name,\r\n                subsystem: subsystem\r\n            },\r\n            position: {\r\n                x: subsystem.posX, y: subsystem.posY\r\n            },\r\n            classes: ['subsystem']\r\n        });\r\n    }\r\n}\r\n","import SystemObject from \"./system-object\";\r\nimport { ObjectTypes } from \"./object-types\";\r\n\r\ninterface Role extends SystemObject {\r\n    possibleHarms: string[];\r\n}\r\n\r\nexport interface MishapVictim extends Role {\r\n}\r\n\r\nexport function isRole(obj: SystemObject): obj is Role {\r\n    return obj.type === ObjectTypes.role;\r\n}\r\n\r\nexport function isMishapVictim(obj: SystemObject): obj is MishapVictim {\r\n    return isRole(obj) && obj.possibleHarms.length > 0;\r\n}\r\n\r\nexport default Role;\r\n","import GraphElementsFactory from \"./graph-elements-factory\";\r\nimport { GraphElement, SystemObjectData, ConnectionData, SubsystemData } from \"./graph-element\";\r\nimport { isRole, isMishapVictim } from \"../system-description/role\";\r\n\r\nexport default class GraphElementsFactoryMishapVictims extends GraphElementsFactory {\r\n\r\n    hookSystemObject(element: GraphElement<SystemObjectData>) {\r\n        if (!isRole(element.data.systemObject)) {\r\n            element.classes = [element.data.systemObject.type.toString(), 'faded'];\r\n        } else if (isMishapVictim(element.data.systemObject)) {\r\n            element.classes = ['mishap-victim'];\r\n        }\r\n        element.grabbable = false;\r\n        return element;\r\n    }\r\n\r\n    hookConnection(element: GraphElement<ConnectionData>) {\r\n        const classes = ['faded'];\r\n        if (element.data.connection.isOriented) {\r\n            classes.push('arrow-edge');\r\n        }\r\n        element.classes = classes;\r\n        return element;\r\n    }\r\n\r\n    hookSubsystem(element: GraphElement<SubsystemData>) {\r\n        element.grabbable = false;\r\n        return element;\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { EventObject, Singular } from 'cytoscape';\r\n\r\nimport VictimHarms from './victim-harms';\r\nimport Graph from '../graph/graph';\r\nimport GraphElementsFactoryMishapVictims from '../../entities/graph/graph-elements-factory-mishap-victims';\r\nimport { isSystemObjectData } from '../../entities/graph/graph-element';\r\nimport Role, { isRole } from '../../entities/system-description/role';\r\nimport { RootState } from '../../store';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    systemDescription: state.systemModel\r\n})\r\n\r\nconst connector = connect(mapState);\r\n\r\ntype Props = ConnectedProps<typeof connector>\r\n\r\ninterface State {\r\n    selectedRoleId: string;\r\n    isMouseOverRole: boolean;\r\n}\r\n\r\nclass GraphView extends React.Component<Props, State> {\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.getRoleFromEvent = this.getRoleFromEvent.bind(this);\r\n        this.mouseEntered = this.mouseEntered.bind(this);\r\n        this.mouseLeft = this.mouseLeft.bind(this);\r\n        this.selectRole = this.selectRole.bind(this);\r\n        this.clearRoleSelection = this.clearRoleSelection.bind(this);\r\n\r\n        this.state = {\r\n            selectedRoleId: '',\r\n            isMouseOverRole: false\r\n        };\r\n    }\r\n\r\n    render() {\r\n        const elementsFactory = new GraphElementsFactoryMishapVictims();\r\n        const elements = elementsFactory.mapSystemDescription(this.props.systemDescription);\r\n\r\n        return (\r\n            <React.Fragment>\r\n                <Graph\r\n                    elements={elements}\r\n                    cursorStyle={this.state.isMouseOverRole ? 'pointer' : 'default'}\r\n                    graphClicked={this.clearRoleSelection}\r\n                    mouseEnteredNode={this.mouseEntered}\r\n                    mouseLeftNode={this.mouseLeft}\r\n                    nodeClicked={this.selectRole}\r\n                />\r\n                <VictimHarms\r\n                    selectedRole={this.props.systemDescription.roles\r\n                        .find(e => e.id === this.state.selectedRoleId)}\r\n                />\r\n            </React.Fragment>\r\n        );\r\n    }\r\n\r\n    private getRoleFromEvent(event: EventObject): Role | undefined {\r\n        const ele: Singular = event.target.element();\r\n        const data = ele.data();\r\n        if (isSystemObjectData(data) && isRole(data.systemObject)) {\r\n            return data.systemObject;\r\n        }\r\n    }\r\n\r\n    private mouseEntered(event: EventObject) {\r\n        if (this.getRoleFromEvent(event)) {\r\n            this.setState({ ...this.state, ...{ isMouseOverRole: true } });\r\n        }\r\n    }\r\n\r\n    private mouseLeft(event: EventObject) {\r\n        if (this.getRoleFromEvent(event)) {\r\n            this.setState({ ...this.state, ...{ isMouseOverRole: false } });\r\n        }\r\n    }\r\n\r\n    private selectRole(event: EventObject) {\r\n        const role = this.getRoleFromEvent(event);\r\n        if (role) {\r\n            event.preventDefault();\r\n            this.setState({ ...this.state, ...{ selectedRoleId: role.id } });\r\n        }\r\n    }\r\n\r\n    private clearRoleSelection(event: EventObject) {\r\n        if (!event.isDefaultPrevented()) {\r\n            this.setState({ ...this.state, ...{ selectedRoleId: '' } });\r\n        }\r\n    }\r\n}\r\n\r\nexport default connector(GraphView);\r\n","import React from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { Action, Dispatch } from 'redux';\r\nimport { TableRow, TableCell, Chip, TextField, IconButton, makeStyles } from '@material-ui/core';\r\n\r\nimport { Add } from '@material-ui/icons';\r\nimport Role, { MishapVictim } from '../../entities/system-description/role';\r\nimport { addPossibleHarm, removePossibleHarm } from '../../store/system-model/actions';\r\nimport { RootState } from '../../store';\r\nimport Hazard from '../../entities/hazard-population/hazard';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    hazards: state.systemModel.hazards\r\n});\r\n\r\nconst mapDispatch = (dispatch: Dispatch<Action>) => ({\r\n    harmAdded: (mishapVictim: MishapVictim, harm: string) =>\r\n        dispatch(addPossibleHarm(mishapVictim, harm)),\r\n    harmDeleted: (mishapVictim: MishapVictim, harm: string, hazards: Hazard[]) =>\r\n        removePossibleHarm(mishapVictim, harm, hazards, dispatch)\r\n});\r\n\r\nconst connector = connect(mapState, mapDispatch);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>\r\n\r\ntype Props = PropsFromRedux & {\r\n    role: Role;\r\n}\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    chip: {\r\n        marginRight: theme.spacing(1),\r\n    }\r\n}));\r\n\r\nconst HarmsTableRow: React.FC<Props> = (props: Props) => {\r\n    const classes = useStyles();\r\n\r\n    const addHarm = (ev: React.FormEvent<HTMLFormElement>) => {\r\n        const form = ev.currentTarget;\r\n        const harm = (form.elements.namedItem(\"harm\") as HTMLInputElement).value;\r\n        form.reset();\r\n        ev.preventDefault();\r\n        props.harmAdded(props.role, harm);\r\n    };\r\n\r\n    const deleteHarm = (harm: string) => {\r\n        props.harmDeleted(props.role, harm, props.hazards);\r\n    };\r\n\r\n    return (\r\n        <TableRow>\r\n            <TableCell component='th' scope='row'>\r\n                {props.role.name}\r\n            </TableCell>\r\n            <TableCell align='left'>\r\n                {props.role.possibleHarms\r\n                    .sort((a, b) => a.localeCompare(b))\r\n                    .map((harm, index) =>\r\n                        <Chip\r\n                            className={classes.chip}\r\n                            key={index}\r\n                            label={harm}\r\n                            variant='outlined'\r\n                            onDelete={() => deleteHarm(harm)}\r\n                        />)}\r\n            </TableCell>\r\n            <TableCell align='right'>\r\n                <form action='#' onSubmit={addHarm}>\r\n                    <TextField\r\n                        required\r\n                        autoFocus\r\n                        margin='dense'\r\n                        type='text'\r\n                        name='harm'\r\n                        placeholder='Add Harm'\r\n                        autoComplete='off'\r\n                    />\r\n                    <IconButton size='small' type='submit' edge='end' title='Add'>\r\n                        <Add />\r\n                    </IconButton>\r\n                </form>\r\n            </TableCell>\r\n        </TableRow>\r\n    );\r\n};\r\n\r\nexport default connector(HarmsTableRow);\r\n","import React from 'react';\r\nimport { TableRow, TableCell, FormControl, InputLabel, Select, MenuItem, makeStyles } from '@material-ui/core';\r\nimport Role from '../../entities/system-description/role';\r\n\r\ninterface Props {\r\n    roles: Role[];\r\n    roleSelected: (role: Role) => void;\r\n}\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    formControl: {\r\n        margin: theme.spacing(1),\r\n        minWidth: 120,\r\n    }\r\n}));\r\n\r\nconst SelectRoleTableRow: React.FC<Props> = (props: Props) => {\r\n    const classes = useStyles();\r\n\r\n    const handleChange = (event: React.ChangeEvent<{ value: unknown }>) => {\r\n        const roleId = event.target.value as string;\r\n        props.roleSelected(props.roles.find(e => e.id === roleId) as Role);\r\n    };\r\n\r\n    return (\r\n        <TableRow>\r\n            <TableCell>\r\n                <FormControl className={classes.formControl}>\r\n                    <InputLabel id='label-select-role'>Select role</InputLabel>\r\n                    <Select\r\n                        labelId='label-select-role'\r\n                        onChange={handleChange}\r\n                        value=''\r\n                    >\r\n                        {\r\n                            props.roles\r\n                                .sort((a, b) => a.name.localeCompare(b.name))\r\n                                .map(e => <MenuItem key={e.id} value={e.id}>{e.name}</MenuItem>)\r\n                        }\r\n                    </Select>\r\n                </FormControl>\r\n            </TableCell>\r\n            <TableCell colSpan={2}>\r\n            </TableCell>\r\n        </TableRow>\r\n    );\r\n};\r\n\r\nexport default SelectRoleTableRow;\r\n","import React from 'react';\r\nimport { makeStyles, Button } from '@material-ui/core';\r\n\r\ninterface Props {\r\n    onClick: () => void;\r\n    disabled?: boolean;\r\n}\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    button: {\r\n        marginLeft: theme.appSpacing.standard,\r\n        marginTop: theme.appSpacing.standard\r\n    },\r\n}));\r\n\r\nconst CornerButtonPrimary: React.FC<Props> = (props) => {\r\n    const classes = useStyles();\r\n\r\n    return (\r\n        <Button\r\n            className={classes.button}\r\n            variant='contained'\r\n            color='primary'\r\n            onClick={props.onClick}\r\n            disabled={props.disabled}\r\n        >\r\n            {props.children}\r\n        </Button>\r\n    );\r\n};\r\n\r\nexport default CornerButtonPrimary;\r\n","import React, { useState } from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { TableContainer, Table, TableHead, TableRow, TableCell, TableBody } from '@material-ui/core';\r\n\r\nimport HarmsTableRow from './harms-table-row';\r\nimport SelectRoleTableRow from './select-role-table-row';\r\nimport Role, { isMishapVictim } from '../../entities/system-description/role';\r\nimport CornerButtonPrimary from '../shared/corner-button-primary';\r\nimport { RootState } from '../../store';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    roles: state.systemModel.roles\r\n})\r\n\r\nconst connector = connect(mapState);\r\n\r\ntype Props = ConnectedProps<typeof connector>\r\n\r\nconst TableView: React.FC<Props> = (props: Props) => {\r\n\r\n    const [newlyAdded, setNewlyAdded] = useState<string[]>([]);\r\n    const [isSelectingRole, setIsSelectingRole] = useState(false);\r\n\r\n    const addNewRole = (role: Role) => {\r\n        setNewlyAdded(newlyAdded.concat(role.id));\r\n        setIsSelectingRole(false);\r\n    };\r\n\r\n    const existingMishapVictims = props.roles\r\n        .filter(e => isMishapVictim(e) && !newlyAdded.some(n => n === e.id))\r\n        .sort((a, b) => a.name.localeCompare(b.name));\r\n    // sorting - existing alphabeticaly, newly added in order of adding\r\n    const newlyAddedMishapVictims = props.roles.filter(e => newlyAdded.some(n => n === e.id));\r\n    const mishapVictims = existingMishapVictims.concat(newlyAddedMishapVictims);\r\n\r\n    const rolesToSelect = props.roles.filter(r => !mishapVictims.some(e => e.id === r.id));\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <TableContainer>\r\n                <Table size='small'>\r\n                    <TableHead>\r\n                        <TableRow>\r\n                            <TableCell>Mishap Victims</TableCell>\r\n                            <TableCell align='left'>Possible Harms</TableCell>\r\n                            <TableCell align='right'>&nbsp;</TableCell>\r\n                        </TableRow>\r\n                    </TableHead>\r\n                    <TableBody>\r\n                        {!isSelectingRole && mishapVictims.length === 0 ?\r\n                            <TableRow>\r\n                                <TableCell align='center' colSpan={3}>\r\n                                    No mishap victims identified\r\n                                </TableCell>\r\n                            </TableRow>\r\n                            :\r\n                            mishapVictims.map(e => (\r\n                                <HarmsTableRow\r\n                                    key={e.id}\r\n                                    role={e}\r\n                                />\r\n                            ))}\r\n                        {isSelectingRole ?\r\n                            <SelectRoleTableRow roles={rolesToSelect} roleSelected={addNewRole} />\r\n                            :\r\n                            undefined}\r\n                    </TableBody>\r\n                </Table>\r\n            </TableContainer>\r\n            <CornerButtonPrimary\r\n                onClick={() => { !isSelectingRole && setIsSelectingRole(true) }}\r\n                disabled={rolesToSelect.length === 0}\r\n            >\r\n                {rolesToSelect.length === 0 ?\r\n                    'All mishap victims have been identified' :\r\n                    'Add new mishap victim'}\r\n            </CornerButtonPrimary>\r\n        </React.Fragment>\r\n    );\r\n};\r\n\r\nexport default connector(TableView);\r\n","import React from 'react';\r\nimport { makeStyles, Fab } from '@material-ui/core';\r\n\r\ninterface Props {\r\n    separated?: boolean;\r\n    onClick: () => void;\r\n}\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    fab: {\r\n        position: 'fixed',\r\n        marginBottom: theme.spacing(2),\r\n        marginLeft: theme.spacing(2),\r\n        bottom: 0,\r\n        zIndex: theme.zIndex.graphAction,\r\n    },\r\n    fabSpace: {\r\n        height: theme.spacing(3) + 40\r\n    }\r\n}));\r\n\r\nconst CornerFab: React.FC<Props> = (props) => {\r\n    const classes = useStyles();\r\n\r\n    return (\r\n        <React.Fragment>\r\n            {\r\n                props.separated ? \r\n                    <div className={classes.fabSpace} />\r\n                    :\r\n                    undefined\r\n            }\r\n            <Fab variant='extended'\r\n                className={classes.fab}\r\n                size='medium'\r\n                onClick={props.onClick}>\r\n                props.children\r\n            </Fab>\r\n        </React.Fragment>\r\n    );\r\n};\r\n\r\nexport default CornerFab;\r\n","import React, { useState } from 'react';\r\nimport GraphView from './graph-view';\r\nimport { TableChart, BubbleChart } from '@material-ui/icons';\r\nimport TableView from './table-view';\r\nimport CornerFab from '../shared/corner-fab';\r\n\r\nconst MishapVictimIdentification: React.FC = () => {\r\n    const [isGraphView, setIsGraphView] = useState(true);\r\n\r\n    if (isGraphView) {\r\n        return (\r\n            <React.Fragment>\r\n                <GraphView />\r\n                <CornerFab onClick={() => setIsGraphView(false)} >\r\n                    <TableChart />\r\n                    Table View\r\n                </CornerFab>\r\n            </React.Fragment>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <TableView />\r\n            <CornerFab separated={true} onClick={() => setIsGraphView(true)} >\r\n                <BubbleChart />\r\n                Graph View\r\n            </CornerFab>\r\n        </React.Fragment>\r\n    );\r\n}\r\n\r\nexport default MishapVictimIdentification;\r\n","import SystemObject from \"./system-description/system-object\";\r\nimport Connection from \"./system-description/connection\";\r\nimport Subsystem from \"./system-description/subsystem\";\r\nimport Role from \"./system-description/role\";\r\nimport Hazard from \"./hazard-population/hazard\";\r\nimport { FlowStepId } from \"./meny/flow-step-id\";\r\n\r\nexport interface SystemDescription {\r\n    kinds: SystemObject[];\r\n    roles: Role[];\r\n    relators: SystemObject[];\r\n    systemObjectConnections: Connection[];\r\n    subsystems: Subsystem[];\r\n    hazards: Hazard[];\r\n}\r\n\r\nexport interface SystemModel extends SystemDescription {\r\n    projectName: string;\r\n    currentStep: FlowStepId;\r\n    lastCompletedStep: FlowStepId;\r\n    nextHazardId: number;\r\n};\r\n\r\nexport function createObjectId(prefix: string) {\r\n    return `${prefix}-${new Date().getTime()}`;\r\n}\r\n","import React from 'react';\r\nimport { makeStyles, Fab } from '@material-ui/core';\r\n\r\ninterface ButtonDescription {\r\n    icon: JSX.Element;\r\n    text: string;\r\n    action: () => void;\r\n}\r\n\r\ninterface Props {\r\n    buttons: ButtonDescription[];\r\n}\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    root: {\r\n        position: 'fixed',\r\n        bottom: theme.appSpacing.standard,\r\n        zIndex: theme.zIndex.graphAction\r\n    },\r\n    fab: {\r\n        marginLeft: theme.appSpacing.standard,\r\n    }\r\n}));\r\n\r\nconst ToolbarButtons: React.FC<Props> = (props) => {\r\n    const classes = useStyles();\r\n\r\n    return (\r\n        <div className={classes.root}>\r\n            {props.buttons.map((e, index) => (\r\n                <Fab\r\n                    key={index}\r\n                    className={classes.fab}\r\n                    size='small'\r\n                    color='primary'\r\n                    variant='extended'\r\n                    onClick={e.action}\r\n                >\r\n                    {e.icon}\r\n                    {e.text}\r\n                </Fab>\r\n            ))}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ToolbarButtons;\r\n","import React, { useState } from 'react';\r\nimport { Dialog, Backdrop, DialogActions, Button, TextField, DialogContent, FormControl, InputLabel, Select, MenuItem, makeStyles } from '@material-ui/core';\r\n\r\nimport { isSystemObject } from '../../entities/system-description/system-description-entity';\r\nimport Subsystem from '../../entities/system-description/subsystem';\r\nimport SystemObject from '../../entities/system-description/system-object';\r\n\r\ninterface Props {\r\n    entity: SystemObject | Subsystem;\r\n    subsystemsAvailable: Subsystem[];\r\n    entityUpdated: (entity: SystemObject | Subsystem) => void;\r\n    editCancelled: () => void;\r\n}\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    formControl: {\r\n        marginTop: theme.spacing(1),\r\n    },\r\n    selectEmpty: {\r\n        marginTop: theme.spacing(2),\r\n    },\r\n}));\r\n\r\nconst NodeEditor: React.FC<Props> = (props: Props) => {\r\n\r\n    const [entity, setEntity] = useState(props.entity);\r\n\r\n    const classes = useStyles();\r\n\r\n    const defaultParent = \"\";\r\n\r\n    let parentEditor;\r\n    if (isSystemObject(entity)) {\r\n        const subsystems = props.subsystemsAvailable\r\n            .sort((a, b) => a.name.localeCompare(b.name))\r\n            .map(e => <MenuItem key={e.id} value={e.id}>{e.name}</MenuItem>);\r\n\r\n        let entityParent = defaultParent;\r\n        if (entity.parent) {\r\n            entityParent = entity.parent;\r\n        }\r\n\r\n        const updateParent = (ev: React.ChangeEvent<{ value: unknown }>) => {\r\n            let parent: string | undefined;\r\n            if (ev.target.value !== defaultParent) {\r\n                parent = ev.target.value as string;\r\n            }\r\n            setEntity({ ...entity, ...{ parent: parent } });\r\n        };\r\n\r\n        parentEditor = (\r\n            <FormControl className={classes.formControl}>\r\n                <InputLabel shrink id=\"label-subsystem\">\r\n                    Subsystem\r\n                </InputLabel>\r\n                <Select\r\n                    labelId=\"label-subsystem\"\r\n                    value={entityParent}\r\n                    onChange={updateParent}\r\n                    displayEmpty\r\n                    disabled={subsystems.length === 0}\r\n                    className={classes.selectEmpty}\r\n                >\r\n                    <MenuItem key=\"-1\" value={defaultParent}>\r\n                        <em>None</em>\r\n                    </MenuItem>\r\n                    {subsystems}\r\n                </Select>\r\n            </FormControl>\r\n        );\r\n    }\r\n\r\n    const updateName = (ev: React.ChangeEvent<HTMLInputElement>) => {\r\n        setEntity({ ...entity, ...{ name: ev.target.value } });\r\n    };\r\n\r\n    const submitEntity = (ev: React.FormEvent) => {\r\n        props.entityUpdated(entity);\r\n        ev.preventDefault();\r\n    };\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <Backdrop open={!!props.entity} />\r\n            <Dialog open={!!props.entity}>\r\n                <form autoComplete=\"off\" onSubmit={submitEntity} onReset={() => props.editCancelled()}>\r\n                    <DialogContent>\r\n                        <TextField\r\n                            required\r\n                            autoFocus\r\n                            margin=\"dense\"\r\n                            id=\"name\"\r\n                            label=\"Name\"\r\n                            type=\"text\"\r\n                            fullWidth\r\n                            defaultValue={entity.name}\r\n                            onChange={updateName}\r\n                        />\r\n                        {parentEditor}\r\n                    </DialogContent>\r\n                    <DialogActions>\r\n                        <Button type=\"submit\" variant=\"contained\" color=\"primary\">OK</Button>\r\n                        <Button type=\"reset\" color=\"primary\">Cancel</Button>\r\n                    </DialogActions>\r\n                </form>\r\n            </Dialog>\r\n        </React.Fragment>\r\n    );\r\n};\r\n\r\nexport default NodeEditor;\r\n","import React, { createRef, useState, useEffect, useCallback } from 'react';\r\nimport { Singular } from 'cytoscape';\r\nimport { makeStyles } from '@material-ui/core';\r\nimport Popper from 'popper.js';\r\n\r\ninterface Props {\r\n    element: Singular;\r\n    placement?: Popper.Placement\r\n}\r\n\r\nconst useStyle = makeStyles(theme => ({\r\n    popper: {\r\n        zIndex: theme.zIndex.nodeAction\r\n    }\r\n}));\r\n\r\nconst EVENT_POSITION = 'position';\r\nconst EVENT_MOUSEUP = 'mouseup';\r\n\r\nconst NodePopper: React.FC<Props> = (props) => {\r\n    const root = createRef<HTMLDivElement>();\r\n    const [popper, setPopper] = useState<Popper | null>(null);\r\n\r\n    const destroyPopper = useCallback(() => {\r\n        if (popper) {\r\n            props.element.off(EVENT_POSITION, undefined, popper.scheduleUpdate);\r\n            props.element.off(EVENT_MOUSEUP, undefined, destroyPopper);\r\n            popper.destroy();\r\n            setPopper(null);\r\n        }\r\n    }, [popper, props.element]);\r\n\r\n    useEffect(() => {\r\n        if (root.current && !popper) {\r\n            const popperObj = (props.element as any).popper({\r\n                content: () => root.current,\r\n                popper: {\r\n                    placement: props.placement ? props.placement : 'top'\r\n                }\r\n            });\r\n            props.element.on(EVENT_POSITION, popperObj.scheduleUpdate);\r\n            props.element.on(EVENT_MOUSEUP, destroyPopper); // otherwise the popper will dislocate on mouseup\r\n            setPopper(popperObj);\r\n        }\r\n\r\n        return destroyPopper;\r\n    }, [root, popper, props.element, props.placement, destroyPopper]);\r\n\r\n    const classes = useStyle();\r\n\r\n    return <div ref={root} className={classes.popper}>{props.children}</div>;\r\n};\r\n\r\nexport default NodePopper;\r\n","import React from 'react';\r\nimport { IconButton } from '@material-ui/core';\r\nimport { Delete } from '@material-ui/icons';\r\n\r\ninterface Props {\r\n    click: () => void;\r\n}\r\n\r\nconst DeleteElementButton: React.FC<Props> = (props) => {\r\n\r\n    return (\r\n        <IconButton\r\n            size='small'\r\n            title=\"Delete\"\r\n            onClick={props.click}\r\n        >\r\n            <Delete />\r\n        </IconButton>\r\n    );\r\n};\r\n\r\nexport default DeleteElementButton;\r\n","import { NodeSingular, EdgeSingular } from \"cytoscape\";\r\nimport { isSystemObjectData, isConnectionData } from \"./graph-element\";\r\nimport { isRole } from \"../system-description/role\";\r\n\r\nexport function getSystemObject(ele: NodeSingular | EdgeSingular) {\r\n    const data = ele.data();\r\n    if (isSystemObjectData(data)) {\r\n        return data.systemObject;\r\n    }\r\n}\r\n\r\nexport function getRole(ele: NodeSingular | EdgeSingular) {\r\n    const systemObject = getSystemObject(ele);\r\n    if (systemObject && isRole(systemObject)) {\r\n        return systemObject;\r\n    }\r\n}\r\n\r\nexport function getConnection(ele: NodeSingular | EdgeSingular) {\r\n    const data = ele.data();\r\n    if (isConnectionData(data)) {\r\n        return data.connection;\r\n    }\r\n}\r\n","import { HazardCategory } from \"../hazard-description-categorization/hazard-category\";\r\nimport SystemObject from \"../system-description/system-object\";\r\nimport { ObjectTypes } from \"../system-description/object-types\";\r\n\r\ninterface NameIdPair {\r\n    id: string;\r\n    name: string;\r\n}\r\n\r\nexport default interface Hazard {\r\n    id: number;\r\n    harmTruthmaker: string;\r\n    description: string;\r\n    mishapVictim: NameIdPair;\r\n    mishapVictimEnvObj: NameIdPair;\r\n    exposure: NameIdPair;\r\n    hazardElement: NameIdPair;\r\n    hazardElementEnvObj: NameIdPair;\r\n    category?: HazardCategory;\r\n    expansion?: {};\r\n}\r\n\r\nexport function isKindInHazard(kind: SystemObject, hazard: Hazard) {\r\n    return hazard.hazardElementEnvObj.id === kind.id ||\r\n        hazard.mishapVictimEnvObj.id === kind.id;\r\n}\r\n\r\nexport function isRoleInHazard(role: SystemObject, hazard: Hazard) {\r\n    return hazard.mishapVictim.id === role.id ||\r\n        hazard.hazardElement.id === role.id;\r\n}\r\n\r\nexport function isRelatorInHazard(relator: SystemObject, hazard: Hazard) {\r\n    return hazard.exposure.id === relator.id;\r\n}\r\n\r\nexport function getIsSystemObjectInHazard(entity: SystemObject) {\r\n    switch (entity.type) {\r\n        case ObjectTypes.kind:\r\n            return (hazard: Hazard) => isKindInHazard(entity, hazard);\r\n        case ObjectTypes.relator:\r\n            return (hazard: Hazard) => isRelatorInHazard(entity, hazard);\r\n        case ObjectTypes.role:\r\n            return (hazard: Hazard) => isRoleInHazard(entity, hazard);\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { EdgeSingular } from 'cytoscape';\r\nimport { deleteConnection } from '../../store/system-model/actions';\r\nimport Connection from '../../entities/system-description/connection';\r\nimport DeleteElementButton from './delete-element-button';\r\nimport { getSystemObject } from '../../entities/graph/element-utilities';\r\nimport { showConfirmationDialog } from '../../store/modal-dialog/actions';\r\nimport { RootState } from '../../store';\r\nimport { getIsSystemObjectInHazard } from '../../entities/hazard-population/hazard';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    hazards: state.systemModel.hazards\r\n});\r\n\r\nconst mapDispatch = {\r\n    connectionDeleted: deleteConnection,\r\n    confirm: showConfirmationDialog\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatch);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>\r\n\r\ntype Props = PropsFromRedux & {\r\n    connection: Connection,\r\n    element: EdgeSingular,\r\n    onClick: () => void\r\n}\r\n\r\nconst DeleteConnectionButton: React.FC<Props> = (props) => {\r\n\r\n    const deleteConnection = () => {\r\n        props.onClick();\r\n        const target = getSystemObject(props.element.target());\r\n        if (target) {\r\n            const isTargetInHazard = getIsSystemObjectInHazard(target);\r\n            if (props.hazards.some(isTargetInHazard)) {\r\n                props.confirm(\r\n                    'This connection takes part in one or more hazards. If you delete it those hazards will be deleted as well. Continue?',\r\n                    () => props.connectionDeleted(props.connection, target)\r\n                );\r\n            } else {\r\n                props.connectionDeleted(props.connection, target)\r\n            }\r\n        }\r\n    };\r\n\r\n    return <DeleteElementButton click={deleteConnection} />;\r\n};\r\n\r\nexport default connector(DeleteConnectionButton);\r\n","export enum HazardCategory {\r\n    hazard = 'Hazard',\r\n    initiatingCondition = 'Initiating Condition',\r\n    initiatingEvent = 'Initiating Event',\r\n    mishap = 'Mishap'\r\n}\r\n","import React, { useState } from 'react';\r\nimport { Card, CardHeader, IconButton, Button, Typography, CardContent, CardActions } from '@material-ui/core';\r\nimport { Close } from '@material-ui/icons';\r\nimport { HazardCategory } from '../../../entities/hazard-description-categorization/hazard-category';\r\n\r\ninterface Props {\r\n    cancel: () => void;\r\n    complete: (category: HazardCategory) => void;\r\n}\r\n\r\nenum IntermediateCategory {\r\n    notSet,\r\n    situation,\r\n    event\r\n}\r\n\r\nconst CategorizationWizard: React.FC<Props> = (props) => {\r\n\r\n    const [category, setCategory] = useState(IntermediateCategory.notSet);\r\n\r\n    let question: string;\r\n    let instructions: JSX.Element | null = null;\r\n    let actions: JSX.Element;\r\n\r\n    switch (category) {\r\n        case IntermediateCategory.notSet:\r\n            question = 'Is the hazard description describing a situation (state of affairs) or an event?';\r\n            instructions = (\r\n                <React.Fragment>\r\n                    <p>\r\n                        Note that\r\n                    </p>\r\n                    <p>\r\n                        1) if a hazard description describes that some event is supposed to occur but\r\n                        does not, then the hazard description is regarded as a generic <b>situation</b> that\r\n                        will not trigger the specific event, such as \"the brake command is not issued\",\r\n                    </p>\r\n                    <p>\r\n                        and\r\n                    </p>\r\n                    <p>\r\n                        2) if a hazard description describes a repetitive and continuous behavior, it \r\n                        can be regarded as a <b>situation</b>, such as \"a train is running on the track\".\r\n                    </p>\r\n                </React.Fragment>\r\n            );\r\n            actions = (\r\n                <React.Fragment>\r\n                    <Button\r\n                        size='small'\r\n                        variant='outlined'\r\n                        onClick={() => setCategory(IntermediateCategory.situation)}\r\n                    >\r\n                        Situation\r\n                    </Button>\r\n                    <Button\r\n                        size='small'\r\n                        variant='outlined'\r\n                        onClick={() => setCategory(IntermediateCategory.event)}\r\n                    >\r\n                        Event\r\n                    </Button>\r\n                </React.Fragment>\r\n            );\r\n            break;\r\n        case IntermediateCategory.situation:\r\n            question = 'Can the situation trigger mishaps when some dispositions in the situation are manifested ?';\r\n            actions = (\r\n                <React.Fragment>\r\n                    <Button\r\n                        size='small'\r\n                        variant='outlined'\r\n                        onClick={() => props.complete(HazardCategory.hazard)}\r\n                    >\r\n                        Yes &mdash; Hazard\r\n                    </Button>\r\n                    <Button\r\n                        size='small'\r\n                        variant='outlined'\r\n                        onClick={() => props.complete(HazardCategory.initiatingCondition)}\r\n                    >\r\n                        No &mdash; Initiating Condition\r\n                    </Button>\r\n                </React.Fragment>\r\n            );\r\n            break;\r\n        case IntermediateCategory.event:\r\n            question = 'Can the event bring about severe injuries of people or damages to the environment?';\r\n            actions = (\r\n                <React.Fragment>\r\n                    <Button\r\n                        size='small'\r\n                        variant='outlined'\r\n                        onClick={() => props.complete(HazardCategory.mishap)}\r\n                    >\r\n                        Yes &mdash; Mishap\r\n                    </Button>\r\n                    <Button\r\n                        size='small'\r\n                        variant='outlined'\r\n                        onClick={() => props.complete(HazardCategory.initiatingEvent)}\r\n                    >\r\n                        No &mdash; Initiating Event\r\n                    </Button>\r\n                </React.Fragment>\r\n            );\r\n            break;\r\n        default:\r\n            throw new Error('Unknown intermediate category');\r\n    }\r\n\r\n    return (\r\n        <Card variant='outlined'>\r\n            <CardHeader\r\n                action={\r\n                    <IconButton size='small' onClick={props.cancel}>\r\n                        <Close />\r\n                    </IconButton>\r\n                }\r\n                title={question}\r\n            />\r\n            {\r\n                instructions ?\r\n                    <CardContent>\r\n                        <Typography variant='body2' component='div'>\r\n                            {instructions}\r\n                        </Typography>\r\n                    </CardContent>\r\n                    :\r\n                    undefined\r\n            }\r\n            <CardActions>\r\n                {actions}\r\n            </CardActions>\r\n        </Card>\r\n    );\r\n};\r\n\r\nexport default CategorizationWizard;\r\n","import React from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport Popper from 'popper.js';\r\nimport { NodeSingular, EventObject, Singular, EdgeSingular } from 'cytoscape';\r\n\r\nimport SystemObject from '../../entities/system-description/system-object';\r\nimport Subsystem from '../../entities/system-description/subsystem';\r\nimport GraphElementsFactory from '../../entities/graph/graph-elements-factory';\r\nimport Graph from '../graph/graph';\r\nimport NodeEditor from './node-editor';\r\nimport { isSystemObject, isSubsystem } from '../../entities/system-description/system-description-entity';\r\nimport { isSystemObjectData, isSubsystemData, GraphElementPosition } from '../../entities/graph/graph-element';\r\nimport NodePopper from '../graph/node-popper';\r\nimport Connection from '../../entities/system-description/connection';\r\nimport DeleteConnectionButton from './delete-connection-button';\r\nimport { createSubsystem, updateSubsystem, createConnection, renameSystemObject, createSystemObject, updateSystemObject } from '../../store/system-model/actions';\r\nimport { getConnection } from '../../entities/graph/element-utilities';\r\nimport { RootState } from '../../store';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    system: state.systemModel\r\n});\r\n\r\nconst mapDispatch = {\r\n    subsystemCreated: createSubsystem,\r\n    subsystemUpdated: updateSubsystem,\r\n    connectionCreated: createConnection,\r\n    systemObjectRenamed: renameSystemObject,\r\n    systemObjectCreated: createSystemObject,\r\n    systemObjectUpdated: updateSystemObject\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatch);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>\r\n\r\ntype Props = PropsFromRedux & {\r\n    objectEditing?: SystemObject | Subsystem | null;\r\n    objectEditingDone?: () => void;\r\n    nodeConnecting: NodeSingular | null;\r\n    nodeConnectingDone: () => void;\r\n    tryCreateConnection: (source: NodeSingular, target: NodeSingular) => Connection | null;\r\n    toolbarButtons?: JSX.Element;\r\n    elementDisplayPopper: Singular | null;\r\n    elementDisplayPopperChanged: (element: Singular | null) => void;\r\n    renderSystemObjectActions: (object: SystemObject, element: NodeSingular) => JSX.Element;\r\n    renderSubsystemActions: (subsystem: Subsystem, element: NodeSingular) => JSX.Element;\r\n}\r\n\r\ninterface State {\r\n    isConnectionValid: boolean;\r\n}\r\n\r\nexport interface StepState {\r\n    objectEditing: SystemObject | Subsystem | null;\r\n    nodeConnecting: NodeSingular | null;\r\n    elementDisplayPopper: Singular | null;\r\n}\r\n\r\nconst DEFAULT_POSITION = {\r\n    x: 100, y: 50\r\n};\r\n\r\nclass SdfStepBase extends React.Component<Props, State> {\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.showNodeActions = this.showNodeActions.bind(this);\r\n        this.hideNodeActions = this.hideNodeActions.bind(this);\r\n        this.createConnection = this.createConnection.bind(this);\r\n        this.completeEditEntity = this.completeEditEntity.bind(this);\r\n        this.updateNodePosition = this.updateNodePosition.bind(this);\r\n        this.validateConnection = this.validateConnection.bind(this);\r\n        this.preventOverlap = this.preventOverlap.bind(this);\r\n        this.cancelEditEntity = this.cancelEditEntity.bind(this);\r\n        this.renderConnectionActions = this.renderConnectionActions.bind(this);\r\n\r\n        this.state = {\r\n            isConnectionValid: false\r\n        };\r\n    }\r\n\r\n    render() {\r\n        const elementsFactory = new GraphElementsFactory();\r\n        const elements = elementsFactory.mapSystemDescription(this.props.system);\r\n\r\n        let actionButtonsPlacement: Popper.Placement = 'top';\r\n        if (this.props.elementDisplayPopper && this.props.elementDisplayPopper.isNode()) {\r\n            if (isSystemObjectData(this.props.elementDisplayPopper.data())) {\r\n                actionButtonsPlacement = 'top-start';\r\n            } else {\r\n                actionButtonsPlacement = 'bottom-start';\r\n            }\r\n        }\r\n\r\n        let cursorStyle = 'default';\r\n        if (this.props.nodeConnecting) {\r\n            if (this.state.isConnectionValid) {\r\n                cursorStyle = 'pointer';\r\n            } else {\r\n                cursorStyle = 'not-allowed';\r\n            }\r\n        }\r\n\r\n        let elementActions = <React.Fragment></React.Fragment>;\r\n        const actionElement = this.props.elementDisplayPopper;\r\n        if (actionElement) {\r\n            if (actionElement.isEdge()) {\r\n                elementActions = this.renderConnectionActions(actionElement);\r\n            } else if (actionElement.isNode()) {\r\n                const data = actionElement.data();\r\n                if (isSystemObjectData(data)) {\r\n                    elementActions = this.props.renderSystemObjectActions(data.systemObject, actionElement);\r\n                } else if (isSubsystemData(data)) {\r\n                    elementActions = this.props.renderSubsystemActions(data.subsystem, actionElement);\r\n                }\r\n            }\r\n        }\r\n\r\n        return (\r\n            <React.Fragment>\r\n                <Graph\r\n                    elements={elements}\r\n                    cursorStyle={cursorStyle}\r\n                    graphClicked={this.props.nodeConnectingDone}\r\n                    nodeClicked={this.createConnection}\r\n                    mouseEnteredNode={this.showNodeActions}\r\n                    mouseLeftNode={this.hideNodeActions}\r\n                    nodeMoved={this.updateNodePosition}\r\n                    useCollapseApi={true}\r\n                />\r\n                {this.props.toolbarButtons}\r\n                {\r\n                    this.props.elementDisplayPopper ?\r\n                        <NodePopper\r\n                            element={this.props.elementDisplayPopper}\r\n                            placement={actionButtonsPlacement}\r\n                        >\r\n                            {elementActions}\r\n                        </NodePopper>\r\n                        :\r\n                        undefined\r\n                }\r\n                {\r\n                    this.props.objectEditing ?\r\n                        <NodeEditor\r\n                            entity={this.props.objectEditing}\r\n                            subsystemsAvailable={this.props.system.subsystems}\r\n                            entityUpdated={this.completeEditEntity}\r\n                            editCancelled={this.cancelEditEntity}\r\n                        />\r\n                        :\r\n                        undefined\r\n                }\r\n            </React.Fragment>\r\n        );\r\n    }\r\n\r\n    private renderConnectionActions(element: EdgeSingular) {\r\n        if (this.props.tryCreateConnection(element.source(), element.target())) {\r\n\r\n            const connection = getConnection(element);\r\n            if (connection) {\r\n                return <DeleteConnectionButton\r\n                    connection={connection}\r\n                    element={element}\r\n                    onClick={() => this.props.elementDisplayPopperChanged(null)}\r\n                />;\r\n            }\r\n        }\r\n\r\n        return <React.Fragment></React.Fragment>;\r\n    }\r\n\r\n    private showNodeActions(event: EventObject) {\r\n        // triggered twice for element in subsystem which breaks popper\r\n        if (this.props.elementDisplayPopper) {\r\n            return;\r\n        }\r\n\r\n        let isConnectionValid = false;\r\n        const ele = event.target as Singular;\r\n        if (ele.isNode()) {\r\n            isConnectionValid = !!this.validateConnection(ele);\r\n        }\r\n\r\n        this.setState({ ...this.state, ...{ isConnectionValid: isConnectionValid } });\r\n        this.props.elementDisplayPopperChanged(event.target);\r\n    }\r\n\r\n    private hideNodeActions() {\r\n        this.setState({ ...this.state, ...{ isConnectionValid: false } });\r\n        this.props.elementDisplayPopperChanged(null);\r\n    }\r\n\r\n    private createConnection(event: EventObject) {\r\n        const target = event.target as Singular;\r\n        if (target.isNode()) {\r\n            const connection = this.validateConnection(target);\r\n            if (connection) {\r\n                this.props.connectionCreated(connection);\r\n            }\r\n        }\r\n        this.props.nodeConnectingDone();\r\n    }\r\n\r\n    private validateConnection(target: NodeSingular) {\r\n        if (!this.props.nodeConnecting ||\r\n            this.props.nodeConnecting === target ||\r\n            this.props.nodeConnecting.edgesWith(target).length !== 0\r\n        ) {\r\n            return null;\r\n        }\r\n        return this.props.tryCreateConnection(this.props.nodeConnecting, target);\r\n    }\r\n\r\n    private updateNodePosition(event: EventObject) {\r\n        const node = event.target as NodeSingular;\r\n        const position = node.position();\r\n        const data = node.data();\r\n        if (isSystemObjectData(data)) {\r\n            const systemObject = data.systemObject;\r\n            this.props.systemObjectUpdated(\r\n                { ...systemObject, ...{ posX: position.x, posY: position.y } });\r\n            if (data.parent && node.parent().length > 0) {\r\n                // save position of parent subsystem as it changes when its children move\r\n                const parent = this.props.system.subsystems.find(e => e.id === data.parent);\r\n                if (parent) {\r\n                    const parentPosition = node.parent()[0].position();\r\n                    this.props.subsystemUpdated(\r\n                        { ...parent, ...{ posX: parentPosition.x, posY: parentPosition.y } });\r\n                }\r\n            }\r\n\r\n        } else if (isSubsystemData(data)) {\r\n            const subsystem = data.subsystem;\r\n            this.props.subsystemUpdated({ ...subsystem, ...{ posX: position.x, posY: position.y } });\r\n            // update position of children nodes\r\n            for (var i = 0; i < node.children().length; i++) {\r\n                const childNode = node.children()[i];\r\n                const childData = childNode.data();\r\n                if (isSystemObjectData(childData)) {\r\n                    const childObject = childData.systemObject;\r\n                    const position = childNode.position();\r\n                    this.props.systemObjectUpdated(\r\n                        { ...childObject, ...{ posX: position.x, posY: position.y } });\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private cancelEditEntity() {\r\n        this.props.objectEditingDone && this.props.objectEditingDone();\r\n    }\r\n\r\n    private completeEditEntity(entity: SystemObject | Subsystem) {\r\n        const allNodes = new GraphElementsFactory().getAllNodes(this.props.system);\r\n        const existingEntity = allNodes.find(e => e.id === entity.id);\r\n\r\n        if (existingEntity) {\r\n            if (isSystemObject(entity) && isSystemObject(existingEntity)) {\r\n                let positionOverride = null;\r\n                let parentId: string | undefined = undefined;\r\n                if (entity.parent && (!existingEntity.parent || existingEntity.parent !== entity.parent)) {\r\n                    const parent = this.props.system.subsystems.find(e => e.id === entity.parent);\r\n                    if (parent) {\r\n                        positionOverride = { x: parent.posX, y: parent.posY };\r\n                        parentId = parent.id;\r\n                    }\r\n                } else if (!entity.parent && existingEntity.parent) {\r\n                    positionOverride = DEFAULT_POSITION;\r\n                }\r\n\r\n                if (positionOverride) {\r\n                    const adjustedPosition = this.preventOverlap(positionOverride, allNodes, parentId);\r\n                    entity.posX = adjustedPosition.x;\r\n                    entity.posY = adjustedPosition.y;\r\n                }\r\n\r\n                if (entity.name !== existingEntity.name) {\r\n                    this.props.systemObjectRenamed(entity);\r\n                }\r\n            }\r\n\r\n            if (isSubsystem(entity)) {\r\n                this.props.subsystemUpdated(entity);\r\n            } else {\r\n                this.props.systemObjectUpdated(entity);\r\n            }\r\n\r\n        } else {\r\n            let nodePosition = DEFAULT_POSITION;\r\n            let parentId: string | undefined;\r\n            if (isSystemObject(entity) && entity.parent) {\r\n                const parent = this.props.system.subsystems.find(e => e.id === entity.parent);\r\n                if (parent) {\r\n                    nodePosition = { x: parent.posX, y: parent.posY };\r\n                    parentId = parent.id;\r\n                }\r\n            }\r\n            const adjustedPosition = this.preventOverlap(nodePosition, allNodes, parentId);\r\n            entity.posX = adjustedPosition.x;\r\n            entity.posY = adjustedPosition.y;\r\n\r\n            if (isSubsystem(entity)) {\r\n                this.props.subsystemCreated(entity);\r\n            } else {\r\n                this.props.systemObjectCreated(entity);\r\n            }\r\n        }\r\n\r\n        this.props.objectEditingDone && this.props.objectEditingDone();\r\n    };\r\n\r\n    private preventOverlap(\r\n        position: GraphElementPosition,\r\n        otherNodes: (SystemObject | Subsystem)[],\r\n        parentId?: string\r\n    ): GraphElementPosition {\r\n        if (otherNodes.every(e => (e.posX !== position.x && e.posY !== position.y) || e.id === parentId)) {\r\n            return position;\r\n        }\r\n        return this.preventOverlap({ x: position.x + 20, y: position.y + 20 }, otherNodes);\r\n    }\r\n}\r\n\r\nexport default connector(SdfStepBase)\r\n","import React from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { deleteSystemObject } from '../../store/system-model/actions';\r\nimport SystemObject from '../../entities/system-description/system-object';\r\nimport DeleteElementButton from './delete-element-button';\r\nimport { showConfirmationDialog } from '../../store/modal-dialog/actions';\r\nimport { RootState } from '../../store';\r\nimport { getIsSystemObjectInHazard } from '../../entities/hazard-population/hazard';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    hazards: state.systemModel.hazards\r\n});\r\n\r\nconst mapDispatch = {\r\n    systemObjectDeleted: deleteSystemObject,\r\n    confirm: showConfirmationDialog\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatch);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>\r\n\r\ntype Props = PropsFromRedux & {\r\n    systemObject: SystemObject,\r\n    onClick: () => void\r\n}\r\n\r\nconst DeleteSystemObjectButton: React.FC<Props> = (props) => {\r\n\r\n    const deleteObject = () => {\r\n        props.onClick();\r\n        const isObjectInHazard = getIsSystemObjectInHazard(props.systemObject);\r\n        if (props.hazards.some(isObjectInHazard)) {\r\n            props.confirm(\r\n                'This object takes part in one or more hazards. If you delete it those hazards will be deleted as well. Continue?',\r\n                () => props.systemObjectDeleted(props.systemObject));\r\n        } else {\r\n            props.systemObjectDeleted(props.systemObject);\r\n        }\r\n    };\r\n\r\n    return <DeleteElementButton click={deleteObject} />;\r\n};\r\n\r\nexport default connector(DeleteSystemObjectButton);\r\n","import React from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { NodeSingular } from 'cytoscape';\r\nimport { deleteSystemObject, deleteSubsystem } from '../../store/system-model/actions';\r\nimport { getSystemObject } from '../../entities/graph/element-utilities';\r\nimport DeleteElementButton from './delete-element-button';\r\nimport { showConfirmationDialog } from '../../store/modal-dialog/actions';\r\nimport Subsystem from '../../entities/system-description/subsystem';\r\nimport SystemObject from '../../entities/system-description/system-object';\r\nimport { RootState } from '../../store';\r\nimport { getIsSystemObjectInHazard } from '../../entities/hazard-population/hazard';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    hazards: state.systemModel.hazards\r\n});\r\n\r\nconst mapDispatch = {\r\n    subsystemDeleted: deleteSubsystem,\r\n    systemObjectDeleted: deleteSystemObject,\r\n    confirm: showConfirmationDialog\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatch);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>\r\n\r\ntype Props = PropsFromRedux & {\r\n    subsystem: Subsystem,\r\n    element: NodeSingular,\r\n    onClick: () => void\r\n}\r\n\r\nconst DeleteSubsystemButton: React.FC<Props> = (props) => {\r\n\r\n    const deleteSubsystemWithChildren = (children: (SystemObject | undefined)[]) => {\r\n        children.forEach(e => e && props.systemObjectDeleted(e));\r\n        props.subsystemDeleted(props.subsystem);\r\n    };\r\n\r\n    const checkHazardsAndDelete = () => {\r\n        const children = props.element.children().map(e => getSystemObject(e));\r\n        const hasHazardsAssociated = children.some(e => {\r\n            if (!e) {\r\n                return false;\r\n            }\r\n            const isObjectInHazard = getIsSystemObjectInHazard(e);\r\n            return props.hazards.some(isObjectInHazard);\r\n        });\r\n\r\n        if (!hasHazardsAssociated) {\r\n            deleteSubsystemWithChildren(children);\r\n        } else {\r\n            props.confirm(\r\n                'Some of the subsystem\\'s child objects take part in one ore more hazards. If you delete the subsystem those hazards will be removed as well. Continue?',\r\n                () => deleteSubsystemWithChildren(children)\r\n            );\r\n        }\r\n    };\r\n\r\n    const deleteSubsystem = () => {\r\n        props.onClick();\r\n        if (props.element.isChildless()) {\r\n            props.subsystemDeleted(props.subsystem);\r\n        } else {\r\n            props.confirm(\r\n                'All the objects in the subsystem will be removed as well. Continue?',\r\n                checkHazardsAndDelete\r\n            );\r\n        }\r\n    };\r\n\r\n    return <DeleteElementButton click={deleteSubsystem} />;\r\n};\r\n\r\nexport default connector(DeleteSubsystemButton);\r\n","import React from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { RootState } from '../../store';\r\nimport SystemObject from '../../entities/system-description/system-object';\r\nimport { showConfirmationDialog } from '../../store/modal-dialog/actions';\r\nimport { getIsSystemObjectInHazard } from '../../entities/hazard-population/hazard';\r\nimport { IconButton } from '@material-ui/core';\r\nimport { Edit } from '@material-ui/icons';\r\nimport Subsystem from '../../entities/system-description/subsystem';\r\nimport { isSubsystem } from '../../entities/system-description/system-description-entity';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    hazards: state.systemModel.hazards\r\n});\r\n\r\nconst mapDispatch = {\r\n    confirm: showConfirmationDialog\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatch);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>\r\n\r\ntype Props = PropsFromRedux & {\r\n    node: SystemObject | Subsystem;\r\n    onClick: () => void;\r\n}\r\n\r\nconst EditNodeButton: React.FC<Props> = (props) => {\r\n\r\n    const handleClick = () => {\r\n        if (isSubsystem(props.node)) {\r\n            props.onClick();\r\n        } else {\r\n            const isObjectInHazard = getIsSystemObjectInHazard(props.node);\r\n            if (props.hazards.some(isObjectInHazard)) {\r\n                props.confirm(\r\n                    'This object takes part in one or more hazards. If you edit it those hazards will be affected. Continue?',\r\n                    props.onClick);\r\n            } else {\r\n                props.onClick();\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <IconButton\r\n            size='small'\r\n            title='Edit'\r\n            onClick={handleClick}\r\n        >\r\n            <Edit />\r\n        </IconButton>\r\n    );\r\n};\r\n\r\nexport default connector(EditNodeButton);\r\n","import React from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { NodeSingular } from 'cytoscape';\r\nimport Subsystem from '../../entities/system-description/subsystem';\r\nimport { IconButton } from '@material-ui/core';\r\nimport { ExpandMore, ExpandLess } from '@material-ui/icons';\r\nimport { getCollapseApi } from '../../entities/graph/collapse-api';\r\nimport { updateSubsystem } from '../../store/system-model/actions';\r\n\r\nconst mapDispatch = {\r\n    subsystemUpdated: updateSubsystem,\r\n};\r\n\r\nconst connector = connect(null, mapDispatch);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>\r\n\r\ntype Props = PropsFromRedux & {\r\n    node: NodeSingular;\r\n    subsystem: Subsystem;\r\n}\r\n\r\nconst SubsystemCollapseButton: React.FC<Props> = (props) => {\r\n\r\n    const toggleCollapsedState = () => {\r\n        const cy = props.node.cy();\r\n        const collapseApi = getCollapseApi(cy);\r\n        const newStateCollapsed = !props.subsystem.isCollapsed;\r\n        if (newStateCollapsed) {\r\n            collapseApi.collapse(props.node);\r\n        } else {\r\n            collapseApi.expand(props.node);\r\n        }\r\n        // collapsing tool messes up everything\r\n        cy.json(cy.json()); // force redraw\r\n        cy.zoom(1.1); // restore position\r\n        cy.pan({ x: 0, y: 0 });\r\n\r\n        props.subsystemUpdated({ ...props.subsystem, ...{ isCollapsed: newStateCollapsed } });\r\n    };\r\n\r\n    return (\r\n        <IconButton\r\n            title={props.subsystem.isCollapsed ? 'Expand' : 'Collapse'}\r\n            onClick={toggleCollapsedState}\r\n            size='small'\r\n        >\r\n            {props.subsystem.isCollapsed ? <ExpandMore /> : <ExpandLess />}\r\n        </IconButton>\r\n    );\r\n};\r\n\r\nexport default connector(SubsystemCollapseButton);\r\n","import React from 'react';\r\nimport { makeStyles } from '@material-ui/core';\r\n\r\ninterface Props {\r\n    placement: 'top' | 'bottom';\r\n}\r\n\r\nconst useStyles = makeStyles(() => ({\r\n    base: {\r\n        position: 'relative',\r\n        left: '-5px'\r\n    },\r\n    top: {\r\n        top: '-5px'\r\n    },\r\n    bottom: {\r\n        top: '5px'\r\n    }\r\n}));\r\n\r\nconst NodeActions: React.FC<Props> = (props) => {\r\n    const classes = useStyles();\r\n\r\n    return (\r\n        <div className={`${classes.base} ${classes[props.placement]}`}>\r\n            {props.children}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default NodeActions;\r\n","import React from 'react';\r\nimport { NodeSingular } from 'cytoscape';\r\nimport { IconButton } from '@material-ui/core';\r\nimport { Add, Link } from '@material-ui/icons';\r\n\r\nimport SystemObject from '../../entities/system-description/system-object';\r\nimport Subsystem from '../../entities/system-description/subsystem';\r\nimport { createObjectId } from '../../entities/system-model';\r\nimport ToolbarButtons from './toolbar-buttons';\r\nimport { ObjectTypes } from '../../entities/system-description/object-types';\r\nimport { isSystemObjectData } from '../../entities/graph/graph-element';\r\nimport SdfStepBase, { StepState } from './sdf-step-base';\r\nimport DeleteSystemObjectButton from './delete-system-object-button';\r\nimport DeleteSubsystemButton from './delete-subsystem-button';\r\nimport EditNodeButton from './edit-node-button';\r\nimport SubsystemCollapseButton from './subsystem-collapse-button';\r\nimport NodeActions from '../graph/node-actions';\r\n\r\nexport default class SdfStep1 extends React.Component<{}, StepState> {\r\n\r\n    constructor(props: Readonly<{}>) {\r\n        super(props);\r\n\r\n        this.tryCreateConnection = this.tryCreateConnection.bind(this);\r\n        this.startCreatingKind = this.startCreatingKind.bind(this);\r\n        this.startCreatingRole = this.startCreatingRole.bind(this);\r\n        this.startCreatingSubsystem = this.startCreatingSubsystem.bind(this);\r\n        this.renderSystemObjectActions = this.renderSystemObjectActions.bind(this);\r\n        this.renderSubsystemActions = this.renderSubsystemActions.bind(this);\r\n\r\n        this.state = {\r\n            nodeConnecting: null,\r\n            objectEditing: null,\r\n            elementDisplayPopper: null\r\n        };\r\n    }\r\n\r\n    render() {\r\n        const toolbarButtons = <ToolbarButtons buttons={[\r\n            {\r\n                icon: <Add />,\r\n                text: 'Kind',\r\n                action: this.startCreatingKind\r\n            },\r\n            {\r\n                icon: <Add />,\r\n                text: 'Role',\r\n                action: this.startCreatingRole\r\n            },\r\n            {\r\n                icon: <Add />,\r\n                text: 'Subsystem',\r\n                action: this.startCreatingSubsystem\r\n            },\r\n        ]} />;\r\n\r\n        return (\r\n            <SdfStepBase\r\n                elementDisplayPopper={this.state.elementDisplayPopper}\r\n                elementDisplayPopperChanged={(ele) => this.setState({\r\n                    ...this.state, ...{ elementDisplayPopper: ele }\r\n                })}\r\n                nodeConnecting={this.state.nodeConnecting}\r\n                nodeConnectingDone={() => this.setState({ ...this.state, ...{ nodeConnecting: null } })}\r\n                objectEditing={this.state.objectEditing}\r\n                objectEditingDone={() => this.setState({ ...this.state, ...{ objectEditing: null } })}\r\n                toolbarButtons={toolbarButtons}\r\n                tryCreateConnection={this.tryCreateConnection}\r\n                renderSubsystemActions={this.renderSubsystemActions}\r\n                renderSystemObjectActions={this.renderSystemObjectActions}\r\n            />\r\n        );\r\n    }\r\n\r\n    private renderSystemObjectActions(object: SystemObject, element: NodeSingular) {\r\n        if (object.type === ObjectTypes.kind) {\r\n            return (\r\n                <NodeActions placement='top'>\r\n                    <IconButton\r\n                        size='small'\r\n                        title='Connect to containing kind'\r\n                        onClick={() => this.setState({ ...this.state, ...{ nodeConnecting: element } })}\r\n                    >\r\n                        <Link />\r\n                    </IconButton>\r\n                    <EditNodeButton\r\n                        node={object}\r\n                        onClick={() => this.setState({\r\n                            ...this.state, ...{ objectEditing: object, elementDisplayPopper: null }\r\n                        })}\r\n                    />\r\n                    <DeleteSystemObjectButton\r\n                        systemObject={object}\r\n                        onClick={() => this.setState({ ...this.state, ...{ elementDisplayPopper: null } })}\r\n                    />\r\n                </NodeActions>\r\n            );\r\n        }\r\n        if (object.type === ObjectTypes.role) {\r\n            return (\r\n                <NodeActions placement='top'>\r\n                    <EditNodeButton\r\n                        node={object}\r\n                        onClick={() => this.setState({\r\n                            ...this.state, ...{ objectEditing: object, elementDisplayPopper: null }\r\n                        })}\r\n                    />\r\n                    <DeleteSystemObjectButton\r\n                        systemObject={object}\r\n                        onClick={() => this.setState({ ...this.state, ...{ elementDisplayPopper: null } })}\r\n                    />\r\n                </NodeActions>\r\n            );\r\n        }\r\n        return <React.Fragment></React.Fragment>;\r\n    }\r\n\r\n    private renderSubsystemActions(subsystem: Subsystem, element: NodeSingular) {\r\n        return (\r\n            <NodeActions placement='bottom'>\r\n                <SubsystemCollapseButton\r\n                    node={element}\r\n                    subsystem={subsystem}\r\n                />\r\n                <EditNodeButton\r\n                    node={subsystem}\r\n                    onClick={() => this.setState({\r\n                        ...this.state, ...{ objectEditing: subsystem, elementDisplayPopper: null }\r\n                    })}\r\n                />\r\n                <DeleteSubsystemButton\r\n                    element={element}\r\n                    subsystem={subsystem}\r\n                    onClick={() => this.setState({ ...this.state, ...{ elementDisplayPopper: null } })}\r\n                />\r\n            </NodeActions>\r\n        );\r\n    }\r\n\r\n    private tryCreateConnection(source: NodeSingular, target: NodeSingular) {\r\n        const sourceData = source.data();\r\n        const targetData = target.data();\r\n        if (isSystemObjectData(sourceData) && isSystemObjectData(targetData) &&\r\n            sourceData.systemObject.type === ObjectTypes.kind &&\r\n            targetData.systemObject.type === ObjectTypes.kind\r\n        ) {\r\n            return {\r\n                id: createObjectId('connection'),\r\n                source: sourceData.systemObject.id,\r\n                target: targetData.systemObject.id,\r\n                label: 'ispartof',\r\n                isOriented: true\r\n            };\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private startCreatingKind() {\r\n        if (!this.state.objectEditing) {\r\n            const obj = {\r\n                id: createObjectId('kind'),\r\n                name: \"\",\r\n                type: ObjectTypes.kind,\r\n                posX: 0,\r\n                posY: 0\r\n            };\r\n            this.setState({ ...this.state, ...{ objectEditing: obj } });\r\n        }\r\n    };\r\n\r\n    private startCreatingRole() {\r\n        if (!this.state.objectEditing) {\r\n            const obj = {\r\n                id: createObjectId('role'),\r\n                name: \"\",\r\n                type: ObjectTypes.role,\r\n                posX: 0,\r\n                posY: 0,\r\n                possibleHarms: []\r\n            };\r\n            this.setState({ ...this.state, ...{ objectEditing: obj } });\r\n        }\r\n    };\r\n\r\n    private startCreatingSubsystem() {\r\n        if (!this.state.objectEditing) {\r\n            const subsystem = {\r\n                id: createObjectId('subsystem'),\r\n                name: \"\",\r\n                posX: 0,\r\n                posY: 0,\r\n                isCollapsed: false\r\n            };\r\n            this.setState({ ...this.state, ...{ objectEditing: subsystem } });\r\n        }\r\n    };\r\n}\r\n","import React from 'react';\r\nimport { NodeSingular } from 'cytoscape';\r\nimport { IconButton } from '@material-ui/core';\r\nimport { Link } from '@material-ui/icons';\r\n\r\nimport SystemObject from '../../entities/system-description/system-object';\r\nimport Subsystem from '../../entities/system-description/subsystem';\r\nimport { createObjectId } from '../../entities/system-model';\r\nimport { ObjectTypes } from '../../entities/system-description/object-types';\r\nimport { isSystemObjectData } from '../../entities/graph/graph-element';\r\nimport SdfStepBase, { StepState } from './sdf-step-base';\r\nimport SubsystemCollapseButton from './subsystem-collapse-button';\r\nimport NodeActions from '../graph/node-actions';\r\n\r\nexport default class SdfStep2 extends React.Component<{}, StepState> {\r\n\r\n    constructor(props: Readonly<{}>) {\r\n        super(props);\r\n\r\n        this.tryCreateConnection = this.tryCreateConnection.bind(this);\r\n        this.renderSystemObjectActions = this.renderSystemObjectActions.bind(this);\r\n        this.renderSubsystemActions = this.renderSubsystemActions.bind(this);\r\n\r\n        this.state = {\r\n            nodeConnecting: null,\r\n            objectEditing: null,\r\n            elementDisplayPopper: null\r\n        };\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <SdfStepBase\r\n                elementDisplayPopper={this.state.elementDisplayPopper}\r\n                elementDisplayPopperChanged={(ele) => this.setState({\r\n                    ...this.state, ...{ elementDisplayPopper: ele }\r\n                })}\r\n                nodeConnecting={this.state.nodeConnecting}\r\n                nodeConnectingDone={() => this.setState({ ...this.state, ...{ nodeConnecting: null } })}\r\n                tryCreateConnection={this.tryCreateConnection}\r\n                renderSubsystemActions={this.renderSubsystemActions}\r\n                renderSystemObjectActions={this.renderSystemObjectActions}\r\n            />\r\n        );\r\n    }\r\n\r\n    private renderSystemObjectActions(object: SystemObject, element: NodeSingular) {\r\n        if (object.type !== ObjectTypes.kind) {\r\n            return <React.Fragment></React.Fragment>;\r\n        }\r\n\r\n        return (\r\n            <NodeActions placement='top'>\r\n                <IconButton\r\n                    size='small'\r\n                    title='Connect to role'\r\n                    onClick={() => this.setState({ ...this.state, ...{ nodeConnecting: element } })}\r\n                >\r\n                    <Link />\r\n                </IconButton>\r\n            </NodeActions>\r\n        );\r\n    }\r\n\r\n    private renderSubsystemActions(subsystem: Subsystem, element: NodeSingular) {\r\n        return <NodeActions placement='bottom'>\r\n            <SubsystemCollapseButton\r\n                node={element}\r\n                subsystem={subsystem}\r\n            />\r\n        </NodeActions>;\r\n    }\r\n\r\n    private tryCreateConnection(source: NodeSingular, target: NodeSingular) {\r\n        const sourceData = source.data();\r\n        const targetData = target.data();\r\n        if (isSystemObjectData(sourceData) && sourceData.systemObject.type === ObjectTypes.kind &&\r\n            isSystemObjectData(targetData) && targetData.systemObject.type === ObjectTypes.role\r\n        ) {\r\n            return {\r\n                id: createObjectId('connection'),\r\n                source: sourceData.systemObject.id,\r\n                target: targetData.systemObject.id,\r\n                label: 'play',\r\n                isOriented: true\r\n            };\r\n        }\r\n        return null;\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { NodeSingular } from 'cytoscape';\r\nimport { IconButton } from '@material-ui/core';\r\nimport { Add, Link } from '@material-ui/icons';\r\n\r\nimport SystemObject from '../../entities/system-description/system-object';\r\nimport Subsystem from '../../entities/system-description/subsystem';\r\nimport { createObjectId } from '../../entities/system-model';\r\nimport ToolbarButtons from './toolbar-buttons';\r\nimport { ObjectTypes } from '../../entities/system-description/object-types';\r\nimport { isSystemObjectData } from '../../entities/graph/graph-element';\r\nimport SdfStepBase, { StepState } from './sdf-step-base';\r\nimport DeleteSystemObjectButton from './delete-system-object-button';\r\nimport SubsystemCollapseButton from './subsystem-collapse-button';\r\nimport NodeActions from '../graph/node-actions';\r\nimport EditNodeButton from './edit-node-button';\r\n\r\nexport default class SdfStep3 extends React.Component<{}, StepState> {\r\n\r\n    constructor(props: Readonly<{}>) {\r\n        super(props);\r\n\r\n        this.tryCreateConnection = this.tryCreateConnection.bind(this);\r\n        this.startCreatingRelator = this.startCreatingRelator.bind(this);\r\n        this.renderSystemObjectActions = this.renderSystemObjectActions.bind(this);\r\n        this.renderSubsystemActions = this.renderSubsystemActions.bind(this);\r\n\r\n        this.state = {\r\n            nodeConnecting: null,\r\n            objectEditing: null,\r\n            elementDisplayPopper: null\r\n        };\r\n    }\r\n\r\n    render() {\r\n        const toolbarButtons = <ToolbarButtons buttons={[\r\n            {\r\n                icon: <Add />,\r\n                text: 'Relator',\r\n                action: this.startCreatingRelator\r\n            }]} />;\r\n\r\n        return (\r\n            <SdfStepBase\r\n                elementDisplayPopper={this.state.elementDisplayPopper}\r\n                elementDisplayPopperChanged={(ele) => this.setState({\r\n                    ...this.state, ...{ elementDisplayPopper: ele }\r\n                })}\r\n                nodeConnecting={this.state.nodeConnecting}\r\n                nodeConnectingDone={() => this.setState({ ...this.state, ...{ nodeConnecting: null } })}\r\n                objectEditing={this.state.objectEditing}\r\n                objectEditingDone={() => this.setState({ ...this.state, ...{ objectEditing: null } })}\r\n                toolbarButtons={toolbarButtons}\r\n                tryCreateConnection={this.tryCreateConnection}\r\n                renderSubsystemActions={this.renderSubsystemActions}\r\n                renderSystemObjectActions={this.renderSystemObjectActions}\r\n            />\r\n        );\r\n    }\r\n\r\n    private renderSystemObjectActions(object: SystemObject, element: NodeSingular) {\r\n        if (object.type === ObjectTypes.relator) {\r\n            return (\r\n                <NodeActions placement='top'>\r\n                    <IconButton\r\n                        size='small'\r\n                        title='Connect to role'\r\n                        onClick={() => this.setState({ ...this.state, ...{ nodeConnecting: element } })}\r\n                    >\r\n                        <Link />\r\n                    </IconButton>\r\n                    <EditNodeButton\r\n                        node={object}\r\n                        onClick={() => this.setState({\r\n                            ...this.state, ...{ objectEditing: object, elementDisplayPopper: null }\r\n                        })}\r\n                    />\r\n                    <DeleteSystemObjectButton\r\n                        systemObject={object}\r\n                        onClick={() => this.setState({ ...this.state, ...{ elementDisplayPopper: null } })}\r\n                    />\r\n                </NodeActions>);\r\n        }\r\n        if (object.type === ObjectTypes.role) {\r\n            return (\r\n                <NodeActions placement='top'>\r\n                    <IconButton\r\n                        size='small'\r\n                        title='Connect to relator'\r\n                        onClick={() => this.setState({ ...this.state, ...{ nodeConnecting: element } })}\r\n                    >\r\n                        <Link />\r\n                    </IconButton>\r\n                </NodeActions>\r\n            );\r\n        }\r\n        return <React.Fragment></React.Fragment>;\r\n    }\r\n\r\n    private renderSubsystemActions(subsystem: Subsystem, element: NodeSingular) {\r\n        return <NodeActions placement='bottom'>\r\n            <SubsystemCollapseButton\r\n                node={element}\r\n                subsystem={subsystem}\r\n            />\r\n        </NodeActions>;\r\n    }\r\n\r\n    private tryCreateConnection(source: NodeSingular, target: NodeSingular) {\r\n        const sourceData = source.data();\r\n        const targetData = target.data();\r\n        if (isSystemObjectData(sourceData) && isSystemObjectData(targetData)) {\r\n            // connection goes from role to relator, this is important for hazard population\r\n            if (sourceData.systemObject.type === ObjectTypes.role &&\r\n                targetData.systemObject.type === ObjectTypes.relator\r\n            ) {\r\n                return {\r\n                    id: createObjectId('connection'),\r\n                    source: sourceData.systemObject.id,\r\n                    target: targetData.systemObject.id,\r\n                    label: '',\r\n                    isOriented: false\r\n                };\r\n            }\r\n            // swap ends if ends are wrong\r\n            if (sourceData.systemObject.type === ObjectTypes.relator &&\r\n                targetData.systemObject.type === ObjectTypes.role) {\r\n                return {\r\n                    id: createObjectId('connection'),\r\n                    source: targetData.systemObject.id,\r\n                    target: sourceData.systemObject.id,\r\n                    label: '',\r\n                    isOriented: false\r\n                };\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private startCreatingRelator() {\r\n        if (!this.state.objectEditing) {\r\n            const obj = {\r\n                id: createObjectId(ObjectTypes.relator.toString()),\r\n                name: \"\",\r\n                type: ObjectTypes.relator,\r\n                posX: 0,\r\n                posY: 0\r\n            };\r\n            this.setState({ ...this.state, ...{ objectEditing: obj } });\r\n        }\r\n    };\r\n}\r\n","import React from 'react';\r\nimport { NodeSingular } from 'cytoscape';\r\nimport { IconButton } from '@material-ui/core';\r\nimport { Link } from '@material-ui/icons';\r\n\r\nimport SystemObject from '../../entities/system-description/system-object';\r\nimport Subsystem from '../../entities/system-description/subsystem';\r\nimport { createObjectId } from '../../entities/system-model';\r\nimport { ObjectTypes } from '../../entities/system-description/object-types';\r\nimport SdfStepBase, { StepState } from './sdf-step-base';\r\nimport SubsystemCollapseButton from './subsystem-collapse-button';\r\nimport { getConnection, getSystemObject } from '../../entities/graph/element-utilities';\r\nimport NodeActions from '../graph/node-actions';\r\n\r\nexport default class SdfStep4 extends React.Component<{}, StepState> {\r\n\r\n    constructor(props: Readonly<{}>) {\r\n        super(props);\r\n\r\n        this.tryCreateConnection = this.tryCreateConnection.bind(this);\r\n        this.renderSystemObjectActions = this.renderSystemObjectActions.bind(this);\r\n        this.renderSubsystemActions = this.renderSubsystemActions.bind(this);\r\n\r\n        this.state = {\r\n            nodeConnecting: null,\r\n            objectEditing: null,\r\n            elementDisplayPopper: null\r\n        };\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <SdfStepBase\r\n                elementDisplayPopper={this.state.elementDisplayPopper}\r\n                elementDisplayPopperChanged={(ele) => this.setState({\r\n                    ...this.state, ...{ elementDisplayPopper: ele }\r\n                })}\r\n                nodeConnecting={this.state.nodeConnecting}\r\n                nodeConnectingDone={() => this.setState({ ...this.state, ...{ nodeConnecting: null } })}\r\n                tryCreateConnection={this.tryCreateConnection}\r\n                renderSubsystemActions={this.renderSubsystemActions}\r\n                renderSystemObjectActions={this.renderSystemObjectActions}\r\n            />\r\n        );\r\n    }\r\n\r\n    private renderSystemObjectActions(object: SystemObject, element: NodeSingular) {\r\n        if (object.type !== ObjectTypes.role) {\r\n            return <React.Fragment></React.Fragment>;\r\n        }\r\n\r\n        return (\r\n            <NodeActions placement='top'>\r\n                <IconButton\r\n                    size='small'\r\n                    title='Connect to kind'\r\n                    onClick={() => this.setState({ ...this.state, ...{ nodeConnecting: element } })}\r\n                >\r\n                    <Link />\r\n                </IconButton>\r\n            </NodeActions>\r\n        );\r\n    }\r\n\r\n    private renderSubsystemActions(subsystem: Subsystem, element: NodeSingular) {\r\n        return <NodeActions placement='bottom'>\r\n            <SubsystemCollapseButton\r\n                node={element}\r\n                subsystem={subsystem}\r\n            />\r\n        </NodeActions>;\r\n    }\r\n\r\n    private tryCreateConnection(source: NodeSingular, target: NodeSingular) {\r\n        // in this step we create reversed connection from role to kind\r\n        // still in data model the connection goes from kind to role\r\n        // so there is difference in creating a new connection with handling an existing one\r\n        const existingConnection = source.edgesWith(target);\r\n        if (existingConnection.length > 0) {\r\n            const connection = getConnection(existingConnection[0]);\r\n            if (connection) {\r\n                return connection;\r\n            }\r\n        }\r\n\r\n        const sourceObj = getSystemObject(source);\r\n        const targetObj = getSystemObject(target);\r\n        if (sourceObj && sourceObj.type === ObjectTypes.role &&\r\n            targetObj && targetObj.type === ObjectTypes.kind\r\n        ) {\r\n            return {\r\n                id: createObjectId('connection'),\r\n                source: targetObj.id,\r\n                target: sourceObj.id,\r\n                label: 'play',\r\n                isOriented: true\r\n            };\r\n        }\r\n        return null;\r\n    }\r\n}\r\n","import React from 'react';\r\nimport Hazard from '../../entities/hazard-population/hazard';\r\n\r\ninterface Props {\r\n    hazard: Hazard;\r\n}\r\n\r\nconst HazardId: React.FC<Props> = (props) => {\r\n\r\n    return (\r\n        <React.Fragment>H{props.hazard.id}</React.Fragment>\r\n    );\r\n};\r\n\r\nexport default HazardId;\r\n","import { TableCell, withStyles, createStyles } from '@material-ui/core';\r\n\r\nconst TableCellSmall = withStyles(theme =>\r\n    createStyles({\r\n        sizeSmall: {\r\n            padding: theme.spacing(1)\r\n        }\r\n    })\r\n)(TableCell);\r\n\r\nexport default TableCellSmall;\r\n","import React from 'react';\r\nimport { useState } from 'react';\r\nimport { TableRow, TextField, IconButton } from '@material-ui/core';\r\nimport { Delete, Edit, Save } from '@material-ui/icons';\r\nimport Hazard from '../../entities/hazard-population/hazard';\r\nimport HazardId from './hazard-id';\r\nimport TableCellSmall from '../shared/table-cell-small';\r\n\r\ninterface Props {\r\n    hazard: Hazard;\r\n    hazardEdited: (hazard: Hazard) => void;\r\n    hazardDeleted: (hazard: Hazard) => void;\r\n}\r\n\r\nconst HazardsRow: React.FC<Props> = (props) => {\r\n\r\n    const [isEditable, setIsEditable] = useState(false);\r\n    const [harmTruthmaker, setHarmTruthmaker] = useState(props.hazard.harmTruthmaker);\r\n    const [description, setDescription] = useState(props.hazard.description);\r\n\r\n    const isEmpty = (string: String) => {\r\n        if(!string || string.length === 0) {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    const editHazard = () => {\r\n\r\n        if(!isEmpty(harmTruthmaker) || !isEmpty(description)) {\r\n            if(harmTruthmaker !== props.hazard.harmTruthmaker ||\r\n                description !== props.hazard.description) {\r\n                    const hazard = {\r\n                        ...props.hazard,\r\n                        harmTruthmaker: harmTruthmaker,\r\n                        description: description\r\n                    };\r\n            \r\n                    props.hazardEdited(hazard);\r\n            }\r\n            \r\n\r\n            setIsEditable(false);\r\n        }\r\n    };\r\n\r\n    const deleteHazard = () => {\r\n        setIsEditable(false);\r\n\r\n        props.hazardDeleted(props.hazard);\r\n    };\r\n\r\n    return ( \r\n        <TableRow>\r\n            <TableCellSmall>\r\n                <HazardId hazard={props.hazard} />\r\n            </TableCellSmall>\r\n            <TableCellSmall>\r\n                {props.hazard.mishapVictim.name}\r\n                <br />\r\n                ({props.hazard.mishapVictimEnvObj.name})\r\n            </TableCellSmall>\r\n            <TableCellSmall>{props.hazard.exposure.name}</TableCellSmall>\r\n            <TableCellSmall>\r\n                {props.hazard.hazardElement.name}\r\n                <br />\r\n                ({props.hazard.hazardElementEnvObj.name})\r\n            </TableCellSmall>\r\n            <TableCellSmall>\r\n                {isEditable\r\n                ? <TextField\r\n                required\r\n                autoFocus\r\n                defaultValue={props.hazard.harmTruthmaker}\r\n                margin='none'\r\n                type='text'\r\n                onChange={(ev) => setHarmTruthmaker(ev.target.value)}\r\n                error={isEmpty(harmTruthmaker)}\r\n                helperText={isEmpty(harmTruthmaker) ? 'Required field' : ' '}\r\n                autoComplete='off'\r\n                />\r\n                : props.hazard.harmTruthmaker}\r\n            </TableCellSmall>\r\n            <TableCellSmall>\r\n                {isEditable\r\n                ? <TextField\r\n                required\r\n                defaultValue={props.hazard.description}\r\n                margin='none'\r\n                fullWidth\r\n                type='text'\r\n                onChange={(ev) => setDescription(ev.target.value)}\r\n                error={isEmpty(description)}\r\n                helperText={isEmpty(description) ? 'Required field' : ' '}\r\n                autoComplete='off'\r\n                />\r\n                : props.hazard.description}\r\n            </TableCellSmall>\r\n            <TableCellSmall>\r\n                {isEditable \r\n                ? <IconButton size='small' onClick={() => editHazard()}><Save /></IconButton>\r\n                : <IconButton size='small' onClick={() => setIsEditable(true)}><Edit /></IconButton>\r\n                }\r\n                <IconButton\r\n                    size='small'\r\n                    onClick={deleteHazard}\r\n                >\r\n                    <Delete />\r\n                </IconButton>\r\n            </TableCellSmall>\r\n        </TableRow>\r\n    );\r\n};\r\n\r\nexport default HazardsRow;","import React from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { TableContainer, Table, TableRow, TableCell, TableBody, TableHead, makeStyles } from '@material-ui/core';\r\nimport HazardsRow from './hazard-row';\r\nimport { RootState } from '../../store';\r\nimport { updateHazard, deleteHazard } from '../../store/system-model/actions';\r\nimport { MishapVictim } from '../../entities/system-description/role';\r\nimport TableCellSmall from '../shared/table-cell-small';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    hazards: state.systemModel.hazards\r\n})\r\n\r\nconst mapDispatch = {\r\n    hazardEdited: updateHazard,\r\n    hazardDeleted: deleteHazard\r\n}\r\n\r\nconst connector = connect(mapState, mapDispatch);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>\r\n\r\ntype Props = PropsFromRedux & {\r\n    selectedMishapVictim?: MishapVictim\r\n}\r\n\r\nconst useStyles = makeStyles(() => ({\r\n    id: {\r\n        width: '7%'\r\n    },\r\n    mishapVictim: {\r\n        width: '15%'\r\n    },\r\n    exposure: {\r\n        width: '10%'\r\n    },\r\n    hazardElement: {\r\n        width: '15%'\r\n    },\r\n    harmTruthmaker: {\r\n        width: '15%'\r\n    },\r\n    actions: {\r\n        width: '10%'\r\n    }\r\n}));\r\n\r\n\r\nconst HazardsTable: React.FC<Props> = (props) => {\r\n    const classes = useStyles();\r\n\r\n    let hazards = props.hazards;\r\n    const mishapVictim = props.selectedMishapVictim;\r\n    if (mishapVictim) {\r\n        hazards = hazards.filter(e => e.mishapVictim.id === mishapVictim.id);\r\n    }\r\n\r\n    return (\r\n        <TableContainer>\r\n            <Table size='small'>\r\n                <TableHead>\r\n                    <TableRow>\r\n                        <TableCellSmall className={classes.id}>\r\n                            ID\r\n                        </TableCellSmall>\r\n                        <TableCellSmall className={classes.mishapVictim}>\r\n                            Mishap Victim<br />(Env Obj)\r\n                        </TableCellSmall>\r\n                        <TableCellSmall className={classes.exposure}>\r\n                            Exposure\r\n                        </TableCellSmall>\r\n                        <TableCellSmall className={classes.hazardElement}>\r\n                            Hazard Element<br />(Env Obj)\r\n                        </TableCellSmall>\r\n                        <TableCellSmall className={classes.harmTruthmaker}>\r\n                            Harm TruthMaker\r\n                        </TableCellSmall>\r\n                        <TableCellSmall>\r\n                            Hazard Description\r\n                        </TableCellSmall>\r\n                        <TableCellSmall className={classes.actions} />\r\n                    </TableRow>\r\n                </TableHead>\r\n                <TableBody>\r\n                    {hazards.length === 0 ?\r\n                        <TableRow>\r\n                            <TableCell colSpan={7} align='center'>\r\n                                No hazards identified\r\n                            </TableCell>\r\n                        </TableRow>\r\n                        :\r\n                        hazards\r\n                            .sort((a, b) => a.id - b.id)\r\n                            .map((hazard, index) => (\r\n                                <HazardsRow \r\n                                    hazard={hazard}\r\n                                    key={index}\r\n                                    hazardEdited={props.hazardEdited}\r\n                                    hazardDeleted={props.hazardDeleted}\r\n                                />\r\n                            ))\r\n                    }\r\n                </TableBody>\r\n            </Table>\r\n        </TableContainer>\r\n    );\r\n};\r\n\r\nexport default connector(HazardsTable);\r\n","import React, { useState } from 'react';\r\nimport { MenuItem, TableRow, TableCell, FormControl, Select, InputLabel, TextField, IconButton, makeStyles } from '@material-ui/core';\r\nimport { Add } from '@material-ui/icons';\r\nimport { PossibleHazard } from '../../entities/hazard-population/possible-hazard';\r\nimport Hazard from '../../entities/hazard-population/hazard';\r\n\r\ninterface Props {\r\n    template: PossibleHazard;\r\n    nextHazardId: number;\r\n    hazardCreated: (hazard: Hazard) => void;\r\n}\r\n\r\nconst useStyle = makeStyles((theme) => ({\r\n    divide: {\r\n        paddingRight: theme.appSpacing.standard\r\n    },\r\n    select: {\r\n        width: '220px'\r\n    }\r\n}));\r\n\r\nconst HazardCreateDetails: React.FC<Props> = (props) => {\r\n    const classes = useStyle();\r\n\r\n    let hazardElementEnvObj = '';\r\n    if (props.template.hazardElementEnvObjs.length === 1) {\r\n        hazardElementEnvObj = props.template.hazardElementEnvObjs[0].object.id;\r\n    }\r\n    const [envObj, setEnvObj] = useState(hazardElementEnvObj);\r\n    const [harmTruthmaker, setHarmTruthmaker] = useState('');\r\n    const [description, setDescription] = useState('');\r\n\r\n    const createHazard = (ev: React.FormEvent<HTMLFormElement>) => {\r\n        const form = ev.currentTarget;\r\n        form.reset();\r\n        ev.preventDefault();\r\n        const hazardElementEnvObj = props.template.hazardElementEnvObjs\r\n            .find(e => e.object.id === envObj);\r\n        if (!hazardElementEnvObj) {\r\n            return;\r\n        }\r\n\r\n        const hazard = {\r\n            id: props.nextHazardId,\r\n            harmTruthmaker,\r\n            description,\r\n            mishapVictim: {\r\n                id: props.template.mishapVictim.id,\r\n                name: props.template.mishapVictim.name\r\n            },\r\n            mishapVictimEnvObj: {\r\n                id: props.template.mishapVictimEnvObj.object.id,\r\n                name: props.template.mishapVictimEnvObj.object.name\r\n            },\r\n            exposure: {\r\n                id: props.template.exposure.object.id,\r\n                name: props.template.exposure.object.name\r\n            },\r\n            hazardElement: {\r\n                id: props.template.hazardElement.object.id,\r\n                name: props.template.hazardElement.object.name\r\n            },\r\n            hazardElementEnvObj: {\r\n                id: hazardElementEnvObj.object.id,\r\n                name: hazardElementEnvObj.object.name\r\n            }\r\n        };\r\n        props.hazardCreated(hazard);\r\n    };\r\n\r\n    let selectOptions = props.template.hazardElementEnvObjs\r\n        .sort((a, b) => a.object.name.localeCompare(b.object.name))\r\n        .map((item, index) => (\r\n            <MenuItem key={index} value={item.object.id}>\r\n                {item.object.name}\r\n            </MenuItem>));\r\n    if (props.template.hazardElementEnvObjs.length === 0) {\r\n        selectOptions = [(<MenuItem key={-1} value='' disabled>Nothing found</MenuItem>)];\r\n    }\r\n\r\n    return (\r\n        <TableRow>\r\n            <TableCell colSpan={3}>\r\n                <form action='#' onSubmit={createHazard}>\r\n                    <FormControl className={classes.divide}>\r\n                        <TextField\r\n                            required\r\n                            autoFocus\r\n                            margin='none'\r\n                            type='text'\r\n                            onChange={(ev) => setHarmTruthmaker(ev.target.value)}\r\n                            label='Harm Truthmaker'\r\n                            autoComplete='off'\r\n                            multiline\r\n                            rowsMax={4}\r\n                        />\r\n                    </FormControl>\r\n                    <FormControl className={classes.divide}>\r\n                        <TextField\r\n                            required\r\n                            margin='none'\r\n                            type='text'\r\n                            onChange={(ev) => setDescription(ev.target.value)}\r\n                            label='Hazard Description'\r\n                            autoComplete='off'\r\n                            multiline\r\n                            rowsMax={4}\r\n                        />\r\n                    </FormControl>\r\n                    <FormControl className={classes.select}>\r\n                        <InputLabel id='label-select-env-obj'>\r\n                            Hazard Evement Env Obj\r\n                            </InputLabel>\r\n                        <Select\r\n                            required\r\n                            margin='none'\r\n                            labelId='label-select-env-obj'\r\n                            value={hazardElementEnvObj}\r\n                            onChange={(ev) => setEnvObj(ev.target.value as string)}\r\n                        >\r\n                            {selectOptions}\r\n                        </Select>\r\n                    </FormControl>\r\n                    <IconButton type='submit' edge='end' title='Create'>\r\n                        <Add />\r\n                    </IconButton>\r\n                </form>\r\n            </TableCell>\r\n        </TableRow>\r\n    );\r\n};\r\n\r\nexport default HazardCreateDetails;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { TableRow, TableCell, TableContainer, Table, TableHead, TableBody, withStyles, createStyles, Theme, Grid, Typography, makeStyles } from '@material-ui/core';\r\nimport { NodeSingular, EdgeSingular, SingularElementReturnValue } from 'cytoscape';\r\n\r\nimport { PossibleHazard, ConnectionToObject } from '../../entities/hazard-population/possible-hazard';\r\nimport HazardCreateDetails from './hazard-create-details';\r\nimport { getRole, getSystemObject, getConnection } from '../../entities/graph/element-utilities';\r\nimport { isMishapVictim, MishapVictim } from '../../entities/system-description/role';\r\nimport { RootState } from '../../store';\r\nimport { createHazard } from '../../store/system-model/actions';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    nextHazardId: state.systemModel.nextHazardId\r\n})\r\n\r\nconst mapDispatch = {\r\n    hazardCreated: createHazard,\r\n}\r\n\r\nconst connector = connect(mapState, mapDispatch);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>\r\n\r\ntype Props = PropsFromRedux & {\r\n    node: NodeSingular\r\n}\r\n\r\nconst StyledTableRow = withStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            backgroundColor: theme.palette.grey[200],\r\n            cursor: 'pointer'\r\n        }\r\n    })\r\n)(TableRow);\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    header: {\r\n        marginLeft: theme.appSpacing.standard\r\n    }\r\n}));\r\n\r\n\r\nconst HazardCreate: React.FC<Props> = (props) => {\r\n\r\n    const classes = useStyles();\r\n\r\n    const [template, setTemplate] = useState<PossibleHazard | null>(null);\r\n    const [possibleHazards, setPossibleHazards] = useState<PossibleHazard[]>([]);\r\n\r\n    useEffect(() => {\r\n        const mishapVictim = getRole(props.node);\r\n        if (!mishapVictim || !isMishapVictim(mishapVictim)) {\r\n            throw new Error('Entity passed is not a mishap victim');\r\n        }\r\n\r\n        const findPossibleHazards = (mishapVictim: MishapVictim) => {\r\n            let result: PossibleHazard[] = [];\r\n            const victimKinds = props.node.incomers();\r\n            const relators = props.node.outgoers();\r\n            const hazardRoles = relators.incomers();\r\n\r\n            const hazardElementsEnvObjs: ConnectionToObject[] = [];\r\n            const hazardKinds = hazardRoles.incomers();\r\n            for (let i = 0; i < hazardKinds.length; i++) {\r\n                const envObj = getEntityPair(hazardKinds[i], true);\r\n                if (envObj) {\r\n                    hazardElementsEnvObjs.push(envObj);\r\n                }\r\n            }\r\n\r\n            for (let i = 0; i < victimKinds.length; i++) {\r\n                const mishapVictimEnvObj = getEntityPair(victimKinds[i], true);\r\n                if (!mishapVictimEnvObj) {\r\n                    continue;\r\n                }\r\n                for (let j = 0; j < relators.length; j++) {\r\n                    const exposure = getEntityPair(relators[j], false);\r\n                    if (!exposure) {\r\n                        continue;\r\n                    }\r\n                    for (let k = 0; k < hazardRoles.length; k++) {\r\n                        const hazardElement = getEntityPair(hazardRoles[k], true);\r\n                        if (!hazardElement) {\r\n                            continue;\r\n                        }\r\n                        result.push({\r\n                            mishapVictim,\r\n                            mishapVictimEnvObj,\r\n                            exposure,\r\n                            hazardElement,\r\n                            hazardElementEnvObjs: hazardElementsEnvObjs\r\n                                .filter(e => e.connection.target === hazardElement.object.id)\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n            return result;\r\n        };\r\n\r\n        const getEntityPair = (\r\n            ele: SingularElementReturnValue | (NodeSingular & EdgeSingular),\r\n            takeSource: boolean\r\n        ) => {\r\n            if (ele.isEdge()) {\r\n                const node = takeSource ? ele.source() : ele.target();\r\n                const object = getSystemObject(node);\r\n                const connection = getConnection(ele);\r\n                if (object && connection) {\r\n                    return { object, connection };\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        setPossibleHazards(findPossibleHazards(mishapVictim));\r\n    }, [props.node]);\r\n\r\n    const renderDetailsForm = (possibleHazard: PossibleHazard) => {\r\n        if (template !== possibleHazard) {\r\n            return <React.Fragment></React.Fragment>;\r\n        }\r\n\r\n        return (\r\n            <HazardCreateDetails\r\n                template={template}\r\n                nextHazardId={props.nextHazardId}\r\n                hazardCreated={props.hazardCreated}\r\n            />\r\n        );\r\n    }\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <Grid container>\r\n                <Grid item xs={12}>\r\n                    <Typography variant='caption' className={classes.header}>\r\n                        Select a table row to add\r\n                    </Typography>\r\n                </Grid>\r\n            </Grid>\r\n            <TableContainer>\r\n                <Table size='small'>\r\n                    <TableHead>\r\n                        <TableRow>\r\n                            <TableCell>Mishap Victim (Env Obj)</TableCell>\r\n                            <TableCell>Exposure</TableCell>\r\n                            <TableCell>Hazard Element</TableCell>\r\n                        </TableRow>\r\n                    </TableHead>\r\n                    <TableBody>\r\n                        {possibleHazards.length === 0 ?\r\n                            <TableRow>\r\n                                <TableCell colSpan={3} align='center'>\r\n                                    No possible hazards found\r\n                            </TableCell>\r\n                            </TableRow>\r\n                            :\r\n                            possibleHazards.map((hazard, index) => (\r\n                                <React.Fragment key={index}>\r\n                                    <StyledTableRow onClick={() => setTemplate(hazard)} >\r\n                                        <TableCell>\r\n                                            {hazard.mishapVictim.name} ({hazard.mishapVictimEnvObj.object.name})\r\n                                        </TableCell>\r\n                                        <TableCell>\r\n                                            {hazard.exposure.object.name}\r\n                                        </TableCell>\r\n                                        <TableCell>\r\n                                            {hazard.hazardElement.object.name}\r\n                                        </TableCell>\r\n                                    </StyledTableRow>\r\n                                    {renderDetailsForm(hazard)}\r\n                                </React.Fragment>\r\n                            ))\r\n                        }\r\n                    </TableBody>\r\n                </Table>\r\n            </TableContainer>\r\n        </React.Fragment>\r\n    );\r\n};\r\n\r\nexport default connector(HazardCreate);\r\n","import React from 'react';\r\nimport { makeStyles, Typography } from '@material-ui/core';\r\nimport { NodeSingular } from 'cytoscape';\r\n\r\nimport { isMishapVictim } from '../../entities/system-description/role';\r\nimport { getRole } from '../../entities/graph/element-utilities';\r\nimport HazardsTable from './hazards-table';\r\nimport HazardCreate from './hazard-create';\r\nimport CornerFab from '../shared/corner-fab';\r\n\r\ninterface Props {\r\n    node: NodeSingular;\r\n    close: () => void;\r\n}\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    header: {\r\n        marginLeft: theme.appSpacing.standard\r\n    },\r\n    tableGutter: {\r\n        marginBottom: theme.appSpacing.standard\r\n    }\r\n}));\r\n\r\nconst VictimHazards: React.FC<Props> = (props) => {\r\n    const classes = useStyles();\r\n\r\n    const mishapVictim = getRole(props.node);\r\n    if (!mishapVictim || !isMishapVictim(mishapVictim)) {\r\n        throw new Error('Entity passed is not a mishap victim');\r\n    }\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <Typography variant=\"h6\" color=\"textSecondary\" className={classes.header}>\r\n                Possible Harms\r\n            </Typography>\r\n            <Typography variant=\"body1\" className={classes.header} gutterBottom>\r\n                {mishapVictim.possibleHarms.join(', ')}\r\n            </Typography>\r\n            <Typography variant=\"h6\" color=\"textSecondary\" className={classes.header}>\r\n                Hazards\r\n            </Typography>\r\n            <HazardsTable selectedMishapVictim={mishapVictim} />\r\n            <div className={classes.tableGutter}></div>\r\n            <Typography variant='h6' color='textSecondary' className={classes.header}>\r\n                Add New Hazard\r\n            </Typography>\r\n            <HazardCreate node={props.node} />\r\n            <CornerFab separated onClick={props.close} >\r\n                Back\r\n            </CornerFab>\r\n        </React.Fragment>\r\n    );\r\n};\r\n\r\nexport default VictimHazards;\r\n","import React, { useState } from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { EventObject, NodeSingular } from 'cytoscape';\r\nimport { Typography } from '@material-ui/core';\r\n\r\nimport GraphElementsFactoryMishapVictims from '../../entities/graph/graph-elements-factory-mishap-victims';\r\nimport Graph from '../graph/graph';\r\nimport { isMishapVictim } from '../../entities/system-description/role';\r\nimport CornerCard from '../shared/corner-card';\r\nimport { getRole } from '../../entities/graph/element-utilities';\r\nimport { RootState } from '../../store';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    system: state.systemModel\r\n})\r\n\r\nconst connector = connect(mapState);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>\r\n\r\ntype Props = PropsFromRedux & {\r\n    victimSelected: (node: NodeSingular) => void;\r\n}\r\n\r\nconst GraphView: React.FC<Props> = (props) => {\r\n\r\n    const [isVictimPointed, setIsVictimPointed] = useState(false);\r\n\r\n    const getMishapVictimFromEvent = (event: EventObject) => {\r\n        const ele: NodeSingular = event.target.element();\r\n        const role = getRole(ele);\r\n        if (role && isMishapVictim(role)) {\r\n            return role;\r\n        }\r\n    }\r\n\r\n    const checkVictimPointed = (event: EventObject) => {\r\n        setIsVictimPointed(!!getMishapVictimFromEvent(event));\r\n    }\r\n\r\n    const selectVictim = (event: EventObject) => {\r\n        const mishapVictim = getMishapVictimFromEvent(event);\r\n        if (mishapVictim) {\r\n            props.victimSelected(event.target);\r\n        }\r\n    };\r\n\r\n    const elementsFactory = new GraphElementsFactoryMishapVictims();\r\n    const elements = elementsFactory.mapSystemDescription(props.system);\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <Graph\r\n                elements={elements}\r\n                cursorStyle={isVictimPointed ? 'pointer' : 'default'}\r\n                mouseEnteredNode={checkVictimPointed}\r\n                mouseLeftNode={checkVictimPointed}\r\n                nodeClicked={selectVictim}\r\n            />\r\n            <CornerCard>\r\n                <Typography>\r\n                    Click on a mishap victim to populate hazards\r\n                </Typography>\r\n                <Typography variant='caption'>\r\n                    Mishap victims are marked yellow\r\n                </Typography>\r\n            </CornerCard>\r\n        </React.Fragment>\r\n    );\r\n};\r\n\r\nexport default connector(GraphView);\r\n","import cytoscape, { Core, ElementDefinition } from 'cytoscape';\r\nimport { SystemDescription } from '../system-model';\r\nimport GraphElementsFactory from './graph-elements-factory';\r\n\r\nexport class HeadlessGraph {\r\n\r\n    private readonly _cy: Core;\r\n\r\n    public get cy(): Core {\r\n        return this._cy;\r\n    };\r\n\r\n    constructor(system: SystemDescription) {\r\n        const elements = new GraphElementsFactory().mapSystemDescription(system) as ElementDefinition[];\r\n        this._cy = cytoscape({ elements, headless: true });\r\n    }\r\n};\r\n","import React, { useState, useRef } from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { makeStyles, Typography, FormControl, InputLabel, Select, MenuItem } from '@material-ui/core';\r\n\r\nimport HazardsTable from './hazards-table';\r\nimport { NodeSingular } from 'cytoscape';\r\nimport { isMishapVictim } from '../../entities/system-description/role';\r\nimport HazardCreate from './hazard-create';\r\nimport { RootState } from '../../store';\r\nimport { HeadlessGraph } from '../../entities/graph/headless-graph';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    mishapVictims: state.systemModel.roles.filter(e => isMishapVictim(e)),\r\n    systemModel: state.systemModel\r\n})\r\n\r\nconst connector = connect(mapState);\r\n\r\ntype Props = ConnectedProps<typeof connector>\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    header: {\r\n        marginLeft: theme.appSpacing.standard\r\n    },\r\n    tableGutter: {\r\n        marginBottom: theme.appSpacing.standard\r\n    },\r\n    select: {\r\n        marginLeft: theme.appSpacing.standard,\r\n        width: '220px'\r\n    }\r\n}));\r\n\r\nconst TableView: React.FC<Props> = (props: Props) => {\r\n    const classes = useStyles();\r\n\r\n    const [mishapVictimId, setMishapVictimId] = useState('');\r\n    const [mishapVictimNode, setMishapVictimNode] = useState<NodeSingular | null>(null);\r\n    const headlessGraph = useRef<HeadlessGraph>();\r\n\r\n    const selectMishapVictim = (ev: React.ChangeEvent<{ value: unknown }>) => {\r\n        const id = ev.target.value as string;\r\n        if (!headlessGraph.current) {\r\n            headlessGraph.current = new HeadlessGraph(props.systemModel);\r\n        }\r\n\r\n        const node = headlessGraph.current.cy.$(`#${id}`);\r\n        if (!node || !node.isNode()) {\r\n            throw new Error(`Node with id ${id} not found`);\r\n        }\r\n\r\n        setMishapVictimId(id);\r\n        setMishapVictimNode(node);\r\n    };\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <Typography variant=\"h6\" color=\"textSecondary\" className={classes.header}>\r\n                Hazards\r\n            </Typography>\r\n            <HazardsTable />\r\n            <div className={classes.tableGutter}></div>\r\n            <Typography variant='h6' color='textSecondary' className={classes.header}>\r\n                Add New Hazard\r\n            </Typography>\r\n            <FormControl className={classes.select}>\r\n                <InputLabel id='label-select-mishap-victim'>\r\n                    Select mishap victim\r\n                </InputLabel>\r\n                <Select\r\n                    margin='none'\r\n                    labelId='label-select-mishap-victim'\r\n                    onChange={selectMishapVictim}\r\n                    value={mishapVictimId}\r\n                >\r\n                    {props.mishapVictims\r\n                        .sort((a, b) => a.name.localeCompare(b.name))\r\n                        .map((item, index) => (\r\n                            <MenuItem key={index} value={item.id}>\r\n                                {item.name}\r\n                            </MenuItem>))}\r\n                </Select>\r\n            </FormControl>\r\n            {mishapVictimNode ?\r\n                <HazardCreate node={mishapVictimNode} />\r\n                :\r\n                undefined\r\n            }\r\n        </React.Fragment>\r\n    );\r\n};\r\n\r\nexport default connector(TableView);\r\n","import React, { useState } from 'react';\r\nimport { NodeSingular } from 'cytoscape';\r\n\r\nimport VictimHazards from './victim-hazards';\r\nimport GraphView from './graph-view';\r\nimport TableView from './table-view';\r\nimport { getSystemObject } from '../../entities/graph/element-utilities';\r\nimport CornerFab from '../shared/corner-fab';\r\nimport { TableChart, BubbleChart } from '@material-ui/icons';\r\n\r\nconst HazardPopulation: React.FC = () => {\r\n\r\n    const [isSummarySelected, setIsSummarySelected] = useState(false);\r\n    const [selectedVictim, setSelectedVictim] = useState<NodeSingular | null>(null);\r\n\r\n    if (selectedVictim) {\r\n        const mishapVictim = getSystemObject(selectedVictim);\r\n        if (!mishapVictim) {\r\n            throw new Error('Selected node does not represent a mishap victim');\r\n        }\r\n        return <VictimHazards\r\n            node={selectedVictim}\r\n            close={() => setSelectedVictim(null)}\r\n        />;\r\n    }\r\n\r\n    if (isSummarySelected) {\r\n        return (\r\n            <React.Fragment>\r\n                <TableView />\r\n                <CornerFab separated={true} onClick={() => setIsSummarySelected(false)}>\r\n                    <BubbleChart />\r\n                    Graph View\r\n                </CornerFab>\r\n            </React.Fragment>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <GraphView victimSelected={setSelectedVictim} />\r\n            <CornerFab onClick={() => setIsSummarySelected(true)}>\r\n                <TableChart />\r\n                Table View\r\n            </CornerFab>\r\n        </React.Fragment>\r\n    );\r\n};\r\n\r\nexport default HazardPopulation;\r\n","import React, { useState } from 'react';\r\nimport Hazard from '../../../entities/hazard-population/hazard';\r\nimport { TableRow, TableCell, Button } from '@material-ui/core';\r\nimport HazardId from '../../hazard-population/hazard-id';\r\nimport { HazardCategory } from '../../../entities/hazard-description-categorization/hazard-category';\r\nimport CategorizationWizard from './categorization-wizard';\r\n\r\ninterface Props {\r\n    hazard: Hazard;\r\n    hazardUpdated: (hazard: Hazard) => void;\r\n}\r\n\r\nconst OchStep1TableRow: React.FC<Props> = (props) => {\r\n\r\n    const [isCategorizing, setIsCategorizing] = useState(false);\r\n\r\n    const updateCategory = (category: HazardCategory) => {\r\n        setIsCategorizing(false);\r\n        props.hazardUpdated({ ...props.hazard, ...{ category: category } });\r\n    };\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <HazardId hazard={props.hazard} />\r\n                </TableCell>\r\n                <TableCell>{props.hazard.description}</TableCell>\r\n                <TableCell>\r\n                    {props.hazard.category ? props.hazard.category : '-'}\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Button variant='outlined' onClick={() => setIsCategorizing(true)}>\r\n                        Categorize\r\n                    </Button>\r\n                </TableCell>\r\n            </TableRow>\r\n            {isCategorizing ? \r\n                <TableRow>\r\n                    <TableCell colSpan={4}>\r\n                        <CategorizationWizard\r\n                            cancel={() => setIsCategorizing(false)}\r\n                            complete={updateCategory}\r\n                        />\r\n                    </TableCell>\r\n                </TableRow>\r\n                :\r\n                undefined}\r\n        </React.Fragment>\r\n    );\r\n};\r\n\r\nexport default OchStep1TableRow;\r\n","import React from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { TableContainer, TableBody, TableRow, Table, TableHead, TableCell } from '@material-ui/core';\r\nimport OchStep1TableRow from './table-row';\r\nimport { RootState } from '../../../store';\r\nimport { updateHazard } from '../../../store/system-model/actions';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    hazards: state.systemModel.hazards\r\n});\r\n\r\nconst mapDispatch = {\r\n    hazardUpdated: updateHazard\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatch);\r\n\r\ntype Props = ConnectedProps<typeof connector>\r\n\r\nconst OchStep1: React.FC<Props> = (props) => {\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <TableContainer>\r\n                <Table size='small'>\r\n                    <TableHead>\r\n                        <TableRow>\r\n                            <TableCell>\r\n                                ID\r\n                             </TableCell>\r\n                            <TableCell>\r\n                                Hazard Description\r\n                             </TableCell>\r\n                            <TableCell>\r\n                                Category\r\n                             </TableCell>\r\n                            <TableCell />\r\n                        </TableRow>\r\n                    </TableHead>\r\n                    <TableBody>\r\n                        {props.hazards.length === 0 ?\r\n                            <TableRow>\r\n                                <TableCell colSpan={4} align='center'>\r\n                                    No hazards identified\r\n                                </TableCell>\r\n                            </TableRow>\r\n                            :\r\n                            props.hazards.map((hazard, index) => (\r\n                                <OchStep1TableRow\r\n                                    key={index}\r\n                                    hazard={hazard}\r\n                                    hazardUpdated={props.hazardUpdated}\r\n                                />\r\n                            ))\r\n                        }\r\n                    </TableBody>\r\n                </Table>\r\n            </TableContainer>\r\n        </React.Fragment>\r\n    );\r\n};\r\n\r\nexport default connector(OchStep1);\r\n","import React from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { TableContainer, TableBody, TableRow, Table, TableHead, TableCell, Button } from '@material-ui/core';\r\nimport { RootState } from '../../../store';\r\nimport HazardId from '../../hazard-population/hazard-id';\r\nimport Hazard from '../../../entities/hazard-population/hazard';\r\nimport { Check } from '@material-ui/icons';\r\n\r\nconst mapState = (state: RootState) => ({\r\n    hazards: state.systemModel.hazards\r\n});\r\n\r\nconst connector = connect(mapState);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>\r\n\r\ntype Props = PropsFromRedux & {\r\n    hazardSelected: (hazard: Hazard) => void;\r\n}\r\n\r\nconst HazardsList: React.FC<Props> = (props) => {\r\n\r\n    const hazards = props.hazards.filter(e => e.category);\r\n\r\n    return (\r\n        <TableContainer>\r\n            <Table size='small'>\r\n                <TableHead>\r\n                    <TableRow>\r\n                        <TableCell>\r\n                            ID\r\n                        </TableCell>\r\n                        <TableCell>\r\n                            Hazard Description\r\n                        </TableCell>\r\n                        <TableCell>\r\n                            Category\r\n                        </TableCell>\r\n                        <TableCell>\r\n                            Expanded\r\n                        </TableCell>\r\n                        <TableCell />\r\n                    </TableRow>\r\n                </TableHead>\r\n                <TableBody>\r\n                    {hazards.length === 0 ?\r\n                        <TableRow>\r\n                            <TableCell colSpan={5} align='center'>\r\n                                No hazards categorized\r\n                                </TableCell>\r\n                        </TableRow>\r\n                        :\r\n                        hazards.map((hazard, index) => (\r\n                            <TableRow key={index}>\r\n                                <TableCell>\r\n                                    <HazardId hazard={hazard} />\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    {hazard.description}\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    {hazard.category}\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    {hazard.expansion ? <Check /> : '-'}\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    <Button\r\n                                        variant='outlined'\r\n                                        onClick={() => props.hazardSelected(hazard)}\r\n                                    >\r\n                                        Expand\r\n                                    </Button>\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        ))\r\n                    }\r\n                </TableBody>\r\n            </Table>\r\n        </TableContainer>);\r\n};\r\n\r\nexport default connector(HazardsList);\r\n","import React, { useRef, useEffect, useState } from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux';\r\nimport { RootState } from '../../../store';\r\nimport CornerFab from '../../shared/corner-fab';\r\nimport Hazard from '../../../entities/hazard-population/hazard';\r\nimport { HeadlessGraph } from '../../../entities/graph/headless-graph';\r\nimport { SystemDescriptionEntity } from '../../../entities/system-description/system-description-entity';\r\nimport { getSystemObject, getConnection } from '../../../entities/graph/element-utilities';\r\nimport Graph from '../../graph/graph';\r\nimport GraphElementsFactory from '../../../entities/graph/graph-elements-factory';\r\n\r\n\r\nconst mapState = (state: RootState) => ({\r\n    systemModel: state.systemModel\r\n});\r\n\r\nconst mapDispatch = {\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatch);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>\r\n\r\ntype Props = PropsFromRedux & {\r\n    selectedHazard: Hazard;\r\n    onClose: () => void;\r\n}\r\n\r\nconst ExpansionGraph: React.FC<Props> = (props) => {\r\n\r\n    const headlessGraph = useRef<HeadlessGraph>();\r\n    const [expansionMembers, setExpansionMembers] = useState<SystemDescriptionEntity[]>([]);\r\n\r\n    useEffect(() => {\r\n        headlessGraph.current = new HeadlessGraph(props.systemModel);\r\n\r\n        const hazardNodesSelector = `#${props.selectedHazard.exposure.id},` +\r\n            `#${props.selectedHazard.hazardElement.id},` + \r\n            `#${props.selectedHazard.hazardElementEnvObj.id},` + \r\n            `#${props.selectedHazard.mishapVictim.id},` + \r\n            `#${props.selectedHazard.mishapVictimEnvObj.id}`;\r\n        const hazardNodes = headlessGraph.current.cy.nodes(hazardNodesSelector);\r\n        const hazardEdges = hazardNodes.edgesWith(hazardNodes);\r\n\r\n        const hazardSystemObjects = hazardNodes.map(getSystemObject) as SystemDescriptionEntity[];\r\n        const hazardConnections = hazardEdges.map(getConnection) as SystemDescriptionEntity[];\r\n\r\n        setExpansionMembers(hazardSystemObjects.concat(hazardConnections));\r\n\r\n    }, [props.systemModel, props.selectedHazard]);\r\n\r\n    const elements = new GraphElementsFactory().mapSystemDescriptionEntities(expansionMembers);\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <Graph\r\n                cursorStyle={'default'}\r\n                elements={elements}\r\n                mouseEnteredNode={() => { }}\r\n                mouseLeftNode={() => { }}\r\n                nodeClicked={() => { }}\r\n                graphClicked={() => { }}\r\n            />\r\n            <CornerFab onClick={props.onClose}>\r\n                Back\r\n            </CornerFab>\r\n        </React.Fragment>\r\n    );\r\n};\r\n\r\nexport default connector(ExpansionGraph);\r\n","import React, { useState } from 'react';\r\nimport Hazard from '../../../entities/hazard-population/hazard';\r\nimport HazardsList from './hazards-list';\r\nimport ExpansionGraph from './expansion-graph';\r\n\r\nconst OchStep2: React.FC = () => {\r\n\r\n    const [selectedHazard, setSelectedHazard] = useState<Hazard | null>(null);\r\n\r\n    if (selectedHazard) {\r\n        return <ExpansionGraph\r\n            selectedHazard={selectedHazard}\r\n            onClose={() => setSelectedHazard(null)}\r\n        />\r\n    }\r\n\r\n    return <HazardsList hazardSelected={setSelectedHazard} />;\r\n};\r\n\r\nexport default OchStep2;\r\n","import React from 'react';\r\nimport { useBeforeunload } from 'react-beforeunload';\r\nimport 'typeface-roboto';\r\nimport CssBaseline from '@material-ui/core/CssBaseline';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport { Toolbar, AppBar, Grid, Drawer } from '@material-ui/core';\r\nimport { connect, ConnectedProps } from 'react-redux'\r\n\r\nimport ErrorBoundary from './components/error-boundary';\r\nimport Meny from './components/meny/meny';\r\nimport ProgressSteps from './components/meny/progress-steps';\r\nimport ProjectName from './components/project-name';\r\nimport { RootState } from './store';\r\nimport ConfirmationDialog from './components/confirmation-dialog';\r\nimport { FlowStepId } from './entities/meny/flow-step-id';\r\n\r\nimport MishapVictimIdentification from './components/mishap-victim-identification/mishap-victim-identification';\r\nimport SdfStep1 from './components/system-description/sdf-step-1';\r\nimport SdfStep2 from './components/system-description/sdf-step-2';\r\nimport SdfStep3 from './components/system-description/sdf-step-3';\r\nimport SdfStep4 from './components/system-description/sdf-step-4';\r\nimport HazardPopulation from './components/hazard-population/hazard-population';\r\nimport OchStep1 from './components/causes-identification/och-step-1/och-step-1';\r\nimport OchStep2 from './components/causes-identification/och-step-2/och-step-2';\r\n\r\nconst drawerWidth = 240;\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    root: {\r\n        display: 'flex',\r\n    },\r\n    appBar: {\r\n        zIndex: theme.zIndex.drawer + 1,\r\n    },\r\n    drawerOpen: {\r\n        width: drawerWidth,\r\n    },\r\n    toolbar: {\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        justifyContent: 'flex-end',\r\n        padding: theme.spacing(0, 1),\r\n        ...theme.mixins.toolbar,\r\n    },\r\n    content: {\r\n        flexGrow: 1,\r\n    },\r\n    appTitle: {\r\n        textAlign: 'center'\r\n    },\r\n}));\r\n\r\nconst mapState = (state: RootState) => ({\r\n    currentStep: state.systemModel.currentStep,\r\n    hasUnsavedChanges: state.unsavedChanges\r\n})\r\n\r\nconst connector = connect(mapState);\r\n\r\ntype Props = ConnectedProps<typeof connector>\r\n\r\nconst App: React.FC<Props> = (props) => {\r\n\r\n    useBeforeunload((ev) => {\r\n        if (props.hasUnsavedChanges) {\r\n            ev.preventDefault();\r\n        }\r\n    });\r\n\r\n    const classes = useStyles();\r\n\r\n    const getMainContent = () => {\r\n        switch (props.currentStep) {\r\n            case FlowStepId.SDF_1:\r\n                return <SdfStep1 />\r\n            case FlowStepId.SDF_2:\r\n                return <SdfStep2 />\r\n            case FlowStepId.SDF_3:\r\n                return <SdfStep3 />\r\n            case FlowStepId.SDF_4:\r\n                return <SdfStep4 />\r\n            case FlowStepId.OHI_2:\r\n                return <MishapVictimIdentification />;\r\n            case FlowStepId.OHI_3:\r\n                return <HazardPopulation />;\r\n            case FlowStepId.OCH_1:\r\n                return <OchStep1 />;\r\n            case FlowStepId.OCH_2:\r\n                return <OchStep2 />\r\n            default:\r\n                throw new Error(`Unknown step id ${props.currentStep}`);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <ErrorBoundary>\r\n            <CssBaseline />\r\n            <ConfirmationDialog />\r\n\r\n            <div className={classes.root}>\r\n                <AppBar\r\n                    position=\"fixed\"\r\n                    className={classes.appBar}\r\n                >\r\n                    <Toolbar variant=\"dense\">\r\n                        <Grid container justify=\"space-evenly\">\r\n                            <Grid item xs>\r\n                                <Meny />\r\n                            </Grid>\r\n                            <Grid item xs={6} className={classes.appTitle}>\r\n                                <ProjectName />\r\n                            </Grid>\r\n                            <Grid item xs>\r\n                                &nbsp;\r\n                            </Grid>\r\n                        </Grid>\r\n                    </Toolbar>\r\n                </AppBar>\r\n\r\n                <Drawer\r\n                    variant=\"permanent\"\r\n                    className={classes.drawerOpen}\r\n                    classes={{\r\n                        paper: classes.drawerOpen\r\n                    }}\r\n                >\r\n                    <div className={classes.toolbar}></div>\r\n\r\n                    <ProgressSteps />\r\n                </Drawer>\r\n\r\n                <main className={classes.content}>\r\n                    <div className={classes.toolbar} />\r\n                    {getMainContent()}\r\n                </main>\r\n            </div>\r\n        </ErrorBoundary>\r\n    );\r\n}\r\n\r\nexport default connector(App);\r\n","import Hazard, { isRelatorInHazard, isRoleInHazard, isKindInHazard, getIsSystemObjectInHazard } from '../../../entities/hazard-population/hazard';\r\nimport { SystemModelActionTypes, CREATE_HAZARD, UPDATE_HAZARD, DELETE_HAZARD, RENAME_SYSTEM_OBJECT, DELETE_CONNECTION, DELETE_SYSTEM_OBJECT } from '../types';\r\nimport SystemObject from '../../../entities/system-description/system-object';\r\nimport { ObjectTypes } from '../../../entities/system-description/object-types';\r\n\r\nexport function hazardsReducer(state: Hazard[], action: SystemModelActionTypes): Hazard[] {\r\n    switch (action.type) {\r\n        case CREATE_HAZARD:\r\n            return state.concat(action.payload);\r\n        case UPDATE_HAZARD:\r\n            return state.map(e => e.id === action.payload.id ? action.payload : e);\r\n        case DELETE_HAZARD:\r\n            return state.filter(e => e.id !== action.payload.id);\r\n        case RENAME_SYSTEM_OBJECT:\r\n            const transform = getHazardTransform(action.payload);\r\n            return state.map(transform);\r\n        case DELETE_CONNECTION:\r\n            const isTargetInHazard = getIsSystemObjectInHazard(action.payload.target);\r\n            // both connection's source and destination are always part of the same hazard.\r\n            // so no sense to check them both, checking either of them\r\n            return state.filter(e => !isTargetInHazard(e));\r\n        case DELETE_SYSTEM_OBJECT:\r\n            const isObjectInHazard = getIsSystemObjectInHazard(action.payload);\r\n            return state.filter(e => !isObjectInHazard(e));\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\nfunction getHazardTransform(entity: SystemObject) {\r\n    switch (entity.type) {\r\n        case ObjectTypes.relator:\r\n            return (hazard: Hazard) => {\r\n                if (!isRelatorInHazard(entity, hazard)) {\r\n                    return hazard;\r\n                }\r\n                return {\r\n                    ...hazard,\r\n                    ...{ exposure: { id: entity.id, name: entity.name } }\r\n                };\r\n            };\r\n        case ObjectTypes.role:\r\n            return (hazard: Hazard) => {\r\n                if (!isRoleInHazard(entity, hazard)) {\r\n                    return hazard;\r\n                }\r\n                return {\r\n                    ...hazard,\r\n                    ...{\r\n                        mishapVictim: hazard.mishapVictim.id === entity.id ?\r\n                            { id: entity.id, name: entity.name } : hazard.mishapVictim,\r\n                        hazardElement: hazard.hazardElement.id === entity.id ?\r\n                            { id: entity.id, name: entity.name } : hazard.hazardElement,\r\n                    }\r\n                };\r\n            };\r\n        case ObjectTypes.kind:\r\n            return (hazard: Hazard) => {\r\n                if (!isKindInHazard(entity, hazard)) {\r\n                    return hazard;\r\n                }\r\n                return {\r\n                    ...hazard,\r\n                    ...{\r\n                        mishapVictimEnvObj: hazard.mishapVictimEnvObj.id === entity.id ?\r\n                            { id: entity.id, name: entity.name } : hazard.mishapVictimEnvObj,\r\n                        hazardElementEnvObj: hazard.hazardElementEnvObj.id === entity.id ?\r\n                            { id: entity.id, name: entity.name } : hazard.hazardElementEnvObj,\r\n                    }\r\n                };\r\n            };\r\n    }\r\n}\r\n","import { SystemModelActionTypes, CREATE_HAZARD } from '../types';\r\n\r\nexport function nextHazardIdReducer(state: number, action: SystemModelActionTypes): number {\r\n    if (action.type === CREATE_HAZARD) {\r\n        return state + 1;\r\n    }\r\n    return state;\r\n}\r\n","import { SystemModelActionTypes, CREATE_SUBSYSTEM, UPDATE_SUBSYSTEM, DELETE_SUBSYSTEM } from '../types';\r\nimport Subsystem from '../../../entities/system-description/subsystem';\r\n\r\nexport function subsystemReducer(state: Subsystem[], action: SystemModelActionTypes): Subsystem[] {\r\n    switch (action.type) {\r\n        case CREATE_SUBSYSTEM:\r\n            return state.concat(action.payload);\r\n        case UPDATE_SUBSYSTEM:\r\n            return state.map(e => e.id === action.payload.id ? action.payload : e);\r\n        case DELETE_SUBSYSTEM:\r\n            return state.filter(e => e.id !== action.payload.id);\r\n        default:\r\n            return state\r\n    }\r\n}\r\n","import { SystemModelActionTypes, CREATE_CONNECTION, DELETE_CONNECTION, DELETE_SYSTEM_OBJECT } from '../types';\r\nimport Connection from '../../../entities/system-description/connection';\r\n\r\nexport function connectionReducer(state: Connection[], action: SystemModelActionTypes): Connection[] {\r\n    switch (action.type) {\r\n        case CREATE_CONNECTION:\r\n            return state.concat(action.payload);\r\n        case DELETE_CONNECTION:\r\n            return state.filter(e => e.id !== action.payload.connection.id);\r\n        case DELETE_SYSTEM_OBJECT:\r\n            const objectId = action.payload.id;\r\n            return state.filter(e => e.source !== objectId && e.target !== objectId);\r\n        default:\r\n            return state\r\n    }\r\n}\r\n","import { SystemModelActionTypes, CREATE_SYSTEM_OBJECT, UPDATE_SYSTEM_OBJECT, DELETE_SYSTEM_OBJECT } from '../types';\r\nimport SystemObject from '../../../entities/system-description/system-object';\r\nimport { ObjectTypes } from '../../../entities/system-description/object-types';\r\n\r\nexport function systemObjectReducer(\r\n    state: SystemObject[],\r\n    action: SystemModelActionTypes,\r\n    objectType: ObjectTypes\r\n): SystemObject[] {\r\n    switch (action.type) {\r\n        case CREATE_SYSTEM_OBJECT:\r\n            if (action.payload.type !== objectType) {\r\n                return state;\r\n            }\r\n            return state.concat(action.payload);\r\n        case UPDATE_SYSTEM_OBJECT:\r\n            if (action.payload.type !== objectType) {\r\n                return state;\r\n            }\r\n            return state.map(e => e.id === action.payload.id ? action.payload : e);\r\n        case DELETE_SYSTEM_OBJECT:\r\n            if (action.payload.type !== objectType) {\r\n                return state;\r\n            }\r\n            return state.filter(e => e.id !== action.payload.id);\r\n        default:\r\n            return state\r\n    }\r\n}\r\n","import SystemObject from '../../../entities/system-description/system-object';\r\nimport { SystemModelActionTypes } from '../types';\r\nimport { systemObjectReducer } from './system-object-reducer';\r\nimport { ObjectTypes } from '../../../entities/system-description/object-types';\r\n\r\nexport function kindsReducer(state: SystemObject[], action: SystemModelActionTypes): SystemObject[] {\r\n    return systemObjectReducer(state, action, ObjectTypes.kind);\r\n}\r\n","import { SystemModelActionTypes, ADD_POSSIBLE_HARM, REMOVE_POSSIBLE_HARM } from '../types';\r\nimport { systemObjectReducer } from './system-object-reducer';\r\nimport { ObjectTypes } from '../../../entities/system-description/object-types';\r\nimport Role from '../../../entities/system-description/role';\r\n\r\nexport function rolesReducer(state: Role[], action: SystemModelActionTypes): Role[] {\r\n    switch (action.type) {\r\n        case ADD_POSSIBLE_HARM:\r\n            return state.map(e => {\r\n                if (e.id === action.payload.mishapVictim.id) {\r\n                    const possibleHarms = e.possibleHarms.concat(action.payload.harm);\r\n                    return { ...e, ...{ possibleHarms } }\r\n                }\r\n                return e\r\n            });\r\n        case REMOVE_POSSIBLE_HARM:\r\n            return state.map(e => {\r\n                if (e.id === action.payload.mishapVictim.id) {\r\n                    const possibleHarms = e.possibleHarms.filter(h => h !== action.payload.harm);\r\n                    return { ...e, ...{ possibleHarms } }\r\n                }\r\n                return e\r\n            });\r\n        default:\r\n            return systemObjectReducer(state, action, ObjectTypes.role) as Role[];\r\n    }\r\n}\r\n","import SystemObject from '../../../entities/system-description/system-object';\r\nimport { SystemModelActionTypes } from '../types';\r\nimport { systemObjectReducer } from './system-object-reducer';\r\nimport { ObjectTypes } from '../../../entities/system-description/object-types';\r\n\r\nexport function relatorsReducer(state: SystemObject[], action: SystemModelActionTypes): SystemObject[] {\r\n    return systemObjectReducer(state, action, ObjectTypes.relator);\r\n}\r\n","import { SystemModel } from '../../entities/system-model'\r\nimport { getFirstStepId, getFlowStepOrder } from '../../entities/meny/flow'\r\nimport { SystemModelActionTypes, LOAD_MODEL, RESET_MODEL, UPDATE_FLOW_STEP, UPDATE_PROJECT_NAME } from './types'\r\nimport { hazardsReducer } from './reducers/hazards-reducer'\r\nimport { nextHazardIdReducer } from './reducers/next-hazard-id-reducer'\r\nimport { subsystemReducer } from './reducers/subsystems-reducer'\r\nimport { connectionReducer } from './reducers/connections-reducer'\r\nimport { kindsReducer } from './reducers/kinds-reducer'\r\nimport { rolesReducer } from './reducers/roles-reducer'\r\nimport { relatorsReducer } from './reducers/relators-reducer'\r\n\r\nconst initialState: SystemModel = {\r\n    projectName: 'Hazard Ontology',\r\n    currentStep: getFirstStepId(),\r\n    lastCompletedStep: getFirstStepId(),\r\n    kinds: [],\r\n    roles: [],\r\n    relators: [],\r\n    systemObjectConnections: [],\r\n    subsystems: [],\r\n    hazards: [],\r\n    nextHazardId: 1\r\n}\r\n\r\nexport function systemModelReducer(state = initialState, action: SystemModelActionTypes): SystemModel {\r\n    switch (action.type) {\r\n        case LOAD_MODEL:\r\n            return action.payload;\r\n        case RESET_MODEL:\r\n            return initialState;\r\n        case UPDATE_FLOW_STEP:\r\n            const step = action.payload;\r\n            const stepOrder = getFlowStepOrder(step);\r\n            if (stepOrder === getFlowStepOrder(state.currentStep)) {\r\n                return state;\r\n            }\r\n            if (stepOrder > getFlowStepOrder(state.lastCompletedStep)) {\r\n                return { ...state, ...{ currentStep: step, lastCompletedStep: step } };\r\n            }\r\n            return { ...state, ...{ currentStep: step } };\r\n        case UPDATE_PROJECT_NAME:\r\n            return { ...state, ...{ projectName: action.payload } };\r\n        default:\r\n            return {\r\n                ...state,\r\n                ...{\r\n                    hazards: hazardsReducer(state.hazards, action),\r\n                    nextHazardId: nextHazardIdReducer(state.nextHazardId, action),\r\n                    subsystems: subsystemReducer(state.subsystems, action),\r\n                    systemObjectConnections: connectionReducer(state.systemObjectConnections, action),\r\n                    kinds: kindsReducer(state.kinds, action),\r\n                    roles: rolesReducer(state.roles, action),\r\n                    relators: relatorsReducer(state.relators, action)\r\n                }\r\n            }\r\n    }\r\n}\r\n","import DialogConfirmation from \"../../entities/dialog-confirmation\";\r\nimport { ModalDialogActionTypes, SHOW_CONFIRMATION_DIALOG, HIDE_CONFIRMATION_DIALOG } from \"./types\";\r\n\r\nconst initialState = {\r\n    contentText: '',\r\n    onYes: () => { }\r\n};\r\n\r\nexport function modalDialogReducer(state = initialState, action: ModalDialogActionTypes): DialogConfirmation {\r\n    switch (action.type) {\r\n        case SHOW_CONFIRMATION_DIALOG:\r\n            return action.payload;\r\n        case HIDE_CONFIRMATION_DIALOG:\r\n            return initialState;\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n","import { combineReducers } from 'redux'\r\nimport { systemModelReducer } from './system-model/system-model-reducer'\r\nimport { unsavedChangesReducer } from './unsaved-changes/reducers'\r\nimport { modalDialogReducer } from './modal-dialog/reducers'\r\n\r\nexport const rootReducer = combineReducers({\r\n    systemModel: systemModelReducer,\r\n    unsavedChanges: unsavedChangesReducer,\r\n    modalDialog: modalDialogReducer\r\n})\r\n\r\nexport type RootState = ReturnType<typeof rootReducer>\r\n","import { SystemModelActionTypes, RESET_MODEL, LOAD_MODEL } from '../system-model/types';\r\nimport { UnsavedChangesActionType, SAVE_CHANGES } from './types';\r\n\r\nexport function unsavedChangesReducer(\r\n    state = false,\r\n    action: SystemModelActionTypes | UnsavedChangesActionType\r\n): boolean {\r\n    if ('unsavedChanges' in action) {\r\n        return action.unsavedChanges;\r\n    }\r\n    switch (action.type) {\r\n        case RESET_MODEL:\r\n        case LOAD_MODEL:\r\n        case SAVE_CHANGES:\r\n            return false;\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n","import { createMuiTheme } from '@material-ui/core/styles';\r\n\r\nconst appZIndex = {\r\n    graph: 10,\r\n    nodeAction: 20,\r\n    graphHelp: 30,\r\n    graphAction: 40\r\n};\r\n\r\nconst defaultTheme = createMuiTheme();\r\n\r\nconst appSpacing = {\r\n    standard: defaultTheme.spacing(2),\r\n    drawerWidth: 240\r\n};\r\n\r\nconst appTheme = createMuiTheme({\r\n    zIndex: appZIndex,\r\n    appSpacing\r\n});\r\n\r\nexport default appTheme;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\nimport { createStore } from 'redux';\r\nimport { Provider } from 'react-redux';\r\nimport { rootReducer } from './store';\r\nimport { ThemeProvider } from '@material-ui/core';\r\nimport appTheme from './styles/app-theme';\r\n\r\nconst store = createStore(rootReducer);\r\n\r\nReactDOM.render(\r\n    <Provider store={store}>\r\n        <ThemeProvider theme={appTheme}>\r\n            <App />\r\n        </ThemeProvider>\r\n    </Provider>,\r\n    document.getElementById('root'));\r\n"],"sourceRoot":""}